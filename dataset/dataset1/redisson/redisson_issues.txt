1
Implement RedissonSortedSet

Implement with binary insertion algorithm


2
SCAN or ZRANGE operations as Java Iterators?

Just an idea, would this be possible? Still new to Redis / Redisson.


3
Rework connection management to use master/slave redis instances

No description provided.


4
Add support for TIME command.

It would be great to see TIME supported.
See also #19 in lettuce.


5
Promises vs Futures?

Hi there!
As I understand, Future returned by RedisAsyncConnection moves API user back to the blocking world. Java futures are NOT non-blocking by nature, they have blocking get(). Thus API user needs to spawn new threads and say hello to threading overhead again. Then why Netty is used?
I propose to return promises (Java's 8 CompletableFuture, Guava's ListenableFuture or jdeferred's promises).
Thanks,
Denis


7
Is all methods of  collections redisson provide synchronized?

No description provided.


8
Setting expiry

Hi
I could not find a way to set expiry for the contents of the cache from within Java. Is this true, or did I miss something?
Thank you
Jozsef


9
WRITE_BIGDECIMAL_AS_PLAIN Error

I just imported redisson 1.0.3 via maven, set up a redis-server on localhost on default port and wanted to try the redisson redis client. My test code looks as following:

But I'm getting an Error:
java.lang.NoSuchFieldError:
Am I doing something wrong or is this a dependency problem?


11
this "synchronized " protect what?

in RedisClient.java
this "synchronized " protect what?


12
load balancer does not work as expected

I have test code for the load balance, but only the first instance got the load:
Do I miss any thing?


13
Provide access to the underlying connection manager

It would be nice if the Redisson class exposed its connection manager.  The use case is to access low level redis commands using the same pool of connections as the high-level redisson abstractions.  Currently its protected and private which means I have to resort to ugly hacks to get to it.


14
Eval method does not work in RedisAsyncConnection

The eval method does not seem to work for me.  I traced the cause to this line in theRedisAsyncConnection:eval() method:
It should instead be:
In its current form, the script is escaped with double quotes and cannot be interpreted by redis.


15
Add Kryo Encoder

See GIST: https


16
URGENT: java.lang.NoSuchFieldError: WRITE_BIGDECIMAL_AS_PLAIN

I do not have Jackson and do not want to use it. Sadly, the Config class has a hard pointer on it:

Thus when creating a new Config instance I have the exception:
Caused by: java.lang.NoSuchFieldError:
Codecs should be made optional or at least the default should be the Serializer codec which only depends on the JDK, or a simple String <=> String codec.
For now I cannot use Redisson properly :-(


17
Publish message method should be moved out from RTopic

Pub a message doesn't require a pubsub connection, however get a RTopic does. There are many cases just want to publish a message, get a RTopic from Redisson will automatically subscribe on the channel, which is unnecessary and there is no safe way to close topic after publish message since there may be some listeners are actually interested in the topic.
BTW, RedisConnection has a method  publish(K channel, V message)
Unfortunelty the underlying connection manager is not exposed, see 13
Provide access to the underlying connection manager


18
Support for HLL · 18

It would be really nice if you can add support for PFADD | PFCOUNT | PFMERGE commands in Redisson.


19
Android Support

Hi,
I want to use this inside Android, is it supported?
Thanks


20
Question: Why do you have imported lettuce code into your project?

Hi,
why do you have imported lettuce code into your project instead of referencing it via artifact?
The approach your library works is quite cool providing collections. It's just somehow annoying having no access to the underlying RedisClient. Redisson.create(RedisClient client) or even redisson.getList(RedisClient client, String name) etc. would be a way opener approach. The current way, it's Redisson who manages all the Redis stuff for you. I see Redisson as a sort of valueable add-on.


21
ConnectionWatchdog not works as expected.

Hi Nikita, when I ran some load test, ConnectionWatchdog did not restore PubsubConnection correctly (my env is redis 2.8.3, java 1.7.0_45,Netty 4.0.19 final, OSX 10.9.2). After some digging, I found a couple of problems,

When ChannelInitilizor ChannelInitializer.initChannel is called,           pipeLine.get(CommandHandler.class) and pipeLine.get(RedisAsyncConnection.class) return null, I guess the old ChannelPipeline had been destroyed.
The connection retry and backoff doesn’t seem right, the connection attempt seems only fired when the channel is inactive, if re-connect did not work, no further attempt will be fired.
RedissonTopic.promise.get().setSuccess(true) will throw IllegalStateException: complete already when PubsubConnection is re established.
4)Though this is not a bug, it seems unnecessary to use a dedicated HashedTimeWheel to schedule reconnection task.

I will push a patch later.


23
Make ConnectionManager accessible from Redisson

Hi,
When we create a Redisson object, I would also need to execute some Redis commands.
What is the best way ? Do I need to create another ConnectionManager completely separate from the one in the Redisson class, or it would be better to access the one created on the Redisson object, so that we can re-use it ?
Thanks!


24
Support For Master Detection?

Does reddison support the ability to add both a master and slave addresses and only write to the master?


26
Thread-safety questions - access to Thread-safe connection.

In RBucket we have:

get connection
do something
return back to pool

Before using this, I was simply getting a RedisConnection from the connection manager like this:

The RedisConnection class javadoc states that the connection is thread-safe. So I was keeping a singleton reference over one connection to issue some simple commands like get, set, del, ... from several threads.
Questions:

Is a RedisConnection class is intended to be used this way (multiple threads doing get/set/del ops) ?
If yes, would it be possible to expose this behavior so that users could get from Redisson a connection (with auto-reconnect) ? This connection could be kept as a singleton ref during the entire lifetime of the server and not be returned back to the pool, because this connection will be used often (i.e. session management). This will avoid the burden of the get from pool / return to pool code.

Thanks!


27
Question: Does redisson handle redis clusters?

Redisson clusters may return a 'MOVED' if a key is on another shard, does redisson handle that?


28
Sorted set scores collapsed to zeros

After running for a week or two, the scores collapsed to zeros or nead zero (10^-300) and we encountered an infinite loop in redisson when adding (it couldnt settle on a score). So we will manage the score ourselves.


29
Auth Issue Only On Read

I just added requirepass and masterauth to my configuration for 3 slaves and a master. Using 1.5 I am able to write just fine, but when I tried Map::get I get a RedisException: "NOAUTH Authentication required."
I've tried just using a single connection to the master, a 'useMasterSlaveConnection' with only 'setMasterAddress', and a 'useMasterSlaveConnection' with all hosts configured.
When I connect with a tool like Redis Desktop Manager I am able to view the updated values just fine.


30
Detecting any the elected master changes (using redis sentinels)....

No description provided.


31
Add removeAsync, addAsync methods to RSortedSet and RSet

No description provided.


32
NPE On RedissonTopic.publish & RedisPubSubConnection.channelRead

Same client code worked with 1.4 but not 1.5


33
Warning in Redisson 1.1.0 - NullPointerException (An exceptionCaught() event was fired)




34
getBucket().get() returns null on Redisson 1.1.0

redis monitor shows the setex followed by the get
code returns null.


35
Several question about Redisson/Jedis

Note: I don't really know if there is a better place to ask for these sorts of questions... ;-)
Besides all the cool features added to Redisson to use locks, queues, maps, etc... How does Redisson performs compared to Jedis in terms of:

memory usage
speed
number of concurrent connections supported
use in multi-threading app requiring in both case using a pool
thread-safety
etc...

For having used both, I strongly prefer the api of Redisson (using publish subscribe in a reliable way with Jedis is a pain, and also there is no codec). But I am wondering, since their implementation only rely on simple sockets and a pool, how it compares to Redisson, which is based on Netty.
Also concerning thread-safety, having already aked a question about it, and in both libraries a connection pool is used for each operation and it is better to do so. So does thread-safety on a connection level really used ?
Thanks!


36
Wrong password error if auth fails

No description provided.


37
Cluster support

No description provided.


39
Locking on Jersey

I'm trying to use Lock and Unlock on Jersey Resource.
User makes a POST request
System LOCK "A"
System does some stuff
System UNLOCK "A"
User makes another POST request
System LOCK "A"
System does some stuff
System UNLOCK "A"

The system crashes at point 6 (view attachment).
If i try to make some LOCK-UNLOCK in a while loop it works, but when i make these LOCK-UNLOCK from different Threads it does not works.


40
Lock TTL

Any plan to add TTL to a Lock operation? Don't confuse with tryLock with TIME.
I refer to a situation where a thread is dead and leave a resource locked (deadlock).


41
Two serious issues

1.Sentinel not support auth password.(I have solve this problem)
2.When redis sentinel occur failover,redisson can not failover to new master automatic.


42
Batch/Pipeline operations support

Operates with async methods only. Code example:


43
Transactions support

No description provided.


44
Add RMap.fastPut method

No description provided.


45
Implement operation auto-retry

No description provided.


46
Add RMap.fastRemove method

No description provided.


47
Use interfaces to easy DI and Unit testing

[]


49
Get Object From Distributed Map, Command timed out

Using Distributed Map, put obj is ok, when get some obj by key, an exception will occur:
the exception will not occur when get naive java obj (String, int, ...)


50
Implement RLock.newCondition

No description provided.


51
1.3

No description provided.


52
Exceptions handling during deserialization

No description provided.


53
Local cache for Redission

Does redisson support local cache?

For some usage scenario, local read is very heavy, local write is not much, and the delay of data synchronization can be tolerated in seconds. Some configurable cache mechanism could be helpful.


54
Add RMap.getAll(Set<K> keys)

Use hmget


55
Add RMap.filterKeys

No description provided.


56
Add RMap.filterValues

No description provided.


57
Add RMap.filterEntries

No description provided.


58
Sentinel event listeners

ability to register event listeners for sentinel server events


59
Timeout and database

I don't see any way to configure a timeout or select a database. Am I missing something?


60
RedissonList

RedissonList.subList() doesn't conform to the specifications of java.util.List, which states that subList() returns a view backed by the current list.
On a related note, it would be nice to also have access to some of the buffered collections in addition to the redisson wrapper collections. If you're expecting to read all or most of a list, it would be wasteful to have to call RedissonList.get() for each element, resulting in another redis query each time. (Currently you can get a buffered list by calling subList(), but that's a workaround unique to the list collection, and it shouldn't really work that way - as mentioned above.)


61
Why RTopic.removeListener unsubscribes underlying PubSub channel

I ran into an issue in which I found if I remove a listener from an RTopic, it will unsubscribe the entire channel, which will kill the connection for all listeners and RTopic subscribed to the same channel. Following is the code in question.
I am not quite sure whether I am using Redisson RTopic in the right way. Would you please help me to understand what’s the reason to unsubscribe the channel when removing one listener? And if I need to have multiple listeners subscribed on the same channel and the list of listeners will change dynamically (since it’s used on the application server to propagate changes to clients), what’s the right way to use RTopic?
Your help will be greatly appreciated.


62
Netty NPE

Hey folks, I'm seeing this error on redisson 1.1.5 and it seems completely sporadic


65
Failover in Redisson with Redis Cluster

I have created a cluster with 3 master and 3 slave.
port 7000 seems to be myself,master.
If 7000 goes down I get a connection refused exception with Redisson. Ideally it should shift to its slave.
I am copying the exception here
Is it a known issue?


66
Key exists

Is there a way to distinguish between empty and non-existent collections? (Or some way to invoke the EXISTS command?)


67
RedissonList concurrency problem

How is it ever safe to rely on RedissonList.size() when each invocation can technically return a different value? This would mean that calling subList(0, size()), or even two consecutive calls to hasNext() on the iterator (which is normally what happens) can potentially cause an exception.


69
"Connection Leak" in RedissonBucket

Hi guys!
When I get some error, eg: redis servers down, in getAsync and setAsync the connection is not released, once the release is done in a Promise listener, that never executes, can you check this please?
Regards,
Marcio


70
Keys adding quotes when going to data store

I was working with redisson adding data to the data store.  I was having issues, so I went to the command line to check what was in the data store and couldn't find my structures (although the program seemed to find them OK).  So I listed the keys and got this:
then from the cli, I entered "set foo bar" and listed the keys again and got this:
it seems that redisson is surrounding the key names with quotes before storing them.


71
Constructors for RBucket, RList, etc should be protected, not default.

Use Case:
1)Extending the Redisson data types as part of a data abstraction layer.


72
StackOverflowError

Invocation of init method failed; nested exception is java.lang.StackOverflowError


73
Lua Script Evaluation Support

Hey, I was wondering if there is any way to execute a LUA script in redisson. I can do it through the connection manager, using something like this:
But obviously that's not the cleanest solution. Would it be possible to add a public evalScript() method, or something of the sort to the Redisson class? Thanks!


74
BSON support for compress

No description provided.


75
Guava RateLimiter Redisson implementation.

No description provided.


76
Add wildcard pubsub support (psubscribe/punsubscribe)

The RedisPubSubConnection class already had a psubscribe and punsubscribe methods for dispatching commands to Redis, but they are not hooked up to anything
The RTopic interface should get a new addPListener and removePListener and all the underlying changes necessary to propagate down to RedisPubSubConnection


78
it reached at the tail of the pipelin




79
Redisson keys should be objects

Since RedissonCodec supports any type of serialized key, RedissonObject.name should be of type Object so that we can invoke Redisson.getList(someSerializableObject) etc.


80
Error while deserializing arrays with JsonJacksonCodec

I'm getting the following exception when deserializing some array types with JsonJacksonCodec:
To reproduce:


81
Allow separate Master/Slave password configuration

No description provided.


83
Deadlock while obtaining lock

Thread gets stuck while obtaining lock. Running 'keys L*' in redis-cli returns an empty list.
The same lock name was likely concurrently obtained and held by another thread possibly on another jvm, and then released.
Redisson version used: 1.1.5


84
Lock reentrancy race

At line A the lock key is set only if it doesn't exist (NX), but on line B it's set assuming it still exists. If the lock timeouts between A and B, another process may obtain the lock, which is then overwritten at B.
Here's a test case:
This will reliably fail if:
run in debug mode with a breakpoint placed in RedissonLock.tryLockInner(long, TimeUnit) on line B (line 306 for 508b903).
the breakpoint is released after waiting at least half a second
The same problem is also present in the no-args method RedissonLock.tryLockInner(). (though a race condition is possible only if upgrading an expiring lock)
I wonder if reentrancy support shouldn't be done purely in java.


85
Topic subscription: not re-subscribing after slave down or master change

Hi,
Redis: 2.8.14
Redisson: 1.1.5
Environment: 1 master & 2 slaves on separate hosts (each running Redis & Redis Sentinel)
Redisson connection: SentinelServersConfig (with 3 sentinels configured)
We subscribe to a number of topics from all our clients talking to Redis via SentinelServersConfig. If there is a Redis failover/down event, the topics aren't properly re-subscribed to and messaging stops. Unsubscription is called, but re-subcription isn't.
For a:
slave down (re-subscription never works)
sentinel initiated failover (re-subscription eventually always fails, but could work once or twice)


86
How do I register a Module on the Jackson ObjectMapper instance Redisson is using under the covers so it can handle Java8 time types?

We are using Java8 java.time.Instant as the type in our objects, and running into this problem:
com.fasterxml.jackson.databind.JsonMappingException: No suitable constructor found for type [simple type, class java.time.Instant]: can not instantiate from JSON object (need to add/enable type information?)
And according to the Jaxson question I asked here: FasterXML/jackson-docs#3 I need to register a Module on the ObjectMapper instance that Redisson is using. How do I do that?


87
Unhandled IllegalStateException in RedissonLock.

I make heavy use of RLock in my app, and from time to time I find this in my logs.


89
RedissonLock locks up

Under heavy use on production, Redisson's locks get all locked up, and the application stalls. I'm using Redisson 1.1.5
I have 1 thread locked trying to release a lock:
Also of note, I have about 30 other threads locked awaiting for a lock (a different one from the one used by the previous thread).
I checked the threads with jstack, here is the relevant output:
I checked Redis's state:
this key is the one corresponding to the thread blocked trying to release a lock. The other threads, that are waiting for a separate lock are locked even though there is no-one taking up such lock....


90
Infinite loop on connection failure

I'm using Redisson in Master/Slave configuration, and I'm running into an endless loop when using a bad address. BaseLoadBalancer.nextConnection() get called, catches the RedisConnectionException, then loops until clientsCopy is empty, then enters nextConnection() again, resulting in an infinite recursive loop.


91
list name has extra Quotation marks

when I put a list named monitor_list into redis through redisson, It come up like "monitor_list" . The key in redis has extra Quotation marks. Please check it out.


96
README.md not up to date

Kudos on the new release! I'm already deploying it to production. Unfortunately, README.md is now outdated (no changelog, the version for Maven users is still 1.1.5, so on). It could be misleading for new users.


98
use treeMap putall Rmap throw nullpoitn

when throw this exception ..i found the rmap and other reference is error but not null???!!!


101
when thread is interrupt...all Reference variables is locked!!

the redisson is locked!
all Reference variables is locked!!


102
SAdd in RedisAsyncConnection uses wrong AddValues

line 629 uses addMapValues for sadd rather than addValues
This causes JsonJacksonCodec to fail on Longs stored with the mapObjectMapper to fail to be deparsed by objectMapper;
Change line 629
Test code follows :


103
How can I get all the keys in Redisson?

I need to delete all the keys in the database. How do I do this in Redisson? I can't figure out a way to get the RedisConnection handle from my Redisson object so I can call the flushdb() call.


104
RedissonAtomicLong expiring during get causes NullPointerException.

This happens on RedissonAtomicLong , line 101 " return res.longValue(); " as the Number res is null after async.
Theres the dirty fix of wrapping with something akin to
Also likely occurs in other methods.
Heres the unit test if you're interested:


105
use rmap class not have default consturctor throw exception.

use rmap class not have default consturctor throw exception , and the network is broken


106
RedissonList's Iterator Race Conditions.

RedissonList iterator as it tries to keep "up to date" with data has a race condition in which if between the .hasNext() and the .next() call the set is emptied the list will throw NoSuchElementException.
Unit Test
Additional Information
This also effects RedissonSet, but much less likely to hit the race condition. It causes RedissonSet line 96 to throw a null pointer exception.
This is akin to issue #104


107
How to config read data from slave servers?

No description provided.


108
Config a specific slave for read operation

Assume that I have 3 zones z1, z2, and z3. Also I setup master node at z1, slave node 01 at z2, and slave node 02 at z3. I want to config like this:

Read operation from z1 is redirected to master node
Read operation  from z2 is redirected to slave node 01
Read operation  from z3 is redirected to slave node 02

I want to achieve this because there is long distance between different zones. I think read from a slave in another zone is not a good idea. Of course failover need to be achieved also.


109
Can't get Redisson 1.1.7 to work in an OSGi container

Apologies if this is not the right forum to raise this bug.
I have  been trying to deploy redisson to an OSGi container however I can't get v1.1.7 to work even though it's one of Radissons features. Here are some details of what I have so far found.
Redisson has a "provided" scoped maven dependency on kryo (com.esotericsoftware.kryo:kryo:2.24.0), but the OSGi manifest imports com.esotericsoftware.kryo,version=[2.24,3)
This means that the radisson OSGi bundle won't start up as it depends on kryo 2.24.*  Unfortunately due to an OSGi issue in Kryo (EsotericSoftware/kryo#189), there is no release of kryo after v2.24 that has the bug fixed (only v 3.0.0 which is too new according to the OSGi requirements of redisson - import com.esotericsoftware.kryo,version=[2.24,3)) . This means that Redisson 1.1.7 won't and can't work in an OSGi environment unless it is manually hacked.
Kryo v 3.0.0 has been released that contains the OSGi fixes thus Redisson should probably be modified to utilise kryo v 3.0.0 to fix the OSGi issues. Also the dependency should be changed to be a compile time dependency (rather than provided) if radisson has a hard runtime depdency on kryo.
If Kryo is not required at runtime (i.e. it's an optional dependency that can somehow be configured and sorry I haven't used radisson before so this is a newbie assumption) then the maven-bundle-plugin configuration could be changed to dynamically import kryo (see below) as and when it's needed. The upgrade to kryo v3.0.0 should still be considered.
Also note that kryo maven groupId has changed to com.esotericsoftware.
I hope you can help... thanks


112
could redisson provide integration with netty5 snapshot?

netty5 seems widely used and does many enhancement for last year. does any test or integration with redisson take into consideration or provide some small modification to make it compatible or provide some new branch for testing ? if any done it would be much appreciated.


113
weird null exception error

I was wondering if anyone else has seen this and what the cause would be(threading?)


114
LockInterruptibly

General Question
would calling lockInterruptibly(long leaseTime, TimeUnit unit) multiple times act like a watchdog reset? and reset the TTL


116
ClassCastException in RedissonCountDownLatch.trySetCount

Take a nice and clean redis server.
Execute the following code twice
At the second execution you get a ClassCastException
And the redis monitor output is
Running on Java 8


117
Does Redisson support BlockingQueue ?

I just read the documentation, but in the documentation there is no mention of BlockingQueue.
Does redisson support this ? I'm wondering because redis supports natively blocking operation on queues. Am I missing something ?


118
java.lang.ClassCastException  java.lang.Integer cannot be cast to org.redisson.RedissonLock$LockValue

when use lock,but throw some class cast exception,sample code :
error stack:


119
SingleConnectionManager doesn't respect timeouts

SingleConnectionManager ignores timeouts set by the configuration, defaults to MasterSlaveConnectionManager timeouts


120
When using Redisson.getMap("mapName").addAndGet() setting data, Redisson.getMap("mapName").get() call will be blocked.

When using Redisson.getMap("mapName").addAndGet() setting data, Redisson.getMap("mapName").get() call will be blocked.


121
IllegalArgumentException when hostname is the local loop back in IPv6 format "::1"

When the connection returns a master address that is the local loop back in IPv6 format, meaning "::1", it causes the following exception:
IPv6 addresses are permitted for the host component. An IPv6 address must be enclosed in square brackets ('[' and ']') as specified by RFC 2732.


122
ClusterConnectionManager sets nodesValues as null.

Hi,
Following the examples given in the docs, I've initialized my cluster servers as follows:
Now, I get a null pointer exception when I try to do Redisson.create using the above config. I've traced it down to the ClusterConnectionManager class, where the following is carried out:
String nodesValue = connection.clusterNodes().awaitUninterruptibly().getNow();
Nodes Value is always null, no matter which port i start redis server on (confirmed that it is running). I'd appreciate any guidance that you can give me as I'm stuck here and cannot proceed with my POC using Redisson otherwise.
BTW, this works perfectly:


123
Promise timeout (temporary) resource leak.

When a promise has been fulfilled the timeout task should be cancelled. Currently this is not the case and means that the (potentially very large) amounts of data included in the promise will remain on the heap until the timeout fires.
An example:
A request is made for a large (millions of entries) dataset.
The promise is returned and then fulfilled
The data is consumed and the promise goes out of scope
repeat
What should happen is that the garbage collector should clean up the promise since it is now out of scope but this can't happen since the timeout task still has a reference to it so it remains in memory for 60 secs (deadline) and very quickly you get OOM.
cc @group-papa @priyeshpatel


124
Connection timeout.

I am testing redisson library with the situation when redis server is down at some point.
The scenario is:
Redis server is up
My java app initialises the connection with redis server properly
Redis server goes down
Java app wants to read an example key from redis
After aprox 4 mins I have timeout exception which is completely fine:
My question is: How can I change the timeout? Waiting 4 minutes is definitely too long in my case.
I am using SingleServerConfig and what I tried is following (500ms) but this doesnt seem to work:


125
Implement getBuckets(String pattern)

To be able to get a list of buckets from a key pattern


127
KryoCodec: do not encode / decode keys

Have the smae behavior as Jackson codec, because encoding / decoding keys made them unable to be retreived by patterns such as api:sessions:*


129
Java Redisson on single server

I am trying to understan how redisson lib works with redis on my single server. I've downloaded redis, started it and can to the following:
Then I've installed in my javaee osgi application redisson and its libs. However, I can't understand how to get my "mykey". The connection I create this way:
Please, help me.


130
Redisson and multiple like inserts.

Lets suppose I have a list of some students - the current list has students with ids: 3,5,8. As I understand I don't need to use redis list here as I don't need to keep order. The order I don't need as it's clear it's just SOME of students. However I want to cache them.
I think I need to use here redis type string and do something like db:stundents:{id}. My question - how can I do multiple insert of these three stundents? To insert one I use Bucket.set().


131
Redisson sorted set creates list in redis server.

I do the following:
but when I do
./redis-cli
type test
it return "list". Why does redisson creates list and how can I do sorted set with scores using redisson?


132
Storing RBucket<Map<Integer,String>> returns RBucket<Map<String,String>>

I store HashMap<Integer,String> but after taking it from redisson I get HashMap<String,String> or HashMap<Object,Object>. Checking it via cli I get
How to fix it?


134
more than one decoder/encoder for redisson and auto Type detection.

auto detection support will be nice, json,xml,protocolbuffer,kyro


135
Autocomplete functions for redisson?



136
Addings string to set stores the string with quotes

Storing the string "myString" using myset.add("myString") ends up being stored as ""myString"" in redis.


137
Add ability to specify codec per RTopic

Being able to specify codec per pub/sub topic is helpful when you would like to re-use the same Redisson client for a variety of topics all with different serialization strategies.


138
How to check if Redis Server is available ?

Hi,
This may be a stupid question but we fail to find a quick way to check if the Redis server is up & running before trying anything on it.
is there any quick and simple way to check for the servers connection ?
Many thanks in advance,
Cheers!


140
Support for onSubscribe and onUnsubscribe events for PubSub

Is there a way to simulate that right now? MessageListener currently only supports event listening for message events. Users(like me) are also interested in reacting to subscribe and unsubscribe events.


141
How to rename a key in Redisson?

It seems that redisson is not providing access to low-level redis connector which makes issuing RENAME command on any key impossible, though sometimes it could be very handy.


142
Feature request

Ability to auto-unlock RLock's when the owning server is stopped, crashes, leaves the cluster, etc.


143
SortedSet needed

It's inconvenience  to use sorted set like this:
<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<

144
SortedSet.subSet() support

No description provided.


145
Connection errors handling breaks redis watch/multi/exec semantics

Let's look into org.redisson.RedissonMap#replace(K, V, V)
Good scenario:
watch -> ok
hexists -> ok
multi -> ok
hset -> queued
exec -> ok
Bad scenario:
watch -> ok
hexists -> ok
multi -> ok
hset -> operation timeout or other error handled by MasterSlaveConnectionManager#readAsync , retry on new connection, result ok
exec -> "exec without multi" failure
Impact: in bad scenario map content can be replaced with invalid value for key K


146
Long as Key in Hashs

I tried to use the library then I started running  the next code , the map has K-->String(JSON)
but unfortunately  when I checked the redis I found the key stored  in the hash as String by the next format
is there is any way to store the Key as Long to save space on my redis node


147
Use issues ----lock(long leaseTime, TimeUnit unit)

when i run the method
com.lambdaworks.redis.RedisException: ERR wrong number of arguments for 'set' command
How to solve this problem?


148
BRPOPLPUSH and RPOPLPUSH support

No description provided.


149
Get/Set strings

How do I get/set a simple string with Redisson?


151
Naming connection

Is there a way to name the Redis connection? I haven't see an option on the config object.


152
Old readme version

The readme's pom.xml extract refers to 1.2.0, but 1.2.1 is released. Is 1.2.1 not pushed to maven repository, or is the readme simply not updated?


153
[Question] What if I don't call Redission#shutdown()?

Hi,
I'm using this library together with Storm. Since the connection should essentially be alive during streaming to be able to read/write continuously, I don't want to call Redission#shutdown(). I wonder what would happen to the connection? What if a node that uses the connection fails in the middle of a stream?
Thank you.
Huy


154
Calling Publish On Topic in the Listener of Another Topic

I have an issue related to publish message on topic inside the subscribe listener on another topic. I am getting this exception io.netty.util.concurrent.BlockingOperationException: DefaultPromise@6c7a158e(incomplete).
The code


155
lock.lock(2, TimeUnit.SECONDS)

RLock lock = redisson.getLock("anyLock");
lock.lock(2, TimeUnit.SECONDS);
lock.unlock();
run it ,report error:


156
lock.lock(2, TimeUnit.SECONDS) report error ERR wrong number of arguments for 'set' command

RLock lock = redisson.getLock("anyLock");
lock.lock(2, TimeUnit.SECONDS);
lock.unlock();
run it ,report error:


157
How to set the RMap put timeout

Hello  I'm testing the redisson with Master/Slave module .
When redis memory is exhaustion the RMap.put will be wait.
There is no any Exception or someting.
Is anyway to fix this?


158
[Question] Using Redission how to achieve LRU?

(1) Using Redission how to achieve LRU?
(2) How to set expiry for one particular object of the Bucket or List or Set ?


159
No enum const class org.redisson.connection.ClusterNodeInfo$Flag.HANDSHAKE

redis version: redis-3.0.0
./src/redis-cli -c -p 7001 cluster nodes


160
suggest  StringCodec as default Codec

JsonJacksonCodec performance is not so Good  , suggest  StringCodec as default Codec .
JsonJacksonCodec VS StringCodec :
server 8core16G , one redis node , concurrent 200 ,total task 2000*1000,each task set 128byte to redis


161
NPE in RedissonExpirable

hi,
i keep seeing occasional null pointer exceptions in RedissonExpriable, line 37 (when i try to extend the lifetime of a bucket). i only see this in one environment, not on a second one and not on my local. i am assuming that i am having some connectivity issues there. could that be a cause? why is it an NPE?


162
[BUG]Thread dead lock when using distributed lock on 1.2.1

I run into a thread dead lock problem when using distributed lock on 1.2.1:
After a certain period, some threads will be dead lock, and we can tell this by VisualVM's thread dump:


163
Thread dead lock bug when using distributed lock on 1.2.1

I run into a thread dead lock problem when using distributed lock on 1.2.1:

There are ten threads call this function like this in a thread pool:
After a certain period, some threads will be dead lock, and we can tell this by VisualVM's thread dump:
I don't know why, is it a bug?


164
will redisson support ASKING when migrating slot?

No description provided.


165
RedisConnectionException when using Amazon ElastiCache

We encountered an issue when using Redisson to connect our application running on Ubuntu to Amazon ElastiCache for Redis.
When performing any operation Redisson throws a RedisConnectionException: Unable to connect xxxx.cache.amazonaws.com/10.xxx.xxx.xxx:6379. However, after installing the redis-tools package (using apt-get) the issue goes away and everything works correctly.
Does Redisson requires the redis-cli binary or the redis-tools package? Did anyone had a similar issue?


166
KryoCodec strange behaviour

Between client restarts, KyroCodec serialisation randomly fails with exception;
Prior to release this feature, did you run some regression tests for it? Also do you have any comment about the exception?
P.S: Content of the redis and the classes are same between restarts and I am simply applying Predicate upon RMap.
Edit: Between restarts, Kyro is sweeping the classes and give them uniqueIds in order to identify and serialise/deserialise them. I used to give Kyro exact list of classes in the exact order but with the auto discovery I think class loading order causes this issue right now.
IMHO, best solution would be to provide an interface for registering the Kyro classes to the underlying KyroCodec impl.


168
ClassCastException with StringCodec and RSet iterator

I've got a problem with iterating over a RSet, the following code throws a ClassCastException when using the StringCodec:
Stacktrace:
With a List everything works.


169
ConnectionManager call hangs forever if exception is thrown during Command processing

Bug found that can cause MasterSlaveConnectionManager to hang forever on get() call if exception is thrown anywhere in CommandHandler.
To replicate the bug, you can use RedissonMap with JsonJacksonCodec to put instance of class that doesn't have default constructor. When you try to fetch that object by using RedissonMap.get() call, deserialization of object will fail in MapOutput because of missing appropriate constructor and thread calling RedissonMap.get() will block forever.
In more details, this is happening because get() method awaits forever on Future object, which is released when Command.complete() is called. This complete() call is executed in decode() method of CommandHandler after RedisStateMachine processes Redis response. If, for example, RedisStateMachine throws an exception, complete() won't be called and result/exception will never be set to the Future object. This is causing calling thread to block forever in MasterSlaveConnectionManager.get() method.
Pull request with test case that is proving this bug and bug fix proposition will be published shortly.


171
Issue in locking on key in concurrency

In my project, I have a servlet, that call a utility class.
Utility class calls a wrapper class that  I have implemented over redisson lock.
Wrapper class holds RLock object for a thread and provides lock and unlock methods that call RLock's lock and unlock method
But while running a apache ab-test tool for concurrency, Following exception occurs.
Can you tell me if I am missing something over here?


172
Use Redis client to add a set , but in Redisson got a error

Redis 3.0.1
Redisson 1.2.0
I got a problem.
Firstly , in redis client , I put a set named "hello", the set numbers are "hello1"  and "hello2"
Second,in Redisson , I get this set.


173
Unix Sockets

Do you have a plan to develop  the client to be able to use  unix sockets instead of tcp.


174
Redisson and leap second

Hello,
I am using redis and redisson for my service deployed on Amazon server. Server has older kernel version that suffers from leap second bug. Will it affect redis or redisson lock in any manner? If so what is the possible solution to it?


175
Reddison tries to connect to a slave which is down

Redisson library version: 1.2.1
Hi,
We are using SentinelServersConfig and during the tests we observed that if a slave is down, and sentinel properly reports this by putting the s_down flag, Redisson still considers it at initialization and during the operation tries to connect to it.
This affects badly the performance, since RoundRobin tries periodically send though that slave.
WARN  o.r.c.RoundRobinLoadBalancer - Can't connect to /192.168.150.163:6379, trying next connection!
As I see, the SentinelConnectionManager constructor does not check for the "s_down" flag when initializes the list of available slaves, thus the Redisson snapshot of slave status does not reflects the status of slave servers.


178
org.redisson.RedissonLock.tryLockInner  throw  java.lang.NullPointerException

in RedissonLock.java Line 291, if Boolean res is null, the 291 line if(!res)  throw java.lang.NullPointerException.
java.lang.NullPointerException


180
expose async operation to List Queue etc

It worth to expose the async operation to these data straction eg:
Future<V> popAsync(timeout),Future<Collection> popAsync(Int maxNumber,timeout) etc,maybe add something like AsyncList,AsncQueue?


181
NPE when call queue.poll




182
How can i specify the redis database in Redisson?

How can i specify the redis database in Redisson?
Thanks for reading.


183
New Redis client

The idea is go away from lettuce due to some api limitiations and absence of commands pipeline support. Also command handling - encoding/decoding should be implemented with lock free approach.


184
Are the recent Netty related features alerting Netty for other libraries?

Today attempted to migrate Redisson from version 1.2.1 to 1.3.0 and that caused the 2.1.6 version of the DataStax Java driver to write a WARN + stack trace instead of an INFO to the log.
With org.redisson:redisson:1.2.1, I see:
With org.redisson:redisson:1.3.0, I see:
I also tried version 2.2.0-rc1 of the DataStax Java driver and see the same thing.
I also tried adding a dependency on io.netty:netty-transport-native-epoll:4.0.29.Final, which I believe contains the linux-x86_64 jars but still see the same thing.
For reference, I'm deploying to Ubuntu 14.04.1 LTS (GNU/Linux 3.13.0-44-generic x86_64).
Please advise.
Thanks,
Peter Luttrell


185
can't stop via shutdown

when call shutdown(),it cause these error again and again and never stop the application.
I single the JVM via Ctrl + D and there is a shutdown() hooked in Play's lifecycle's onShutdown() callback.


186
Extract async interfaces.

Extract async interfaces for all redisson objects. This is necessary for further development of batch operations feature support.


187
Migrate and Move commands support

Add migrate and move commands to RedissonObject class


188
Flushall support

No description provided.


190
Bloom filter

No description provided.


191
add some java doc about the codec's method

it would be great to  add some java doc here:


192
Compiled "java.util.regex.Pattern" gets corrupted

Look the below smaple code, the compiled Java Regex looses its flags once you keep your object in Redis.  The below code Prints 2 before put operation, But Prints 0 after put operation to Redisson Map.


193
Compability with Guava (com.google.common.collect.ImmutableSet).

I tried to do this:
The test fails on the line "assertTrue(testSet.contains(newSet));", that is, testSet.contains(newSet) return false, but set1 equals newSet and set1.hashCode() equals newSet.hashCode().
Redisson version is 1.2.1.


194
how to  delete keys like redis  del keys in fuzzy matching

No description provided.


195
How to set up the expired time of different object in RMap?

No description provided.


196
redisson client is connected

any method to know if redisson client is connected or not? i have a "connection is closed" error and i don"t know when re-use the same client or should create new one...


197
NullPointerException When Using Cluster Config

With release 2.0.0, while using sample cluster setup using the create-cluster script from redis (http) and this Redisson sample code:
I always get the following NPE:


198
Redisson calls do not time out and very long cache times depending on ttl setting

Hi, while developing using redisson some problems with timeouts and cache times are experienced.
Consider the following scenario:
Now there are several problems here. Timeout exceptions are being thrown, but seemingly at random times ignoring the timeout setting of redisson. It is also somehow being affected by ttl setting as the shorter ttl yields lower cache times, as well as the frequency of hitting the cache. You can see it from the following graphs of CACHE_TIME timer:
In all cases the timeout was set to 100ms, 3 attempts with 100ms interval. In all the cases in the end requests succeed to fall over to the database (either through a timeout error or through returning null). Regardless, the timeout is not being thrown according to the settings. Please let me know if you might know the cause of the issue. Thoroughly investigated the code on this side and it seems like the issue is in redisson. Let me know if you need more context


199
Concurrency Issues

Today I tried some tests to experiment with Redisson's performance using a build from /master and discovered significant concurrency issues. I'm not sure what the state of this code is, so perhaps these issues are known ones, but wanted to make sure you guys are aware of them.
I have a very simple app that a) Creates a Redisson instance with a connection pool of 50 to masters and 50 to slaves, then b) creates a quick thread pool using Executors.newFixedThreadPool() and then c) feeds it Runnables, each of which generates a random string and adds it to the end of a Deque.
Whenever I do any of these three things: 1) Add >1 millions of queued Runnables or 2) Increase the number of threads >20 or 3) add a .contains() call on the Deque (more on that in a sec), I get a ton of exceptions that don't include any of my code in the stack trace. Here's one such snippet:



200
RBatch NPE's

No description provided.


201
add RSet.removeRandom and RSet.removeRandomAsync methods

No description provided.


202
Infinispan redis integration

I'm contributing a redis integration to infinispan and am investigating the use of Redisson to use as the client.
I need an efficient way to retrieve a list of all keys and iterate over them for processing, but because Redis can store millions of records, I wanted to avoid a list/queue of data pulled from the Redis server and held in memory on the client as this could wind up exhausting resources on the client.
Will getBuckets, findKeysByPattern or findKeysByPatternAsync retrieve the keys in an efficient manor, like a database cursor stepping over each record, or is there another approach that is recommended to efficiently cater for this?


203
SCAN command support

add findKeysByPatternIterator, findKeysByPatternIteratorAsync, getKeysIterator, getKeysIteratorAsync methods. Move keys operations to RKeys object


204
can't deserialize object when JsonTypeInfo.As.PROPERTY was different to @class

hi,
when i put the "toto" object in the MAP there is no problem but when i do a get operation i get an exception
error when deserialize object, simply because i used jackson for other operation and i forced property to "type"
Exception :


205
Check connections at client startup

No description provided.


206
ReentrantReadWriteLock implementation

No description provided.


207
Semaphore implementation

No description provided.


208
ExecutorService implementation

Introduce redisson-all.jar to have ability to run it as standalone node.

Add isAnonymousClass checking for Runnable param
Add ability to inject RedissonClient object into task


209
RANDOMKEY support

No description provided.


210
Reactive Streams support

No description provided.


211
Empty slot error

Add slot checking for MasterSlaveEntry. Fire an error if correspond entry for slot not found.


212
extract drainToAsync?

this would be nice


213
Scheduler support

No description provided.


214
Examples update

Add links to object interfaces
Add low-level Redis client usage example


215
Redis healthcheck using Redisson PING

Can you add ping in Redisson which helps in healthcheck?


216
Warnings about serialization exceptions being swallowed (using SerializationCodec with non-Serializable class)

I wound up pulling my hair out after upgrading from 1.3.1 to 2.1.0 and starting some new projects - the root cause being my attempt to use the SerilizationCodec with objects that were not Serializable. Simplest reproduction:
Expected: a warning about serialization with a root cause of a java.io.NotSerializableException.
Actual: nothing in the logs, threads just hang around wait()ing on DefaultPromise.
I'm not a netty expert so unfortunately I have no PR to fix this. My best guess at root cause lies in CommandExecutorService#async. If I modify the ChannelFutureListener to
I get a nice warning message:
The listener originated in 2019283


217
Is it possible to have RSortedSet as part of batch

Was wondering if its possible to include RSortedSet as part of batch commands


219
How can I do set and get operation in cluster mode

Thanks in advance :)


220
Add ability to subscribe for keyevents


221
Sentinel auto discovery

No description provided.


222
Cluster mode "Too many open files" (java.net.SocketException)

Cluster mode Redisson client running out of files (sockets) in communicating with Redis.
This occurs even when the Redisson client is not receiving any requests.  It must be a problem with cluster mode connectivity.
To reproduce, I simply made two calls to my server using Redisson to set a simple value on Redis and then retrieve a simple value.  Then we did nothing at all.
It appears the Redisson in cluster mode is continually opening new socket connections but not closing existing ones.
After about an hour, we started seeing the following exceptions in our server logs.
Note:  I am may have seen a similar behavior in sentinel mode.  We recently upgraded Redisson to 2.1.0 from 1.1.5.  Could this be a more general problem?  We will upgrade to 2.1.1 and test again.
Thank you very much.
--Michael


223
Opening new connections in org.redisson.CommandExecutorService#async

Rmap.addAndGetAsync (and any *Async methonds) - as i understand it shouldn't lock the calling thread, and return value (Future) as soon as possible.
But if for any reason connection is not established yet the calling thread will be blocked.
And if redis server is not available at all it will be blocked for very long period of time.
Maybe i'm wrong but it doesn't look like async nor lock-free.


224
Expirable RCountDownLatch

Is there a reason that RCountDownLatch doesn't implement RExpirable? I'd like to be able to create a CountDownLatch that goes to 0 or is deleted if countDown isn't called the desired number of times before a timeout.


225
RObject#delete returns false object doesn't exist

It seems that in the following test, RObject#delete() will always return false, even though it appears the delete call should be synchronous.


229
RLock.tryLock() thows Exception

org.redisson.client.RedisException: ERR Error running script (call to f_2d027cdc209d32fe7dade9ba284110f88d497180): @user_script:1: WRONGTYPE Operation against a key holding the wrong kind of value . channel: [id: 0x24baaaa8, /192.168.99.1:64875 => /192.168.99.100:6379]
ENV: redis 3.0.3/2.8.3
REDISSON: 2.1.1/1.3.1


230
Major Issue: iterators that uses SCAN/SSCAN/HSCAN command are not using the same node

Since the fact that keys/Sets/Hashes in redis does not guarantee the order of the elements within, iterators should stick to the same node when iteration was first started, to avoid duplicate and/or missing items.
For example, when you have a Set "A" in master node contains:
a slave node could have it in a completely different ordering:
Obviously, the running the command SSCAN "A" 0 on master, the result is going to be different to the one from the slave. Further cursor call SSCAN "A" n, could also be different.
The problem is, under the default setting, SentinelConnectionManager uses the RoundRobinBalancer which is utilised to read from both master and slave nodes, and when you have a for loop like this:
The output could contain duplicate/missing item(s), and the results could be different each time you run it.


233
CommandBatchExecutor executeAsync method freezes

Hello,
Nice work on the redis client.
I noticed that executeAsync did not complete while running a batch of rediscommands against a cluster.
I noticed that in the line:
voidPromise may never complete successfully because it is being re-initialized for every slot entry and its successful completion depends on the number of slots being decremented to zero after all the entries run as shown in the line below from execute(...)
Note that mainPromise is voidPromise from above.
Perhaps the previous line in executeAsync should have been like


234
support max or min connectionPoolSize?

i read redisson code that imply only the max connectionpoolsize is provide. but all other collection framework also support min size (and the not longest not used time).
when the system is not high load, as if cut down the connection that not used offen?
I found that if connection is create,it not close!(when one down the watch dog create a new one asap)


235
bug? watchdog create new channel not attr connection obj

RedisConnection.updateChannel update the new channel obj.but the channel attr NOT on it, so the second time new channel is down, the watchdog channelInactive invoke method attr(RedisConnection.CONNECTION).get() can NPE.
i thinkd it is a bug.
version 2.1.1


237
Subscription connection leak in PubSubConnectionEntry::removeListener

We have a production system using Redisson to handle notification. However, recently we constantly run into subscription connection exhausted issue. After investigation, I found Redisson doesn't release the subscription connection after the last listener is removed.
Eventually, this issue is caused by the following line. It seems ConcurrentLinedQueue doesn't fully implement equals method to compare 2 linked list. Therefore, an empty linked list will never equals to another empty linked list, which eventually leaks all subscription connections.
This is a very urgent issue to us. Any help or workaround will be greatly appreciated.


239
Leak issues

When using redisson, I'm occasionally getting errors like this: "LEAK: you are creating too many HashedWheelTimer instances".What are possible causes of this issue?
I'm also seeing (probably related) errors like this: "LEAK: HashedWheelTimer.release() was not called before it's garbage-collected." I assume this is related to my problem, but I don't know where to look in my code for this leak. Could this be a bug?
Thanks!


240
Read split feature in Sentinel mode

Hi,
I have a setup with a master, 3 slaves and 3 sentinel nodes. I do not have too much data and cluster setup is not required. I should be able to support high throughput(400K Ops/sec). Most of them are read operations. Is there any way to split read requests among master and slaves?
If there is no way to do this, can this feature be added?
Thanks
Naresh


241
Elasticache and failover; Redisson configuration question

We're using Redisson 2.1.1 on our production web cluster for session persistence: https:
Our redis implemention is AWS's ElastiCache where we have 2 nodes in a replication group. Elasticache provides 3 endpoints for this scenario:
foobar.elasticache.com - always points to the primary (read/write) node of the cluster
Normally node1 is the read/write master and node2 is a read slave with foobar.elasticache.com pointing to node1. In a failover scenario. Elasticache promotes node2 and repoints foobar.elasticache.com to now point at node2.
Our Redisson configuration is to use a SingleServerConfig with the endpoint of foobar.elasticache.com
Last night we experienced our first ever failover (exciting!). Unfortunately, this brought our application to a standstill with errors of
The 10.0.x.x address listed is that of node1 which was demoted to read slave when node2 was promoted to master.
My belief is that using SingleServerConfig here is incorrect and led to this issue (i.e., redisson remained connected to node1 and never reconnected to foobar.elasticache.com to now be connected to node2. Am I correct in this analysis?  If so, I can't really seem to figure out which config is the proper one to use. MasterSlaveServersConfig seems logical at first glance, but looking through the code it appears only Sentinel and Cluster configurations invoke the paths that switch the master node.
Any help would be greatly appreciated.  Thanks!


242
reconnection functionality doesn't work with AUTH enabled on redis

If I enable security on redis, re-connection functionality no longer works - wihout security redisson works as expected and re-connects.


245
Fst and snappy codecs · Issue #245

No description provided.


246
Feature Request: Redisson backed ObjectCodec (Object-Hash Mapping)

Now, the ability to specify a different codec per object feature is added
d484c19, this has paved the way to implement a new type of object codec that serialise each field of POJO object into a redis hash.
Thinking it as a persistent layer for persisting an object to redis like the EntityManager does. Using reflection/javasisst to proxy the accessors of the POJO to read/write fields straight from/to redis.
It would allow different programs to be able to share sets of live data without needing to serialise and deserialise the entire object.


247
Add serialization codec for java Number

By default any Number class descendants is serialized as ["java.lang.Long",1843] for example.


248
Resubscribe to topics when RedisPubSubConnection has been reconnected

No description provided.


249
Ringbuffer structure

No description provided.


250
Redis master change is not detected properly.

Redisson does not seem to be detecting Redis master change in failover scenario.  (We are using Redisson 2.1.3).
I have 2 questions regarding this.
After the 60-second timeout (described below) everything started working again, although not in the original configuration.  Can this timeout be changed (lowered) and done so safely?
Should Redisson should be able to detect and react to this last master change back to our original configuration?  We were assuming that it should.
Details are below.
I can provide the redis commands we used to reconfigure Redis if they will help.
Thank you very much.
--Michael
In testing redis failover we have discovered that moving a master instance frmo one instance to another causes all our servers to hang.  We have reproduced the issue several times with the following process.
We are running 3 Redis servers (redis-01, redis-02, and redis-03).  Each server is running both a redis master and a redis slave.  Each master is associated with a slave on one of the other redis servers.
Start multiple work sessions on our application servers running light load
[At this point everything appears great - the test continues to run.  The slave instance has taken over the responsibilities for the failed redis node.  run "redis-cli cluster nodes" for a list of all the nodes, the reassigned master and a list of the failed shards.]
restart redis on the "failed" server - "service redis_master start" "service redis_slave start"
[After 60 seconds, we see our first indication of trouble - we get a redis connection timeout exception on each of the application servers.  If you look at the "cluster node" output you should see the two instances back in the list, however at this point they are both slave nodes.  Another server will have two master instances on it.]
rebalance the redis nodes - on the server that you just restarted the services, run "redis-cli cluster failover" this tells redis to failover the remote master to this instance.  After this step you should be back to the original configuration with one master and one slave instance on each server, with no master/slave combination on the same server.
This is where our application servers seem to hang.  From yourkit we see several of these:


251
Report possible race issues.

Hi, Developers of mrniko/redisson,
I am writing to report two race issues on use of ConcurrentHashMap. The issues are reported by our tool in an automatic way. Although manually confirmed, they would be false positives, given we do not know the specification of the program. We would very appreciate if you could check below for details and confirm with us whether they are real problems. For more information, please refer to our website:
Line 120 is in the synchronized block on "ENTRIES". If the intention is to guarantee exclusive access for the !containsKey checking on "ENTRIES" and to ensure the atomicity of the checking and unsubscription (line 120,121), then the write operations on "ENTRIES" in line 66, 115, 117, 136 may break this. Relying on the ConcurrentHashMap to ensure exclusive access is dangerous since ConcurrentHashMap has no guarantee of exclusive access.


252
ReplayingDecoder.callDecode() thows NP Exception




253
NPE during load testing

Hi.
I'm relatively new to java, so sorry if i say something stupid.
When i'm storming my server with 50 concurrent requests using AB, i'm getting NPE during some channel negotiating (as i guess). The following line (CommandDecoder:267):
results in null pointer exception:
I'm not 100% sure where does this problem originate from, but i can tell that those requests use Redisson for inter-process locks and fetching/updating two string sets.
I'm using Redisson 2.1.3 against dockerized Redis 3.0.2 (the standard docker library image)
upd: debugger told me that client has received null for hannels.get() for redisson__lock__channel__{lock:pn:phone-number:79219767095}, which, i guess, means trouble with lock.


254
EOFException when I use RLock with SerializationCodec

I configure Redisson to use SerializationCodec instead of default JsonJacksonCodec. Then I run my code in environment with concurrent threads and use Lock object to sync thread. After that I get exception and unlock only after expiration in 30 sec. Previous major version of Redisson does't contain this issues. Similar problem I have when I use CountDown.


256
unknown command EVAL when call

I am getting an exception when trying to add an ArrayList to a redisson RMap  on a Linux Server. I cam using Redis 3.0.4.  Below is an example of the code I am using
This code works perfectly fine when running on an OSX machine but the folllowing exception is thrown when it is run on a Linux Server.


258
Codec key and value decoders are opposite.

When implementing my own custom code, I've found that it seems Codec key and value decoders are opposite.
This does not work.


259
NPE in pub/sub




260
Mocking Redisson

Is there any library for mocking Redisson? I have a scenario where I do not want to have Redis server running for unit tests.
There is a library for Jedis.


262
AddSentinelAddress(...) non-running instance ClosedChannelException

Hi,
I have noticed something running some load tests recently.
I have a 3 sentinels, 1 slave and 1 master set up.
Initially I was running load tests on this exact set up and would occasionally run into org.redisson.client.RedisConnectionException: Slave connection pool gets exhausted! which is fine since when the load is reduced the app goes back to normal.
Then I had to switch off one of the sentinels and forgot to restart it, so now I was running with 2 sentinels, 1 slave and 1 master.
I would first again run into org.redisson.client.RedisConnectionException: Slave connection pool gets exhausted! but would also run into
After reducing the load, org.redisson.client.RedisConnectionException: Slave connection pool gets exhausted! disappear, but org.redisson.client.WriteRedisConnectionException: Can't send command... persist and appear on every couple of calls even for 0.5QPS.
I tried this several times and it always was like this, 3 sentinels - all good, 2 sentinels - WriteRedisConnectionException exceptions.
Note that in both cases I passed all 3 sentinel's addresses to addSentinelAddress(...) for useSentinelConnection()
Maybe a check on the new Redis(...) call to ping all the sentinels would be nice


263
Can i use redisson for the "mget/mset" multi-command?

I can not find "mget/mset" api in redisson, whether redisson support those multi-command? and for redis cluster mode?


264
A serious mistake for redisson cluster!

hi, @mrniko
I review the parse() function in ClusterConnectionManager.java, and it only parses one pair start_slot and end_slot.
Is it right, or my understanding is wrong?


265
RMap.putAll not working.

I have RMap<String, String> and static map with default values which I need to save but RMap.putAll keeps throwing exception:


266
Handle Redis Cluster memory

Hi @mrniko,
I want to know what Redisson can do with Redis Cluster:
-check Redis Cluster memory
-handle exception when Redis Cluster exceed memory
Thanks & regard


267
LZ4 codec support.

No description provided.


268
Implement realtime cluster nodes scan list.

No description provided.


269
CROSSLOT handling.

No description provided.


270
BitSet implementation.

No description provided.


271
Cluster slave servers info update.

No description provided.


272
Add readFromSlaves config param for cluster mode.

No description provided.


273
Handling MOVED response

Command with MOVED response could be redirected to Master or Slave node.


274
Async reconnection to channel

No description provided.


275
check Android compatibility

No description provided.


276
receiving multiplied PubSub messages

Little modification to the testHeavyLoad reveals the problem I encountered when having a single listener processing many messages sent at the same time (in latest version):
volatile long counter;
Running the test will fail for me many (but not every) time saying the listener got like 9000 messages instead of the 500 sent.


277
RedissonSet iterator in Sentinel mode doesn't seem to be sticking to one slave for the lifetime of the iterator

Hi,
I have a Redis setup with 3 nodes (master, slave, slave) and 3 sentinels (one per node). When I try to iterate over a set within Redis, I'm getting some odd results that are breaking the Redis SCAN guarantees - that is, I'm losing some entries.
I'm pretty sure this is because the iterator isn't sticking to a single slave during its lifetime, and rather that it's using the default RoundRobinLoadBalancer switching between slaves for the same scan (which otherwise works well).
Example
Let's say I have a big set with 100K entries:
with all nodes up (two slaves), and when iterating over the collection, adding all my results to a java.util.Set such as below, then I'm getting some random size result sets:
However, if I turn off a slave, I get the correct result:
and I agree with the behavior of the RScript (as Redisson would never implicitly know when to stick to a single server). Incidentally, the latter use of RScript provides me with a workaround, but it'd be nice to use the inbuilt iterators for simplicity.
Hope that make sense-cheers!


278
Why RedissonLock.tryLockInner not call 'setnx' command?

No description provided.


279
I want a codec for msgpack

HELP ME PLEASE..Thanks in advanced:)


280
RList add at index inserts data in different format causing an exception on read

Hi,
I have code running against redisson 2.1.3 that was adding a value at an index and after the add is called the list can no longer read, throwing this exception:
I wrote a simple test to see what was going on.  The code from test1 executes without issue.  The code for test2 throws the exception on the first pass through the for loop.
I queried the redis server and here are the two lists.  In test 2 you can see that bar does not get the escaped quotes around it.


281
Add RMap values, keys and entries iterator

No description provided.


285
RLock.isLocked() get hung when I disable/enable my local network

I was crashed into a blocking issue when I was doing some configuration on my windows laptop. RLock.isLocked()  got hung forever with callstack as following:
Callstack:
The issue is repreduceable. Steps to reproduce the issue:
My os is windows, and I haven't tested it on linux.
Steps: disable network.  Then enable network. The program will be blocked with the callstack I pasted


286
LOADING response handling

Error like "LOADING Redis is loading the dataset in memory" should be handled correctly


287
Add connectTimeout param

No description provided.


288
Use PEXPIRE and PEXPIREAT instead of EXPIRE and EXPIREAT

No description provided.


289
KEYSLOT command support

No description provided.


290
Where is ZRANGEBYSCORE command

I can not find anything in RScoredSortedSet class...


291
handle MASTERDOWN response

When slave-serve-stale-data is set to 'no' then this error occur:
MASTERDOWN Link with MASTER is down and slave-serve-stale-data is set to 'no'


292
BLPOP from multiple queues

No description provided.


293
What does RBatch.execute() return?

Hello. I have an RBatch variable that I've added some commands to. I noticed if I tax redis a bunch sometimes it has trouble writing a backup file (this might be the fault of my weak vm). At any rate, I'd like to detect this failure mode and tell the user about it if it ever happens.
I'm trying to figure out what RBatch.execute returns. There aren't any javadocs on this. I either get one of two responses:
The second one indicates failure.
The wiki suggests these are responses to the specific commands, which agrees with what I would assume from EXEC, but I'm not sure why I'm getting boolean results, because the commands I'm running should all be add commands (like HSET, ZADD, etc).
Do you mind updating the javadoc, and do you know why I'm getting booleans back (and what they mean) instead of ints?


294
connection-status  handling (question)

Hi there, is there any hook somewhere for client to handle when connection to server gets dropped/lost ?
thany


295
Add geo commands

No description provided.


296
Revise return value for some methods

Return value of follow methods: RedissonScoredSortedSet.remove, RedissonScoredSortedSet.add, RedissonMap.fastPutAsync and so on could be changed from boolean to value returned by Redis.


298
Rename config params

Rename useSentinelConnection to useSentinelServers
Rename useMasterSlaveConnection to useMasterSlaveServers


299
Add redis client state listeners

No description provided.



300
Duplicate values are returned with redisson.getSet00

Hi,
I'm getting duplicate entries with redisson.getSet.
Redis command "SMEMBERS pSet" returns the following.

""MOBD5G7DDCRHQCHS""
""MOBE4G6GTTD33ZUT""
""MOBEY39PGWFVQHQE""
""9788129135728""
""MOBDP6W6MCUWCFGV""
""MOBDDA5Y6BKX6VHR""
""MOBDA3N2XBF74DSJ""
""MOBE4G2SKSQJSPGJ""
""MOBEBZPYZEVYCYWM""
""MOBDGY7DGAAN7SZY""
""MOBDCAJJJ55SCWBY""
""MOBEBZZGKH7QGZKH""

redisson.getSet is returning the following values.
"MOBEBZPYZEVYCYWM",
"MOBE4G6GTTD33ZUT",
"MOBDDA5Y6BKX6VHR",
"9788129135728",
"MOBEY39PGWFVQHQE",
"MOBDCAJJJ55SCWBY",
"MOBD5G7DDCRHQCHS",
"MOBE4G2SKSQJSPGJ",
"MOBDGY7DGAAN7SZY",
"MOBDP6W6MCUWCFGV",
"MOBEBZPYZEVYCYWM",
"MOBDP6W6MCUWCFGV",
"MOBDDA5Y6BKX6VHR",
"MOBDA3N2XBF74DSJ",
"MOBDGY7DGAAN7SZY",
"MOBDCAJJJ55SCWBY",
"MOBEBZZGKH7QGZKH"
Please notice that MOBDGY7DGAAN7SZY is repeated.


301
Add redissonlist equals

No description provided.


302
Add RMap.getAllAsync method

No description provided.


304
Ping fails if requirePass is set

Can't ping single node either with ping or pingAll commands - getting NOAUTH Authentication required
Piece of code
Full exception


305
Сheck lock existence in forceUnlockAsync method

No description provided.


306
Extract Async interface for RedissonCountDownLatch

No description provided.


307
Redisson shutdown hangs if redis server was down

Start redis server
Create redisson bean
Stop on a breakpoint inside test
Shutdown redis server
call redisson.shutdown()
What I see is that ConnectionWatchdog is scheduling tryReconnect indefinitely incrementing attempts and connection is not closing. But if I put break point in ConnectionWatchdog#channelInactive (line 64) and stop there, connections are closing properly. Perhaps there is race condition somewhere?


308
RScript.Mode.READ_ONLY... not read only?

I have a script that deletes some things. Here's how I'm executing it:
myRScript.evalSha(Mode.READ_ONLY, mySha, ReturnType.BOOLEAN, myKeyNames);
It's working (deleting things). This is confusing to me. Shouldn't Mode.READ_ONLY not allow that? I think what is happening is this is using redis' READONLY command, which I think is okay with letting me change data, as long as I'm not hitting a slave (which I'm not, because I'm only running one node locally). I think this will cause an issue once I run this on something like Amazon's ElastiCache.
Do you know if my assumptions about what's happening are correct? I wasn't able to figure that out. If so, maybe adding some documentation to that enum would make things less confusing. If not, maybe there's a bug? Anyway I'll start using Mode.READ_WRITE, but I thought it was strange that Mode.READ_ONLY worked too, so I figured I'd report it.


309
SortedMap

It would be useful to have a SortedMap implementation.
Could this feature be added? or are there any nifty tricks with SortedSet to hack around the issue?


310
Add 'pollFirst' and 'pollLast' methods to RScoredSortedSet

No description provided.


311
Precache lua scripts in all Redisson objects

No description provided.


312
Map/Reduce implementation

No description provided.


313
Cache convertor instances

No description provided.


314
Add JCache API support


315
Apache Spark integration

No description provided.


316
Add RObject.isExists

No description provided.


317
Add WAIT command support

No description provided.


318
Add RCacheReactive implementation

No description provided.


319
Add RSetCache implementation

No description provided.


320
Add BlockingDeque implementation

No description provided.


321
Add RSetCacheReactive

No description provided.


322
Add TransferQueue implementation

No description provided.


323
RedissonClient `isShutdown` check

I'm somehow missing a possibility to check whether the current Redisson instance has been shut down already.
Are there some run-state flags that one could check? Would a isShutdown method  make sense in the RedissonClient interface? Would this be possible with the changes required for #299 ?


324
bug! expire expireAsync use toSeconds with PEXPIRE

the code above timeUnit.toSeconds is wrong,shoud be toMillis


325
a error in RedissonExpirable 2.2.1

PEXPIRE is milliseconds ,not seconds


326
Auto Deploy Redis Clusters function.

Redisson.createCluster.node(ipAddress,sshUsername,sshpassword).node(ipAddress,sshUsername,sshpassword).node(ipAddress,sshUsername,sshpassword).deploy();


327
BlockingQueue questions

Hello,
I have some questions about BlockingQueue, if I have two different consumers, can I be sure that an object in the queue won't be consumed by both consumers at the same time? Does it implement any locking mechanism to prevent that?


328
an error in RedissonSortedSet




329
RLock did not work

It's very wired. I just run a very simple test case to try redisson lock. But the result is not good.
Can anyone show me why RLock didn't work?
The results are as below. It seems the lock failed completely.


330
Add MGET command support via loadBucketValues method

No description provided.


331
Add size method to RKeys

No description provided.


332
NoClassDefFoundError: Could not initialize class org.redisson.client.handler.CommandsQueue

I am getting below exception, not sure why I am getting NoClassDefFoundError while I do see that class in the jar.
Using Redis redis-2.8.14 and redisson-2.2.1.jar


333
Return queue name in RBlockingQueue.pollFromAny result

No description provided.


334
Move flushdb and flushall methods to RKeys object

No description provided.


335
Add RBlockingDequeReactive

No description provided.


336
Add saveBuckets method to RedissonClient

No description provided.


338
New version 2.1.4 or greater performance is low.

When I use redisson 2.1.3 the ubuntu's load average is 1.8 ~ 2.3; but I use 2.1.4 or greater, the load average is often greater than 3.00, my java application often overload.


339
Suspected Memory Leak under load

Version 2.2.3 under load doing simple asynchronous set operation with small string value is running out of heap.  Heap dump shows a large number of promise objects.  I will post more details soon.


340
Aliyun redis use 2.8.19 and not support LUA script

Aliyun(http)redis use redis v2.8.19 and not support LUA script(eg. command EVAL EVALSHA SCRIPT EXISTS SCRIPT FLUSH SCRIPT KILL SCRIPT LOAD),  Redisson's RLock RList RMap use EVAL command, so I
can not use Redisson in the Aliyun redis.
How can I do a branch from  redisson v2.1.3 and remove the LUA script to resolve this problem?


341
topic listener decode error

An exceptionCaught() event was fired, and it reached at the tail of the pipeline. It usually means the last handler in the pipeline did not handle the exception. (io.netty.channel.DefaultChannelPipeline)
io.netty.handler.codec.DecoderException: com.fasterxml.jackson.core.JsonParseException: Unrecognized token 'aa': was expecting ('true', 'false' or 'null')
Is it an issue ? or a mistake made by me? thx


342
use StringCodec with config,RedissonLock.tryLock() will occur ClassCastException




343
How to not throw an exception on connection error and retry infinitely

I'm add Redis as a non-crucial data store (application can survive without it). However, when redis is down, the application will not start and will throw Exception in thread "main" org.redisson.client.RedisConnectionException: Can't init enough connections amount!. I would like the application to continue as usual, ideally to retry infinitely. I couldn't find this setting, and it seems like there's no way to catch the exception. Any ideas?


344
Redisson MasterSlaveMode with weighted load

can you add this feature with load balance control between serveral slaves.
this is important when the cluster have non uniform performance.


345
Redisson cluster Read connections issue

I use Redisson 2.2 to implement distributed lock in my project and use Redis cluster.  And I found the Redisson client will create new connection and do not use the connection in the pool while invoke some readOnly methods which execute evalRead. So when I start to run the test it will produce lots of TIME_WAIT connection on my server. The followings are some logs on my server.
The codes are very spectacular and I only understand a bit. But I doubt whether the client get the connection from the pool but also create a new one?


346
Spring cache integration

No description provided.


347
Bounded queue

No description provided.


348
Implement AtomicReference

No description provided.


349
pollLastAndOfferFirstToAsync does not block properly

RedissonBlockingQueue#pollLastAndOfferFirstTo(String queueName, long timeout, TimeUnit unit) does not seem to behave as defined in
I'm expecting the invocation in this piece of code to block until there is an element in myqueue. Instead it continues after 1 second and returns null.
a different time interval doesn't change the behavior either.
i've also tried using the lower level functions:


350
A problem

This is a simple code:
Look at the attach picture..RMap<String, Integer> generate two key:str and "str", It seems to be a bug..But RMap<Integer, Integer> will be all right..


351
Add ability to read config from json

No description provided.


352
Add max-idle param to RSetCache and RMapCache

No description provided.


353
Add ZADD command support with NX option

No description provided.


354
Add RScoredSortedSet.addAll method

No description provided.


355
RedisConnectionException in High Concurrence

I use redis as required data store, but in high concurrence, there are almost 50% connection failed. I want to know whether to optimize my redis server(use cluster) or my client? Is there any great suggestion? infinity retry until success? And My test code are list after:
I use 1000 threads, and find that if i set the connection pool size to 500, the successful proportion achieves maximum.


356
hello i got a server error when i use redisson to connet AliyunRedis

the error like this:
"ERR unknown command eval. channel: [id: 0x73e1562f, /10.47.102.114:35465 => 126748df08bd4eea.m.cnhza.kvstore.aliyuncs.com/100.99.113.11:6379] command: CommandData [promise=DefaultPromise@40a65eef(incomplete), command=(EVAL), params=[local v = redis.call('hget', KEYS[1], ARGV[1]); redis.call('hset', KEYS[1], ARGV[1], ARGV[2]); return v, 1, loginInfo, admin, com.expresscne.parcelconfig.data.model.UserAndPermission.UserPermissionObject@175b609e], codec=org.redisson.codec.JsonJacksonCodec@5bcaeaef]",
"path": "/system/userPermissionEndPoint"
I ask Ali's tech support about it. He told me this issue was caused by AliyunRedis not supported EVAL operation.
How can I do?


357
I found a bug when using RMap! infinity loop!

Here is the code:
the loop is endless!!! I am sure there is only one Object in this map because program prints same key in the console !!
How to deal with it!?


358
Add fastPutIfAbsent and fastPutIfAbsentAsync method.

the  public Future putIfAbsentAsync(K key, V value)
return null or value, can you add fastPutIfAbsent return 0 or 1 for fast put?


359
Please add RedissonAtomicDouble implementation.

I use RedisAtomicDouble with spring data redis ,but redisson only implement RedissonAtomicLong


360
Optimize RedissonAtomicLong.getAndSetAsync & RedissonAtomicLong.getAndAddAsync

No description provided.


361
this is a bug?I can't use RBatch.

these codes will throw NullPointerException. but data has save into redis
but these codes work properly.:


362
Add RAtomicDoubleReactive

No description provided.


363
2.2.6

No description provided.


364
RedissonList add LTRIM Command

Can you add the method in RList?


366
SMOVE command support

I think this would be a good addition to the RSet family.


368
Add SUNIONSTORE command support

No description provided.


369
Add SINTERSTORE command support

No description provided.


370
A RMap error in 2.2.5

these codes work right in 2.2.4,but  in 2.2.5 will throw Exception:


371
Can't init enough connections amount

Hi,
I am trying to connect to redis using RedissonClient. When I create the client without any configuration it works. However, whenever I try to pass the configuration as parameter it gives the following error,
" org.redisson.client.RedisConnectionException: Can't init enough connections amount! from /127.0.0.1:6397"
By default it is using the same port and host. But when I try to enter it using the config param it gives me the error.
Following is the code snippet,
Any suggestion?
Thanks.


372
Add max-idle param to RMapCache

No description provided.


373
Add max-idle param to RSetCache

No description provided.


374
RSet add getAll(SMEMBERS) method.

RedissonSet  has toArray() method to invoke readAllAsync (SMEMBERS) , it is return Arrays.
I want add a method directly return Set or List to local, then I can use these collections in local, don't need to access the redis anymore.


375
Can't init enough connections amount

Caused by: org.redisson.client.RedisConnectionException: Can't init enough connections amount! from /192.168.1.87:6379
This exception  appeared sometimes.
who can tell me how to solve this problerm?
stacktrace:


376
Implement MultiLock object based on RLock objects collection

No description provided.


377
Connecting to localhost

Hi,
I am trying to connect to the localhost redis client as follows:
RedissonClient redisson = Redisson.create();
But I do get the following error, not sure what is the issue.
Thanks for your help.


378
How can I use mget/mset in redis cluster?

Hi.
I want to use this
but when cluster mode, RedissonClient#loadBucketValues return unsupported error.
how can I use it?
thanks!


379
Question: Does redisson handle redis clusters with password?

when i tried with codes below
i got this exception
and i debuged into redisson code ,it seems exception is throwed when doing a sync operation while creating a ClusterConnectionManager,
my redisson version is 2.2.5
thanks


380
Add readFrom (SLAVE, MASTER, MASTER_SLAVE) option to all master slave connection modes

No description provided.


381
Healthcheck for Redisson

I am using this client in a dropwizard service and I want to add a healthcheck. Jedis has a PING command, here using the RedissonClient I can't issue a ping command. I need to create a instance of RedisClient for the same. I should be able to retrieve instance of RedisClient from RedissonClient, or suggest me a way to perform a healthCheck for the same.


383
Implement vertx-redisson module

From @jackygurui: Since there are still people prefers to just use hazelcast as cluster manager but use redisson for other tasks, it would be wise to make redisson cluster manager implementation into a sparate jar and use can just pick and choose themselves.


384
"Can't connect to servers!" aways occured

my config as following:
before if (lastPartitions.isEmpty()) ,  maybe  lastPartitions is not initialed ?


385
Add readAll method to RSetReactive and RListReactive

No description provided.


386
Running out of connections

I use Elasticache Redis as my redis server, 1 master, 1 slave (fairly large machine, this is an autoscaling micro webservice).  I used to use an older version and it worked good (from a connections point of view), but I had to upgrade from 2.1.2 due to distributed lock fixes. I am currently using 2.2.4, but after about 12-24 hours I see the " RedisConnectionException:Can't aquire connection from pool! " exceptions.
I expected it had to do with Elasticache closing idle connections, so I turned that back off for now, but it didn't effect this behavior, it seems to be related with my update from 2.1.2 to 2.2.4.
Does redisson not refresh its connection pool as connections close, do they timeout, or is this something else entirely?
I am using SingleServer or MasterSlave Configuration, with defaults, the current behavior is seen with SingleServer. (I haven't added configurations for slaves yet)
The only functionality I currently use in Redisson is the Distributed lock mechanism, to control 2 sets of locks.
Flow of using lock: get lock, set expire to 15s, (try) process,(finally) unlock (or set lock to expire in 500ms)
Redis has plenty of connections available. only 1300 or so used out of about 7k


387
An exception when upgrade from 2.2.5 to 2.2.6

i do "mvn clean" before start tomcat


388
RedissonCacheManager use custom Codec and must be more simply

build CacheConfig Map is hard and more code,I expect use these config:


389
Restore RMap.keySet and RMap.values methods with eager fetch loading

Those methods were deleted in a07e4d4ebdf0a2c2436942c8e537eebe48aee7f5 commit.


390
Add readAllKeySet, readAllValues, readAllEntry to RMapReactive

No description provided.


391
Sentinel error when no slaves

if there are no slaves on SentinelConnectionManager:82 we have a List<Map<String, String>> sentinelSlaves = connection.sync(StringCodec.INSTANCE, RedisCommands.SENTINEL_SLAVES, cfg.getMasterName()); which returns just Map not List of Maps.
So, the exception I get is:
You may argue that it is not correct if there are no slaves, but, this cut config is used on test machines and not on production (which is fully configured with slaves). So, would be nice to handle this error.
Thanks.


392
RKeys.deleteByPattern in cluster mode throws error

No description provided.


393
Sentinel "ERR unknown command 'AUTH'" error after upgrade from 2.2.5 to 2.2.6,2.2.7

Stacktrace:


394
Redisson

Hi mrniko,
since upgrading to 2.2.6 from 2.1.4, suddenly the Rmap only returns 10 elements - although it reports size correctly to 1000. Below is my test scenario - please help! I have attached output log.


396
Log Level

Hi,
I want to stop receiving the default debug logs in my tomcat logs, how do I change the log level?
Sorry for the noob question, thanks in advance!
Regards,
Balaji B R


397
Lots of string allocations by exception

Doing some load testing I found that this line:
exceptionRef.set(new RedisTimeoutException("Command execution timeout for command: " + command + " with params: " + Arrays.toString(params)));
in CommandExecutorService can do a lot of string allocation and generate garbage. Could this exception be improved so the array is only built when necessary?
thanks


398
Add sunion command to RSet

No description provided.


399
Add type to Node

Methods to get master and slave nodes are needed too.


402
Redisson keep retry commands during shutdown

No description provided.


403
Read all values of set

Hi,
When I am trying to read all the values of set I get the following exception. Let me know if you require more details.
Version: 2.2.7


404
Multimap

Implement Set and List based multimaps RSetMultimap and RListMultimap.


405
an exception of RedissonSpringCacheManager




406
Where is ZREVRANGEBYSCORE command

Returns all the elements in the sorted set at key with a score between max and min (including elements with score equal to max or min). In contrary to the default ordering of sorted sets, for this command the elements are considered to be ordered from high to low scores.
Sorry, I can't find it...


407
redisson.shutdown()  time consuming 2s

I use  distributed lock,but redisson.shutdown()  method  time consuming 2s,help! help!


408
why not invoke FSTObjectInput.close() in FstCodec?


409
ElasticacheCluster not working correctly with DistributedLocks

I am trying to use redisson 2.2.7 for distributed locks. I have a 3 node Elasticache cluster with one of them as master.
When I try to get lock using the following code, i get an error saying that i cant write to a Slave. My assumption is that i can feed a list of nodes to the redisson client as Elasticache nodes and it will figure out who the master is...is that not true?
The error that i get is shown below..
Here is how i am setting up a redisson client


410
Add DynamicImport-Package to OSGi-instructions

If you cache domain models (i.e. via the Serialization-Codec) within an OSGi-environment and want to retrieve those back you will hit ClassNotFoundException as the Redis-Bundle doesn't import the appropriate packages. One way to avoid this would be the additional "*" declaration for the OSGi headers,


413
Throw RedisOutOfMemoryException on OOM error from Redis

No description provided.


414
New connection pool

Connection pool could be improved. Each connection has own commands queue which should be used and connection acquire/release and consequently connection waiting logic will be removed


415
Add CLIENT REPLY command support

No description provided.


416
Add config option to reuse existing netty EventLoopGroup.

Our application (and many others :) uses netty for networking and it would be good to have option to reuse main EventLoopGroup instead of creating new.


417
Google App engine support

No description provided.


418
Redis Logback appender

No description provided.


419
Add HSTRLEN command

No description provided.


420
Add INFO command

No description provided.


421
orphan netty threads on connection failure

If you try to create a RedissonClient and get a timeout error, the created netty threads aren't destroyed and you can never terminate the Java program but with a System.exit(). For example:
If this code fails, then several netty threads remain in execution and they are never destroyed, because the "client" variable is the only point where you can "shutdown" those threads, but that RedissonClient instance hasn't been created (because an exception has been thrown).
A possible solution is to shutdown the failed connection at MasterSlaveConnectionManager.init(), which is the point that all kind of connection managers run to create a connection. Surrounding:


422
Version.logVersion() error

version:redisson-2.2.9
exception:


423
An exception was thrown by org.redisson.RedissonLock$8$1.operationComplete()- java.lang.NullPointerException

An exception was thrown by org.redisson.RedissonLock$8$1.operationComplete()
in class RedissonLock ,row 580, futureRef.get() may be null


424
Async version of RSetMultimap/RListMultimap

Is there a plan to implement RSetMultimapAsync and RListMultimapAsync?


425
Missing entries in RMapAsync using single redis server and multiple web servers in servlet enviornment

I am testing out using RMapAsync to store connected users to our web service in a servlet environment with two or more web servers and one redis server.  When a user creates or removes a session, I'm adding/removing to the RMapAsync like so:
and similarly, when a session is removed:
I am seeing that there are a few hundred missing with a total user count of 3K or so.  Is this possibly because the same redis key/hashmap is being altered simultaneously from more than one server?  Is it best to get the map and edit it like I'm doing here? or would it be better to have one class member instance of the map in my class and just add remove in the relevant methods (so I'm not continuously calling get map for every add/remove)?  What's the best practice for a setup like this if this isn't a bug, but a misuse of the RMapAsync?  (awesome project btw)


426
RScoredSortedSet should be able to handle +/-inf as value range.

Credit to @ZizhengTai


428
RSetMultimapCache and RListMultimapCache

There should be field-expirable versions of the multimap classes.


429
Add LINSERT operation to RList

Add RList.addBefore() and RList.addAfter() methods


430
Add MSETNX command support

No description provided.


431
RedisConnectionException: Can't init enough connections

Redisson version: all from 2.2.3 to 2.2.9
Redis version: 3.0.4
Initializaition:


433
Please add RScoredSortedSet#revRank method

corresponding the ZREVRANK command
Thanks in advanced..


434
RemoteService




436
Read Write lock cannot be correctly unlocked

in ReadLock and WriteLock,  the unlock method use thread id to determine whether it is owned by this thread. it works fine for a single machine.
However, when it is used in a distributed processing framework such as MapReduce, the Read and Write lock cannot be correctly unlocked.
I browse the source codes and find that the UUID is generated in the lock, I think it is better to use UUID as lock id  istead of thread id or provides a way to let users to set a unque id.


437
Connection pool exhausted! All connections are busy

version: redisson-2.2.9
test as following:


438
Connection pool exhausted! All connections are busy

version: redisson-2.2.9
test as following:


440
Allow injecting custom ConnectionManager

Use case:
Redis clustering is implemented using twemproxy, and its location should be discovered and monitored using Consul, etcd or whatever else. Currently I have to either use DNS monitoring (which is not an option in some cases) or wrap Redisson instances into a proxy to implement this. It would be better to have an option to implement such behavior in custom ConnectionManager.
I can make pull request with implementation, if anyone else needs this.


444
Optimization on interactions between Redis and Redission

I have seen the source codes and found that many codes use java string join parameter.
I think it is not inefficient.
May be use StringBuffer of use static string values, so that the interactions between Redis and Redission can be more efficient.


445
Add oneShotListener to RTopic

oneShotListener must remove itself automatically after execution


446
Ability to cancel BRPOP and BLPOP async command execution.

Implement correct cancellation handling for Future object returned by pollAsync, pollFromAnyAsync, takeAsync, pollLastAsync, pollLastFromAnyAsync, takeAsync and pollLastAndOfferFirstToAsync methods


447
Fix delete and expire Multimap methods.

No description provided.


448
MOVED, ASK handling in cluster mode using RBatch

No description provided.


449
Long BlockingQueue\Deque commands reattaching

BlockingQueue\Deque Commands like take, poll and pollLastAndOfferFirstTo must be reconnected to a new channel after RedisConnection has been reconnected.


450
2.2.11

No description provided.


451
Is Redisson a good candidate for session manager?

I know my question is not an issue but I couldn't find a better way to get an answer, sorry!
Would you recommend Redisson as a session manager (as in HttpSession)?
Spring Session comes with a clustered version using Redis but it does not support locks (AFAIK) and personally I find that useless. Then I found this project and it sounds suitable but there's so much to consider and trying to get advise from the community I thought this is the best place to ask.


452
Add Spring session integration

No description provided.


453
Exception on  pub / subscribe and after whole system becomes unstable

i use Reddison framework with scala and noticed very strange behavior. If I use sync. and pub \ subscribe features all system get unstable and issue an exception listed below. Also below is the simple test which produce this behavior. Any comments ?

454
RSetCache not checking expiration

From gitter:
I just want to confirm but redisson.getSetCache would be appropriate for locking? That is using .add() to see if it was able to add a guid to the set (unlocked) or not (locked)
@mrniko  As you can see lua-script from this method doesn't check element expiration as others do. Could you create an issue about this?


455
Long latency issue while call Redis.

I use Redisson 2.2.10 to implement distributed lock in my project. And then I run load test for this distributed lock using SINGLE redis mode. But I found there are many long latency APIs and it's wired that almost all the long latency APIs are a little greater than 1000ms. The average latency and 99 percent latecy is about 15ms and 30ms respectively. And then I used jstack to get the call stack and found most of the threads are WAITING at the same place just as the following
Meanwhile, during the test, I dumped the network packages using tcpdump and found that it took about 1000ms before the first package was sent to Redis. And in Redis server, I didn't find any slow query whose latency is more than 10ms. So I think, for the long latency API, most of the time might be cost in the project not the network. So can you help me to have a check or give me some suggestion about this issue?  Many thanks.


457
Add TIME command to Node object

No description provided.


458
Add ZCOUNT command

No description provided.


459
remove "lex" workd from method names in RLexSortedSet

No description provided.


460
Move all mass bucket methods to RBuckets object

No description provided.


462
Exception occurred. org.redisson.client.RedisTimeoutException: Redis server response timeout for command: (HGET) with params:

Hi,
I have setup Redis in sentinel mode with 4 slaves and 1 master. As I increase the number of read requests, Redission is throwing RedisTimeoutException. The TimeOut is set to 5 sec and retry count is set to 5. Will increasing the number of slaves help?


463
wrong SCAN commands handling, affects Iterator objects

No description provided.


464
Reconsider interface hierarchy used in RMultimap.get methods

No description provided.


465
Need suggestion for connection issue

Hi,
I am using a single server connection and set the connection pool size to 10. I have created multiple threads to test a code snippet where I am saving an object to RBucket<> object and deleting it afterwards in a same transaction block. I get following error sometime in the process,
Any suggestion?
Thanks.


466
RedisTimeoutException with "large" objects

I have a simple setup with a SingleServer connected to a ElasticCache-Redis instance. I upload various sizes of bytes to measure the performance between those. Small objects up to 3 MB perform fine but above that I receive this error:
In "Batch" mode is also see this:
My setup for connecting looks as following (I have a similar setup with redisson-reactive showing the same problem):
I have tried using the latest versions (release + HEAD). I have debugged the issue but haven't found any obvious problem. The only thing I found is the timeout in "new HashedWheelTimer(minTimeout, TimeUnit.MILLISECONDS);" which is set to a 100ms (from MasterSlaveConfig) and seems to be the reason for cancelling the commands? Though I tried changing this without success.
Somebody has an idea about what might be causing the timeouts? Can I configure those to be suitable for bigger objects?


467
Deadlock using RedissonMultiLock

I am using simple app to run on 2 clients to test locks.
While using RedissonMultiLock with 3 locks both clients blocks.


468
IllegalStateException while iterating over RMapCache using an iterator

While iterating over an RMapCache object with an iterator, an "IllegalStateException" occurs  on the second removal of an entry from the map.
The map structure is RMapCache<String, List>.
The iterator is received via cacheMap.entrySet().iterator().
The iterator removes successfully the first entry, but upon the second entry removal it fails with the exception mentioned above.
Please note this code used to work fine with a regular Java Map.
Here is the code:
And here is the relevant stack trace:


471
RMapCache.values() fails

I recently change some code to use maxIdle timeouts on a map.  I.e changed from RMap to RMapCache.   Put and gets are working as expected but the .values() call doesnt work.
I have attached a test class to show this.


473
Add RTopic.waitMessage method

No description provided.


474
In Cluster when master goes down and his slave becomes a master, Redisson does not recognize the new master

Hi,
I configured Redisson, see below, and it works, but when I shutdown one redis master and his slave on other machine becomes a master (in 5 sec) Redisson cannot recognize the new master and the request seems like still go to the old master which is not exist.
Please assist ASAP.
Thanks!


475
Master change in cluster mode causes an unneccesary slots migration.

No description provided.


476
Redisson fails to recognize slave that become a master due to master down in Redis Cluster

Hi Niko, seems like problem really exists with redisson driver for cluster.
Here is our configuration:
When I did this Redis cluster reorganized to following:
As you can see cluster is ok, but requests are failing for some reason.
If I restart tomcat without touching anything on Redis requests are not failing.
Very strange.
This is the link to the redisson log:
Please assist,
Thank you!


477
Error if first node is down in 3 node Master-Master cluster

I have a Master Master redis cluster of 3 (node1,node2,node3). Locking mechanism works fine if we block the network for node2 or node 3. But if we block node1's network then it fails with the below error
Below is how I'm creating the Redission client


478
A bug about RScoredSortedSet#revRank method




479
Connection pool exhausted! error in Redis Cluster

Hi Niko!
We constantly have "connection pool exhausted" errors on our env.
The configuration is : 3 machines with 1 master and 1 slave on each machine.
May be we should tune some configurations in our redisson config?
Can you please explain briefly the meaning of these:


480
Rlock Exception in cluster mode

Hi
I am using redis 3.0.6 (4 node cluster  ) and redisson version 2.2.5.
Sometimes when I try lock a key I get the following exceptions:
my code :


481
RSetCache TTL doesnt readd after expiry via RSetCache.add

I have a problem with a RSetCache with TTL.   The problem seems to be that the value is not returned from the iterator and calling readAll throws an exception.
Redisson : 2.2.12
Redis : 3.0.7 (00000000/0) 64 bit
I have attached a test which reproduces the issue.
When I run this, it keeps adding a string into the set and it should expire but be replaced quickly, this doesn't happen and the set is empty after the 30 seconds.
Calling readAll() on the set it fails with the following error.
hscan testRSetCacheTTL 0
shows the value in the set while its running and after (when I disable the delete() call).
Also note that removing the delete() call seems to stop the exception from readAll().  So using readAll() with no delete() works or using delete() without the readAll().   But I have a feeling that it could be timing related.


486
Rlock performance issue

Hi
I am using reddison Rlock with a cluster setup , and sometimes I see latency( up to 1000ms)  when trying to acquire the lock or unlock.
I saw this issue opened by zhxjouc (#455) with a similar problem  and I am working with 2.2.13 but I am still getting latency when a thread is trying  lock a key.
My code is running with Java thread pool for accessing redis, I notice that if I work with pool of size 1-2
almost no latency when getting the lock, but working with 30-50 threads cause the lock delay.
It could be thread overhead issue but I think that 1000ms is too long for that.
Any help on how can I get better performance when locking an unlocking?.
Thanks


487
getBlockingQueue throws IndexOutOfBoundsException

Hi:
when I was using getBlockingQueue method.
following exception happened to me:


490
expireAt(Date) use second instead of ms




491
Dead Locks Happen in lock() Process

when heavy concurrency happens in my application, a few lock requests will "sink" without any responses, even after the lock lease time has passed. All of these requests wait at RedissonLock.lockInterruptibly().The exact position is RedissonLock.get() after RedissonLock.subscribe().
In my opinion, this may be due to a thread removes the netty listener which is used by another thread. It can happen in this way:
Thread A is in the loop of getting the lock after subscription.
Thread B has also applied subscription and waits for result.
Thread A gets the lock very soon and enters  RedissonLock.unsubscribe(). In this step, it possibly removes all the listeners on the same channel, which includes the listener used by Thread B. It causes Thread B can never get subscription response and hang on forever.
The similar issue is at http. But I think it is not solved completely.
Also I suggest  to apply the ttl algorithm to RedissonLock.get() because this step can cost some time. And if it has a timeout, dead lock can be prevented in a work-around way.
This is the thread dump when dead lock happens:


492
Move all config classes to org.redisson.config package

No description provided.


493
RedissonRemoteService: executorsAmount vs invokeMethod

This is more a question than an issue, and please excuse me if this is a dumb question, I may be wrong, I am just beginning to dig into the code.
Here I suppose that the clients are able to issue calls more quickly that the servers can respond to.
In RedissonRemoteService, is it possible that the server ends up invoking simultaneously more than the expected executorsAmount given that it re-subscribe before the invokeMethod, and even before the ack ?


494
RedissonRemoteService ideas

Here, two things that would be great additions (I think) to the RedissonRemoteService.
1) Be able to choose the remote service interface prefix
Right now its hardcoded to redisson_remote_service:.
The use case is simple: for example I want to be able to deploy the same worker application (that expose the same service) on two types of instances (say some AWS m3-* for standard use, and some c4-* for hardcore use).
So on the server side I would call:
And on the client side:
1) Be able to issue one-way call (ie: wait for the ack, but not the actual response)
This could be a client side only change, for example, by having a new set of RRemoteService.get(...) methods, that takes a boolean waitForResponse...
Or, maybe, re-use the RRemoteService.get(...)'s long executionTimeout, where a value of executionTimeout < 0 would indicate to the client to wait for the ack, but not the actual response.


500
Java 8 compatibility

No description provided.


503
Asynchronous lock release

Hi,
I'm trying to create an infrastructure where different machines acquire shared locks through Redisson. Once the lock is acquired, some async tasks gets done, finally, when I finish the job, I'm releasing the Redisson lock through the thread currently running - but i receive the following error
java.lang.IllegalMonitorStateException: attempt to unlock lock, not locked by current thread by node id: xxxxx thread-id: 57
So, I understand the meaning of that, but since I want to perform asynchronous work, I cannot use the acquiring thread to perform the release.
Is there a solution for asynchronous programming? Should I not use Redisson Lock?
I also references the issue on SO
Thanks.


504
Async Semaphore

No description provided.


505
FstCodec: FSTObjectOutput proper usage

Juste a little something.
In the FstCodec, when an object in encoded, an FSTObjectOutput is first borrowed from the FSTConfiguration, then used to write the object and then closed.
In the FST Serialization Recommended threadsafe Use, they recommend, when using the factory method, not closing this stream in order for it to be reused.
I think that only an oos.flush() instead of a oos.close() will do the job here.
Not a big deal, but still....


506
Only `connect` Topic under Cluster mode Not Working in win7

my OS is win7, so i use MSOpenTech/redis 3.0.1 and running redis under cluster mode.
i learn from redisson topic and use redisson.getTopic("anyTopic"), it is working well.
but only redisson.getTopic("connect") not working!?
i changed redisson.getTopic("connect") to redisson.getTopic("connected") or use redissonConfig.useSingleServer() it is still working well.


507
Possible race-condition in RemoteService

Race-condition during ack checking is possible. For example, ack timeout = 1000 ms:
worker receives Request in 999 ms sends ack, but it comes in 1010ms or something like that.
client checks ack in 1000 ms and throws RemoteServiceAckTimeoutException
worker invokes method
To solve this problem ackObject was introduced. Worker or client set it to 1 via SETNX command. Worker set it during ack sending. Client during ack receiving.
Client check ackObject only if ack timeout has occurred. If client can't set it means that worker have done it already. So client should poll an element from queue again.
If worker can't set ackObject then it means that ack timeout already occurred on client side and invocation should skipped.


511
Add RedissonFairLock

No description provided.


513
Allow to execute interface methods used for RemoteService in asynchronous way

No description provided.


514
RedissonSortedSet's order seems broken

Hi, we have been using RedissonSortedSet and just found that on certain cases the order can be broken and I assume RedissonSortedSet is supposedly thread safe.
Assuming RedissonSortedSet of integers are added with the following integers : 103, 101, 102. RedissonSortedSet state (list in the redis server) should be: 101, 102, 103. However, there are cases when it is not. It may become 102, 101, 103 instead. And looking at RedissonSortedSet's source code, it uses binary search that requires the list/state to be always sorted. Therefore it breaks many other functionality.
The use case that breaks (in my case) is when we are adding multiple items and there is another thread that delete an item in between. Looking the source code implementation briefly, it may be because when removing an item it does not consider getCurrentVersion() (just a quick guess).


515
RKeys.getKeysByPattern infinite scan when no keys are present

After updating to version 2.2.14 RKeys.getKeysByPattern is doing infinite scans when there is not even 1 key by this pattern. It was working fine earlier.
It works fine when there is at least 1 key with this pattern


516
Guava BiMap.

No description provided.


517
redis master/slaver switch exception

When redis master-slave switch,my project throw exception.
I ues redisson 2.2.8 and cluster mode.
Thank you very much.
--Marck


518
Redisson cannot recover from password protected rebooted redis server

Steps:
Redis Server up.
Client is up connecting and connected to Redis Server. It required AUTH password
Redis Server down and passed the failedAttemps, so the server is excluded.
Redis goes back up
Client is trying to reconnect, but the mechanism to check if server is alive is broken for password protected server.
I think the following line of code can be improved by including authentication:


519
Support for ssdb as a replacement of redis.

No description provided.


521
Storing simple key/value pairs in RMap vs. RBucket

Sorry for using an issue for my question, but I couldn't find a mailing list to post this question to :)
I am using Redisson to store key/value pairs and was wondering whether it makes more sense to use just plain RBuckets for each pair or a single RMap. I am especially interested in the possibility of sharding these across nodes in a cluster setup (PRO feature?). The key/value pairs are immutable and I would expect a lof of PUTs and DELETEs of them. Any pros and cons?
I do also use a lot of different "types" (around 8) of caches (with different serializations and TTLs). Currently I am using a different redis databases  for each type. This means I have to create a new connection (aka RedisonClient) for each of these. This also means a lot of Threads in the different ThreadPools, though I am already sharing the EventLoopGroup between the instances. Would there be any particular drawback in storing all of these in just one database to avoid the Thread overhead?
Thanks in advance!


522
Add RGeo to RBatch object.

No description provided.


523
Add ability to define Codec for RemoteService

No description provided.


524
Add Multimap to RBatch object

No description provided.


525
Add MultimapCache to RBatch object

No description provided.


526
Conflicting setter definitions for property "masterAddress

Hi,
I am getting below error while creating instance of config through json ObjectMapper.
Exception in thread "main" com.fasterxml.jackson.databind.JsonMappingException: Conflicting setter definitions for property "masterAddress": org.redisson.MasterSlaveServersConfig#setMasterAddress(1 params) vs org.redisson.MasterSlaveServersConfig#setMasterAddress(1 params)
I tried both yml and json but still facing the same issue with both.
Please let me know, what I am missing in config.
Thanks,
Sid


529
Add TYPE command

Add TYPE command RKeys interface


530
Deadlock on lock() and not only

Hi,
I want to raise the issue with deadlocks again.
This bug is still exist and making big headache. As before, It present itself only on very heavy loaded tasks, but in this case I is happens only when client talks to the claster which is located remotely.
With a single-local or claster-local servers I was unable to reproduce it, but with remote server it happens with rate 1 / 20 (means from 20 runs of "heavy-load" JUnit test it happens only once)
I can see where thread is locked down, it always stuck in CommandAsyncService.get(Future), on l.await() line and never exits from it. As I understand something wrong with mainPromise object, it is staying in incomplete state... and nobody change it. I tried to understand the logics in CommandAsyncService.async(...) function, which is actually deals with connection, retry, redirections and at end should release (or fail) the mainPromise object, but it is nightmare. All these spagetty with promises and futures made the code difficult to read and impossible to analyse. For sure BUG is there, but I am near to give-up. Any thoughts?


531
Writing to Redis failed without any exception

Hi,
I'm using Redisson version2.1.5. Writing (Synchronously) to Redis has failed without throwing an exception. Is there any known issue?


532
A type based codec for json

The current JacksonJsonCodec embeds the class information into the json payload, therefore coupling the redis data with the java client.
What do you think about me adding a codec dedicated to a specific type, so we can get away with clean json?
Thanks


533
Exception in using RedissonMultiLock

I have 5 independent masters and I use single server config to create Redission instance.
The RedissonMultiLock works fine if all the redis nodes are alive.
If I shutdown one of the redis nodes, it will throw RedisConnectionException
Exception in thread "main" org.redisson.client.RedisConnectionException: Can't init enough connections amount! Only 0 from 5 were initialized. Server: /192.168.223.128:8000
According to The Redlock algorithm, it should try to lock another node but not throw exception. Do I use RedissonMultiLock correctly?
It tries to acquire the lock in all the N instances sequentially, using the same key name and random value in all the instances. During step 2, when setting the lock in each instance, the client uses a timeout which is small compared to the total lock auto-release time in order to acquire it. For example if the auto-release time is 10 seconds, the timeout could be in the ~ 5-50 milliseconds range. This prevents the client from remaining blocked for a long time trying to talk with a Redis node which is down: if an instance is not available, we should try to talk with the next instance ASAP.


534
Add SCAN command support to RedissonKeys.deleteByPattern

No description provided.


535
memory leak




539
Scalability of Channels (Pub/Sub)

I'm building a real-time text based chat program where people can chat with ONLY 1 other person.
Each person can chat with 1 other person, but the aim is they can chat with Many people at once. (i.e. MANY one to one chats with different people). The aim is to have it scaleable, not necessarily to snapchat's level, but enough for 1 City.
I'm just wondering what is more scaleable:
Having 1 channel for the entire application and filtering who the message is for and who sent the message based on the data encoded in the message
OR
Having 1 channel for each person and all the different people sending messages to that person send their messages through that channel with data encoding who sent the message
OR
Have an individual channel for EACH Chat between 2 people.
OR
For Option 1 (1 channel for entire app), perhaps an intermediate solution of having 1 channel per city.
I'm wondering what approach is best for Java and Redis. If there is no clear cut answer, what the conditions/criteria are for making the decision.


540
RMapCache with timeout leaves redisson__idle__set__ behind

If you create a RMapCache with a TTL entry then delete the map, the idle_set is left behind.  This should be deleted too.


541
pub/sub timeout

500 num cur time


542
RedissonRedLock.unlock() is using forceUnlockAsync()

RedissonRedlLock overrides unlock() of RedissonMultiLock and it will force to unlock all instances.
Is it more reasonable to use unlock method of RedissonMultiLock?


543
RLock trylock blocks forever

Found this in 2.2.16, seems like this was not around in 2.2.10. But still verifying.
When tryLock is called with 0 wait time, the thread blocks forever. I took a thread dump and it looks like the stack pasted below.
A note on the environment: We are running this against an Elasticache cluster in AWS and accessing from 4 EC2 instances. We have seen a lot of command timeouts. I am not sure if that is some way leading to this.


545
RedissonLock.isHeldByCurrentThread() doesn't check properly.

I am using RedissonLock in my system.
The lock realted logic in service is like this:
But in the log I found:
I can see the the thread name is same, so the thread got the lock and the thread try to unlock is same thread.
Is there any problem in my code? Or in the logic of lock.isHeldByCurrentThread()?


547
ConnectionListener.onConnect()/onDisconnect() are not invoked when redis server becomes active/inactive.

I am trying to utilize ConnectionListener to monitor connections to redis servers. The way I add connection listener is pretty similar to the sample code showing in wiki 9.1:
The way I test it:
start two redis server on port 6379, 6380, let server on port 6380 to be the slave
setup and start redis client. I am using ElasticacheServersConfig here.
Once all connections are stable, kill redis master server and check output.
However, what I saw is onDisconnect() of my listener is never invoked after I shut down my redis server. If I restart my redis server again, I can see connectionEventHub.fireConnect() is called. But since the check maps.get(addr) == Status.CONNECTED always return true, my listener.onConnect() is also not invoked.
Can anybody help explain why this happens? Did I misunderstand what connection listeners should be used for? Thanks in advance.
The version I am using is redisson-2.2.13
Below is the console output after master is down.


548
redisson creates non-daemon threads

There are times we don't want to explicitly call RedissonClient::shutdown,
but because redisson creates some non-daemon threads when using the MasterSlaveConnectionManager (by using HashedWheelTimer's default thread factory)
then the JVM will never be able to quit without calling the shutdown method.
Please add support or change the default behaviour to start HashedWheelTimer with daemon threads.


549
redisson org.redisson.client.RedisException: NOAUTH Authentication required. exception in 2.1.0

I got redisson org.redisson.client.RedisException: NOAUTH Authentication required. exception in 2.1.0


550
Connection pool exhausted

I met similar problem these days online  used  of sub/pub.
The version I use is 2.2.17, I have 2 redis server, one master and one slave, in sentinel mode. It is in test environment so net work and cpu usage is low.
This error appears about every 1 day.


551
Move classes from `org.redisson.core` to `org.redisson.api`

No description provided.


552
Redis server response timeout

My program often occured the following error:


553
Consider consolidating tests on Travis CI

Hello!
Thank you for using Travis CI for your testing needs.
We noticed, however, that currently this repository configures 180 jobs for each push. This puts undue burden on the system, not to mention long waits for each build to complete.
I have marked the user @mrniko as an offender to prevent further queueing of builds from this repository at this time.
I apologize for the inconvenience. Please send email to support@travis-ci.com when the jobs are sufficiently consolidated.
Thank you!


554
why key never don,t expire?

hi:
i have use ression ,ression version is:2.2.15
problem for: my code is mylock.lock(2L, TimeUnit.SECONDS);
why ttl key value is loop for 20-30 ,  un locked.
please help me,  thank you.


556
Command execution timeout for command

I started getting RedisTimeoutException("Command execution timeout for command") for put operation on RMap. I have been using Redisson in production for 6 months. I'm seeing this exception now. I'm using Sentine mode with the following configuration.
What could be the reason for it?


557
java.lang.UnsupportedOperationException during command batch usage with netty 4.0.38 and higher

Starting from netty 4.0.38 java.lang.UnsupportedOperationException occurs during command batch usage. This is issue related to netty/netty#5581


558
loop lock blocked when master-slave failover

description: after master-slave failover , the test code blocked forever .
redis cluster :
test code:
exception:


559
Ack object used to prevent race-condition during ack receiving should be created per request

Because of this issue RemoteServiceAckTimeoutException could be thrown prior the end of ackTimeout


560
Add Future.cancel method handling for remote method call

No description provided.


561
Redisson map get makes the thread waiting forever

The map is a regular <Integer, String> map, and by calling a get on some key we see the following thread trace:


562
attempt to unlock lock, not locked by current thread by node id

redisson version:2.2.21
implement code:


563
Add ability to cancel remoteService task execution

No description provided.


564
Help needed with elastic cache configuration

Hi @mrniko , we are checking the work with AWS elastiCache instead of Redis-labs, and wanted to check if the following parameters seems ok in that case:
Thanks


565
Improve BLPOP response timeout

According timeout issue with blpop command redis/redis#874 one second should be added to response timeout handler.


567
Exceptions handling in CommandDecoder.

Unhandled exceptions in CommandDecoder during decoding leads to response timeout exception.


568
Exceptions handling in CommandEncoder

Same thing as for CommandDecoder: unhandled exceptions leads to response timeout exception.


569
Limit Payload String on RedisTimeoutException

If a timeout occurs while inserting a ginormous payload, the entire payload is logged in the error message.
Is it possible to limit the payload portion of the error log?


570
Unable to redefine RedisClient command execution timeout

command execution timeout should be = retryInterval * retryAttempts


571
Add Smile and Avro codecs

No description provided.


572
redisson can't subscribe to the slot after fix Redis Cluster PubSub  Scalability Issues

redis PubSub Scalability issure:
after fixed it , redisson can't receive message becauseof following code:


573
Connection pool exhausted

When set rertyAttemps to 0. connection pool size is 100. use 100 threads to read the redis cluster,it will throw exception like "Connection pool exhausted! for slots:
In my point of view,it's caused by LoadBalance.


576
"Command execution timeout" for INFO replication

Hi @mrniko,
I am getting the Command execution timeout when my application comes up. Looks like the first INFO replication command is being timed out. Same command I have tried from the command and the same command works well in almost no time. Can you please suggest if there is any such open issue? I am using 2.2.24 of the library.
Following is the stack trace:


577
Replace Future interface to RFuture for async methods

No description provided.


579
diffrent topic subscribe to the same node

redisson version: 2.2.17
redis version: 3.2.3
redis cluster nodes:
test code:
we expect  SUBSCRIBE test0-test9 to all nodes of cluster .


580
Cannot create Redisson Client if it cannot connect to the only Slave in SLAVE and MASTER_SLAVE read mode

Hi all
As the issue title says, we cannot create Redisson Client if it cannot connect to the only Slave in SLAVE and MASTER_SLAVE read mode. While this looks like the expected behaviour, since creation of RedissonClient object can be very critical for an application startup, may be the redisson library can fallback to something more forgiving, like using the Master for reads with some error logs.
We have encountered this issue due to firewall rules not being setup correctly (which can happen, no matter how much effort is put in) and the consequence of this was our app did not start up and the deployment had to be rolled back. We couldn't explain why Redisson Client cannot be created when the connection to the Master was working, until I tested it out using the unit test below.
We have fixed up the firewall rules, but just wanted to inform as this feels like a rough edge. By the way, we were using 2.2.13 and this issue seems to be in the latest release 2.2.24 as well.
Thanks
The setup used for the unit test below is:
testReadModeSlave and testReadModeMaster tests fail with the following error:
I have also seen the following error when running the tests above, but does not seem to happen consistently:


581
tryLock method throw Exception:attempt to unlock lock, not locked by current thread by node id: 157ddcf5-0cc2-445d-bdea-98160a459bd5 thread-id: 42

@mrniko
hi, I stress test tryLock(long waitTime, long leaseTime, TimeUnit unit) method, throw Exception:attempt to unlock lock, not locked by current thread by node id: 157ddcf5-0cc2-445d-bdea-98160a459bd5 thread-id: 42
unnormal code:
1:but use lock() or lock(long leaseTime, TimeUnit unit) method is normal, why?
2:tryLock() can not be block? lock() is blocked?
3:tryLock(long waitTime, long leaseTime, TimeUnit unit) method, waitTime must be more than leaseTime value, otherwise occasionally have "attempt to unlock lock, not locked by current thread by node id" ecxeption, in stress test condition, why?


582
java.lang.ArithmeticException: / by zero in WeightedRoundRobinBalancer if the connections to the only Slave are frozen

I was trying to use the WeightedRoundRobinBalancer to give preference to a Redis server over another for reads and encountered java.lang.ArithmeticException: / by zero. Following is the unit test and the stacktace. Interestingly, this error happens only when the slave is given an higher weight; if the master is given a weight of 2 and slave a weight of 1, then the error does not occur.
The setup used for the unit test below is:
Sentinels running on localhost:5000, localhost:5001 and localhost:5002
All the above processes running in a guest VM
With port forwarding setup from host to guest for 6379, 6380, 5001, 5001 and 5002
But the slave on the guest had the bind configuration to listen only on 127.0.0.1. i.e. connections from host wouldn't work.


584
lock.unlock

if (lock.getHoldCount() > 0) this ,why not include unlock?


585
Improve re-connection scheduling accuracy in ConnectionWatchdog

EventExecutorGroup scheduler can't provide scheduling accuracy in milliseconds. ConnectionWatchdog should use HashedWheelTimer instead of EventExecutorGroup.


586
redisson lock failure problem

redisson version:2.2.24
@mrniko
hi, i user jmeter pressure measurement  redisson lock.
scene :
Pressure test scenarios:
Using two tomcat, simulating the two service requests, each request the server queue to obtain a lock, concurrency of 5000, continued request for 20 minutes,After acquiring the lock counter, increments by 1. It appears six times double counting problem, log is as follows::
A server
lock and unlock code


587
how to del expire key in hash?

when i use redisson ,just like redissionCache.put(key, value, this.time, this.timeUnit), value is obj,but the key just use once, now we do some stress-testing ,there are lots of expire keys ,i don't know how to clean these expire keys.


588
Q: To use RedissonRedLock locking mechanism do we need to create multiple locks?

My use case is simple (I think). I need to make sure that for a specific keyspace, only one client can create an entry i.e. akey with value for it. If multiple threads/clients etc access the "creation" method at the very same time, then only the first one should get access to create the entry & all others should be rejected.
I was trying to accomplish using the following code snippet.
But this seems to not work at all. I executed this method using executor service, where I ran 2 threads in parallel.
And it seems that one of the threads gets is able create the lock, do the work & unlock it. But the second one is not even able to get the lock & the method never finishes execution.
After I changed the locking mechanism to Fair Lock things work as expected.
I am not sure why this is? Is it because of the fact that the RedissonRedLock expects multiple locks? But I dont think I would need that in my case.
FYI here is the snippet of code I use to paralelly start 2 executions.
Am I doing something wrong?


589
Duplicate objects in a set

Hi,
I seem to be able to create duplicate POJO objects in a Redisson distributed set. The implementation doesn't seem to call equals(), which I find odd. I've tried the sorted set implementation too, which calls compare(), but I can get duplicates there as well. Am I missing some implementation details?
Thnkas
Nick


590
Tomcat session manager

Support all versions starting from 6.0


591
possible memory leak due to unlimited io.netty.util.internal.MpscLinkedQueue size

as the titles tells, when the qps is big enough, say 30000, the MpscLinkedQueue size may run out of control and worse, even full GC can not save any capacity.
and this is code


592
Implement LocalCachedMap

Supports LRU and LFU eviction policy.
Supports time to live and max idle time support.
Supports size limitation. If cache max size reached then elements evicted according eviction policy and/or object TTL.
If element has been added/removed then invalidation message sent to all LocalCachedMap instances and element evicted in all of them.


593
can't find slaves

My program in the process of running.Occasionally, there will be no node to find!
my redisson 2.2.14. master/slaver mode . redis cluster 3.x


594
Wrong object encoding during RedissonScoredSortedSet.addScore usage

No description provided.


595
Add ZINTERSTORE and ZUNIONSTORE support

No description provided.


596
Implement Phaser

No description provided.


597
Check that RLock still belongs to owner during renewal expiration

No description provided.


598
Could not initialize class org.redisson.codec.JsonJacksonCodec

Hello,
I`m having the next issue (trying to use an Elasticache-Server):
StandardWrapperValve[Login]: Servlet.service() for servlet Session threw exception
Server conf:
64bit Debian jessie v2.1.6 running GlassFish 4.1 Java 8 (Preconfigured - Docker)


599
Getting memory leak warnings when gracefully shutting down tomcat

I am getting warnings about potential memory leaks when gracefully shutting down tomcat:
In each webapp I configure a RedissonClient bean with a "useSingleServer" config:
After that I use this bean by autowiring it in other spring beans:
Any idea why this happens?


600
java.lang.NoClassDefFoundError: io/netty/channel/epoll/EpollEventLoopGroup




601
Trouble with change from io.netty.util.concurrent.Future to org.redisson.api.RFuture

I'm updating our app to use Redisson 2.3.0, and I'm having some trouble with the breaking change (io.netty.util.concurrent.Future to org.redisson.api.RFuture).
Previously, I had been using the fastPutAsync method for RMapAsync like this:
I'm trying to change that Future<Boolean> (which is the netty Future) to RFuture, but I'm having a bit of trouble getting it right. All I'm really after is being able to log success/failures of the fastPutAsync() method.
How would this be accomplished using the RFuture?


602
Issue with using Executor Service

I am trying to use Executor Service to do a distribute processing of some records. I started with a basic configuration as follows
Here is my Executor Service and Callabable.
But I am running into serialization issue with below stacktrace.


603
Implement Semaphore.reducePermits method

No description provided.


604
Implement PermitExpirableSemaphore

In some cases ability to acquire permit with leaseTime is required. It's not possible to implement it with standard Semaphore object, because it's impossible to determine which permit should be expired. Example:
1. client #1 acquires 1 permit with leaseTime = 30 seconds
2. client #2 acquires 1 permit with leaseTime = 15 seconds
3. client #2 or someone else releases 1 permit.
How to know which timeout should be deleted in this case for 30 seconds or 15 seconds?
To overcome this problem each acquired permit should have own unique id - 128-bits random number (UUID). So new RSemaphoreWithIds object should be introduced. Thus client could release only own acquired permits. If it tries to release wrong id or same id second time exception would be thrown.


606
Check Jackson 2.8.x compatibility

No description provided.


607
Need to be able to set expiry on a Live Object

I haven't been able to find a way to EXPIRE the key for a live object. I am working around this by extracting the underlying RMap field with reflection and calling expire on that.
Obviously thats not a great solution:)


608
Sync commands usage in connectionListener leads to connection timeout exception

No description provided.


612
rlock error report




613
Update ProjectReactor dependency to 3.x

No description provided.


615
MasterConnectionPool exhausted!  Hosts with fully busy connections

I am using a RScheduledExecutorService as a job queue backed by a java ThreadPoolExecutor:
Other code schedules jobs on the executor. The problem I have is that after a while if the service is busy it eventually runs out of connections.
I added some hackery to get info on the number of free connections and print this periodically:
The freeConnectionsCounter + freeConnectionsAmount value started dropping as more and more requests are executed. It doesn't drop one-for-one with requests so at least some of the time connections are being released. Interesting if the server gets less busy for a while before running out of connections then suddenly a bunch get released and things recover.
Any idea whats going on here and how I can fix this? Tx.


617
Log unexpected errors in netty handlers

No description provided.


618
Channel shouldn't be closed on exceptionCaught

No description provided.


619
Add `nettyThreads` and `executor` settings

No description provided.


620
org.redisson.client.RedisException: ERR unknown command 'EVAL'

I have installed redis-2.4.6-setup-64-bit on windows
I am getting the following exception


621
Executor service execution

The following call does not return
It neither prints "Executing" nor returns
I am using Redis 2.8.2402 and Resisson 2.3.0


622
Kindly Implement CompletionService

As it is done in Infinispan


623
Docker support for Redisson Node

No description provided.


624
Incorrect RedissonRedLock.tryLock behaviour

Lock could acquired by several threads at once when leaseTime parameter less than waitTime parameter passed into RedissonRedLock.tryLock


625
Keep RMap insertion ordering during iteration

No description provided.


627
Allow to use Jackson mixins with ExecutorService

No description provided.


628
Usage samples

Hello,
Is it possible to add some easy and working usage samples?? I'm studying about hibernate / redis / redisson and the documentation available, alone, doesn't make any sense for a newbie on these tools.


629
why ScoredSortedSet not supports the redis command "ZREVRANGE"

i just found it supports command "ZREVRANGEBYSCORE" , why not supports "ZREVRANGE"


630
Add RBucket.size method

No description provided.


631
RedissonRedLock & RedissonMultiLock lock method stuck

If more than 3 locks are supplied to RedissonRedLock or RedissonMultiLock instance then lock method could stuck


632
ClassCastException error happen when use sentinel server mode

Test code as below:


633
Implement random wait time in RedissonRedLock & RedissonMultiLock lock method

This issue related to #575


634
Remain time calculation for RLock, RSemaphore and RCountDownLatch objects should take in account command time execution

Remain time calculation should take in account command time execution when waitTime param defined during "sync" method invocation of RLock, RSemaphore, RCountDownLatch object.


635
RGeo should extends RScoredSortedSet

No description provided.


636
LiveObjectService doesn't work with id without setter

No description provided.


637
LiveObjectService doesn't create objects mapped to Redisson objects in runtime

Let's consider such object:


638
LiveObjectService can't detach content of List object

No description provided.


639
Remove `create` and `getOrCreate` methods of RLiveObjectService

persist method should be used instead of create and getOrCreate methods


640
RLexSortedSet.addAll(Collection) doesn't work

If I try to call addAll I get a RedisException:
I am using 2.4.0.


641
Not persisted REntity object allowed to store automatically

No description provided.


642
Cyclic dependencies during LiveObjectService.detach process lead to stackoverflow

No description provided.


643
RId generator should be empty by default

No description provided.


644
Replace fields with Redisson object in proxied object returned by LiveObjectService

It's not possible to encapsulate logic to work with fields in LiveObject proxied object.


645
LiveObjectService doesn't support protected constructors

No description provided.


646
RedissonSetCache TTL not updated if element already present

When using RedissonSetCache.add(value, ttl, unit) method, TTL is not updated if the element is already in the set. I think the problem is in the addAsync(value, ttl, unit) method, in the script passed to redis:
If I'm getting it right, when the element is not expired the script returns 0 without calling ZADD and updating the TTL. I would expect 'false' return code (according to Set interface), but also TTL to be updated.


647
LiveObjectService swallow exceptions during merge or persist operation

No description provided.


648
Cascade LiveObjectService.persist whole object graph

No description provided.


649
Cascade LiveObjectService.merge whole object graph

No description provided.


650
Cascade delete object graph for LiveObjectService

No description provided.


651
Introduce RCascade annotation for LiveObject

No description provided.


654
Setter for collection field of LiveObject entity should rewrite collection content

No description provided.


655
Support setter/getter with protected visibility scope for LiveObject

No description provided.


656
RedissonRedLock trylock success while another thread already hold the lock in specific conditions

it's reproducible, my code is below.
redlock lock result will be success, but when I check redis, I found the multi locks belong to different thread.
like:
I did more test and found:
if the single lock is the first of redlock, it's ok.
when I move multilock2 to first position ,it will return false correctly.
the code below
I am wondering if it is a bug or not?


657
redis list operation throw exception




658
RLocalCacheMap.readAllValues and readAllEntrySet methods return wrong values

No description provided.


659
RPermitExpirableSemaphore.availablePermits doesn't return actual permits account under certain conditions

No description provided.


661
java.util.LinkedHashSet support

Hello!
Will it be a big effort to support java.util.LinkedHashSet-like behavior in one of redisson data structures?
Basically what I need is a collection with element uniqueness and preserved insertion order.
Would be happy to contribute as well, but I would need some guidance or example where to start from.


662
Add COUNT and ASC/DESC support to RGeo.radius methods

No description provided.


663
MasterConnectionPool exhausted

redis use  Sentinel when switch master slave  where cause it


664
Live Object: @RId is returned/overwritten by similarly named methods

Hi!
First off, thank you for this awesome library! :)
I've noticed a potential bug with Live Objects IDs. It is caused by the calls to isGetter and isSetter in the
These helper methods only compare prefix and suffix of method name. For example, this means that an @RId field named Id is overwritten by a call to  setSomeOtherId.
As a workaround, I avoid naming things get...Id and set...Id for now:)


666
RMapCache doesn't keep entries insertion order during iteration

No description provided.


667
NullPointerException in CommandDecoder

Hi,
under heavy load we experience a NPE in the CommandDecoder sometimes[1]. Do you have a guess about what could be going wrong here?
Thanks.
Cheers,
Philipp
An exceptionCaught() event was fired, and it reached at the tail of the pipeline. It usually means the last handler in the pipeline did not handle the exception.


668
Runtime dependencies

Is it safe to exclude the byte-buddy dependency, or is it required at runtime?


669
InputStream and OutputStream support

From Gitter user @cdeszaq:
Wanting to keep memory usage within my app as low as possible. We're getting large collection-like responses from a backend system, processing them "item" at a time, and we want to be able to cache that response in a streamy way
Needs to keep memory low are many concurrent requests, large collections of things processed a streamy way, and we're hitting issues with OOM due to having large strings flying around
It's a CSV response from a back-end webservice, so we process it in a streamy way, but it'll easily get to sizes of 100MB for each response, and we often have to have 30+ of these responses being processed at once. We process it 1 row at a time within our code to keep memory low, but hit OOM when we go to/from our current caching layer because it converts to/from massive strings


670
redis lock subscribe

when redis unlock publish the message,where is deal with the message and release semaphore?I can't find


671
ConnectionWatchdog throws NullPointerException when connection drops (Redisson 2.5.0)

When restarting the Redis server all connection threads logged the following exception.
The host resolves to the same IP so that isn't a problem and I am able to telnet and issue the replication command without problems (immediate response)..


674
performance slow, when multiple thread

I use 1000 mutliple thread to test the list operation. the costTime is average 1000~2000ms. But when single thread it costs 1ms.


675
redisson Sentinel error




676
Documentation: RBatch.executeSkipResult only available with Redis >= 3.2

see http. probably most AWS users are still on 2.8 as 3.2 has just made available, so it might make sense to document this on the API.


677
Configured Timeout in ElasticCacheServerConfig being ignored

Hello,
I am using Redisson library version 2.2.4. I have the following settings configured for when I want to create a Redisson Client object for connecting to the datastore.
As you can see from the above settings I am setting the timeout explicitly to be 3 seconds. But I am seeing exceptions in the log which says mentions 1 second timeout. Here is the exception,
I am wondering how is this is possible? Also I think there is also auto-retry feature in Redisson, which defaults to 3 attempts. Then why would this happen?
Can I provide some more info to debug this issue?


678
RMapCache.fastPutIfAbsentAsync doesn't take in account expiration

No description provided.


679
2 different NPEs under heavy load

Hey, I experienced two more NPE if I am using Redisson under load. Do you have an idea what might be the problem? Thx Philipp


680
Remove `Connection pool exhausted` exception

Connection pool should wait for free connection instead of throwing pool exhausted error. This improves command handling performance.


681
Check ElastiCache | Redis Cluster support

Amazon has announced new version of ElastiCache with Redis Cluster support. Redisson should be checked for proper work with it.


682
Don't log byte arrays in CommandDecoder

Hi,
we sometimes run into OutOfMemoryException while Redisson is trying to log a warning, since it includes the content in the log message [1]. Would it be possible to check for the instance type and in case of byte[] just log something else? I.e.
An exceptionCaught() event was fired, and it reached at the tail of the pipeline. It usually means the last handler in the pipeline did not handle the exception. io.netty.handler.codec.DecoderException:


683
CommandAsyncService blocks indefinitely

Hi,
I have a thread stuck in the CommandAsyncService#get() indefinitely waiting for the CountdownLatch. I don't have a particular repro case but this happens every once in a while on our servers (under load). Redis itself is still delivering events and the instance receives objects on other threads as well.
Would it make sense instead of waiting indefinitely on the latch to only wait as long as the timeout is configured (as a safe belt) and abort the action if there hasn't been any success/failure by then?
Cheers,
Philipp


684
Always timeout when get/set objects from/to redis within onMessage handler.

In our micro services system, we use RTopic process messages between services. In the onMessage method, I need to get data from redis, or set data. But in the test env, when it got or set data from/to redis, there ware always timeout errors (maybe one error for 2 tests). When I commented the code, no more errors.
So, is there any handling time limitation in onMessage method for RTopic? Or any limitation to interact with redis in onMessage method?


685
redisson scheduled job question

I add schedule job and cron quartz expression,but it' not exectue.


686
Fix exception message

Fix message at https:


688
How to use Redisson to upload byte array?

Hello,
I haven't found an explanation about how to upload pure array of bytes. Redisson has a RBitSet but it manages an array of bits not bytes. How to store a byte array by using Redisson?
Here is my configuration:


690
redisson schedule job dependency

I have two schedule job parent and children,the children depend on parent job.when parent job done,then  the children job execute.but the children can not execute


691
Add `RKeys.isExists` method with multiple keys

No description provided.


692
NullPointerException in CommandDecoder.handleResult

I have experienced some NullPointerExceptions in the CommandDecoder (besides the ones reported in #667.  In the handleResult method is a check if data is null so I guess there are situations where this can be null. In the bottom of the method where the NPE occurs the check is missing though. Should this be checked as well? I am using Redisson 3.0.0.


693
Redisson JUnit tests due leaks connections/clients/threads

If you run the JUnit tests for Redisson a lot of client and their associated connections/threads are leaking because they are not properly shutdown. This will prevent the build to be successful on system with limited number of user-processes/open-files (i.e. MacOS El Capitain).
To verify this, build the project with an attached debugger and watch the constantly growing amount of threads.


695
Add BlockingFairQueue implementation

In case when queue consumers in different parts of network: some of them closer to redis and some farther.
"Farther" consumers will get lower amount of messages from queue due to network delays. In turn "closer" consumers will get higher amount and this could lead to client overloading.
Blocking queue with fair polling and guarantees access order for poll and take methods and allows to get uniformly distributed consumption by clients.


698
Add Redisson.shutdownAsync method

No description provided.


699
Add RMapCache.fastPutIfAbsent with ttl

No description provided.


700
Wrong parsing nodes in result of cluster info command

Address like 192.168.234.129:7001@17001 should be converted to 192.168.234.129:7001


701
Add RSortedSet.readAll method

No description provided.


702
In SpringCacheManager, Can the cache name use wildcard . for example '*'

In the below code snippet , can the cache name use wildcard . for example '*'
when i write '*' in the code, but donot effective


703
Add SORT command support

No description provided.


704
Add TOUCH command support

No description provided.


705
Add `putAll` method to all the distributed cache objects

No description provided.


706
Add DelayedQueue object

Could be attached to destination queue only. All elements are inserted with transfer delay to destination queue.


707
Add RQueue.readAll method

No description provided.


708
Test redisson error




710
Error retrieving a hash map that was created/written from PHP app

We started using redis hash for our logged in user session data, and I am having trouble getting a simple map of string key/vals.  I made a little test, where I create the same hash map in java/redisson and in PHP, and I am getting errors when I try to read the map that was created in our PHP application.
This is what they look like via rediscli:
When I try to retrieve a redis hash with redisson that originated in our PHP application (via Predis), I get that exception and I am unable to read that hash map from PHP key: "web:test_string_map"
Is there a way to handle cases like these?


712
RMap.getAll doesn't not preserve the order of elements

No description provided.


713
Add timeout param to RBatch

No description provided.


714
Refactor EvictionScheduler

Introduce task objects instead of methods


715
Expires for RMapCache/RSetCache entries and restarting java

Not really an issue per say, more of a clarification really.  I'm about to launch a new feature that will be making use of the expires for individual entries in RMapCache and RSetCache, and I was wondering how that works regarding restarting the Java process that created/set it.  Will they be expired on shutdown, not touched at all and the expire is lost?
Just want to be sure of what is expected when I restart my Java service.
Thanks!


716
Blocking queue/deque poll method blocks infinitely

Poll method blocks infinitely if timeout specified during invocation less than 1 second


717
Executor Service cannot execute Task

When I try RExecutorService ,found the task not execute
my example:
normal the console whill output : 000000000
but the console output nothing;
when i try this:
the console output:00000000
redission version:2.6.0
jdk:1.6


718
RedissonBaseIterator.hasNext() doesn't return false on Object based RedissonSet.

I encountered an issue on using RedissonBaseIterator.
Inside of RedissonBaseIterator.hasNext(), it checked the end of iteration by lastValues.removeAll(firstValues) when scanned result is larger than default scan count 10.
It failed to return true on lastValues.removeAll(firstValues) when values are in custom object type since ArrayList.removeAll() uses Object.equals(). An object not implementing equals causing infinite loop while processing the iterator.
I'd rather check nextIterPos == 0 && nextIter != null && !nextIter.hasNext() at the start of hasNext() method.


719
Implement RLocalCacheMapCache

No description provided.


720
Add number argument to RSet.removeRandom method

SPOP accepts an optional count argument since 3.2.0 version. It should be supported by RSet object


721
Reduce default connection pool size to 70

Default connection pool could be reduced to 70 because #680 issue has been fixed.


722
Config can not handle underscore in host

Redisson 3.1.0


723
Exceptions during shutdown

Sometimes there are few exceptions occur during Redisson shutdown process.


724
Possible PublishSubscribe race-condition

There is a rare possibility of race-condition during channel re-connection and RTopic subscription invoked first time.


725
Add timeout for subscribe operation

No description provided.


726
IndexOutOfBoundsException when reading from RMapCache

I am using Redisson 3.2.0 and currently facing a problem reading for a cached collection. The following error is thrown


728
Inconsistent Behavior in RListMultimap

I'm seeing a scenario in which RListMultimap.keySet() will return an empty set in spite of the fact that I have confirmed that data exists in the map.  The same goes for keySet().size() as well as simply calling size() on the map.
I captured the behavior .  Note that the in the expression editor the sizes are even though I had just immediately inserted the value into the map.  I also have confirmed that my local Redis instance actually contains the keys mentioned.
I tried to write a test case to demonstrate the issue, but it seems to work fine when running my test case.  However, I'm a bit perplexed to see it happening in my production code.
Could this be related to serialization or string encoding?  I dug pretty deep into Redisson's source code, but I had a hard time pinning down where in the client it actually issues the KEYS command to determine the keyset of the map.
I'd be happy to continue writing a test case, and a fix if necessary but I'm having difficulty reproducing the issue.  Any thoughts?


729
Improvements to ClusterConnectionManager

Currently we are running Redisson on hundreds of application servers to communicate with a redis cluster acting as cache. During a restart of the app servers there is a stampeding of the herd that can result in slower responses from the cluster. For our application we want to ensure that the cluster is available so we have a long connectTimeout. However we don't want to wait very long on key lookups (since we can bypass the cache if needed) so we have a short commandTimeout. In other words, we can tolerate occasional slow lookups, but we abort startup of our application if the redis cluster is not available.
As part of ClusterConnectionManager instantiation, ClusterNodeInfo is retrieved synchronously via RedisCommands.CLUSTER_NODES. It would be nice if this command respected the connectTimeout value rather than commandTimeout.
Example stacktrace of timeout leading to initialization failure:


730
Add sync listeners support for JCache

No description provided.


731
RTopic Superclass Listener

It would be quite useful to be able to add a MessageListener of any generic type, or at least supertypes. This would be extremely useful for topics that might contain multiple types of packets, especially when subscribing to a pattern. Thanks for considering it:)


732
Javadoc for org.redisson.api.RMapCache#putIfAbsent states that it replaces existing value

Same for overloaded variant. The last paragraph seems incorrect.


733
How to get redis information from RedissonClient.

Now  I want to get the redis information  that  from exceute info  command
The message content  is


734
URL.setURLStreamHandlerFactory(new URLStreamHandlerFactory()) causes throw new Error("factory already defined");

when called setAddress("127.0.0.1:6379"), it would invoke URLBuilder.init method and then URL.setURLStreamHandlerFactory(new URLStreamHandlerFactory()) which causes throw new Error("factory already defined");
Because the tomcat server already registered a URLStreamHandlerFactory, and jvm did not allow a second registration for the URLStreamHandlerFactory.


735
connection timeout problem

Hi,In my operating environment, there is firewall settings that interrupt network connections that are not operating within a certain period of time.For some reason, I can't modify firewall settings.
Now when using redisson, the console will throw an exception if it does not operate at some time.
Exception information as follows:
How should I deal with these problems?


736
NoClassDefFoundError while trying to use FstCodec

Is there an extra configuration setting that needs to be set for setting a different codec via the Config object?  I'm getting this error when setting up the client:
Setting up the RedissonClient (sentinel) like so:
Redisson 3.2.2
The json configuration is basically copy/paste from the documentation, and it works just fine if I comment out that config.setCodec(new FstCodec()); line.
Is there an additional maven dependency that needs to be included or something like that?


737
can not config with file in spring-boot

I want to configure redisson in a spring boot project, but encounter such exception:
I searched java manual and found that's because setURLStreamHandlerFactory can only be called once in a given jvm. In my case, this method has been called by org.apache.catalina.webresources.TomcatURLStreamHandlerFactory() , so when I configure RedissonClient using following code, the exception came out:
Is there a way to avoid such exception?


738
DistributedLock - Lock is getting acquired by multiple threads.

We are using distributed lock to ensure that only one thread can take a particular action, among a group of threads spread across multiple EC2 instances.
Here is a snippet that represents what we are doing.
The issue is that we are seeing multiple threads from being able to acquire and do the job.
What might be the issue? Do you see an error in the way we are using distributed locks...is there a better way to solve this problem?
Our goal is to ensure that for every job run...only one thread gets to do the job.


739
Divide by zero error in RedissonBloomFilter contains() when bloom filter is empty

If a user of Redisson sets up a RBloomFilter (the bloom filter has been successfully initialized) but does not populate it with any values, a call to the contains() method will throw a Divide By Zero exception.  The exception occurs within the hash() method when an attempt is made to use the mod operation with a size of zero.
(hash & Long.MAX_VALUE)%size;
A value of false should be returned instead.  It is reasonable that a bloom filter would be created but might be populated after application startup with values encountered by the running application.
Using Redisson 3.2.2


740
3.2.2 regression "Can't decode replay T"

3.2.1 doesn't have this issue, seems a regression:


741
3.2.1 regression "Could not initialize class org.redisson.misc.URLBuilder" @ Tomcat1

3.2.0 doesn't have this issue, seems a regression:
URLBuilder.init() seems registering a protocol handler which could cause SecurityException. Just trying to help brainstorm: any chance to catch & log/warn & move on? Above Error prevents Redisson from being loaded/used, not just that particular protocol handling...


742
Right usage of persist since getOrCreate is deprecated

Hi There,
What's the right usage of persist method since getOrCreate was deprecated on #639 ?
Thanks,
Tiago



743
Wiki sidebar is a bit difficult to use

The wiki is a great resource, but currently the sidebar is rather difficult to use. There are two things I think might be improved.
First, the wiki sidebar is sorted lexically, so the items appear in the order 1, 10, 11, 12 ... 2, 20, 21 ... I don't think github has an option to change how the pages are sorted so it's probably easy to just prefix each single digit page number with a 0, so 01, 02, ... 09, 10, 11 ... The table of contents could also be 00 to make it appear as the first item in the sidebar.
Second, every page is also in Chinese. I think it's awesome that the documentation has multi language support, but github doesn't have good support for wikis in multiple languages. Since both English and Chinese pages are side-by-side in the sidebar, only 7 pages are easily accessible without expanding the sidebar all the way. This obviously doesn't scale well as docs are added for more languages. Perhaps we could prefix the page number with an identifying code for the language so that the lexical sorting groups them together?
Thoughts? @jackygurui


744
org.redisson.client.RedisTimeoutException




745
tomcat-8.0.39 session




746
NoSuchFieldError

I use tomcat-8.0.23 and java7
I find NoSuchFieldError


747
Add getLock(key) method to RMap, RMultimap interfaces

No description provided.


749
Benchmark

I need to compare what is the performance of RCache vs RMap or redisson vs other libraries. Could you provide benchmarks?
This is more of a suggestion than an issue per se.


750
Reusing submited tasks

Hello,
I'm trying to use redisson for distributed task scheduling, but i have some problems with that.
For each app restarting executorService.scheduleAtFixedRate pushing new task to Redis, but  i want to reuse it, is there any way to solve it?


751
How to config jackson Serialize and Deserialize method for LocalDate?

If use the default data serialization——org.redisson.codec.JsonJacksonCodec; deserializer can't successful.


752
Pub/Sub removeListener/unsubscribe by the topic.

Hello,
I would like to have an option to remove all listeners for a given topic which then unsubscribes the given topic from redis.
PS: probably a hint for removeListener which listenerId to use would be great or a possibility to remove by listener instance.
Thank in advance.


753
Redisson get api  is very slow !!!!

I am using Redisson client with Redis and implemented Redisson as JSR 107 .
I am simply calling a cache through jsp but it is taking a lot of time in CountDownLatch.await().
This wait is common for every single request , so what is the possible reason for this wait ?????
Is there any client side or server side setting effecting it....
Please find Jprofiler snapshot showing Api call trace.


754
RMap get value fail

My  test code:
This is my test data:
And this is error:
And jedis work is ok
My  redisson version is 3.2.3.And how can I get test2 value by redisson?


755
Documentation on locks

I was wondering if the documentation could be clarified on what happens to each of the lock types should one redisson node request a lock, then die before releasing it while another node is waiting on it.
i.e.
If the documentation could also note suggested ways to prevent deadlocking in such cases (should deadlocking occur) that would be good too. It's not clear if the distributed locking takes into account the loss of a node while holding a lock.


756
Wiki RLiveObjectService documentation isn't up to date.

The documentation shows still the old way of using the RLiveObjectService.
But it's deprecated (issue #639) and not usable anymore.


757
Unlock does not really unlock

If you unlock a FairLock from some thread, there is a delay until all threads actually see that lock as available.
Example test clase


758
RReadWriteLock is not reentrant

I was expecting the RReadWriteLock to be reentrant, as the wiki page describes it as (emphasis mine):
Redisson distributed reentrant ReadWriteLock object for Java
However, in my simple test:
The "reentrancy" clause of the ReentrantReadWriteLock Javadoc states:
Additionally, a writer can acquire the read lock, but not vice-versa.
My use of redisson relies on these locks being reentrant (at least within the same Thread), however this does not seem to be the case - is this a bug, or a configuration issue on my end?


759
Allow to specify Redisson instance/config during JCache cache creation

No description provided.


760
Remote service registry process to consider usage of method overload scenario

No description provided.


761
NullPointerException on some weird Redis cluster status

Hi,
I use redisson 3.2.3 on my project. I try to do some Resilience test and sometimes i had this exception :
As you can see, node 299302f881862c83c4f4046df9da28a068b76b40 is slave of f19eb78f3165b800f8b2189f307c1ba1d3563476 which is a another slave (Maybe a redis bug ?)
So ClusterConnectionManager.parsePartitions generate for that slave a line like that
I'm not sur how, but it seem after that there is no other scheduleClusterChangeCheck and  this is a big probleme.
I hope this is clear. (Sorry about my english, i'm a french guy).
I'm going to to do a PR for this particular problem, but i want help to understand why this NullPoint completly kill the scheduleClusterChangeCheck thread


763
Problem with Rlock - unlock not releasing lock to waiting threads

I am seeing an intermittent issue with Rlocks. I am implementing what is basically a distributed cyclic barrier using Redisson.
I am running multiple instances of a service on different virtual machines. Each instance receives multiple HTTP REST api requests, handled by multiple threads. As each request is received it waits at a redisson count down latch until the threshold for # of requests has been reached.
At this point, I need one thread to calculate the results and store it in redis so it can be available to all the other threads across all instances. So each thread tries to acquire an Rlock (with TTL of 5 seconds). One thread gets the lock, does the calculation, and stores the result back to redis. It then releases the Rlock.
Now all the other threads that are waiting on the Rlock can (one at a time) acquire the lock, see that the data is already in redis, and simply release the lock and send the result back via HTTP, without repeating the calculation.
We are using a master/slave redis cluster with 1 master and 2 or more slaves. As well as using redisson for the countdown latch and rlock, we use jedis for standard redis reads and writes, but never using the same keys as we use for the latch and locks.
This is all working about 99% of the time. However periodically, I can see that after the Rlock is released, none of the threads that are waiting for it are able to acquire the lock. I was originally using lock(), and finding that HTTP threads were hanging forever. I switched to using trylock, and this returns, but it returns false, indicating a timeout waiting for the lock.
I have added logging to be 100% sure that unlock is being called on the lock in the failure case. Any suggestions on how I can debug this issue, or any known problems with our configuration that might be causing it?
We are running Redisson 3.2.3 and redis 3.2.5
Thanks for the help,
Sue


764
RLocalCachedMap is not Redis cluster compatible

No description provided.


765
Redisson may log RedissonShutdownException on shutdown when configured with ReplicatedConnectionManager




767
compatible with Netty5.0.x?

when to?


768
Add RPriorityQueue object

No description provided.


769
Lz4 or Snappy?

Which one gives better compression result when used with redisson in our application ?
Description :
1- I have tested both compression algorithms by importing their .jar files.
2- I have written one java program which creates a hashmap for 15000 entries.
3- I have compressed this hashmap with both algorithm and in that following is the result .
Snappy Output for hashMap with 15000 entries Object
Which one would be a better option for us in a longer run in terms of performance and code compatibility?


770
FST compatibility

Which version of FST jar  is compatible with jdk 1.6  with structure org/nustaq/serialization/FSTConfiguration ?


771
Tomcat Session Manager with Multiple Tomcat Instances

Hi,
I am trying to have tomcat session to be stored in centralized location using redisson in order to have load balancing on tomcat instances.
I have two tomcat machines behind Load Balancer. Redis stored on one of the machines. Following are the contents of redisson.conf
address is same for both the tomcat machines
I am assuming that the session for both the tomcat machines are stored in the same location and accessed from the same location. But that is not happening. Please let me know if I am missing anything here.
Regards,
Rajesh.


772
Redisson Sentinel and pub/sub

Is there a simple way I'm missing to get the current master from redisson setup using sentinel?  I'd like to subscribe to channels/topics but only on the current master as reported via sentinel.  When I subscribe to a topic, it chooses a server randomly, but I'd like to keep it to the master so I can get the number of subscribers and number of received publishes (external app doing the publishing to communicate with Java app via redis pub/sub), which doesn't work when you publish to master and subscribe on a slave (although the message is received, just no stats).
I figure either one of two solutions would work.  Query sentinel for the current master and then setup singleServer client to that master or would setting the SentinelServersConfig to read from master work to limit the redissonClient to master only? i.e.
What would be the ideal way to setup the redisson client to subscribe to channels/topics so the publisher (ext app) can see those nubmers for subscribers and msg received etc ?
As always, thanks for any help you provide


773
Unix Domain Socket (UDS) Support

No description provided.


774
Redisson connects to slaves of other masters

When sentinel announces a new slave:
+slave slave 1.1.1.1:6379 1.1.1.1 6379 @ redis-master-A 2.2.2.2 6379
redisson adds this slave to its configuration but it does not check if it's a slave of the master used by redisson. As a result redisson attempts to connect to another cluster.
The issue is in SentinelConnectionManager.onSlaveAdded


775
Indefinite lock lost during master failover

I've found my indefinitely held locks will sometimes disappear after a master/slave failover.  The block here will not reschedule a renewal if the attempt of the update fails.
The update can fail during a failover, in which case the lock is gone for good.
The exception that gets thrown when the update fails:


776
StackOverflowException in URLBuilder

URIBuilder is not thread-safe. Following scenario causes infinite recursion and StackOverflowException when someone tries to create new URL:
URLBuilder.replaceURLFactory() - URLBuilder.currentFactory set to null, URL.factory set to custom
URLBuilder.replaceURLFactory() - URLBuilder.currentFactory set to custom, URL.factory set to custom again
new URL fails on StackOverflowException. Following code is an infinite loop because currentFactory points to "this":
Affected version: 3.3.0


778
When try to define some variable throught redisson, it will read all value ofthe key!

when using the codes such as nether( found it when debug):


779
Intermittent issue with MapCache




780
RedisNodeNotFoundException : Never catch, so never release the countdownlatch

Hello,
I have a cluster 3 master and 3 slaves, freshly created.
You can see the conf in config dir and the creation script is init_and_launch_cluster.sh
I launch a Java junit test which use Redisson.
The test initialise redisson (with a scan interval set to 100 ms in order to produce the bug quicker),
and insert key into the redis cluster in 15 thread.
I launch the kill-random-redis-master_local.sh script. This script kill a random master, wait 15s (nodetimeout is 10s),
relaunch the killed master, wait 10s, and start over.
In generally 10 minutes, I have this exception :
I can't understand why there is this exception, but it is not catch anywhere.
So the thread which handle this command is stuck in await of the countdownlatch (CountDownLatch:148)
After 15 RedisNodeNotFoundException, all my insert thread are stuck, i can't insert any more
I made a little project on github, to help people reproduce this:
Thanks for you're help
Ps :  In pj you found the log of the last reproction i made (redis 3.2.6 and redission 3.3.0)
logs.tar.gz


781
Tomcat Manger App still showing session count

Hi,
I am have implemented redisson tomcat session manager. I am able to see sessions created on redis-server. But when I verify tomcat manager app - I am seeing number of sessions there as well. As session being stored in redis - i believe tomcat manager app should show 0 number of session. Please let me know if this fine.
Regards,
Rajesh.


782
Redisson Client Memory Issues

Hello,
I've been stress-testing Redis using Redisson as the client in single server mode and am experiencing steady memory consumption as I increase the client transaction rate, to the point of memory exhaustion.  Indeed, it appears Redisson connections are using gigabytes of memory.  I'm performing simple batch gets (see code snippet below).
I'm initializing and sharing the Redisson client via a simple singleton:
My Redis instance has about 54 million keys and uses about 20GB of memory.
Any advice you could provide would be much appreciated.
Thanks!
HarryTheHawk


783
Class org.redisson.codec.SerializationCodec not subtype of [simple type, class org.redisson.client.codec.Codec]

Hello,
I am getting the following error when I am restarting the tomcat server.  can you please let me know what is the issue here?


784
Using redisson as JCache implementation AND for session replication

We want to use redisson for JCache and for Tomcat session replication.
However, if we place the two jars inside the /lib folder (as explained by the documentation), the serialization of cached objects fails (ClassNotFoundException). And if we place them in the application, the application will not start because the application context initialization cannot find the RedissonSessionManager.
How can we configure redisson for both use cases?


785
command=(INFO REPLICATION) response has been skipped due to timeout

redisson-2.7.4
Every now and then logs are flooded with (org.redisson.client.handler.CommandDecoder) response has been skipped due to timeout, something funky going on wrt the INFO REPLICATION command..?


786
Can anyone provide me small Java code to implement redis pipelining ? I am using " redisson-3.2.2.jar" as Redis client.

No description provided.


788
IllegalStateException when accessing an invalidated session

Just using TomEE (Tomcat), when I invalidate a session using session.invalidate();, the next request the browser sends still has the old JSESSIONID. Tomcat doesn't seem to care about that, creates a new session and changes the cookie.
With redisson however, I get the exception posted below.
It seems that the ManagerBase does not return a session with the given ID, which is correct since the session was invalidated earlier, but then a new RedissionSession is created with that same ID which in turn leads to the exception.
After that, a new session seems to be created elsewhere, as the response contains a new JSESSIONID.


789
Call Config.fromJson(File file) method, throws StackOverflowError

When call Config.fromJson(File file) method, throws StackOverflowError, because loop call itself.
The following java test code:


791
Use PSETEX for time to live with precision of less than second

Right now only usage of SETEX is mapped.
Therefore even though the API allows setting ttl using value(long) and TimeUnit.
Using values like 1500ms gets translated into 1s, since it's using SETEX command which only takes seconds.
And using values like 700ms gets translated to 0s, which makes the command fail by being an invalid SETEX parameter ("ERR invalid expire time in setex").
Unless there is performance/memory implication i am not aware, using PSETEX for higher precision should cover that


792
DelayedQueue.remve(),DelayedQueue.remveAll() can't work,the element has not been deleted

I deleted the element, but still can consume the element.


793
More modular/optional dependency management

We are using Redisson in an OSGi environment and have a lot of trouble with updating to new versions due to additional dependencies being introduced for optional features.
In OSGi we have to make sure that appropriate bundles are available for each mvn-dependecy (whether they are only compile time or runtime) b/c the mvn-bundle-plugin will generate "Import-Packages" for these. As said that had been kind of a burden in the past b/c not all dependencies are available as OSGi-bundles.
By optional features I am mostly talking about different compression-, serialization-algorithms, javax.cache-api, Spring-Cache, etc.
I have somewhat two ideas around this:
(simplistic, short term): mark dependencies for "optional" features as an optional mvn-dependeny. By that the mvn-bundle-plugin will also mark the "Import-Packages" as optional.
(sophisticated, long term): split up the redisson library into a core-library which contains only the core functionality. Create separate projects for each compression and serialization. Which only contain the implementation of the CODEC, etc. The same for Spring- and javax.cache: they should really be two different libraries which build upon the core library. Every user can then decide which libraries need to be added to the project.


797
redisson-tomcat-8-3.3.1.jar not compatible with Tomcat 8.5.2

Using redisson-tomcat-8-3.3.1.jar inside a TomEE 7.0.0, which in turn is based on Tomcat 8.5.2, leads to the exception below. It looks like the API has changed from Tomcat 8.0 to 8.5 by at least leaving out org.apache.catalina.util.LifecycleSupport as can be seen in Tomcats repository.


798
factory already defined error when starts tomcat with two WAR apps

Hi,
I have met an issue seems have been fixed :(
software stack info is as follows:
Configuration  in context.xml of tomcat
Process  to reproduce this issue
Please note that, if I place only one war in the webapps directory, this issue won't occur ...
error  message when this issue occurs


799
org.redisson.codec.AvroJacksonCodec is not covered by tests

I've noticed that the org.redisson.codec.AvroJacksonCodec is not covered by tests like the others Codecs.
The test class: org.redisson.RedissonCodecTest instantiate all codecs with objective of test each of them.
At org.redisson.RedissonCodecTest class def, you can see this declarations:
Look for the two first lines, avroCodec is being instantiated using the same class as smileCodec,
and there is two Test cases:
But avroCodec is a SmileCodec object.
And to confirm, you can search for usages of org.redisson.codec.AvroJacksonCodec, and you'll not find any.


801
Is there any way to provide/plugin connection manager

Hi,
Currently i am trying to plugin a Connection manager and config which can auto-discover nodes in AWS ElastiCache calling an AWS api, Current ReplicatedServersConfig is limited, where in it cannot add/remove newly added/removed slaves automatically and it needs me to configure individual node addresses instead of configuration endpoint.
But i see that ConfigSupport.createConnectionManager is static method. is there any way to plugin new connection manager?


803
add attribute distribution lock to "LiveObject"




804
auto config between 'dev' and 'prod' environment

This is my application-dev.yml file
How can i config this in Application.java in Spring-boot?


805
xml schema not working

So I am setting up redisson with spring per the doc. However the schema doesn't seem to be working. I'm getting 301 and is redirected to the homepage of redisson. Am I missing something?
Please check following links:
Thanks!


806
what cause the wrong?

I have a issue,blew the exception it's what mean?


807
session data stored successfully but cannot  be reused after restart: Session xxx has already been invalidate

I have configured redisson in my tomcat and ran an web application successfuly,after an ajax request,
the session data  has been stored in redis successfully,but when I restarted tomcat and called the ajax request again,an error occured and the request responsed with error code 500, then I called the ajax request again, a new session has bean created.
the stacktrace:


808
Stack Overflow using Config.fromJSON()

Tried to update my project to redisson 3.3.1 (from 3.3.0) and I'm using redis sentinel configured via json file, and it is giving me a stack overflow (same config that works fine in 3.3.0).  Were there any changes in 3.3.1 that could break sentinel config via json?
Error is:


810
NPE during RLocalCachedMap.fastRemove invocation

No description provided.


811
add metho RScoredSortedSet.firstScore()

Something like.


813
Cache @Cacheable with sync=true never expires

I am using redisson for Spring Cache.
If I set sync=true for @Cacheable then this cache never expires (cache ttl is ignored).
Probably the reason of this issue is in code of function
Also no ZSET "redisson__idle__set__{...}" is created in Redis in this case.


814
[documentation] Config from YAML

Could I clarify if the example YAML at for cluster configuration is sufficient, I am getting "server(s) address(es) not defined!" (IllegalStateException in ConfigSupport). I already have a working cluster, YAML config documentation seems incomplete to me. (Also a cluster restart seems necessary after this config has failed).
Please note that I have just spent two hours on this problem, I am asking a question about documentation, not asking for support, I've tried just about everything I can think of, including Config.useClusterServers() which seems to reset the config somehow.


817
Redisson Compiled jar lost package

I am using redisson for Spring Session
In the source code,I can find the package "org.redisson.spring.support".
but in compiled jar from maven,The package "org.redisson.spring.support" is missing


818
Wrong encoder usage for value in `RedissonLocalCachedMap::fastPutAsync`

RedissonLocalCachedMap should use encodeMapValue instead of encodeMapKey at here


819
`RedissonSpringCacheManager` creates new cache on  each `getCache` call

Currently RedissonSpringCacheManager creates new cache on each getCache call. But it should reuse existing caches if there are. Otherwise, Spring cache interceptor retrieves new cache at each time.
This behaviour can be implemented by just extending from  org.springframework.cache.support.AbstractCacheManager and overriding getMissingCache method as implemented in current getCache method.


820
org.redisson.client.RedisTimeoutException: Redis server response timeout

We are seeing an increase in the number of timeouts lately when we try to use SET or SETX commands lately with Elasticache. Here are some details about our setup.
We use a 4 node cache.m3.xlarge Elasticache Redis cluster.
Our Redisson initialization code:
Exception thrown:
We are using Redisson client version: 2.2.27
Is 5 second timeout too low for EC2? We are operating within a VPC. All EC2 instances and cache is running within the same VPC.
Any help/guidance will be very helpful...please do let me know if i can provide any additional info.


822
Can Scheduled executor run non-serializable tasks?

I have a non-serializable task to schedule. The executor is failing to submit this task with a NotSerializableException. The task is available to the worker node in its classpath. Is there a way I can execute these kind of tasks on the worker node.


823
How can I get ttl by key directly?

Is there a way to get ttl like jedis.ttl(key) in redisson?


824
[StackOverFlowError]

I use
Java 1.7.0_75
tomcat-8.0.23
redisson-tomcat-8-2.8.1.jar
redisson-all-2.8.1.jar
And
StackOverflowError


825
why redisson start up  error   Caused by :NoSuchMethodError




826
Add NodesGroup.time method

No description provided.


827
putIfAbsent followed by addAndGet causes bad argument #2 to 'unpack' (data string too short)

Hello , have peculiar situation where below works only first time around (reason for first API call is to establish "expire" on key as addAndGet does not allow one to specify expire)
so below works fine during first run, subsequent runs Redisson throws an exception (below at the end of this post)
thanks for any input on this


828
URIBuilder seems not to be thread safe

We test this in case of a multi cluster setup and sometimes went the java.net.URL.factory to null instead of the original factory.
Best,
ebersb


829
Encountered unregistered class ID: 32

please tell me why kryo with DefaultClassResolver.readClass to error
i see #166 kryocodec kryo.setReferences(false); was change


833
Can RedissonFairLock work if my application was deployed on more than one server

For example, i deploy my application on 3 servers
now,
the first request as req1 processed by server1
the secoind request as req2 processed by server2
the third request as req3 processed by server3
will RedissonFairLock works to make sure three requests be synchronized and the process order is
req1,req2,req3?


834
Configuration in cloud

Hi Team,
We are planning to use redisson in pivotal cloud foundry. Can you please help me to configure that.
if you guys can provide some example it will be nice.
We are using redis as a service.


835
schema error in Integration with Spring  by namespack




837
Bean property 'address' is not writable or has an invalid setter method

Hi,
I have configured a plain single server install of Redis. When I configure the Redisson client within my spring XML config with a simple single-server configuration. Spring gives the following error:
Bean property 'address' is not writable or has an invalid setter method.
I had a look at the file SingleServerConfig.java file and I noticed that it has both a public SingleServerConfig setAddress(String address) method as well as a void setAddress(URL address) method. I am not sure if this is what is causing the configuration error. I have created a gist with my XML config.
Spring Version: 3.1.3.RELEASE
Java Version: 1.7
Redisson Version: 2.8.2


839
GitHub · Where software is built

[]


840
No field factory in class Ljava/net/URL

Configure as above, but raise java.lang.IllegalStateException: java.lang.NoSuchFieldException: No field factory in class Ljava/net/URL; (declaration of 'java.net.URL' appears in /system/framework/core-libart.jar) Exception.


842
SSL connection (Azure Redis Cache)

Hello!
I would like connect to Azure Redis Cache service with redisson, but I didn't find how to connect over ssl. I searched here in the redisson wiki, looked up more forums, but I didn't find anything. Can you show me a descriptoin or code sample!
Thank you!
Tamas


844
redisson with spring

hey,gays.
i want use redisson with spring


846
 RMap with byte[] key?

Is it wrong way  to use RMap?


847
redisson is so slow!

redisson is so slow!
code bellow will output :


848
change <xsd:attribute name="database" type="xsd:int"> to type="xsd:string"

org/redisson/spring/support/redisson-1.0.xsd
It will be wrong like this:
Is it?


849
Suspicious subtle bug in [RedissonCacheMap.putIfAbsentAsync]

I think there is some bug in [RedissonCacheMap.putIfAbsentAsync].
And I made this test code.
This test should be passed, but failed.
As you can see, there is no code for checking ttl or idle time in [putIfAbsentAsync] method,
not like [getAsync] or [fastPutIfAbsent] I have added.
If it's alright, I'm ready to PR to fix it.
Please verify whethrer my found is right.


850
JSR107 cache implementation should throw javax.cache.CacheException

The redisson JSR107 org.redisson.jcache.JCache implementation throws exception like org.redisson.client.RedisException. According to the JSR107 specification this exception should be wrapped into javax.cache.CacheException . This way when interchanging cache implementation one can expect same error handling.


852
Spring boot with redisson 3.3.2, 2.8.2 fails without optional actuator dependency

Actuator is an optional feature in Spring Boot, there are a lot of projects that do not use actuator due to additional dependencies and complexity.
Redisson 3.3.1 worked fine without actuator but 3.3.2 fails to start with ClassNotFoundException for org.springframework.boot.actuate.cache.CacheStatisticsProvider.
Suggested change registers Redisson AutoConfiguration only if actuator is in the classpath
Pull request #851
That pull request is only for 3.0.0 but change changes apply for the master branch


853
RedissonCache should put NullValue object instead of null

No description provided.


855
Support STORE for GEORADIUS and GEORADIUSBYMEMBER

With GEORADIUS | GEORADIUSBYMEMBER ... STORE key, Redis stores the result to the specified key, and returns the result size.
I see two ways to implement this into the Redisson API:
Add new radiusStore...() methods to RGeo and RGeoAsync, with a fromKey parameter. Search the Geo specified by fromKey, and store the result in this RGeo. This mirrors the API for intersecting and unioning sorted sets.
GEORADIUS fromKey ... STORE getName()
Add new radiusStore...() methods to RGeo and RGeoAsync, with a storeKey parameter. Search this Geo, and store the results in the Geo specified by storeKey. This is more straightforward to implement.
GEORADIUS getName() ... STORE storeKey
Which is preferred? Are there alternate suggestions? I vote for # 1.


858
about version 2.8.2 compatibly to jdk 1.6

Do Redisson  version 2.8.2 compatibly to jdk 1.6???


859
Redisson 2.8.1,application can not start




861
Jackson annotation @JsonDeserialize does not worked

Hi, I used redisson to keep my tomcat session, and deserializing session error when the tomcat was restart.
The error info is 'the class missing default constructor or creator, or perhaps need to add/enable type information'.
So I add jackson annotation JsonDeserialize to my class, but it does not worked.
Can you help me solve this problem?
I have try deserializing the class with Jackson, and it can working
The code:


862
NoClassDefFoundError after upgrading from 3.3.1 to 3.3.2

I'm using redisson JSR107 implementation and after upgrading from version 3.3.1 to 3.3.2 I start to get following exception immediately:


863
java.lang.IllegalStateException: Can't decode replay

I have this message quite often in my logs. There is a StackOverflowException happening right before that (though I am not sure whether these two correlate). Do you have an idea what is happening? Is the message too long to be processed? (Just for the context we have a pub/sub on expired keys.)


864
DnsMontioring not available in Master Slave Mode

One of our use case requires that if there is a failover, we reconnect automatically to another node. This is available in single server config as DnsMonitoring but not in Master Slave mode. Is there a specific reason for this? Can there be a support added? @mrniko


865
Lcom/fasterxml/jackson/dataformat/avro/PackageVersion




866
org.redisson.client.RedisOutOfMemoryException: command not allowed when used memory > 'maxmemory'

hello friend
For blow code with stress test redisson client, but test_redisson_set method add loop items, have Exception message


867
redisson cluster startup very slow (1.5 sec) in AWS Lambda with AWS Elasticache Redis

Hello,
I'm trying to use redisson for my project that will run on AWS lambda and will use AWS Elasticache Redis Cluster. I have the following snippet:
I had the threads and nettyThreads as 0 and that was even worse. I now set it up to 4... and the startup is about 1440 ms.
Can someone please advise the right cluster configuration for Redisson in AWS Lambda?
Rgds.
Dheepak


870
RMap.addAndGet(key,number)  threw 'org.redisson.client.RedisException' exception.

My RedissonClient codec is.
use this codec. Get RMap via RedissonClient, and then call RMAP's addAndGet method. Can be successful, but I then throw out the RMap when the exception thrown: Throws an exception: Unable to evaluate the expression Method threw 'org.redisson.client.RedisException' exception.
p.s:If the codec from KryoCodec into StringCodec or default codec(Jackson JSON) will not be an error.


871
Dropwizard support

Add metric for each command execution.
Add metrics for succeed and failed commands.
Add metrics for connections utilization


874
Issues with AvroCodec

Running redisson 2.9.1, jasckon dataformat 2.7.2.
I'm attempting to use AvroJacksonCodec with redisson client. This stack trace occurs when attempting to serialize and deserialize avro data from redis.
This is how the codec is being created (note, the environment is scala).
It works when I use JsonJacksonCodec, but not with AvroJacksonCodec. Am I doing something incorrectly which would be causing this issue?


875
why excuted RAtomicLong.addAndGet(long delta), but Bucket.get() return Integer result?

hello mrniko:
But (bucket.get()) return Integer result? why?


876
To search more than one live object by id or by attributes

With present radisson is it possible to search more than one item by id or  other properties ?
for example :
if not this way. are there any other ways to do this ?
Question 2:
Is it possible to search objects by property name?
for eg: searching customer by product id.


877
RBlockingQueue.pollLastAndOfferFirstTo does not block properly

This  bug could be a duplicate of #349 but this is not the same method.
The following code:
Does not block until a message is available
In the documentation, it is said that BRPOPLPUSH can be replaced by a call to RBlockingQueue.pollLastAndOfferFirstTo().
So this call should bock until a message is available.
As a workaround, I can use RBlockingQueue.pollLastAndOfferFirstToAsync() or pollLastAndOfferFirstTo(String queueName, long timeout, TimeUnit unit) throws InterruptedException.
By the way,  Reddis is a fantastic framework and I love it


878
what about lazy connecte to redis?

what about delay to  connect to redis, by the first function call ?
rather than connect to redis immediately  when  application startup .


879
How to listen for changes to an RMap (migrating from Hazelcast)?

I'm investigating moving from Hazelcast to Redisson and one question popped up that I can't seem to work out the answer for. Perhaps I'm trying to incorrectly compare functionality between the two?
Anyway, in our code that uses Hazelcast, we create a distributed IMap and add listeners so that each process (Hazelcast client) can listen for changes to that map. I can't seem to work out how to get the same functionality using the RMap. Is this possible or is this functionality only available using the LiveObject? Or do I have to mimic this functionality using a topic perhaps?
Thanks


880
remove dependency of jackson selectively

I configure Redisson by spring xml, and I use gson as codec, I want to remove jackson dependencies from maven, but report "No class com/fastxml/...... found" error.


881
Add RBlockingQueue.takeLastAndOfferFirstTo method

No description provided.


882
Add method to RedissonSpringCacheManager for setting an option to cache null values or not

No description provided.


883
Data serialization error




885
Scan / getKeysByPattern infinite scan

I am using version 2.2.24 of redisson and using getKeysByPattern command. It works fine if no keys are found in the redis. But, if at least one key is found then the code returns successfully. But the scan command keeps on running on the redis server.
Sample code:
Please share the sample code of getKeysByPattern command.


886
Composite Spring Cache resolution Bug

When I use CompositeCacheManager with many different CacheManagers, for example:
where commonCacheManager - is a  CaffeineCacheManager and redissonCacheManager is a RedissonSpringCacheManager, and when I try to use @Cacheable(value = "cacheName"), there is a bug in discovering a needed cache.
The deal is - spring trying to find cache by its name from @Cacheable and it's iterating through all registered caches in composite manager, calling  getCache(String name) in every cacheManager.
The problem is - in another cache managers there is an additional variable for dynamic getting cache and usual discovering. When you make a simple cacheManager.getCache("cache"), method getCache() creates a new cache if it's null and it's normal, but in dynamic resolving as in the @Cacheable annotation getCache() should return null.
Here is an example, how it's done in CaffeineCacheManager:


887
Metrics with Redisson

Is Redisson support querying metrics from Redis?
For example:


888
is someone use the Tomcat Session Manager?

i got in trouble when i use it to share session,  i Configure it as the document and  create two pods with docker ,then i visit the webapp in docker , After I login successfully, I refresh the page, it  indicating that I am not logged in,Is there anyone like me? can someone tell me something ,please


889
CommandAsyncService blocks indefinitely [without OutOfMemoryError]

all application threads are blocked with stack trace


890
Need some help to understand the cause of this error please.

Details : Redisson (3.3.1) using cluster mode:
Exception:


891
RReadWriteLock is incompatible with reentry r&w op

While using RReadWriteLock, a bug (or not?) confuse me for a long time.
I described a wrong ops yesterday, and fix it now. Sorry about this.
There is a sure logic problem if ops like this:
So if there is no holding check and running in a concurrent environment, op4 may throw IllegalMonitorException.
But it's ok as follows:
I found that "read unlock" will delete the whole lock without checking if there is any other write lock.
Is it a bug, or it just shouldn't do and need to do in another way?


892
Codec usage

The default is Jaxson, can we use a combination of Jaxson with Snappy for compression?


893
JaxsonCodec and abstract classes.

We are storing objects that is an abstract class.
The Jaxson codec fails while de-serializing the object, how to i set subType can you help me out with an example?


895
JCache: NOAUTH Authentication required error after slave crash and restart

I'm testing Redisson JCache with following configuration:
After crashing the slave (DEBUG SEGFAULT) the client reconnects but doesn't authenticate. I see endless errors like this:
Is this a bug or wrong configuration?


896
RedissonBoundedBlockingQueue.pollAsync blocks if timeout is less than 1 second

In RedissonBoundedBlockingQueue.pollAsync, if timeout is less than 1 second, it will be round to 0. 0 is interpreted as indefinite timeout. Thus, pollAsync never returns.
I understand timeout < 1 second is not supported in  BLPOP command, but at least, this behavior is a surprise for me who didn't know poll is map to BLPOP command.
I am not sure what is the best way to improve this, here are some ideas:
default behavior should round up to 1 second if not 0
do not allow time out less than 1 second
just mention this behavior in the documentation


897
redisson can use oracle jdk?

redission can  use oracle jdk? there is a old project in my company, I use the redisson as a redis client in my project ,but the console like this:java.lang.ClassNotFoundException: jdk.internal.misc.Unsafe, so I see the oracle jdk , it only sun.misc.Unsafe, thank you!


898
Nested live object returns RedissonReference?

I have a LiveObject A, with a List of B as a field. Definitions are as below:
When I iterate through listB of A, it sometimes fails with error message: "java.lang.ClassCastException: org.redisson.RedissonReference cannot be cast to com.xxx.B."
When I run in debug mode, I found out the reference has content as below:
Is this a bug or wrong usage of live object?


899
Cache ops taking too long

Currently i'm using Redisson 2.7.4  as JCache Provider, and some cache operations are taking a long time to execute, as can be seen in the log below:
in some cases it takes ~30 minutes
Taking a thread dump I noticed that all EJB async threads (and some http-executor threads too) were in the same state, generating a huge queue in the async thread pool:
Thread dump for some threads (Complete thread dump can be downloaded here):
it looks like that is a lock issue, but i don't know how to solve it.


900
java.lang.StackOverflowError




901
Data deserialization error after upgrade to version 2.9.2

I upgraded Redisson to 2.9.2 and several JsonMappingException occurred:
Looking for why it happened i discovered that it happens because support for @ConstructorProperties was added only in Jackson 2.7 version (FasterXML/jackson-databind#905) and in this commit c14e97c jackson was downgraded to 2.6.7 to maintain JDK 1.6 compatibility.
According to Jackson release notes, still be possible to use Jackson 2.7 on Java 6:
@mrniko can i open a pull request to upgrade jackson to 2.7.6 again?


902
Port out of range:-1 when using 'redis://' to configure RedissonClient

I made the following test:
I had an error message like this:
Using like this:
It works perfectly.
Shouldn't be better to accept all the configuration formats without problems? Like using config.useClusterServers().addNodeAddress("redis://127.0.0.1:7181"); (from Wiki).


905
spring boot support?

spring boot support?


906
Any way to get a list of all the map caches in Redisson?

I may have missed this, but is there a way to get a list of all the map caches in Redisson? I have this functionality in my hazelcast based code that I am trying to update and it's useful to use for logging.
Thinking about it, this feature would be useful for other collections and objects etc.
Thanks


907
Using locks to synchronize master/standby functionality?

I'm using a lock in Hazelcast to implement "single master" functionality for service applications. Hazelcast's lock is release when the owner dies.
So basically, say I have two applications that provide the same service, called A and B. A and B both start, but B grabs the lock for that service. B becomes ACTIVE and starts its processing. A becomes STANDBY and waits for that lock.
B dies, the lock is released. A grabs the lock and it becomes ACTIVE and starts its processing.
B restarts, tries to grab the lock but fails, so it becomes STANDBY and it waits for the lock.
Now I read in a ticket that a lock is still held when the owning process dies, which is counter to what I need.
Can you make any suggestions how to implement this functionality in Redisson?
Thanks again


908
Question with AWS Elasticache Redis cluster

Questions
I recently switched from Hazelcast to Redisson and I have a question about the cluster mode and sharding.
When I create my configuration, should I use useClusterServers method or another?
Which nodes address should I add? All? One node per shard? Other?
The great feature of the cluster mode is the ability to partition data accross shards. But I'm asking myself if it is automatically done by AWS? Actually, I saw in the documentation that the RClusteredLocalCachedMap is a pro feature, but by using RLocalCachedMap and AWS redis, does the sharding works as if I was using RClusteredLocalCachedMap? Or you "simply" put the data in all the nodes I provide at start?
Is there an auto-discovery features of all nodes so I don't have to hardcode endpoint addresses in the application?
Thanks,


909
Exception when removing entry from a map cache

I'm sure I'm missing something obvious here but I'm getting an exception when I remove an entry from the map cache, using the KryoNet encoder. I can put an entry into the map cache but I can't remove from it.
Any suggestions would be appreciated, thanks.


910
Feature like EntryProcessor

Would it be possible in the future to have a feature which can get entries matching a Predicate?
With an EntryProcessor i could have the ability to get all MyObject in the map that match a == "hello" for instance.


911
Simple example about how to retrieve object using RBucketReactive

I didn't find any simple examples about how to retrieve an object using RBucketReactive. Here's my example:
Can someone help?


912
Security vulnerability with jackson

There is a deserialization security vulnerability in the jackson-databind version you are using.
See Jackson Deserializer security vulnerability issue 1599
Fixed in 2.7.9.1


913
Can redisson use IBM JDK?

This is the error which i was receiving while with Oracle JDK this was working fine


914
Redisson reconnection issue.

When the network is unavailable I get the following error
Which is expected but once the network connection is restored redisson never reconnects. I am using ElasticCache and Redisson version 3.4.2. Most of my settings are default, I tried some settings but nothing works. I presume that this should happen by default which is the case when I use Jedis


915
using redisson "\xA6testok" problem

look at the code below:
why the value include :\xA2 ?


916
NPE when the value type is byte[]

I try to get the value of future.getNow() when debugging, but I get io.netty.util.concurrent.DefaultPromise#SUCCESS and the value is null.


917
configuration java.lang.IllegalArgumentException with 2.9.3

I got the error message as followed when the code to the singleServerConfig.setAddress(address);.
Fortunately, there is no error with 2.9.2.


918
Error occurred of serialization of kryo

Caused by: com.esotericsoftware.kryo.KryoException: Class cannot be created (missing no-arg constructor): java.util.Arrays$ArrayList
Serialization trace:


919
Introduce config setting to handle PubSub messages in arrival order

No description provided.


920
ExecutorService should return RExecutorFuture object with taskId

TaskId parameter should be exposed by api during task submission through RExecutorService. To achieve a new interface RExecutorFuture is required.
Usage example:


921
Add ability to submit few tasks atomically (in batch) through RExecutorService interface

No description provided.


922
Clarification on RLocalCachedMap

Just looking for some clarification on how the RLocalCachedMap works.
The documentation says it's better suited for read heavy operations (and less network round trips), which sounds perfect for something I'm implementing currently, which is a small map of runtime configurations (for simple settings like max for this and limit on that etc... Then the map in redis can be altered externally, and in turn my application without having to restart, since it's a service)
My question is does the RLocalCachedMap periodically update it's values from Redis every so often?  If so, how frequent?  If not, is there a mechanism to force it to update?  Would RLocalCachedMap be a good use case for having update on the fly, runtime config vals?
Thanks and keep up the awesome work!
P.S.
Using Redisson 3.4.3 (sentinel master/slave setup), and Java 8 on Centos linux 64bit


923
Add RList.get method to load elements in a batch

No description provided.


924
When i use sentinel mode,the attribute "database" doesn't work

here is  my config code:
when i start my application,some exception happen:
and i track the sourecode,
the code RedisConnection connection = client.connect() throws Exception:
it's seem like execute 'select 3' in sentinel, then cause the exception


925
RScoredSortedSet<String> appends unexpected double quotes to the string value

RScoredSortedSet always put the double quotes to the string value which stored in Redis. The following is how to reproduce the issue:
Add string value to RScoredSortedSet in Java
List all the values in the ZSet via redis-cli
The listed value should be "1:100" instead of "\"1:100\""


926
Sentinel: MasterConnectionPool no available Redis entries

Hi,
I have 3 nodes of redis configured as sentinel.
This is my config:
When terminating the master node, redis cluster allocated a new master but Redisson fails to recognize that and starts to fail with this error:
MasterConnectionPool no available Redis entries.  Disconnected hosts: [/100.127.5.18:6379]
Seems that it fails to recover and locate the new master.


927
Add read-through, write-through and write-behind support for RMap objects.

No description provided.


928
Can't cache methods resulting in Optional

Using Spring + RedissonSpringCacheManager, I can't cache methods returning Optional<T>. Sample:
Spring automatically "unwraps" the result from Optional before sending it to cache manager, see org.springframework.cache.interceptor.CacheAspectSupport#unwrapReturnValue:
Which returns null when the optional is empty:
Then org.redisson.RedissonMap#fastPutAsync doesn't support map's value being null, so I receive a NullPointerException.


929
Live Object with Map<> field

I am trying to use a Live Object with a Map<DateTime, T> field. I use the rLiveObjectService.merge() to persist to Redis.
I can retrieve the Live Object OK using get(), but the Map field is always empty. I have stepped through the code and the Map field is populated OK - something appears to be going wrong when persisting the Map to Redis.
If I use a List field, this returns correctly i.e. is populated.
From the Live Object example code, the Map should work.
I'm using Redisson 3.4.3.
Are there any known issues with using a Map<> field on Live Object?


930
Live Object service have issues while working with inherited classes

So i have the following use-case :
And when i make Child object as my live object as Follows :
I get the following error --


931
Add Amazon Ion codec

No description provided.


932
Redisson (3.x.x) failed to initialize in Replicated connection with one of the nodes is not online

A connection refused exception is been thrown at this line when a node is offline during the initialization period.
Problem is only related to CompletableFuture


933
Executor and ScheduledExecutor should have the ability to unregister workers.

No description provided.


934
org.redisson.client.RedisTimeoutException: Redis server response timeout (6000 ms) occured for command




935
URI Builder Issue in 3.4.3 jar- java.lang.IllegalArgumentException: Illegal character in scheme name at index 0:

Host and Port removed. tried using the 3.4.3 redisson all jar and receiving the above issue, however, this was not observed with the 3.4.2 jar. Did the node address syntax change?


936
Make RMapReactive and RMapCacheReactive interfaces match RMap and RMapCache

RMapReactive and RMapCacheReactive objects haven't been update for a long time.


937
RBinaryStream doesn't work in Redis cluster environment

No description provided.


938
No Such Method Error while upgrading from Redisson 2.2.4 to 2.9.3

Caused by: java.lang.NoSuchMethodError: io.netty.channel.DefaultChannelId.newInstance()Lio/netty/channel/DefaultChannelId;


939
Reactive Stream methods are executed immediately after Publisher object creation

Reactive Stream methods should be executed only after Subscription.request invocation


940
RLexSortedSet should extend RSortedSet

No description provided.


941
Resisson Spring Session - Spring Security

Friends I am integrating redisson with spring session and spring security I have the detail may be something in my configuration.
I understand was added to Jacksson2 support to spring security but I do not know if it is only for the client that they handle could guide me in this please
Based on the following example and add what the redisson documentation indicates. In the redis client I see that the session key is created
Thanks, forgive me, my English is new to this.


942
SCAN command is not getting used in deleteByPattern

#534 issue is not fixed.
The code is still not fixed. I am using elasticache servers and redisson version 3.4.3


943
Cannot connect using Sentinel and Database != 0 ("unknown Command SELECT")

SentinelConnectionManager fails with
because Sentinel does not understand SELECT
should be fixed in org.redisson.connection.MasterSlaveConnectionManager#createRedisConfig
setDatabase should only be called for non-sentinel instances


944
RedisNodeNotFoundException: Node: /xxx.xxx.xxx.xxx:xxx for slot: 15242 hasn't been discovered yet

This is log print.......
This is jstack print......
Whenever this problem occurs, restarting application will resolve this error
i had talked to Nikita Koksharov
and i think the problem is that
when redis cluster update metadata, redisson can't be noticed right away,then it read the old metadata,but why the thread be stopped?
please help


945
Redisson tries to write to a read-only slave

I have a requirement where I need to read and write from only master, so that our application gets consistent data from Redis. At the same time, we need HA and automatic failover.
To satisfy above requirements, I am using Redis master-slave setup, with sentinel, and with read mode as MASTER. The issue I am facing is, Redisson tries to write to a read-only slave and Redis throws exception.
To reproduce the issue, perform following steps:
Configuration and other details are as follows:
Maven dependency:
A test spring scheduled job that reads and writes dummy data:
As you can from see in above above logs, node 127.0.0.1:6381 joined as slave (but was master in the beginning). But Redisson tries to insert data into it.
Please let me know if I am doing anything wrong in my configuration, or this is a bug with Redisson.


946
reconnect on network down

Hi. Debugging my swarm cluster and down my network, then I see:
Message: org.redisson.client.RedisTimeoutException: Redis server response timeout (500 ms) occured for command: (INCRBY) with params: [..., 0] channel: [id: 0x315e345a, L:/172.18.0.8:54874 - R:/192.168.167.182:6379].
Only restart help me. Why can you reconnect?


947
Connection Count

Who controls the count of connection to the remote server? You or I?


948
Pls implement Priority Blocking Queue

Hi,
I have a requirement where I need to use take() from RPriorityQueue, But I can't found any RPriorityBlockingQueue, can you implement Priority Blocking Queue?
PriorityBlockingQueue oracle doc


949
RMapCache remove, put, putIfAbsent, replace methods aren't respect entry expiration

No description provided.


950
cloud not find redisson:client in config xml when server start

errorInfo:
org.springframework.beans.factory.xml.XmlBeanDefinitionStoreException: Line 26 in XML document from class path resource [application-service.xml] is invalid; nested exception is org.xml.sax.SAXParseException; lineNumber: 26; columnNumber: 42; cvc-complex-type.2.4.c:
my config as bellow:


951
RedisException: ERR Error running script




952
can I use redisson with spring-session as a spring-xml config

I can't find the example how can i use redisson with spring-session as a spring-xml config
this is my spring-xml
Now I config redis-server twice  and  i must  add spring-data-redis and jedis for the spring-session. the redisson's wiki show the code  we can config with java code to use this 2, but i don't know how can i use thsi 2 with  spring-xml config


953
Parse URI error in 3.4.3

After updating to 3.4.3 I got a parse URI exception by setting my Redis address, which is in the form: redis-instance.something.else.0001.euc3.cache.amazonaws.com. Switching back to 3.4.2 everything works fine. The error relies in org.redisson.misc.URLBuilder.create which has been changed in 3.4.3


954
[Question] Netty dependencies problems / shading

Since netty keeps being a source of headaches sometimes, specially when using this library in combination with Play Framerwork or AsyncHttpClient or gRPC, as all of them use Netty, and netty seems to not play very nice with differences even on minor and hotfix versions.
Now i am testing with the newly release play 2.6 which has netty 4.0.x but since this version they shaded it, but i am still having issues when trying to use the nativeEpoll and including the dependency to redisson, I am still trying to figure out the cause, since the dependency is there but i still get
java.lang.NoSuchMethodError: Method io.netty.channel.epoll.Native.recvFd0(I)I not found
I will be testing a few more things soon, but if anyone has observed anything like that using play 2.6, feel free to mention.


955
 what is the best way  to store a MultiLock between web request?

If i want to lock a MultiLock in a web request,and unlock it in another web request, what is the best
way to store the multilock ? Maybe  the two web request will been distribute to different tomcat server.
The root cause is we can not unlock a multilock with a lock name .


956
how to use redLock in cluster

I have build the cluster of redis, 3 master, 3 slave. According to the Redlock algorithm: 'It tries to acquire the lock in all the N instances sequentially, using the same key name and random value in all the instances'.'
i think every lock name is must same, it's right?the following is my example, this is right?
Thanks!


957
Redisson 3.4.3. Wildfly. Sentinel. Netty exception : "Too many open files"

Hello! Could you please explain what's going on?
Using Redisson 3.4.3 in Java EE with Wildfly 10.1.0.Final on Linux in production.
JRE 1.8.
This is how I configure it (may be not the excelent solution, but anyway...):
And all the Stateless beans use this static RedissonClient instance to use API's business.
After some time (about several hours) I started to face to this stack trace (even if no invocations of Redisson API were done) :
ulimit -a gives me nofiles = 64000 soft and hard, and it is said to be good for production environment.
How to deal with it?
(Fortunatelly the problem had some not excellent solution : I switched to single server configuration, and that worked for me, but how about API's sentinel configuration?)
By the way since Redisson uses netty, how to (or should I at all) correctly deal with EventLoopGroup, mentioned in this theme with almost the same issue ?
As far as I understood from that article, EventLoopGroup should be shared between clients.
But EventLoopGroup is not mentioned in Redisson documentation at all (Am I wrong?)


958
Migration to Project Reactor 3.1.0

Reactor is about to be released. It would be great have Redisson compatible with the latest version


959
Can Redisson3.4.3 support spring session 1.3.x?

When I use spring session with redisson, I got some error when call session method


960
how to set comparator when using priority queue

Hi, I'm new to redisson. And I'm learning using priority queue with customized comparator. My code works well for the first time, but fails the second. Seems it cannot load the comparator class.
Here's my code.
The exception:
So anybody can tell me how to write customized comparator for priority queue.
Thanks so much !


961
Unable to locate Spring NamespaceHandler for XML schema namespace

version:2.9.3


962
Add RLockReactive

No description provided.


963
Add RReadWriteLockReactive

No description provided.


964
RLocalCachedMap with JsonJacksonCodec

Hi. Why this code does not work?


965
Add support for DEL unlink and async FLUSHDB & FLUSHALL operations

No description provided.


966
why not poll a RedisConnection directly without using connectionFuture

in class CommandAsyncService 498-503 line
In my opinion, after the bootstrap(RedissonClient redisson = Redisson.create(config)),we have
Created serveral long connections  from the client to redis server.
Can we poll the connection from che ClientConnectionsEntry.freeSubscribeConnections  directly
without using the connectionFuture. I think using che connectionFuture is nonecessary.
Who can answer the question?Thanks


967
java.net.URISyntaxException: Illegal character in scheme name at index 0

Hi team,
It throw an error, but it works fine @3.4.2 without prefix (redis://)


969
reactor/fn/Supplier : Unsupported major.minor version 51.0 (unable to load class reactor.fn.Supplier)

When i use redisson 2.9.4 , i find this error in logs


971
Redis timeout in AWS Lambda

Hi,
We are trying to figure out the cause of an error we are seeing in our logs.  We are using AWS Lambdas and using a Redisson read write lock, with a lease time of 10 seconds.  There is no obvious place where there error is raised so we are wondering if this is a background task that is timing out as a result of the AWS life cycle see The Freeze/Thaw Cycle https
Is this an exception we should be worried about?
Thanks,
John


972
Tomcat does not delete keys on Redis when session expires.

Hello,
I'm using Redisson with two Tomcat, each one in a virtual instance behind a Load Balancer on Azure, using Azure Redis PaaS as centralized database.
Everything works great, both Tomcat can create and store session on Redis (I can easily see keys/values serialized on Redis) and both can retrieve the stored session correctly.
My issue/question is: should Tomcat be able to delete keys automatically from Redis when the session expires? The sessionDestroyed() method on the SessionListener in correctly invoked, so I'm sure that Tomcat is destroying the session internally, but keys keep staying on Redis. I was assuming that Tomcat, through Redisson, whould be able to delete keys from Redis as well.
Thanks.
IP


973
How to use the pagination in redisson

If I have a list or set to save data,How can l get data by pagination?
Thanks


974
tomcat session replication with non-sticky session not working, multiple issues

Hi,
I'm trying to setup a Tomcat 8 cluster with 2 nodes without sticky session.
Issues:
1.java.lang.IllegalStateException: setAttribute: Session [F766FB4EAE8FE29451215A67300EF46A] has already been invalidated
1. From RedissonSessionManager and RedissonSession i can't understand how this solution replicates in real time( no sticky sessions) the same session from one node to another.I was expecting that method getAttribute should use the map also. If someone can explain this.
And a feature if it is possible:
can we filter some session attributes from going into RMap?
Thanks.


975
Exception in thread "redisson-netty-17-12" java.lang.NoClassDefFoundError: ch/qos/logback/classic/spi/ThrowableProxy

I use redisson with springboot,throw the following Exception when starting:


976
RLocalCachedMap doesn't work with non-json and non-binary codecs

No description provided.


977
Add RSemaphoreReactive

No description provided.


978
Retrieve RMap keys by pattern

Hi,
Redis has the feature HSCAN to retrieve the hash keys that matches the given pattern.
I will retrieve the values one by one through get after filtering the keys because some of the keys will contain objects that do not exists for the certain environment.
Is there a way to do this without modifying your code?
Thanks =)


979
Spring Cache Manager with local cache support

No description provided.


980
none




981
Class org.redisson.spring.cache.NullValue does not implement Serializable or externalizable

Hi team:
redisson throw an error when I put a "null value" into cache with fst codec, but works fine when I use kryo codec.


982
memory leak

Hi, I got some error when I try to undeploy or reloading my webapp in tomcat manager.
spring config
I also tried @PreDestroy on app destroy event as following code, but same error.
any idea?


983
org.redisson.spring.cache.createDefaultConfig() return CacheConfig can`t use in application




984
none




986
connectionListener methods won't get triggered

I wanted to sure the connection still alive while putting objects to Redis and so tried to add connection listener. But the methods won't get triggered.
The redis version I'm working on:
The output:


987
RScoredSortedSet race condition with Redis cluster

We are running two redis servers in AWS, one master, and a replica. The read mode is the default (slave).
In our application code we have something like this..
The issue is that since reads go to the slave, addasync returns from master and before the data replicates to the other server it tries to pull the new revrank and returns null. imo the following api would make more sense and avoid that race condition..
In the meantime I will either add retry logic or change the read mode to master but that's not going to scale in the long run so it would be nice to have this addressed.
Cheers!


988
SSO One Login APP  Different applications

Greetings.
I have an application consisting of two applications in one ear. And we have separated them in two .war.
These applications share the session in redis database whit Spring Session Fst coded. The point is that there are classes that an application does not have in another and deserializacion fails. Is there any way to add a list of in each app to omit deserialization by class name so that each application gets the object it wants to share. There apps in Jsf and various session manage bean each .war.
Thanks sorry for My English.


989
none




990
o.r.c.ClusterConnectionManager - Command execution timeout for Nodes

I am not able to connect to redis cluster on my local machine using redisson but single redis server is working in redisson - kindly check the issue and let me know if there is something wrong on my end or some actually with 3.4.3 version of redisson.


991
Hibernate Cache with local cache support

No description provided.


992
Exeption with netty 4.1.13.

We are using cache to generate some events on key expiry. As version 3.4.4 has support to add listeners directly using cache.getCollection.addListener. We are getting following exceptions and unable to find out the reason.
I checked the code of netty.jar we are using and Bootstrap.config is present.


993
Redisson Connect to Cluster via DNS

It will be nice to have a functionality to connect via redisson to redis using a DNS as hostname instead of specifying host:port of all the nodes.


994
Android build issue Invalid class reference (redisson 2.9.4)

While building for Android I get following error
Error:Execution failed for task ':app:transformClassesWithNewClassShrinkerForFikDebug'. com.android.build.gradle.shrinker.ClassLookupException: Invalid class reference: org/springframework/beans/support/ArgumentConvertingMethodInvoker


995
none




996
Expiring a live object won't expire those fields that are distirbuted objects

I define a live object like this:
Then try to expire a live object:
RLiveObjectSerivce service;
ExampleLiveObject liveObject;
The live object will be removed after one second, but the map in the object won't. Is this behavior expected?
My current workaround is to expire each distributed object field in a live object explicitly.


997
redisson getkeys iterator got more keys than counts

The counts of keys are 3000 for example, but the iterator seem never stops counting. Why?


998
Storing Redisson Live Object in RSetCache

Hi,
Is it possible to store Redisson Live Object in RSetCache such that when the live object expires, it is evicted from RSetCache as well?
Also can we access the Live Objects from RSetCache?  While iterating over the live objects in RSetCache, I tried to assign the object to an instance of Live Object Class but I got an error stating that I cannot typecast object of type RedissonReference to object of type Class X.


999
Issues when master goes down

Hi,
I have configured redisson with the following configuration
I am initalising reddison client at the start of my application like this
I wanted to test the scenario of how redisson behaves when master  goes down
I brought the master node down and  it was back up within a minute
I see this in redisson logs
So redisson aware of the new master
However I am getting this exception from the logs
My redis cluster is very simple. It is using kubernetes helm chart https to use redis as an in memory cache
Could you please advice if anything is wrong with the configuration or is it a bug?


1000
RemoteService invoke very fast,the remoteServer register point has a warn,what wrong is it?

I do a RemoteService invoke test,it report a warn,then the remote client wait timeout.what wrong is it?


1001
about RedissonRedLock

I need a exclusive lock,but it not work,my code is :
java 1.7
redis_version 2.8.6
thanks


1002
RedissonLock confuse

I wanna know when to execute the 'else' block?
because tryLockInnerAsync just return null or pttl.
The command returns -2 if the key does not exist.
The command returns -1 if the key exists but has no associated expire
firstly, if the key exists, it must have a ttl time, so return -1 will not happen.
secondly, if the key not exists, the lua script will return nil before execute pttl.
conclusion: 'else' block will not be executed.
or is there really happen in lua script:


1003
Does redissonLock  enforce the same memory synchronization semantics

as we all know,redisson lock implemts java.util.Lock,so dose it enforce the same memory synchronization semantics as provided by the built-in monitor lock  just like ReentrantLock??


1004
Class Cast Exception while converting object to RExpirable

I'm using an REntity object that I'd like to store in the redis store. And I'd also like to set the expiry time as 30 miutes for the same. But whenever I use the RExpirable function I get the ClassCastException.
The REntity class that I'm using
The persist function works as I'm able to retreive the data back. So the redis config is fine. But the following exception is being thrown.
Any help is appreciated. Thanks!


1005
RMapCache Listener in Cluster Environment

Hi,
We have a trouble with Redisson RMapCache in a redis cluster.
Map Initialization
With our app configured with one redis, we have no trouble, the listener is called once
But we experienced troubles with a redis cluster with 3 nodes, the listener is called 3 times.
It seems that every node send an expiry event...
Did you have any similar troubles?
Thanks


1006
Hibernate Second level cache with Redisson JCache API

We want to use JCache API for hibernate second level cache. We have successfully done a POC for basic scenarios of Caching using hibernate-jcache 5.2.9 with Redisson 3.4.4.
How do we provide configurations such as expiry time (time-to-live) for individual Cache(s)?
(Couldn't find much info in the documentation for JCache API.)


1007
none




1008
Traversing the RLiveObjectService

Hi. Is it possible to traverse all the objects in RLiveObject Service?


1009
DNS monitoring in Replicated mode?

Hi,
I have a question regarding the DNS monitoring. Looks like the 'dnsMonitoring' can only be set when using single server config, but not in ReplicatedServersConfig. We are currently using AWS elasticache and we found in the AWS document, it highlights that "It is important that client applications are configured to frequently resolve DNS names of cache nodes when they attempt to connect to a cache node endpoint." So does redisson have the ability to detect potential ip changes on endpoints when using Elasticache?
Based on my test, when I 'restored' an endpoint with the same host url but a different ip address, redisson kept using the last known ip address to try connect to that endpoint, but never detected the new one. I tried to change the ttl in java.security and it didn't help.
Please let know if you have any ideas on this one. Thanks.


1010
Latencies when Redis server is down

Hi,
During our tests of redisson, we noticed that if the redis server is down, the latency is around 100ms, no matter what.
This is problematic for our use case because it slows down too much and we would prefer a fast response/error.
After carefully reading configuration options and experimenting with many tests, we could not find a solution.
Do you have an idea of what could provoke this latency ?
Below is a simplified code allowing to reproduce it (no need to launch a redis instance):


1011
none




1012
none




1013
[maybe a bug]I use RBatch to read and write bucket data,when redis cluster failover,the old master's ops and cpu ratio become very high

Hi,please check whether this situation is a bug:
1)I use RBatch to read and write bucket data,so that I'can use the redis pipeline mechanism.
2)redis is in cluster mode,the version is 3.2.9; redisson version is 3.5.0.
3)when I killed the redis master instance,until failover,and restart it.now the old master become slave.
4)use info command to observe the old master's cpu ratio and instantaneous_ops_per_sec indicator,I find it's very high.cpu ratio is 400%,and ops is nearly 200,000.
5)I killed the redisson process,and the old master instance become normal.
here is my configuration:
and my code below,I implement codec interface using proto buf as the codec:


1014
none




1015
why the property 'address' is not writable or has an invalid setter method?

This is my set in the spring.xml:
Please help me,Thank you.


1016
Config.fromJSON thow an exception

the redisson version is 3.5.0,
follow is the StackTrace
then i copy this code to eclipse ,and eclipse report an Compile error like follow:
 The method setFilterProvider(FilterProvider) is undefined for the type ObjectMapper
so I think there is some problem in the jar of 3.5.0 version


1017
Can't create SentinelServersConfig using ip:port configuration

Hello, I'm trying to use redisson 3.5.0 with the same settings where I previously used 3.4.1. However, the steps below don't work anymore.
SentinelServersConfig sentinelConfig = config.useSentinelServers();
sentinelConfig.addSentinelAddress("10.10.10.0:16380");
This code results in the following error messages:


1018
Optimize memory allocation during encoding process

No description provided.


1019
redisson 3.5.0 clusterServersConfig server can't start

my project can't start. i debug ClusterConnectionManager.class file. connectionFuture is not completed
redisson:3.3.1 is OK.


1020
none




1021
Connection could be in closed state during reconnection process for blocking queue

No description provided.


1022
support fair share scheduling?

alll client try to get  lock fair .


1023
Sentinel response timeout defined as retryInterval*retryAttempts in Sentinel Mode

In sentinel mode timeout for sentinel response is configured as retryInterval*retryAttempts. This make it impossible to set retryAttempts =0 in sentinel mode.
Also RBatch retryAttempts cannot be set to zero.


1024
Add iterator by patter method to RSet objects

No description provided.


1029
Monitor calls to redis

Hi,
We wanted to monitor the calls made by our service to redis. For this, we were currently checking the calls made to RedissonCache get/put/putIfAbsent functions.
Could you please let us know if this is the best approach or we should be monitoring some base method that is ultimately used by all wrappers to execute redis operations.
Thanks


1030
During the load testing got org.redisson.RedissonShutdownException: Redisson is shutdown , but there isn't  start() method to restart it again! 0

My application only use the Redisson lock/unlock feature as below:
redissonClient.getFairLock(name).lockInterruptibly(expiredTime, timeUnit);

 redissonClient.getFairLock(name).unlock();


Then I do load testing finally I got the un-recoverable errors as below:
org.redisson.RedissonShutdownException: Redisson is shutdown
        at org.redisson.command.CommandAsyncService.async(CommandAsyncService.java:477)
        at org.redisson.command.CommandAsyncService.evalAsync(CommandAsyncService.java:453)
        at org.redisson.command.CommandAsyncService.evalWriteAsync(CommandAsyncService.java:395)
        at org.redisson.RedissonFairLock.tryLockInnerAsync(RedissonFairLock.java:126)
        at org.redisson.RedissonLock.tryAcquireAsync(RedissonLock.java:172)
        at org.redisson.RedissonLock.tryAcquire(RedissonLock.java:145)
        at org.redisson.RedissonLock.lockInterruptibly(RedissonLock.java:114)

So I post two issues:


Issue 1: What does cause the Redisson shutdown without call redissonClient.shutdown() during testing


Issue 2: It need to provider below API when application encounter this error to restart its connections:


redissonClient.start();

or
redissonClient.restart();

when encounter this error, but there isn't this method.


1031
class 'LoadBalancerManager' in  version 2.10.1  may cause the NullpointException in method 'returnConnection'

i updated the version to 2.10.1 in my project.
when i use redissonClient.getBucket("thekey").isExists(),some exception happen:
the code connection.getRedisClient().getAddr().getAddress().getHostAddress() returns ip address, but the map ip2Entry need the key: ip + port.so null is returned


1035
Huge log messages

I started testing redisson with my app (Redisson 3.5.1), first issue i discovered:
Writing about ~23mb data to redis map.
Error message generated with size ~180mb when RedisTimeoutException accured.
I guess issue with line that blindly call toString:


1036
Support for setting maxSize for bounded RedissonMapCache

While implementing support for setMaxSize in RedissonMapCache we noticed a bug in the eviction where it may evict more elements than the value set for max size. Here is our work in progress


1037
RedissonMapCache merge conflict lost fix for setting large amount of items

@mrniko 2bdccfc#comments


1039
NullPointerException is thrown during cache deletion

We encountered an issue during deleting cache while using RedissonKeys.delete after upgrade Redisson from 2.2.16 to 2.3.0. I have verified same issue with latest version 2.10.1 as well as 3.5.0.
My unit test was very simple, the main thread keeps deleting 40 keys while another thread keeps setting the same.
I am very curious why 2.2.16 does not have this issue. The only change I could find related to this is "switched from io.netty.util.concurrent.Future to org.redisson.api.RFuture".
Well also surprisingly I could not find any same issue reported by anyone else.
The exception information is like this:


1040
RMapCache EntryListener events

I am testing the RMapCache listeners using redisson 2.10.0 release, when I executed the sample code from the wiki of distributed collections, the code is not executed. I am not sure what I am missing here or is this a feature that is only available with Redis Pro, can you please take a look and guide me.
Below is the code


1041
Single connection sharing

Example context:
When you have multiple client apps (near 1000) connecting to the same redis nodes and you don't want the redis nodes (or they can't) handle the amount of connections from all those client connections pools (file descriptors, etc).
Besides of course, having small connection pools or having more redis nodes.
Is there any plan or way to utilize redisson on a single shared connection model?
Like for example other redis libraries does


1044
Bug/Feature-Request: Non-Expiry updating  boolean add(...)  in RSetCache

Hello,
I am using RSetCache as a lock for various work item.
If the item is in the Set, somebody is working on it. The worker that "locks" the item has a certain amount of time to finish the work, otherwise the "lock" on the item is removed and some other worker can try to claim the item.
See
boolean org.redisson.api.RSetCache.add(Long value, long ttl, TimeUnit unit)
Unfortunately, each call to add updates the expiry timestamp of the item, even if add was not successful  because it was already added.
That means that, when the worker is killed/hangs/..., the work will never be picked up after the 5 minutes, because each try to reserve the item fails, but updates the expiry.
It would be great to have an atomic method which:
Only adds if new
Only sets expiry if added
Returns true if value was added


1045
none

[]


1046
Redisson 3.5.2 memory leak with pooled buffers




1047
[Feature enquiry] Redisson create throws exception when the redis cluster is not ready.

I was wondering whether the presence of the redis cluster is must to instantiate the redisson client via Redisson.create(config)).
I am evaluating the Redisson along with Jedis. I noticed that Jedis does not require the redis cluster to reachable when instantiating the client. However, redisson throws exception if there is no redis cluster exists.
We have the use case where our service is started when redis is not available and we expect the redisson client to retry to connect to redis cluster by itself when it is asked to retrieve value.
Could confirm whether this is supported feature or not?
Sincerely,
Peter


1048
Redisson hang on RBatch.execute()

Hi, we are using redisson client for our multi-threaded application.
We use RBatch to batch two commands as below:
During the test, we noticed the hang several time.
We first show this error first before the hang:
Then our thread calling the batch hung. There is the stacktrack:
I tried to set the lower lockWatchdogTimeout and set the batch timeout but this did not help.


1049
[Redisson 3.5.0 and 3.5.3]Executor service Error

The following call does not return
It neither prints "result" nor returns and Redisson node prints many errors.
I am using Redis 4.0.1 and Resisson 3.5.0


1050
none




1052
Redisson 3.5.1 NullPointerException in Sentinel mode - Not working at all

We just upgraded our redisson library from 3.3.2 to 3.5.1. Our application has no problems when run in a single Redis server mode or with 3.3.2, but when we run it in a sentinel mode with 3.5.1 it does not work at all, constantly generating error messages. Our sentinel cluster consists of 3 servers (master and 2 slaves) and 5 sentinel clients. Redis version :3.2.8. Here is example of error log
Here is our Sentinel info


1053
[Redisson 3.5.3] MR Collator Nullpoint Error

Classes:
Result as following: mapReduce.execute(new WordCollator()) is error.


1054
EnableRedissonHttpSession and spring security throw exceptions

use spring-session+redisson+spring security(spring boot 1.5.7, redisson3.5.3, spring-security4.2.3),when i access controller throw exception like this:


1055
[Anti-Fraud]Is Redisson suitable for redis to develop the realtime anti-fraud system?

@mrniko
Hi, Master.
Is Redisson suitable for developing the realtime anti-fraud system which needs high performance, such as 10 millisecond to finish the computing?
Thank you very much!


1057
Is RedissonBoundedBlockingQueue thread safe?

I'm confused when I read RedissonBoundedBlockingQueue.takeAsync() as follow
the takeAsync method first use BLPOP to take object from redis,then if success will call releaseAsync() to increment capacity, I think that two request is not atomic operation, and will cause concurrent issues?


1058
none




1059
Clean stale scheduled tasks

How properly remove stale tasks if my supervisor(who submits tasks) not gracefully exited - crashed.
Workers(redisson nodes) see submited task, executes them and put result back to redis. So after several crashes of supervisor I'v got alot of staled tasks: around 3k.
So how gracefully handle this? What you would recommend to handle this situation?
I have used Distributed scheduled executor service.


1060
Use map,when some value be null,can't get from redis server,and can't set to redis server too

Because map use the jaskson codec,it seem can't resove empty value.But redis server support it.
How can i do this?


1061
Possible race-condition during write operation cancellation

No description provided.


1062
"Too many open files" error when running redisson pro in clustered mode.

We are receiving an issue where we start getting the "too many open files" error in production.  This happens roughly 60 minutes after the application is running.
We create a singleton (using Guice) that is injected into relevant classes in our application:


1063
Is there a way to make a specific key locate on a specific redis instance in cluster mode?

I want to make my multi-locks locate on different redis instances.
I find out that redission can specify an instance to execute command on, but if the command is key-related, the instance specified will transmit the command to another instance.
Can you give me some advice?


1064
Spring Cache Too Many Eval Calls and not setting TTL on the keys

We are using redisson with spring cache and setting ttl on our keys. The problem is that we are not seeing any ttl being set on any key. Instead, I can see that some unnecessary keys are present in the redis database.
Here is the result of "keys *" command:
You can see that for a key "release", the redisson creates two more keys "redisson__timeout__set:{release}" and "redisson__idle__set:{release}". Also, there is no ttl present on key "release".
My code is :
We are using caching here:
We are not using zset and eval commands. But, still the use of these calls are too high from redisson.
Also, I have see that there are almost ~4M sortedSetTypeCommands on the redis cluster from redisson under our peak load which is degrading our performance.
I want to know why redisson is not setting ttl on the key and managing it using sorted sets on the client side. It is not advisable to do it on the client side if the server automatically gives that feature.
Is there any way to disable this ttl management from redisson so that it will just set that on the redis server and these calls are not fired.
PS: We are using AWS elasticache redis server.
Redisson version: 3.4.2
Redis Version: 3.2.4 with 1 master and 3 slaves.


1065
initialDelay: -1 (expected: >= 0)

use redisson in spring-boot with spring-data-redis-stater.
startup exception stack:


1066
Use host alias throw Exception when alias contain '_’

My host alias is redis_db, test found that contain '_’  will throw this Exception.
Caused by: org.springframework.beans.PropertyBatchUpdateException; nested PropertyAccessExceptions (1) are:


1067
Add maxSize setting for SpringCacheManager

No description provided.


1069
redisson throw exception 'Exception in thread "redisson-3-10" java.lang.ArrayIndexOutOfBoundsException: 1'

redisson running on tomcat.The program is working.redisson throw exception few minutes,


1070
Making dependencies optional for easier OSGi deployment

Marking javax.cache api and reactor-stream dependencies as optional in pom makes it easier to deploy redisson in an OSGi environment when not using these modules. This change is in continuation to #793


1072
Bogus map entries in RMapCache

Using version 3.5.0, we've noticed a very strange behavior in RMapCache map-iteration APIs (keySet,  entrySet, etc). It seems that the map sometimes contains "inverted" entries in which the key looks like a (bogus) instance produced by a value encoder, and the value looks like an (again) bogus instance produced by the key encoder*. When they do, these entries show alongside the normal entries. It's only because of Type Erasure that the code doesn't break until one actually calls an iterartion API: Because the original entries are still in place, get, put, etc. works as expected even when the map is in this broken state. We've managed to workaround this issue by using readAllKeys rather than keySet.
We have a custom extremely type-aware jackson-based codec, which makes this bug very easy to spot.


1073
RedissonSpringCacheManager does not take into account default cache config parameters.

Hello, seems there is some tricky code which creates the wrong type of cache map.
RedissonSpringCacheManager has the protected method:
Also it would be really great to have an ability to set ttl and max idle time by default for all caches.


1074
UI - Project Dashboard

Wrong window


1075
Implement proper RedisLoadingException handling during RedisClient reconnection

Code:
Test
redis-cli PUBLISH aaa 111 # works


1076
RedisConnection can not close




1077
RedissonClient with useSentinelServers cannot reconnect resurected slave

Hi,
I'm testing the useSentinelServers connexion. I have 1 master and 1 slave.
If I kill the slave, wait and then restart it, I have the folowing trace in the Tomcat console when
calling redisson.getNodesGroup().getNodes().
If I look at the Redisson ConnectionPool.java, I see that the method will never retry a connexion on a freezed slave :
Question : How can I get Redisson to reconnect the resurected slave ?
thx,Xavier


1079
Upgrade from 3.4.2 to 3.5.3

We have been using Redisson successfully for the past few months, since our version was pretty old we just tried and upgrade to the latest version today.
With version 3.4.2 we used  SnappyCodec as follows
This setup fails with the new 3.5.3 version
Example client usage
With so many release since 3.4.2, many other codecs have been added. We store JSON string so which is the best codec to use for this case?.


1080
Wait Command Support

Is the wait command not yet supported in Redisson?


1081
Many invocations of getEntry and getClient

Hello,
We have performance issue in org.redisson.connection.MasterSlaveConnectionManager#getEntry(java.net.InetSocketAddress)
We did profile the JVM to see what's happening and we have a lot's of invocations in this method.
While looking at the code, we found a
Is there an optimization planned on this part of the lib soon ? Do you have any workaround to fix this ?
Thanks !


1082
Add null value support in RMap.

No description provided.


1083
Data encoding should be executed on client thread only

It's important to do execute data encoding on client thread rather than netty's event loop.


1084
Better collection handling for RedissonReference

No description provided.


1086
Test classes compilation fails on master

Hi, when I try to run tests on master (063dcab) as CONTRIBUTING.md states, I get the following error:
It's likely due to the spring version being used, [3.1,4.3).
Maven version:
Am I doing something wrong or is it actually failing?
Thanks!


1087
Current Connection Max Out when using Distributed Schedule Service ·

Hi,
We are using AWS Elastic Cache (3.2.4-cache.m3.xLarge).
We are trying to solve for scheduling events using Redisson Executor Service (https). We have a setup of 1master and 4 slave nodes.
When we are trying to send scheduling request at rate of around 1000 request per sec for more than 1hour duration, we are seeing that current connections shoots up to max and they are never reclaimed and the app starts throwing errors.
These are our Redisson Client setting: (Replicated servers configuration)
We are creating a executor service on startup and use it throughout the app. We are using the scheduleAsync function and Runnable implementation.
We have a 6node (EC2 instanceC3.xLarge) app Cluster taking to Redis. (Each node has the above configuration)
Can you please help provide guidance as to what might be the issue here and how we can resolve it.
Thanks.


1088
Add connection PING support

No description provided.


1089
"too many results to unpack" when callin RMapCache::getAll on a large (10000+) keyset

I get "too many results to unpack" exception when calling RMapCache::getAll on a large (~10000+) keyset. Tested on both v.3.5.0 and v3.5.4.


1090
Cannot shutdown RedissonNode if there infinite lock is locked

To reproduce the problem:
1 Create a Runnable job which will last ~ 1 minutes (greater than "internalLockLeaseTime" used by RedissonLock.java), get a lock and lock it by lock.tryLock(), release the lock after the job is done.
2 Schedule and run this job using Redission framework.
This is because RedissonLock.scheduleExpirationRenewal still running after we shutdown the node.
Can Redisson stop the scheduleExpirationRenewal when user call node.shutdown()?


1091
RLocalCachedMap

Hi,
I have very large objects that are hard to serialize, so opted for RLocalCachedMap with eviction policy as LRU and Invalidation policy on change. I notice that when I add key, value to the map, both key and value are serialized sent to redis server in serialized format often resulting in errors. Is there any way to preserve the eviction and invalidation and not send the value to redis server with serialization.
From redis monitor


1092
MasterConnectionPool no available Redis entries.




1093
Redisson Client cannot link properly after the master - slave relationship changes

Redis cluster, when the master-slave relationship changes, the Redisson Client links to the original master node and cannot link the changed master node, resulting in no data write.


1094
outofDirectMemory Netty exception with redisson pipelining

i'm trying to learn Redis through Redisson. Here is my code to insert into redis using multiple threads.
package redisson
This code works fine until totalSize=400000. When i put the totalSize=500000, its throwing the following exception:
Can someone explain to me the reason why this is happening?


1095
redisson not handling failover in sentinel mode

Hello, i'm new to redisson and using version 2.10.4. Assume that i have a master node M1 and a slave node R1. 3 sentinels are connected to M1 namely, S1,S2,S3. I have connected Redisson to the 3 sentinels and started inserting data. Following is my code:
My question is whether this is some configuration issue from my side or does redisson not support failover?


1096
RedissonBlockingQueue.take() returns null in case of internal error

The take() method in RedissonBlockingQueue uses Future.getNow(), which returns null if an exception occurs. In our case, we have tons of NPEs when the application is stopped.


1097
Connection Count in Redis Servers increases when Failover happens

I am using redisson 2.8.2 with Java 1.7 and redis in Cluster mode. Recently we had an incident related to connection count of redis servers. After further investigation we have found that after each redis failover, connection count from each client to redis servers get increased and not going back to the earlier values. This happens after each failover in the redis servers whose role got change.
Then eventually connection count reaches maximum connection count and application goes to a freeze state.


1098
CROSSSLOT key error on #getMap#getReadWriteLock when clustered

#Hi,
I'm encountering the CROSSSLOT keys error when I get a lock a ReadWriteLock of a map in a clustered environment. The normal Lock of a map works fine tho.
or do I need the RClusteredMap instead of the normal map when clustered even if I don't need the data partitioning?


1099
none





1100
why is redisson faster than jedis, could you description some main reasons?

No description provided.


1101
none




1102
com.fasterxml.jackson.databind.JsonMappingException: No suitable constructor found for type

Using the latest 3.5.4 version and Java 8. getting the error when deserialize the json to Java objects.
For my own classes, I could implement a default constructor to workaround the issue, but not on other classes that I dont have access to


1103
Making redisson operation atomic

Hi, i have a usecase that i'm trying to implement using redisson. I have 2 redisson instances running on the same server performing the same operation.
Code snippet of redisson instance 1:
Code snippet of redisson instance 2:
My use case is this: At an instant of time both the instances could access the same key and update its value twice. I want to restrict this i.e., if both instances are accessing the same key at the same time, only one update should occur and not both.
My question is this, which would be the best locking mechanism to deal with this or should i handle this on my own???


1104
RFairLock dead lock issue

Hi,
I would like to report a locking issue we are seeing using redisson versions 3.3.2 to 3.5.4, using RFairLock.
We have 3 instances of an application competing for a fair lock. After some time, the timeout of the fair lock queue gets set to a time many hours in the future, and no thread ever gets the lock.
Here is what redis is reporting during one of the occurences - both commands ran at about 9:30AM PST on 10/17/2017 (1508257800000):
You can see that the timeout (zscore of the timeout keys) is set about 6 hours in the future.
So far, we haven't been able to reproduce the issue locally, but it is happening daily in our production environment. We are suspecting the problem is happening randomly when one of the application gets killed by the operating system (kill -9), something that can happen quite often due to the way we manage the apps.
We were using redisson version 3.2.3 before, and never experienced the issue.
Earlier this year, we tried updating to version 3.3.2 and started seeing the problem within a day or so. We reverted to 3.2.3, and waited for an updated version.
Two days ago, we decided to upgrade to 3.5.4 assuming the problem was fixed, but it happened again within a few hours.
I will keep on trying to reproduce the issue, but any help is appreciated.
Thanks,Michael


1106
none




1107
Support for Socks proxy?

Hi there,
I was looking around and I cannot find if there is socks proxy support.
I am creating the socks Authenticator like this.
And the RedissonClient is created like so:
But when it tries to initialize the connection it always tries to access the redisHost directly.
Is there support for socks proxy and if so how can I properly enable it?


1108
Redisson trying to connect to a dead slave on sentinel setup.

Guys,
I have a redis 3.2 setup with sentinel (3 nodes). I'm using redisson 2x.
I'm performing some HA tests, dropping some slaves or making them fail to test the resilience of the system.
My simple config:
So I got this scenario where one of slaves is disconnected and with error on master link (check lines 10 and 33):
sentinel slaves mymaster
The problem is that redisson tries to connect to this slave for reading regardless of its status instead of picking another slave.  Shouldn't redisson consider sentinel flags in this case? Maybe it is just a configuration I'm missing.


1109
Unexpected exception while processing command

I got this problem when I trying to locking an object. Here is the problem:
Date: Thu, 19 Oct 2017 10:15:31 GMT
what I'm missing?


1110
RReadWriteLock reentry is incompatible

This issue is related to #891.
write lock for 10 seconds
write lock for 1 second
Now after 1 second the whole lock is released. I'm not sure if this is a bug, but logically the system should not unlock the because the first lock request is done for 10 seconds.
Manually calling l2.unlock() manually works as expected, that is fixed in #891


1111
none




1112
Cron schedules stop after a certain time

Hi,
I'm using cron schedules on an executor service but the schedules stop after a certain amount of time.
I've reproduced the issue in a small standalone project.
Here the scenario ;
Use latest redisson (3.5.4) with single node redis and using linux native epoll in configuration
Create a single worker for an executor service
Create the corresponding executor service
Schedule a cron task every seconds
Schedule a cron task every days at midnight
After a certain amount of time, the cron task every seconds will stop working.
When midnight comes, the midnight cron task works, and the every seconds task resume, but then stop again after a certain time.
I did not wait midnight on the standalone project, but I have had this behaviour in my project.
I looked into redis and saw that the every seconds task is still here, and the zset contains valid value for the next run in the score.
Note that I also reproduced the bug with every 5 seconds or every 5 minutes task and the task every days at midnight, but I had to wait longer.
I reproduced also without using the native linux epoll.


1113
none

[]


1114
Configuring redisson to work with Azure Redis Cache standard tier

What's the correct way of setting redisson up to work against a standard tier Azure Redis Cache? I'm asking because the standard tier Redis Cache is replicated, but Azure doesn't provide the connection details for the slave instance.
According to the documentation, Redisson's "replicated mode" requires that
All nodes (master and slaves) should be provided.
So do I use "replicated mode" and only specify a single instance, or do I use "single instance mode"?


1115
none

No description provided.


1116
Add checking for failed masters during Redisson startup in Cluster mode

No description provided.


1117
Introduce separate binary codec for messages used in LocalCachedMap object

No description provided.


1118
Handle server down with singleServer mode

Using singleServer mode without slave.
I'd like to handle this in our app, but it looks like the getBucket() or get() is an async call, so the function doesnt throw the exception, I look through the docs, and found nothing to configure Redission to work in synchronized mode. Is  synchronous mode supported by Redission or is there a different way to handle this?


1119
org.redisson.client.RedisTimeoutException




1120
Scheduled Tasks Failover

How can I make sure that if a certain nodes takes a scheduled task but crashes, someone else would try and recover it?


1121
none




1122
Seeing lots of redisson errors - RedisTimeoutException and RedisConnectionException

Hi. I am using redisson 3.5.4.
I am using redisson for task service management. However, I am seeing a bunch of redis errors - not for every call, but for enough calls to where I am concerned. Here is a sample:
and a different error:
I am also seeing some RemoteServiceAckTimeException: No ACK response after 5000ms for request: RemoteServiceRequest.
Here is my configuration:
Is there any config setting I could change to help with this? Am I doing something wrong?
thanks!


1123
Reset maxIdleTime and ttl on read is not working

I am using redis with elastic cache in my spring application where i am using spring annotations for accessing cache.
I need to reset cache idle time and ttl on read so that i can keep my user active until user goes idle beyond timeout.
But read is not resetting the timeout and cache is evicted as per idle time and ttl set in configuration. Using below annotation in both the cases for creating and reading cache, the issue is same in both single and multiple server configuration.
What is the configuration needed to reset idle time and ttl on read? please advise.


1125
presist feature not working as expected

We're are struggling with basic persist function.
When have written a piece of code to persist a simple Customer object that is annotated as @REntity with its guid field marked as @RId.
The piece of code used to persist is as follows:
Customer object is getting stored in Redis server with the key:
We expected it to be saved using its field guid as the key. Nevertheless, now when we try to get this object back, it returns a object (which we believe is a proxy object) with all null values.
service.get(Customer.class, "1")
returns


1126
Data Object Hierarchy not working for live objects (2.10.4 as well as 3.5.4)

Parent -child is still not working for me. I am getting no such field exception when the RId is a part of the parent class. Can you please guide? What am I missing?
Thanks,
Salil


1127
Redisson not set-up correctly when using JCache API and custom config file

I have a Spring Boot application and a Bean that implements org.springframework.boot.autoconfigure.cache.JCacheManagerCustomizer, i.e. there is a method that takes a javax.cache.CacheManager, and then follows the instructions provided here. Specifically, I have implemented a mixture of the code snippets for:
"Using config file with custom location"
"Using Redisson's config object:"
Essentially, I have the following that does create caches as I would expect on my local Redis instance:
@Override
However, when I run tests or start/stop the Spring boot application, I always receive the following Log message and the Redis caches are not cleared.  Note that the caches are reset if multiple tests are run in sequence but the data cached in the last test is still present in the Redis instance after the test has been run.
After debugging, it seems that there is no org.redisson.Redisson object created. This appears to be caused by the checks for either a redisson-jcache.json and redisson-jcache.yaml being on the classpath in org.redisson.jcache.JCachingProvider#loadConfig(URI uri). If these files are not found, the config returned is null which means that org.redisson.jcache.JCachingProvider#getCacheManager(URI uri, ClassLoader classLoader, Properties properties) does not invoke the code inside the if conditional below:
I do not have either a redisson-jcache.json and redisson-jcache.yaml file on the classpath since my team are trying to develop a way of loading different Redisson configuration files based upon the Spring Boot profile that is used to launch a Spring Boot application.  Configuration files are instead searched for in a specified location with a specified file name (the name of a Spring Boot profile).


1128
Retrieving objects using non-@RId fields

I have a Customer object as below
I store this object in Redis using the persist method as below:
I can use the service.get(Customer.class, "1")  method to retrieve this object based on the guid we pass to it. However, I have following requirements:
Can you point me to the right api for such requirement?


1129
Delayed writes

Hello,
I was testing the behavior of Redis/Redisson when a network failure happens (say for few minutes) and then recovers. I observed the following un and wondering if there is a way to avoid this scenario.
Observation:
SADD command was issued at 14:46 PM and failed due to RedisTimeoutException. This seems to have happened just about when network failure just started.
At 14:50 (A full 4 minutes later), it looks like Redisson heard back from Redis master node but due to client side timeout set, just skipped the response.
Here are the logs:
Redis Version:
Redisson Version: 3.4.1


1130
useSentinelServers in ReadMode of MASTER_SLAVE, the master never got read.

Tried following config
I wish both master and 2 slaves could be read (33% chance on RoundRobin algo). But I see the master never got read.
Tried different Balancer and dug into the source, seems that the LB seems only be applied to slaves. The master server is setFreezed(true) and it won't get read unless both slaves get disconnected.
Looks like ReadMode of "MASTER_SLAVE" is actually same as ReadMode of "SLAVE".


1131
Add RListMultimapReactive object

No description provided.


1132
Redisson 3.5.5 will not accept "localhost:6379" as address for SingleServerConfig

it used to accept "localhost:6379", but now the address seems have to be: "redis://127.0.0.1:6379"
this is because the change in org.redisson.misc.URIBuilder.java.
Should it more developer friendly?


1133
timeout configuration in Replicated Mode

Hi, i'm using redisson with a Replicated Mode configuration (1 master and 2 slaves).
When attempting to debug an issue, i found that apparently the timeout configuration parameter is not being used in the implementation as documented.
I was receiving a fair amount of unexpected RedisTimeoutException: Command execution timeout messages.
Changing the retryAttempts and retryInterval allowed to circumvent the issue - but not changing timeout - which seemed odd to me, so i decided to dig further.
In ReplicatedConnectionManager#L123,
A value of 0 for retryAttempts, or even a higher number matched with a relatively low retryInterval always causes the RedissonClient instantiation to fail (due toCommand execution timeout).
Raising these values can bypass the error on the initial connection and allow the instantiation.
Still, the same applies to subsequent calls: they also won't also use the timeout provided in the configuration.
Am i observing this correctly or is there something i'm missing here?


1134
[Performance] Potential performance issue or improvement

One of our teams has been running some load tests that involve calling deleting keys from a redis cluster among other things. And when they run a profiler they observed that top hot spot was actually related to collection management (ConcurrentHashMap and HashSet) on redisson when getting connection info and copying it for every operation.
As seen on the following hotspot analysis
This was tested with redisson 3.4.3, haven't tried with the latest one yet
Is there anything that could be changed from config or improved on the code in future versions?
I believe the same scenario might show up on other operations besides delete


1135
SSL it's not fully implemented

Hi,
I was trying to use your library with AWS Clustered mode and figured out it does not work with SSL.
I figured out the problem and fixed it in my fork  but it's a hack what I did.
Basically everywhere you create an address like "redis://" -- you need a way to know if it's SSL and put "rediss://" instead. Since those places have no access to config, unfortunately I changed all to force SSL everywhere.
Do you have in plan a fix for this, or I can do it if you point me to the right way. I am trying to understand your logic and how can I be least invasive to pass a config. The simplest way would be to put a static public flag somewhere -- but that's also a hack I guess, and will only allow one type at one time, or pass a jvm property ...what do you suggest?
Thanks in advance,
Florin Moisa


1136
Java objects - support for search by non-RId fields

Hi,
We have a usecase where we store Java objects in cache and search them by multiple fields. Is there a way to achieve it in Redisson liveObjects? Spring-data-redis provides such functionality but does not support redisson.
Thanks,
Salil Gandhi


1137
Failed to continue poll remote responses if current waiting for response has been canceled

No description provided.


1138
 Add RSetMultimapReactive object

No description provided.


1139
reactor/fn/Supplier : Unsupported major.minor version 51.0

I am Using Java 1.6 and the Redisson 2.10.1
and i am using the RedissonReactiveClient  as shown in the blow sample code


1140
Read-only GEORADIUS support

Hi,
Redis 4.0.0 and 3.2.10 introduced read-only GEORADIUS variants(GEORADIUS_RO and GEORADIUSBYMEMBER_RO), as the docs state. Are there any plans to add this command to redisson?
Thanks in advance!


1141
Redis timeout exceptions when trying to submit tasks on a now executor

I have a redisson configuration with a single worker executors for various schedules - 1min, 5min, 1hour, ... 24hours. When each of these ticker-tasks are invoked I have a set of devices on which I need to run diagnostics. Each device will have a task that will be slotted in various schedules and these tasks for all the devices that belong to a schedule need to be invoked at that particular time.
The device tasks are put in a 'now' executor. So on every schedule invocation, there are a lot of tasks that are submitted on the now-executor.
I am using Redisson version 3.3.1 and my key settings are:
I am observing sporadic RedisTimeoutException when submitting tasks to the now executor:
I am also getting sporadic timeouts on the ticker tasks - 1min, 3min etc.
I have two instances running that feed off the Redis cache. These errors are sporadic in  nature. Appreciate any help in understanding the root cause of these timeouts.


1142
Is there a way to get a value from a key that wasn't set using redisson?

In my local redis database, I have a node.js app that sets redis keys and values. Can I use redisson to retrieve using the key name? Or can redisson only retrieve keys that were created by redisson?


1143
Initialization timeouts leads to performance issues and timeout on batch

Hi,
I've been fighting for the past week with some weird timeout issue on one of our apps.
The use case is an RBatch operation that execute a bit of getBucket(..).getAsync()
Run scenarios with 1 get or N gets as part of the batch and happens on any.
The issue is basically that after a few minutes after starting the app, some instances of my app start displaying timeouts on that cache operation and thus becoming slow, then i restart that particular node of the app, and maybe it's fine forever, then I restart another instance and maybe now that one starts exhibiting the same problem. Sometimes it add a constant base of 50ms delay (due to timeout and retries) and sometimes it's 150ms or similar.
We tried with redisson 3.2.0 and 3.5.5 and we can observe the problem on both, we though it might some hardware/network problem on those servers where such apps are running, but after restarting and re-running it works fine (or not) and viceversa on other servers.
The errors we get on the failing app are always like this
And this what we observe many times
This is being used on a very high traffic app, but we can reproduce it with low traffic as well.
Do you have any suggestion or insight on any thing we can try changing on our config and re-run our load test so we can sort out this issue. And we really need the data to be read from redis because the alternative when our cache fails is a much worse system that cannot handle the load or our SLA
We have been trying changes on the servers, running on different hardware, etc but nothing changed yet. Could it be some dead connection or bottleneck on the batch or connection manager that is causing this? Also as you can see on the avg time graph on top, it doesn't happen for every request, but for many of them, but constantly ONLY on that running app of all the total


1144
none




1145
Snappy implementation in recent versions throws ArrayIndexOutOfBoundsException

Summary
Up to and including Redisson version 2.10.1 and 3.5.1, Redisson used the Xerial implementation of Snappy (https) for its SnappyCodec.
In versions 2.10.2 and 3.5.2, Redisson was changed to use the internal implementation of Snappy from Netty instead. However, this implementation seems to be designed only for Netty's use cases and cannot encode moderately-sized payloads. In this case, moderately-sized means that payloads of more than 50,000 bytes are very likely to fail.
This results in an error during the encoding step, e.g.
Steps to Reproduce
I have created a repository that shows how and when this bug occurs. I take the last known good versions (2.10.1 and 3.5.1) and compare them with the most recent versions at the time of writing (2.10.5 and 3.5.4).
See the repository here: https
To run the examples, either run the main method for each module in your IDE, or run each module via the command line with mvn package exec:java.
The redisson-*-snappy-demo modules show the behavior in the indicated Redisson version. As you can see, the last known good versions (using the Xerial implementation of Snappy) can encode this payload without any problems, whereas the new versions (using the Netty implementation of Snappy) will fail.
The netty-xerial-snappy-demo module shows how increasing the size of the encoded payload will soon cause Netty's implementation to reach a breaking point after which all attempts at encoding will fail. When creating the sample data with a random seed of 0, Netty will succeed on a payload of 44,895 bytes and fail on a payload of 44,896 bytes. Changing the seed will change this number, but it will generally fail somewhere between 40,000 to 50,000 bytes.
The Xerial implementation, on the other hand, does not fail at any size I tested (up to 100 million bytes).
Fix
While it's nice to avoid an additional dependency, I believe the Snappy implementation from Netty should probably be considered an internal implementation since this size limitation makes it unsuitable as a general compression algorithm.
The Xerial implementation seems to be more widely used by more high-profile projects (e.g. Cassanda) and is probably a safer choice.


1146
Seeing NullPointerExceptions with distributed services

We are testing the distributed services feature of redisson. We are noticing that at scale (i.e. 1000 tasks in a minute), redisson is throwing NullPointerExceptions and the tasks do not complete.
Let me know what other information would be helpful to try and track this down.
thanks


1147
Connection distribution upon nodes

Hi,
I have a setup of 3 redis nodes with 3 sentinel nodes.
I am using latest redisson with master_slave read mode.
I see that almost all connections go to the master redis and slaves are not in use.
Also when connecting to redis i see only db0 is being in use.
What am i doing wrong in my redisson config?
Thanks


1148
OpenTracing support?

Is there any current plans, third party plugins, or a recommended best practice approach to use Open Tracing with Redisson?
In particular the remote service invocations seem like they could benefit from the tracing span context propagating across the service boundaries.
I have done some quick googling and didn't find any libraries, documentation, or anything else on the subject.


1149
please help




1150
Out Of Memory When using RScheduledExecutorService.

Hi,
We are seeing Out Of Memory Exception when using RScheduledExecutorService.
We are using redisson 3.5.5
These are our settings:
It would be great if you could help provide some guidance here and help figure out the issue.
Thanks



1151
Removed entries in RMapCache Through Eviction Process Still able to see through Redis-cli

I am Using the RMapCache<K,V> and using the Method  putIfAbsent(K key, V value, long ttl, TimeUnit ttlunit) .
I want to use the Eviction functionality i.e provided so I am giving ttl as 45 Sec.
After 45 Sec when i check the Entry in the MapCache From the ReddisonClient at runtime i didnt found the entry
But when i check the same in the Redis-cli using HGETALL i can still able to found this Entry that was Deleted through Eviction Process by Redisson
SomeTimes even after 5 min i can able to see the Entry in the Redis-cli even Though it can't be able to find from the Redissonclient after 45 Secs


1152
user_script:1: bad argument #1 to 'len' (string expected, got boolean)

I am using spring and redisson cache manager. Below is the issue I am running into. The thing is that if I manually cleared cache from redis-cli, the issue is gone.


1153
AvroJacksonCodec vs Avro Direct Binary.

Hello,
Can you please tell me the difference between AvroJacksonCodec in Redisson vs creating my own codec using Avro's BinaryEncoder directly? Does the Jackson codec covert the object to JSON first and then to binary? E.g. is it wrapping my objects in { } and also writing the field names? Thanks


1154
none




1155
The question of the version

When I used high version(org.redisson:redisson:3.5.3),The error is as follows.
But, when I used low version(org.redisson:redisson:2.2.17), my project is started normal with tomcat 8.0.14.
My project is used gradle 4.0, I want to use the high version, please tell me how to do?


1156
The Namespace Of Redisson

I want to use the Namespace of IRedisClient. Where is the Namespace of Redisson?


1157
Add entry update strategy on map entry change for RLocalCachedMap object

No description provided.


1158
OOM issue with RedissonExecutorService

Hi,
We are seeing out of memory when trying to use RedissonExecutorService.
Please find attached the file you can use to reproduce the issue.
Usage:


1159
What is the application scenario of the RedissonRedLock?

What is the application scenario of the RedissonRedLock?


1160
The deadlock of RedissonMultiLock

When I used the RedissonMultiLock.lock(), I found the code of Redisson.
This is my code.
The program execution sequence is as follows:
Thread A locked the 'lockSoundbox' of lockA. It's OK?
Thread B locked the 'lock2000' of lockB. It's OK?
Thread A locked the 'lock2000' of lockA. It's OK?
Thread B locked the 'lockSoundbox' of lockB. It's OK?
I think there's a deadlock between 3 and 4, but I'm not going to try it out.


1161
Problems with Spring Session UsernamePasswordAuthenticationToken deserialization

I've read somewhere that you need to add a serializationcodec but didn't manage to get it to work.. any tips?


1162
Redisson willunable to work after the redis-cluster reboot.

No description provided.


1163
Redisson will be unable to work after redis cluster reboot.

Redisson runs base on redis-cluster mode, and every thing looks cool.  When redis cluster nodes all down, the redisson is unable to work and throws connection exception. Howerer, when the redis cluster recovered, the redisson is still unable to work and throws null pointer exception!!!!!!!
I did this test base on redisson 3.3.0.


1164
Redisson Client hangs on creation

Hey guys,
currently trying redis + redisson (v3.5.5), so this might be an easy question for some of you. Anyways as soon as I create my Redisson Client (config seems right), the client hangs in the create statement indefinitely without any exception or timeout, etc (waited for over an hour to hopefully see some error, sadly none).
To the setup: Win10 + Ubuntu subsystem running redis on standard port (6379), single server setup. In its config the redis server is binding to 127.0.0.1 (also tried disabling protected mode). RedisDesktop Manager and Jedis connect just fine without any issues.
Hope someone can help, as I couldn't find anything related to this anywhere online.
Stacktrace :


1165
java.lang.IndexOutOfBoundsException: fromIndex: 0 toIndex: 2 size: 0

the error occurs when get a sub list from Rlist object, use 'indexOf' to get index number of specified string, it returns 1, it shows that there should be some elements in specified region, but reported no data
found, did somebody meet same issue? how did it happen?
BTW, the redission version is 3.4.2


1166
none




1167
Set removeRandom(10)  throws Exception

it seems to use the command "SPOP key 10"
but in fact redis Set doesn't support that uses, SPOP  only pop out one value at a time. So this will cause an Exception "wrong number of arguments for 'spop' command"
i am using redission version 3.5.5;
and i hope redission wilol support the SRANDMEMBER command in the future


1169
nginx + tomcat + redisson share session

Environment:
Configuration all set and session can store in redis and get from redis.
But when I login, I have to login 2 times (First time fail and auto refresh page, second time can success).. After logined, when I click the page, it will show "Uncaught TypeError: Cannot read property 'click' of undefined" (Google Chrome) or "TypeError: tableDom is null"(FireFox). Then I refresh the page and click it agian, it will be normal.
Can you help me slove this problem? thanks.


1170
MapLoader seems to hang if you try to check the same null key, more than once

It looks like the second time you try to get a key that was null through a map loader, the loader will simply hang.
I was able to reproduce this in RedissonMapCacheTest.java with the following code
I'm running Windows 10 with Redis Version 3.2.100 64 bit version.  This is happening on Redisson 3.5.5 and the current master branch.


1171
spring session with spring security error

org.redisson.client.RedisException: Unexpected exception while processing command
n: no suitable constructor found, can not deserialize from Object value (missing default constructor or creator, or perhaps need to add/enable type information?)

1172
Redisson RScript eval codec is not honored

Command executed:
Expected result: values and/or keys encoded with json codec


1173
redission AtomicObject in debug + breakpoint mode cause a different result

version:3.5.4
At first,I delete the key,confirm the key not exist.


1174
Java 9 warning - illegal reflective access

Just wanted to report this warning I'm seeing now since I am giving Java 9 a go (for native alpn/ssl stuff that's not directly related to Redisson).
This warning is shown on stdout when I start up my runnable/uber jar:
So far it appears everything is working fine, but figured it might be worth reporting, since it says it will eventually be denied in a future Java 9 release.


1175
RedissonRedLock issue




1176
spring boot health check redis is down




1177
RxJava 2 Support

I was hoping to see support for RxJava2, I love having Redis on the stack when I make apps, but it's a real pain when almost every other library has standardized. Thanks for considering :)


1178
Redisson not able to detect ip changes of active node in RLEC endpoint

We are currently using Redisson 3.5.0 to connect to our Redis labs enterprise cluster(RLEC). The driver is configured to connect using single server mode (as recommended for RLEC). When the active node ip switches/changes, Redisson is not able to reconnect with the new active node. It keeps retrying to communicate with the last known active node ip from the endpoint. This behavior is consistent with either "dns monitoring" being set to true / false.  If we manually set the same active node ip back, it immediately reconnects, which proves the point that its unaware of the ip address changes, unless the last known ip is elected again as active.
How do we enable Redisson to detect potential ip changes of active node, while using endpoint of RLEC in single server mode?
Please let me know if you have any ideas on this one. Thanks.


1179
Eviction Scheduler doesn't remove expired keys from list

Hello,
I asked a question on stackoverflow about how to well configure redisson to make eviction scheduler working on set in redis, but no answer yet :(. Could you help us by answering on this post or by improving the wiki about this point ?
Many thanks !


1180
Redisson is not reading the values set by external redis clients

I am creating a set through Medis, a Redis client or FastoRedis. When I try to read the same using redissonClient.getSet(key), I see an exception being thrown saying "Unable to evaluate the expression Method threw 'org.redisson.client.RedisException' exception." while debugging the set in IntelliJ. Why can't redisson is reading the value for the key? I noticed one thing when the redisson sets the value, it has quotes. But when you set a string from external clients, it doesn't have any quotes and redisson can't seems to be recognizing it.


1181
ReadWriteLock not working.

Hello.
I'm interested in this project. I am creating a sample project(https) using this,
And I do not think readswriteLock is working properly.
The error pattern is a bit different, but the example org.redission.example.ReadWriteLockExamples.java is not working properly. Version 2.10.5 does not work either.
I do not know much about redis
I hope this project can be maintained.


1182
redisson work with a cluster with no full coverage slots




1183
redisson 3.5.5 RScheduledExecutorService

You can't find a class using the Lambda creation task


1184
FstCodec deserialization problem when adding new properties to session object

FstCodec deserialization problem when adding new properties to session object.
Is there any way to handle that? If its possible to either ignore or invalidate session if new properties are added.
org.redisson.client.RedisException: Unexpected exception while processing command


1185
Add executeSchedule methods to RScheduledExecutorService

executeSchedule methods return void method instead of ScheduledFuture this allow to avoid memory consumption by each schedule.


1186
Rename codecProvider and redissonReferenceEnabled Config properties

Rename codecProvider and redissonReferenceEnabled Config properties to referenceCodecProvider and referenceEnabled


1187
Remove Config.resolverProvider and embed its logic into RedissonLiveObjectService

No description provided.


1188
DNSMonitor fails on bootstrap with custom event loop

redisson 3.5.6 fails on bootstrap when using custom event loop.


1189
Redisson can not deserialize data on expiration event




1190
JVM crashes when using 1000 concurrent redisson threads

I am scheduling tasks on a Redisson executor. On every schedule a massive chunk of tasks are submitted on two Redisson executors. I have equal number of workers assigned to each of the two executors 500 and a maximum redisson thread count of 1000.
I took periodic heap dumps of the JVM and the following was the last dump I captured before the container (my code is running in a docker container) went OOM. It appears to me that the netty's PoolThreadCache continues to increase.
Here is a screenshot of the leak suspect report of the last dump I took:
I am unable to get the crash dump report of the JVM. Will attach that as soon as I am able to figure out the issue with crash dumps not getting generated.
I am using Redisson 3.5.5. The bundled Netty version is 4.1.16.


1191
Redisson remote services can't ack when running redis in cluster mode.

To reproduce this, on 3.5.6, I updated BaseTest.java and ran the tests against a clustered Redis server running  Windows 10 with Redis Version 3.2.100 64 bit version.
Completion appears to work fine.  It's just the ack that is throwing an error.  If I set the options to noAck, I can get a result.
Ack does appear to work correctly if Redis is not in cluster mode.
BaseTest Modification:


1192
Removing class name in serializing an object

Hi,
I would like to minimize the data storage in Redis. When putting an Object in a list, I found that the object is serialized and stored in JSON. However, for every field in the json string, it has a class name info "java.lang.String" next a field for example.
Looking at the source code, realized that this is added by default. Passing my object mapper to initialize won't work either.
Is this necessary? Is there a way to disable this?
Alternatively, I serialized myself an object into a string and put the string into RList. However, then it seems the library serialize one extra time as follow:


1193
Redisson RMap get response is slow

I've a java application where I'm using Rmap to store and retrieve objects to/from Redis. The response time of map.put(...) is reasonable but map.get(...) is averaging 4000000.0 ns.  I'm using FstCodec for serialization/deserialization. The application has many classes that do not provide no arg constructor and hence certain codecs can't be used.
I would like to know how to improve the map.get(...) response. When same object to go LinkedHashMap, the response time is in the range of 446.0 ns and I'm looking for a response time in that range.
Find attached my sample java application and config file.


1194
failover does not work

Hi,
I'm new to redisson, I setup a redis master-slave environment with 3 sentinels.
But failover does not work when I kill master node, it seems redisson node does not try to connect new master node. I got this exception:
Here is my redisson configuration, could someone help me? thanks a lot


1195
AWS ElastiCache SingleServerConfig failover doesn't work partly

We use redisson 3.5.3 , and  AWS ElastiCache SingleServerConfig mode ,of course the redis client config property dnsMonitoring is true , you know that AWS ElastiCache will change the ip to same DNS  when failover.Today AWS ElastiCache failover occurred , we found that we got many redis exception : org.redisson.client.RedisConnectionException:
I research the error log file, found that redisson has switch to the corret ip address :


1196
none




1197
Configure Redisson to connect to Azure redis cache

Hi,
I am using redisson 3.5.6 to connect to Azure redis cache (standard tier).  I am using Config.useSingleServer and have provided password in the redisson.yaml configuration.
It is throwing Exception: Unable to connect to Redis server
Please help me in resolving the issue


1198
Reading from Elasticache replica nodes

Hello
I'm using Redisson ( redisson-all-3.5.5.jar )to connect to AWS Elasticache running in Cluster mode disabled. The cluster has 1 primary and 2 replica nodes.  The application uses Redisson's Spring Cache abstraction support.
I have configured Redisson in Master-Slave mode providing the primary end-point as master and replica end-points as slaves.
I load the application by making hundreds of simultaneous requests hitting the cache.
When I view CloudWatch metrics, I notice that there are no CacheHits for the replica nodes. All the requests seem to be going only to the master/primary node.
I have tried SLAVE as well as MASTER-SLAVE for read-mode attribute. I played around with the LoadBalancer class trying out RoundRobin and Random , but to no luck.
The idea behind using multiple replicas was to distribute read load and not just for high-availability. It is important for us to read from slave nodes. Is there some setting that needs to be enabled to allow Redisson to read from slave nodes ?


1199
Configurable ttl for caches and/or entries in redisson Jcache

Hi, it would be nice to have a global configuration(using redisson-jcache.json, for example) option for the redisson Jcache to set the ttl for caches and/or entries.



1200
Two threads can acquire the same lock with redis cluster

I have a very simple try-finally block something like this:
I have a redis cluster 4.x with 3 masters and 3 slaves, redisson is initialized like this:
In most cases it work, but sometimes I can see it from the log that the lock cannot block two threads T1 and T2 can acquire the lock simultaneously, then one of them can release the lock successfully, the other one will throw an exception:
So, my questions is that, why two threads can acquire the same lock? (They have the same lock name, I observed this from log)


1201
BitMap (RBitSet) questions

I have two questions.
Are there any plans to extend RBitSet index range beyond Integer.MAX_VALUE*2?  Since it supports distributed implementation of BitSet and its operations - having this limitation removed would be very helpful.
There have been studies suggesting Roaring Bitmaps as very powerful mechanism to support space-saving fast bitwise operations on bitmaps ( operations are performed on compressed representations). See e.g.  When do we plan to having a roaring bitmap implementation - be it PRO or community version of Redisson.


1202
none




1203
add repeat feature in priority dequeue.

Thank u.


1204
none

[]


1205
MapCache listener not working on cross-plateform environment

Hello,
I've encountered a bizarre bug when using MapCache listeners between windows and linux.
My setup:
When running the test I've got the following errors:
the line PlatformDependent.isWindows() should not be made regarding to the jvm running environnement but regarding to the redis server.


1206
none




1207
none




1208
none




1209
version 2.10.6, compiler target is 1.6+,but in class BaseRemoteService use Map's putifabsent method?

compiler target which defined in pom.xml is 1.6, but in source code such as BaseRemoteService still use Map's putifabsent method.


1210
Add RMapCache.remainTimeToLive(key) method

No description provided.


1211
Add tomcat 9 support

No description provided.


1212
Add ClusteredBloomFilter

No description provided.


1213
DNSMonitor doesn't work with ClusterServersConfig

I noticed that Redisson isn't detecting DNS changes when using the ClusterServersConfig with AWS Elasticache Redis in cluster mode. After debugging it looks like this line is never hit https
I am using a CNAME DNS record that points to the Configuration endpoint of the Redis cluster and then testing destroying/recreating the cluster and pointing the CNAME at the new configuration endpoint.
Is this expected? What's the  here?


1214
Add Redis Modules support

Implement an infrastructure for adding custom Redis Module support:


1215
Add KQueue support

No description provided.


1216
Add RMap.valuesAsync(String pattern)

The output should be the same as values but it Should response with a RFuture<Colletion<V>>


1217
Is there anyway RMapCache can work with other clients?

Our service (Python) shares a redis with some other Java services. We and some Java service put in the data, and another Java service consumes the stored data.
Java services have decided to use redisson RMapCache to store and read the data. And since they both use redisson so there is no issue for them.
But I found if RMapCache can not get the data I hset in redis via redis python client.
It complains that:
I suppose the data I put didn't follow the RMapCache eviction scheduler data format.
Is there any workaround for this? Or any suggestions on this situation?


1218
rangeTailAync and rangeHeadAsync

I am looking to get a specidic count of data from endString to startstring.
So I have used readTailAsync by providing startString but I am getting data always from startString.
I tried using readHeadSync by providing endString but i still get same data from startString. Is this a bug?
I would like to know how to solve my problem.


1219
ReadLock not working correctly

Hi,
Is this the expected behaviour of the ReadLock from ReadWriteLock?
Clarifying because I did not encounter this in release 3.5.4
There are multiple threads that are trying to lock and unlock the readlock concurrently but I am encountering the "attempt to unlock lock, not locked by current thread by node id" exception.
Here is a rough code sample to replicate the issue.
The unlock part throws the following exception even though they're all read locks.


1220
Using RMapCache what combination of ttl & idleTimeout can I use to expire field that is read < those values

I have a scenario where I have a field that I want to keep as long it the field value is updated at a rate < the idleTime, and expire when the that is not the case.
What appears to be happening is that as the field is read more frequently than the idleTime, and when a get is performed it updates the idleTime expiration, so that the field is never expired.
I tried the following combinations:
but none of those combinations work.  Is it even possible?
thanks, Mitchell


1221
.setDnsMonitoringInterval(-1) doesn't actually seem to be disabling DNS Monitoring

I'm using 3.5.7 and am getting intermittent "Unable to resolve" DNSMonitor exceptions, using AWS ElasticCache Cluster. Here's my createConfig() code:
I'm still getting the UnknownHostExceptions from DNSMonitor which suggests the monitoring is not being disabled. Is this a bug or am I missing something?
Just an additional FYI, this is my initialization block:


1222
Session object was not updated correctly

I used redisson session manager to externalize session data into redis server. However, session data will not be updated if the session is an object and the data to be changed without running httpsession.setattribute(..).
For example:
I tried Jedis session manager, it works as same as what I expected as tomcat session. Is this a bug in redisson?


1223
Question about RFuture

Hello,
I saw that CompletionStage interface implementation has been deleted based on the code.
Are there a particular reason for the removal?
Thank you


1224
RLiveObjectService : isExists method : unclear javadoc

RLiveObjectService has method isExists (which name is grammatically strange already, but "isSomething" is already established expression for boolean variables, so okay)
Javadoc says: Returns true if the RLiveObject does not yet exist in redis
But the same javadoc later says: @return true object exists.
I find this kind of documentation unclear, as I don't understand if it should return if object exists (like method name and @return says) or not (like description says)
UPDATE:
I tried to see for myself and got confused even more.
Here's my code:
Testing code:
So what exactly "isExists" feature does ?


1225
InstantiationException when getting priorityQueue

The code
Is that because comparator is anonymous?


1226
Add LongAddr

No description provided.


1228
Save RScheduledFuture in redisson

I have a few tasks which can be started in RScheduledExecutorService from many instances. They also could be cancelled from any instance. To achieve this, I try to save the RScheduledFuture in RMap, but I got next stacktrace:
Is there a way to store this kind of objects in redisson? Thanks


1229
Can I use RBatch for RPriorityQueue?

I want to perform RPriorityQueue.remove() and update RBucket as atomic operation. Is it possible? There is no RBatch.getPriorityQueue() method
Tried it with getQueue() method like this:
Doesn't work. (and probably shouldn't)


1230
Add DoubleAdder

No description provided.


1231
RScheduledExecutor doesn't restart tasks after crash

I'm testing fault-tolerance of redisson node. I have 5 Runnable scheduled tasks. When instance crashes, sometimes redisson node resumes these tasks again. Sometimes - not.
I found that if it resumes tasks, Redis has next keys:
Could you provide more information, how reliable task resuming in case of crash can be? If redisson node is shutdown correctly, can I rely that tasks would be resumed? Is it the same case in case of single Redisson node? (with one/multiple ExecutorServices in NodeConfig)
Is there some strategy to resume these tasks? Or at lease find out they are broken, remove stale data and re-create tasks?
Thanks!


1232
Add new readMode

Can we add a new readMode? It will read memory first, if session data is not in tomcat session, then read from redis? This will help performance and also keep the session when one of the tomcat failed in clustering environment.
Something like:


1233
RLock reentrant behaviour over unlock

This might be a trivial case/question but according to java specs, a reentrant lock can be acquired  by the owner thread infinite number of times and simple can be unlocked completely with just one unlock call.
What I'm seeing is the opposite of it currently, in RLock implementation. It behaves like a semaphore rather than a reentrant lock. Every unlock call decreases reentrant counter on Redis and in order to unlock it completely, I have to call unlock until the counter hits to zero. Is this the expected behaviour?


1234
RMapCache'Eviction seems not to be in effect

I used RMapCache in my project,and set the timeout time is 3 minutes,but I found that the size of the ZSET is increasing. and the key  still inside, and not be cleared a day after that.
Here's the way I store key "a" with value "1",and 3 minutes to live:
Did i make any mistake?
How can I make the Eviction come into effect?


1235
Add PriorityBlockingDeque

No description provided.


1236
Problem deserializing google immutablelist?

Caused by: java.io.IOException: java.lang.InstantiationException: com.google.common.collect.RegularImmutableList
Do i need to register it?


1237
none


1238
Replace current hash implementation with HighwayHash


1239
none




1240
Add JTA implementation

No description provided.


1241
Add support for Spring Transaction API

No description provided.


1242
Add atomicity property to RBatch object

No description provided.


1243
io.netty.resolver.dns.DnsNameResolver#doResolveCached race condition java.lang.IndexOutOfBoundsException

It's an known bug in io.netty 4.1.19.Final and fixed in 4.1.20.Final
netty/netty#7583
Sometimes my AWS Lambdas fail by creation of the redisson client.


1244
tickDuration 1 causes "tickDuration must be greater than 0"

With minTimeout = 1, first if block is used, calculating 1 / 2 = 0, causing confusing error message.


1245
RLocalCachedMap.putAll gets stuck

No description provided.


1246
[Question] Environmental Variables in Configuration Files?

I'm not seeing this in the documentation, is it possible to reference environmental variables in Redisson configuration files? We are looking at using the Tomcat session manager implementation and being able to do this would be very useful to us given that we are using Docker and the Redis clusters are named differently in different environments (and it isn't easy to use some kind of DNS trickery as we are using SSL).


1247
Add RBucket.getAndDelete method

No description provided.


1248
Add RAtomicLong.getAndDelete and RAtomicDouble.getAndDelete methods

No description provided.


1250
RedisTimeoutException: Unable to send command: (ZADD) with params: ...... after 3 retry attempts




1251
RSCRIPT LUA timeout and not consistent results

RScript LUA timeout/Null Pointer exception
Description
When trying to execute EVAL LUA script using Redisson library,  We receive either null Pointer exception or timeout exception and results are not consistent.  If we execute one or two statements then it works fine but when we add a couple then it isn't giving consistent results. When ran eval Lua script directly  in REDIS client it doesn't timeout and gives consistent results. Please let us know what the issue is when using redisson library and how to fix it.
REDISSON ERROR same error even when I increased the timeout value


1252
Redisson RBucket codec problem!  java  object is Serializable or not makes putting obj to redis failed! ·

I use redisson 2.8.1, as default it use jackson JSON codec, but once I want to store a class ( which implements java.io.Serializable , it's - org.apache.shiro.session.mgt.SimpleSession ) in a RBucket, it failed to store the every object filed value in redis master slave (sentinel mode ) cluster. That means, I lose some value of the Object stored in redis.... it is dark..
Then I tried to use other codec:
Tested OK! a class ( which implements java.io.Serializable) object can be sotred correctly and get from redis using RBucket.  But, we have another problem here : a class ( which not implements java.io.Serializable) cannot be stored in redis now.... dark again...
Could I beg your suggestion? Thanks very much .


1254
none




1255
[Question] Use Rmap as a data member on a singleton or create a new instance for every call ·

If our server handles lots of Rest calls that access distributed collections, is it safe to keep a single instance of Rmap as a data member on a Singleton bean (and have multiple threads use it concurrently) or is it better to create a new instance of Rmap for every call?
We're not using a local cache, so there's no data supposed to be kept in the Rmap instance, but does it have any concurrency limits we should be aware of?
Is there a significant overhead associated with creating a new instance of Rmap for every call?


1256
none




1257
Reddison Spring Cache modifies exception semantics of annotated method ·

Regarding spring javadoc the spring Cache interface demands implementations to throw a Cache.ValueRetrievalException.
"Wrapper exception to be thrown from get(Object, Callable) in case of the value loader callback failing with an exception."
The reddision cache implementations breaks this contract and throws a ValueRetrievalException that is wrapped within an IllegalStateException. This exception is not handled by Springs CacheAspectSupport and thus thrown back directly to the caller of the annotated method.
Looking at CacheAspectSupport, it would also expect a CacheOperationInvoker.ThrowableWrapper as cause of the ValueRetrievalException which is removed within the reddison cache implementation when constructing the ValueRetrievalException.
This behaviour breaks the transparency of the cache abstraction and beaks code that relies on exceptions for control flow (eg. javax.ws.rs.NotFoundException). Can you please take a look and this and tell me if that is intended behaviour?
Best Regards
Daniel Selinger


1258
Redis Replication Configuration

Hi ,
I want to test redis replication scenario on my local machine.
I am using  docker and have below setting
` redis-master:
image: 'bitnami/redis:latest'
ports:
And passing address like "redis://127.0.0.1:6379,redis://127.0.0.1:6380"
From logs I can see master is ready but I am getting below exception
My all 3 servers are running ...  I tried increasing timeout as well. Can you please tell me what could be the issue or I miss anything..


1259
Spring session annotation support

Hello,
I'm following guide, but I get NPE
I tried to use @EnableRedissonHttpSession(maxInactiveIntervalInSeconds = 360) but still the same NPE. Is this annotation usable or the only option I have to use is xml ? Tried  3.5.7 version.


1260
Deserialization through JCache failing with ClassCastException

I am using Redisson as Redis client to store a key-value pair <String, LocalDateTime>. It's configured to be used through the JCache API (JSR-107).
It's storing values like 2018-01-23T11:59:34.997834 but in the cache#get invocation is trying to return a String giving a ClassCastException . It compiles perfectly, cache#get returning LocalDateTime, but if fails in execution.
Am I missing something here or is there some problem using it with the JCache API?
ava.base/java.lang.String cannot be cast to java.base/java.time.LocalDateTime


1261
Update Spring Session to 2.0

No description provided.


1262
Redisson expiration event - deserialization issue

I use Redisson (sentinel mode), and everything was working fine until I added an EntryExpiredListener.
After adding the listener I started getting the following errors
DefaultChannelPipeline] - An exceptionCaught() event was fired, and it reached at the tail of the pipeline. It usually means the last handler in the pipeline did not handle the exception.
io.netty.handler.codec.DecoderException: com.fasterxml.jackson.core.JsonParseException: Unexpected character ('b' (code 98)): Expected space separating root-level values
Any hints?
Client Factory


1264
ZREVRANGEBYLEX not supported by redisson ·

@mrniko Currently ZREVRANGEBYLEX is not supported by redisson which can pull details in reverse order of the stored values on a key LEX sorted set data structure. Please support this function as soon as possible as we would like to use it. Without that the retrieval of data in reverse order is very cumbersome and not an easy way out. Even LUA script based on discussion with REDIS labs, they say it fecthes data only from one shard and cannot go and look for data in other shards... We want to use this function zrevrangebylex in redis batch execute to retrieve data from multiple sorted set keys at once


1265
none




1266
Cannot call config.enableMetrics() to initialize Metrics

Hello,
I'm using Redisson 3.6.0 and want to use the following:
However, the org.redisson.config.Config class does not implement enableMetrics(). I can't find the implementation in Github source code.
How can one initialize the Metrics as described in the documentation ?
Thanks.


1267
RLiveObjectService not support Enum

version : 3.6.0


1268
org.redisson.RedissonTopic.removeAllListeners got blocked on CountDownLatch.await

Hi there,
We hit an issue in one of our server using Redission as Redis Client. We do have a single thread executor handling subscribe/unsubscribe for multiple channels. But last week, we found this got blocked on one server.
The org.redisson.RedissonTopic.removeAllListeners is unable to respond request, and blocked in the acquireUninterruptibly FOREVER. I tried to dig into logs, there was one exception thrown before this in CommandAsyncService.syncSubscription line 125 "Subscribe timeout 9500ms". This is possibly related since this was the only "Subscribe timeout" message I saw in last 30 days logs and then this issue happened. But I still don't find prove on this. Looks like this is a rare case since we just hit once. I tried to reproduce locally but with no luck.
I think the removeAllListeners should give an option to let caller pass in a timeout. But this is also not going to resolve the root cause. I am wondering if other people have observed this issue before. Please advise if you have any ideas on this, thanks.


1269
RedisClient.getBuckets do not have a asynchrounous api

i want a  buckets.getAsync api


1270
RDelayedQueue cannot be delayed




1271
RDelayedQueue cannot be delayed -- help me, thanks

I got it!   Thanks


1272
"You can't write against a read only slave" after failover with sentinel·

Hello, I have a strange issue with redisson and sentinel fail-over
I have a SpringBoot application, I have multiple instance of this application, load balanced(HAproxy).
My http sessions is shared between these instances with Spring-session and Redisson.
I have a Redis cluster in "Master - Slave" configuration with 6 sentinel.
When I have a failure on my Redis master (I can reproduce with "redis-cli -p 6379 DEBUG sleep 30"), the sentinel fail-over is working well (in around 2 minutes) and the slave become a master.
This is the beginning of my problems :
First I can see many "org.redisson.client.RedisConnectionException"  during 10-15 minutes
I assume, it's probably due to connection switching.
But after during 1 hour, I still have lot of "org.redisson.client.RedisException"
Lot of user login in my application are failing and all the access to redis become slow become slow (jump from 2 ms to 100ms)
And I restarted my Spring Boot application and everything is back to normal
Do you have experienced similar issue ? or any hint ?
I'm using SpringBoot 1.5.8.RELEASE
Redisson 3.5.4
Spring Session 1.3.1.RELEASE


1273
Slow gets from redisson in CommandServiceAsyncGet

Hi,
We are using redisson-client 3.6.0 with cluster mode enabled with elasticache, redis=3.2.6(encryption-at-rest enabled). These are the configurations for 2 separate clusters,
We see a degraded performance on all our apis and the bottle-neck seems to be from redisson. We are using spring caching and noticed that all the keys with a particular cacheName are being stored in a single shard instead of being distributed. How do we solve for actually distributing this across different shards?
We are contemplating switching to redisson.pro if it's going to help. But does the configuration look good and will redisson.pro help with the issues?
Please find attached screenshots that is showing the bottle-neck


1274
NPE with redisson pro

I am using redisson pro trial version(3.6.0) in cluster config with elasticache(redis=3.2.6), I see NPE in get and evict operations using spring cache framework. I don't see this issue with the community version(3.6.0) and same configuration
It basically just gives this error and hangs. I think the exception is being swallowed by DefaultPromise


1275
Redisson client keeps running after shutdown invoked

I have the following code:
What is other than shutdown needed for graceful shutdown?


1276
Redissonspringlocalcache manager in distributed systems

Hi I have read about the redissonspringlocalcache manager that it is keeping a local cache backed by redis. Please correct me if I am wrong. Please tell me how it works in distributed mode.
Eg. If we have 10 ec2 instances deployed connecting to same redis. Suppose there is a case which has been invalidated by one machine. How early can the other 9 machines would be knowing that their local cache is invalid and they need to call the redis to update it.
Do it use background polling to check if it is enabled.?


1277
RedissonSpringLocalCachedCacheManager not found

I want to use RedissonSpringLocalCachedCacheManager  for spring cache.But I can not find RedissonSpringLocalCachedCacheManager and LocalCachedCacheConfig in redisson 3.6.0 version. Is something wrong?


1278
Split RFieldAccessor into RGetter and RSetter annotations

No description provided.


1279
Extract RId.generator to RIdGenerator

No description provided.


1280
Sentinel failover with pub/sub failure ·

Guys,
I'm facing na issue I'd like to share and get insights from you.
We run a sentinel cluster which is composed by (3 sentinels, 1 master and 2 slaves). The application can have dozens of instances and is connected to to this cluster via redisson 2.10.7 and redis 3.2.10
Eventually in an event of failover pub/sub messages seems to not be delivered to redisson clients (I say that because SentinelConnectionManager logs for failover are not present in system logs).
The only log after that is:
After that, redisson becomes irresponsive and seems to never recover and the only way to fix it is to restart the application node.
Redis cluster is confirmed to be working properly (as restart of application nodes alone fixes the issue)
According to redis client guideline pub/sub messages are not guaranteed to be delivery and should not replace the pooling mechanism to check the cluster status.  I need to dig a little bit into the redisson code but it seems to strongly rely on pub/sub only.
I'm trying to reproduce it locally and build a test case, but it is being tricky.
Have you ever experienced this problem before?
redisson config as follows:


1281
Add support of PING for Pub/Sub

Add support of PING for pub/sub channels
redis/redis@70e3948
Discussion about this Redis feature: redis/redis#420


1282
Redisson issuing undue commands with spring cache

We are using redisson 3.5.2 with spring cache.
When I put the debug on the method,
I get the following requests when using Monitor on the redis server.
I am unable to understand why the eval and hset command is sent from redisson when I am getting a key.
This is creating an issue for us to scale our services since these eval and hset calls will only go to master. Even if, we increase our redis slaves we wont be able to scale our reads since each read results into two writes to redis master.
Other issues are:
The eval command is taking a lock on redis master.
The hset command is setting the same response in redis master which is being replicated by all the redis slaves. This is resulting in wastage of redis server resources since they are wasting them to replicate the exact same data.


1284
Redisson 2.9.1 Redis 2.8.17 in sentinel mode, redisson subscriber is not self-healing after restarting all redis boxes·

Set Up
Redisson version: 2.9.1
Redis Version: 2.8.17  Mode: Sentinel
Found this issue in our production, not sure if self-healing is supported by redisson during disaster like all redis servers are down, if it is supported, any specific version ?
We initialize the subscriber once as following during server startup
Redisson 2.2.27 is performing better than 2.9.1 in the sense of re-subscribe
Even all Client in 2.9.1 version, sharing the same config as above, some clients are able to re-subscribe
I went through the implementation of 2.9.1, found out that if following Scenario B, while doing MasterSlaveEntry. reattachPubSubListeners(), the unsubscribe and resubscribe process is trying in best-effort, which is prone to lose listener for a channel, leading clients unable to resubscribe. What is confusing is in Scenario A, some of the clients were able to reconnect somehow.
Is there any way for redisson to survive a redis disaster failure like this ?


1286
Multimap tries to keep the List/Set on the same node, but ignores Key Hash Tags in the given Key

As I described in the title, I am trying to utilize Key Hash Tags to accumulate data on the same ClusterNode.
I am using a Multimap and noticed the Key for the Lists/Sets are wrapped in the Key Hash Tags and so they may be placed on another Node.
For example:
The MultiMap key is "{multi.map}.some.key".
An entry in it would be saved in the List/Set "{{multi.map}.some.key}:ADJ...".
So the Hash is not "multi.map" but rather "{multi.map".
For further information see the "Key Hash Tag" section on


1287
Redisson Remote Service stops responding

We have an RMI running on Redission 3.5.7.  Each RMI is fire-and-forget with no ack or completion time
This particular RMI is invoked about once every 2 minutes.  After about 3 days, the server side of the RMI simply stops processing.  The client is still producing messages.  Other Redis features such as client caches seem to still be working correctly on the same APP that is supposed to be processing the RMI calls.
1-2 minutes after the last processed RMI call on the server side, we get the warning below.  This is the only error or warning that we are getting.  The rest of the java application works fine.  Once the the java application is restarted, all the remote calls are processed as expected.
We are running Redis on AWS with Redis 3.2.4 in cluster mode.


1288
Caused by: org.redisson.client.RedisException: ERR max number of clients reached.

When I use Reentrant Lock in my application, this exception  ERR max number of clients reached occurs.
Redisson version is 2.10.7, and redis version is 3.2


1289
Multiple JVMs tryLock attempt

We have a spring application running in 3 different servers/jvms. Those services receives an event notification with an eventID.
In order to avoid event processing duplication we are trying to use redis lock, to process only one event each time. We have multiple requests with same eventID coming from other services, so this is a very common scenario.
The lock is centralized in one Spring Bean
Each time an event comes we first verify if we can lock
We also the singleServer approach (commented above). But in both scenarios events are processed twice, eventually.
We don´t understand what its wrong. Can someone give us a clue?


1290
RedissonLocalCachedMap does not broadcast LocalCachedMapClear on clear()

clear() method is implemented properly on RedissonMap; but it is not overridden on RedissonLocalCachedMap. RedissonLocalCachedMap should override the parent implementation by clearing the local cache, clearing the Redis map, and broadcasting a LocalCachedMapClear event on the invalidationTopic.


1291
RExecutorService - Task resume on another worker doesn't happen, when worker(redisson node) goes down

Problem:
We are evaluating Redisson as a distributed task queue manager and as a result the expected behaviour for failure scenario is:
-- If a worker starts working on a task and if worker goes down before completing the task then task should be resumed on another worker.
As per our observation this doesn't happen.
For SIGINT and SIGQUIT signal - Most of the times it finished the running tasks. (We found couple of instances where it didn't happen)
For SIGKILL (when worker is killed using kill -9), executing tasks are lost.
Can you please help us understanding that is the above mentioned 'expected behaviour' correct? Does redisson provide this guarantee? If yes are we missing some configuration? If no, please indicate what is the best practice for using Redisson in this case?
Here is the code of the the Task:
Here is the main code which is invoking it:
Commands with which I start two Redisson Nodes are:
Please let me know if any more details are needed.


1292
RedissonRedLock.tryLock(long waitTime, long leaseTime, TimeUnit unit) still have something wrong

reference from the issue #1175 after it is closed.
I change the test case in RedissonRedLockTest.testLockSuccess() like this:
The test case above will fail in case of that lock1/lock2 is locked first in thread t1. However, it will pass in case of lock3 is locked first in thread t1.
The  is as follows:
No matter which lock is locked first in thread t1, the Red Lock will always can be locked or cannot.
In this case, the Red Lock should always be locked for most of the lock is available.


1293
JsonJacksonCodec cannot deserialize EnumMap

Hi,
I opened a ticket on the jackson databind project but I think this issue could use some visibility here.
FasterXML/jackson-databind#1932
The code below can replicate the exception I am seeing. I ran into this when calling operations on  a RScoredSortedSet, but the code below is stripped to just the Codec.
I believe this is a bug but I apologize if I am misusing the library.


1294
RBatch throws NPE with big pipeline in atomic mode

No description provided.


1295
Warning about CommandDecoder.decode() method




1296
CertificateException while connecting to Azure redis cluster

I have got CertificateException when Redisson try to connect.
Caused by: java.security.cert.CertificateException: No subject alternative names matching IP address 12.34.567.89 found
When i disabled the setSslEnableEndpointIdentification the connection was successfully established.
The scenario is when I'm using useClusterServers config
the Redisson client sends cluster nodes command to Azure Redis,
the server responses with a list of IP and port of cluster nodes, then Redisson client try to connect to newly discovered masters, but now the target is IP and Azure doesn't sign the certificate.
Important note:
all the discovered IPs are the same IP resolved by endpoint URL (which provided by Azure).
I saw that other redis clients separate the endpointIdentification for the base connection and cluster node connection.
If we are able to do node cluster endpointIdentification with the base connection verification it will solve the issue.
Thanks


1297
Add RLocalCachedMap.clearLocalCache method

It clears all local cache across all RLocalCachedMap instances.


1298
RBatch doesn't sorted sorted sets

Any reason RBatch does have a getSortedSet() method?


1299
Support for dnsMonitoring in Sentinel Setup · Issue #1299

After the fix of #1280 which improved greatly the resilience of Sentinel setup, it would be great to have dnsMonitoring  feature as well because in failover scenarios of sentinels instances, the box can get a different IP and the current implementation caches the dns resolution forever.  It means it never reconnects to new sentinels in the cluster.


1301
Error while creating bean of RScheduledExecutorService

I am trying to create a singleton bean of RScheduledExecutorService in Spring 4. I have not yet autowired this bean anywhere. I am always ending up with error. I am working with Redisson 2.11.
Unable to find any kind of solution or any instances of problem with anyone else here. Is this a bug ?
Since it is a JsonMappingException I also tried using different codes but nothing helped.


1302
Performance issues with updateMode=AFTER_REQUEST

We are trying to use updateMode=AFTER_REQUEST to make sure all the session data will be saved into Redis server. After reviewing the source code, looks it may cause performance issues since we keep a lot of data in the session, and store function will be called on every request no matter there is session changes or not.
Is it possible put save session data to Redis after tomcat request code to a separate thread?


1304
RedisClient does not override 'hashcode and equals' may cause  redis connections are not closed properly.

I found that in master-slave mode, the redis connections on slave servers may not get closed properly.
Caused by: org.redisson.client.RedisException: ERR max number of clients reached
After reading the source code, I found that the reason is that RedisClient does not override hashcode and equals.
Consider the following situation:
One hostname slave-hostname maps to two ip-addresses: ip1, ip2
Firstly, slave-hostname  maps to ip1, client2Entry will cache new RedisClient and ClientConnectionsEntry instances: RedisClient-ip1 and ClientConnectionsEntry-ip1
DNS  changes from ip1 to ip2, all the connections of ClientConnectionsEntry-ip1 were closed properly.
DNS  changes from ip2 to ip1, client2Entry will cache another RedisClient and ClientConnectionsEntry instances: RedisClient-ip1-1 and ClientConnectionsEntry-ip1-1. RedisClient-ip1-1 was different from RedisClient-ip1 as they were not the same instance.
DNS  changes from ip1 to ip2 again,
All the connections of ClientConnectionsEntry-ip1-1 should get closed properly.  When san client2Entry values, it is possible to find ClientConnectionsEntry-ip1 or ClientConnectionsEntry-ip1-1
The connections of ClientConnectionsEntry-ip1-1 may not get closed properly.
Our master-slave model
two slave servers, with one slave hostname, DNS changes every twenty seconds.


1305
RBloomFilter.expire only deletes Bloom Filter string, not hash

Problem
If I initialize a bloom filter like this
The String test is the only thing that gets deleted from Redis after expiration time. The config hash {test}:config remains even after expiration.


1306
Add Kryo 4.x support

No description provided.


1307
[Error] while connecting to remote cluster

I transfer redis cluster server from local host to virtual host recently, then some interesting things happened.
The cluster worked fine itself, but as soon as I used redisson as client, it went wrong.
They can registry by using remote address.However,they cant recognize each other with remote external address, but with local internal address. I dont know how to deal with it, can anyone help me, thanks a lot.


1309
should not clear channel and listeners when unsubscribe failure

This is very likely a bug.
in
Set up:
in step3: slaveDown happens when maximum attempts reached, but it was unable to send "Unsubscribe"
but in, when "UNSUBSCRIBE" failure happens, it removes the channel and remove all the listeners.
my thoughts is when "UNSUBSCRIBE" failure, we should readd the channel, and not executing onMessage()


1310
Wrong classloader used by TasksRunnerService?

Today I had a lot of work to bind embedded Redisson Node with Spring Boot. Here are the final thoughts and conclusions. In short I believe creating own codec in TasksRunnerService using TasksRunnerService class loader is a bug. Please review the article for more details.


1311
Tomcat Session Manager issue to renew session in Load Balance environment

Hi!
I'm using Redisson 3.6.0 with redisson-tomcat 3.5.6 with:
Elasticache Redis Cluster
Spring App deployed on two instances EC2 Tomcat (instance 1 and instance 2)
Load Balance with non-sticky session
My session timeout is configured to 30min.
The steps to reproduce the issue:
a. User logged in on instance 1 (a new session is created with timeout of 30 min);
b. After 15 min, an ajax request was made by the application which was managed by 'instance 2' refreshing the session to more 30min;
c. After more 20min the user reload the page, and the load  balance send some requests to 'instance1' and to 'instance 2', but the instance 1 has been idle  for 35minutes and because of that, delete the session that was renewed 20 min ago!
This issue is only reproducible using at least two instances behind a load balance with non-sticky session because the action to delete the session ignores if the session was renewed by other instances.
Is there anything I can do to prevent this behavior?
I think this is related with #972


1312
is it possible to add a duplicate check when RedisPubsubConnection addListener ?

Sorry to open so many issues for the same problem, feel free to close it if you think this is not appropriate.
We are trying to have the best availability of our service when redis servers in Sentinel mode run into disaster situations (like all redis-server, redis-sentinel are down)
Currently, what we are trying is when Redisson client last received ping is too old, it will try to re-subscribe to the same channel. However, this introduced new problems, when the QPS is high, we added multiple listeners for the same client to the same channel, which is not optimal.
In following two places, there is no duplicate check (if the listener already in the PubsubConnection, don't add the listener)
Is it possible to add a duplicate check that only when the listener is not there, we add the listener to the connection ?


1313
Redisson 3.61 not working with spring-session 1.3.1.RELEASE

Hello,
I try to upgrade redisson from 3.5.7 to 3.6.1 but I get this exception :
I'm using theses dependencies :


1314
JsonJacksonCodec constructor in 3.6.1 breaks with Jackson 2.9.x

Using Jackson 2.9.2 and 2.9.4 (tried both), trying to upgrade from Redisson 3.3.2 to 3.6.1 I get this:
Redisson 3.5.7 does not have this issue.


1315
"Unable to init enough connections" when ConnectionMinimumIdleSize is high

We're having trouble spinning up redisson (3.6.1) when the minimum number of connections is high.
Steps to reproduce:
Run a local redis server. We used the official docker image:
Try to create a redisson client with a high number of idle connections, short retry interval and some client name:
More often than not, we're getting the following exception after a few seconds, with a varying number if successful connections:


1316
The cache in redis can not be clear automatic when Redisson resatrt

I hava set the ttl and idleTime for cache, the cache can be remove when the app is running, however when I restart app the EvictionScheduler may not work for cache, the cache can not be clear when ttl approach. Does it problem have any solution?


1317
Many exceptions and errors after sentinel failover with redisson 3.6.1

Hello, I'm re-opening the issue #1272 for me it's not fixed in 3.6.1, I get lot of errors long time after a fail-over.
My setup :


1318
Redisson 3.6.0 memory leak with cluter batch

018-02-28 19:56:31,534:io.netty.util.ResourceLeakDetector.reportTracedLeak(ResourceLeakDetector.java:311).LEAK: ByteBuf.release() was not called before it's garbage-collected. See for more information.
Recent access records: .


1319
RBloomFilter functionality with RBatch commands

This issue is to implement RBloomFilter with the RBatch batch commands. I do not see a getBloomFilter() option with the batch commands, it would be incredibly helpful to have.


1320
Configurable Tomcat Session Key Prefix for Redis

RedissonSessionManager uses "redisson_tomcat_session:"  as key prefix, so if multiple tomcat instances are using same "redis" server for storing session data. So need a mechanism to configure default key prefix.


1322
calling getMap() million times creates millions of map instances

While reading the Redisson tutorial and examples, I am under the impression that I need to always call redisson.getMap() in order to get the latest data from the cache . Right ?
I have a storm bolt which calls getmap(key) for millions of incoming records
Looks like millions of instances of RedisonMap being created , leading to pressure on GC


1323
Upgrade Spring Boot to 2.0.0

No description provided.


1324
 Skipped slave up  for master redis://?:0 differs from current redis

After upgrading from 3.5.7 to 3.6.1 I can see a lot of warnings every 3 seconds:
I use SentinelServersConfig.


1326
Redisson 3.5.7 memory leak with locks

I'm using RLock and seeing memory leak via org.redisson.client.handler.CommandPubSubDecoder
Retained objects delta between heap dumps taken apart
Around 10MB leak per day


1327
Jcache - getAndRemove method is throwing an NPE

We configured a Redisson cached based on Jcr-107. Most operations are working fine but the getAndRemove implementation is throwing a null pointer exception. When removing the key with cache.remove("key"); instead, it works fine. We could do it in two operations but it will lose the free Atomicity.
Unfortunately, I'm not fluent in the LUA scripting used in order to propose a solution at the moment
Code that show the issue:


1328
none




1329
Wiki is broken

Keeps redirecting me to this page.


1330
Old/stale nodes not removed from NodesGroup

When trying to implement a healthcheck for a Redis Cluster I'm using code similar to the below to get the list of nodes and ping them to see if they're up.
If I redeploy a node and it gets a new IP, the new node is returned by redisson.getNodesGroup(); but the old one remains and we get an error:
If I failover a slave node then the slave node will be returned by redisson.getNodesGroup(); as a master (which is correct) but the original master will appear twice as both a master and a slave. If I then failover back to the original master, that node will be returned as a master twice and still as a slave.
When digging into the code it looks like this list/map lives in MasterSlaveConnectionManager as clientEntries which only gets cleared or removed from during a shutdown.
What I'd expect is for old or stale nodes to be cleared up from this list/map.


1331
[2.11.1] Unable to re-establish MasterConnectionPool after restarting redis

We are Trying to add a mechanism to re-subscribe to topics after restarting redis.
Setting UP:
Steps to recreate:
See Following Error, Redis MasterConnectionPool is not re-established.
We were initially at Redisson version 2.9.1, but when we following the previous steps, in step 5, we encountered the same issue as in #1268, which is removeListener thread blocks forever, so make the switch to 2.11.1
We also simulate the scenario with 2.9.1 version,  without doing removeListener (we found out there is pubsub Listener leak issue with 2.9.1, that is why we remove the old listener first), the MasterConnectionPool was able to re-establish.


1332
Slow down when Redis master switching (sentinel)

Hi,
We have detect an issue on our redis (sentinel) cluster when there is a redis master switching .
During a performance test, we use PriorityQueue (~ 10 calls / seconds). All transaction are closed on 20-50 milli-seconds.
When master switching, on JConsole we have seen Redisson place some locks on redis databases, and all application are slow down... All transaction are closed on 3-10 seconds !
On our Redis cluster we have, 1 master, 5 slaves.
This is our using components versions :
Also, we have test, redisson 2.11.1, we have the same issue.
We have issue with this config :
And we have apply a fix (work around), it's better running, but it's a huge configuration (on system : lot of connection and open file issue)
Can you help us please ?
Thanks you


1333
RedLock Java ambiguous implementation

Hi,
we should implement a distributed lock system for our clustered Spring Boot application.
We have a Redis "cluster" (no cluster mode enabled) with Sentinel.
Now, reading the documentation it seems that RedissonRedLock should be used as locks wrapper class to use lock/unlock api.
It seems that RedissonRedLock should be used with different RedissonInstance e multiple RLock's.
But what kind of lock should we use to implement single distributed lock with single redisson instance per-node?


1334
Unable to connect AWS elastic Cahce over SSL in Cluster mode

I am using lib version: 3.6.2
When trying to connect AWS Elastic cache(i.e rediss) over ssl in cluster mode getting below exception:
Not sure whats going wrong here, as per documents AWS manages the SSL certs so ideally this exception shouldn't have arrises.
I see this was closed as part of the issue #1135 . How ever single server mode with SSL is working fine. Could you please help me on this?


1335
Deserializing Nested RMap throws NotSerializableException

I am using org.redisson.codec.SerializationCodec and   redisson 3.6.0
I have a child Rmap inside a parent Rmap.
Facing an Exception while fetching the stored Rmap
Is Rmap serializable ?
How can I use a codec for fetching (get) and storing (put) Rmap from inside a parent Rmap ?


1337
none




1338
RListMultimapCache removeAll method throw java.lang.ClassCastException: java.util.LinkedHashSet cannot be cast to java.util.List




1339
ERR Error running script (call to f_8770695dc269722cd5368a1e08ca936b4ccbb0b7): @user_script:1: user_script:1: bad argument #2 to 'unpack'

Getting error when calling readAllKeySet() operation.


1340
Redisson Spring Elasticache Iteamcount issue

Hi,
Apologize, if it's not the right forum to post my concern, kindly let me know so i will remove my post or you could redirect me right direction.
we have one doubt regarding how redisson internally storing data on redis cluster (here we are using AWS elastiCache), because the actual number of items is not the same as we have stored using our cache application.
as per logging it's showing proper Set and Get (the data from/to cache server) but the problem is with the actual item count (number of keys) on AWS, it's too lower tan expected,(e.g   even if we are storing 3K data the count is still showing ~20-30).
we are using spring @cachable annotation on top of redisson to achive the caching , also for cluster redis environment we are using AWS elastiCache . here are more details,
Spring redisson config:
Thanks


1341
Get type of a key in Redis

Is it possible to execute the "Type" command and determine which datastructure should be used?
If not could this be Implemented?


1342
RSortedSet tries to compare wrong types

I have a sorted set of longs and try to check if a value is contained.
I use the LongCodec and get the following error:
I debugged it and also saw that a RedissonList is created in the constructor, but the Codec is not supplied to it. May has something to do with it...
The Values in the list are typed as Integer, which they shouldn't be


1343
Redisson Pub/Sub Successful, But RTopic publish method return 0

hi @mrniko
redisson use sentinel configure for pub/sub successful,but RTopic publish method return 0.current use version:2.7.0,I have try use last stable version for 2.11.3,this problem still reappearing.


1345
none




1346
Security Issue - Redis Password visible with TRACE log level

Hello,
I have seen my redis password in the TRACE log.
In general this is one of security requirements for a development: do not print any passwords in the logs.
See OWASP Error Handling and Logging Best Practice 119
I suggest to obfuscate the logged body of the redis command "AUTH" in the class CommandEncoder
Thanks,


1347
Question: Send batched messages - Get batched messages

Hey!
When I send a batch with multiple .publish(msg)  commands to redis,
does redis send these messages as a "batch/pipeline" back to the subscribers
in ONE network connection so that redisson handles them all at once?
Regards, RoboFlax


1349
redisson jcache.getAll(Set<T>) causes io.netty.util.IllegalReferenceCountException: refCnt: 0




1350
NPE in CommandDecoder handler while using RBatch object




1351
Can't execute SENTINEL commands on /

redisson throw follow exception, while start app everytime.


1352
Bug Pub/Sub: Skip result + Execute batch - RedisException: ERR Syntax error, try...

I found out that when using skipResult() + execute() in combination it throws a RedisException.
Exception:


1353
Fair lock vs regular lock

Hi,
Right now we are using regular lock in our system. I found out in the documentation there is also fair lock option.
I am trying to find in the documentation any explanation about performance of fair lock vs regular lock.
Is there any performance penalty? I mean is there a reason not so use fair lock always by default?
Thanks


1354
how to create a custome id generator in hibernate

No description provided.


1355
none




1356
two thread get  the same   RedissonMultiLock?

Is my code has any problem?
there are two different  thread get the same  multilock.
thanks!


1357
method putAll throws map value can't be null




1358
none




1359
IllegalStateException: availableProcessors is already set to [8], rejecting [8]

Hello,
i'm using embedded elasticsearch in my application with EHCache and it all works fine. Now I want to configure redisson and I get this exception during startup:
Looks like redisson has already initialized a netty runtime and elasticsearch is trying to do the same so it blows with this error.


1360
Cannot construct instance of `org.javamoney.moneta.internal.JDKCurrencyAdapter`.

Hello,
I have my app working perfectly fine with EHCache. Now I want to migrate my app to use redisson, however I get the following exception:


1361
Redisson-tomcat in a multi-tenant environment Logs: ERROR io.netty.util.HashedWheelTimer - You are creating too many HashedWheelTimer instances.

Hi!
We are using the redisson-tomcat-8 in a Webserver containing more than a 100 apps. In the tomcat start up we get the following errors in some apps:
ERROR io.netty.util.HashedWheelTimer - You are creating too many HashedWheelTimer instances. HashedWheelTimer is a shared resource that must be reused across the JVM,so that only a few
How can we reuse the HashedWheelTimer in order to avoid this error (Many customers have lost their session while browsing, but we are not sure if that is the cause of the problem).
We are using Redisson 3.6.2 with redisson-tomcat-8.
This is the tomcat context.xml:


1362
DecoderException after upgrade to latest version 3.6.3

We are trying to upgrade our redisson client to latest version by using "After_request" property. However, there is an DecoderException was thrown during tomcat failover testing.
Do you have any recent codec code change may link to this error? Currently we are using "SerializationCodec".


1363
Is this a bug




1364
Consecutive "Subscribe timeout" for topics utilizing same AsyncSemaphore lock

Hi there,
Thanks for the quick fix on the ticket #1268 . We tested it and the block on RedissonTopic.removeAllListeners no longer happened.
However, we started see another issue: After a fairly long time running with the new code, subscriptions( by calling RedissonTopic.addListener) to the topics which are assigned to the same AsyncSemaphore lock from the method MasterSlaveConnectionManager.getSemaphore() are all encountering the same timeout error like "Subscribe timeout 9500ms". It's very consistent. But for other subscription calls to other topics which assigned to different AsyncSemaphore locks, everything works fine.
It's possibly related to #1268. Please help advice how to tune and debug this problem.
Thanks


1365
put  RMap or RLocalCachedMap ,return null, is not sync!!!




1366
Redisson connected to sentinels works fine - But throws the following error

[ERROR] MSG - o.r.c.SentinelConnectionManager Can't update cluster state
Hi,
I've RedissonClient connected to Redis Sentinels(Redis 4). Redis commands work fine, but throws the above error. Couldn't figure out the cause of the issue


1367
Java 10 support

Java 10 looks currently not supported because highMask and lowMask private methods are removed from URI class what is referenced here.


1368
RedisTimeoutException when I register remoteservice

I run redisson by spring,and it works well,But when I register remote service,it does not work.Redis connection is ok.I do not know why.
redisson version is 2.11.1
I find that it will happened when worksAmout is a big number or you register a large amount of services


1369
RedissonScoredSet - contains/remove method - equals and hashcode?

But classes with different values (and same id) are not considered to be equal, when I use methods "contains" or "remove" in RScoredSet.
Is it the desired behavior?


1370
ERROR [io.netty.util.ResourceLeakDetector] - LEAK:

When I run redisson,there are some error logs:


1371
none




1372
Add Transaction API

Implement Transaction API for Bucket, Set, SetCache, Map, MapCache, LocalCachedMap objects with commit/rollback methods and READ_COMMITTED isolation level.


1373
Spring Data integration

No description provided.


1374
Spring Boot Starter implementation

No description provided.


1375
RSet returned by RSetMultimap.get() does not update multimap correctly.

RSets returned by get() cannot be used to populate RSetMultimap. Multimap key and size information is not managed properly despite get() returning populated sets. See this example:
Here, multimap1 keyset and keysize are not initialized. Javadoc for the get() method claims:
"Changes to the returned collection will update the underlying multimap, and vice versa."


1376
What is difference between Rmap and RLocalCachedMap

I have a DB with 100k hashmap. And I run some 10k, 100k loop test to compare time between getting by RMap and getting by RmapCached
I saw no differences in benchmark time. Am i make a wrong config or something
When I use RMapLocalCached, why redisson keep getting result from my Redis DB, I think it should get result from some local variable instead of connecting to Redis DB and get result ?
I use LocalCachedMapOptions.defaults().cacheSize(0).timeToLive(100000) .evictionPolicy(LocalCachedMapOptions.EvictionPolicy.NONE) .syncStrategy(LocalCachedMapOptions.SyncStrategy.NONE) .reconnectionStrategy(LocalCachedMapOptions.ReconnectionStrategy.NONE),
But when i change a value in Redis DB by redis-cli, redisson immediately get a changed value. ?
Thanks.


1377
Unhandled DecoderExceptions deplete Netty pool

Our web application is writing an object using Redisson 3.6.4 (Jackson codec) which Jackson cannot deserialise for whatever reason. On attempting to read the object, Redisson fails on the first few attempts and throws a DecoderException as expected. However, the following message is seen from Netty:
Apr 06, 2018 11:54:28 AM io.netty.channel.DefaultChannelPipeline onUnhandledInboundException
After a few attempts (depending on size of Redisson connection pool), all connections are depleted. At this point Redisson is unable to execute any more commands regardless of validity.
I have created a barebones test case to demonstrate the problem:
You can checkout and run with ./gradle run (assuming Redis is running locally). See how the first few read attempts fail immediately, but the thrown execption changes from RedisException to RedisTimeoutException and the RedissonClient cannot execute any more commands.


1378
[CRITICAL] Redisson cluster sync failed

In cluster mode when master goes down and slave becomes a master, Redisson picks up new master but failes to sync slaves. Cluster nodes synchronisation crashes (never scheduled again) with IllegalArgumentException while processing slave nodes.
Redis cluster setup:
Relevant stacktrace:
Code path which fails with IllegalArgumentException (please note it's 3.0.0 branch):
scheduleClusterChangeCheck(cfg, null); is never executed thus Redisson stops sync cluster state. Any subsequent cluster change leads to a service outage.


1379
Why no RMapCacheAsync::fastReplace?

I am trying to optimize my Redisson throughput, and to do so, am using the MapCache fast methods, where no result is returned for a put or remove, but there is no fastReplace.  Why so?
I created my own one by subclassing RedissonMapCache and adding a method there, and that works fine.  However, now I want to use pipelining, but it will not work with the Batch classes without further modification.
I do see that there is a replaceOperationAsync, which returns a Boolean, so keeps the response message to a minimum, but that is offset by essentially doubling the size of the request by including the value to be replaced, so that is less than ideal for my purposes.


1380
RList value in a RLocalCachedMap returns RedissonReference

I have the following RLocalCachedMap defined:
By the way, I'm using Spring and the Map is loaded as a Bean.
Am I doing something wrong or is it a framework issue?


1381
about getList implement

I use a redissonClient  instantce invoke getList method. when I debug into the method,I find it's just return a construct of RList with some parameters(key,executor..).Then the Rlist fullfill with data in redis server! I wanna know how it execute....I look up the source code all the afternoon ,so disappointment.I Find no answer.
Please who can tell me how it work linked with the real execute method,thanks a lot ,U angle ღゝ◡╹)ノ♡


1382
Redis server response timeout (3000 ms)




1383
org.redisson.client.RedisException: ERR unknown command ' EVAL '

I used master slave model on tencent cloud server.


1384
RMI starts to lose ability to send commands

We are using Redisson 3.6.4 and publishing several hundred RMIs at a time.  After a few minutes, we start seeing these errors, and they start to build up over time, until no RMIs are being processed at all.
We are on a clustered AWS Redis server


1385
RedissonSortedSet does not implement ZRANGE commands

RedissonSortedSet does throw an UnsupportedOperationException on a call to the headSet, tailSet and subSet methods.
They could return the response of the ZRANGE or the ZRANGEBY redis commands.


1386
throw exception when use redissonClient.getPermitExpirableSemaphore function




1387
none




1388
Frequent timeout with RedisLabs multi-proxy setup

In the latest Redislabs cluster, the user can enable multiple proxies, and the DNS query of the cluster would return different IP addresses for load balancing.
From Redisson side, we observe Redisson would have very frequent timeout with DNS monitoring enabled. Seems like for each DNS lookup, if IP address changes, Redisson would try to reconnect with this new IP and lead to unstable system.
Is it possible for Redisson to check the cluster health before trying to connect to the new IP address?


1389
About select db

why Config.setDatabase can not use? how to select db in sentinel mode


1390
Implement Spring Transaction API

No description provided.


1391
Redisson: Why reactive client doesn't have PermitExpirableSemaphore?

Note: Asked same question here in StackOverflow, but there was no response.
I am using redisson reactive Java client. In non reactive client one could get expirable Semaphore as:-
RPermitExpirableSemaphore semaphore = redisson.getPermitExpirableSemaphore("mySemaphore");
But If I create a reactive client, I can only find redisson.getSemaphore("value") function. I need PermitExpirableSemaphore because:-
I need a lock, that could be released by different thread(so can't use RLock).
I need a lease timeout to prevent deadlock in case the lock aquiring thread is killed or stuck.
Is there any way to achieve this behavior in Redisson?
I can set lease time global in Config as:- Config().setLockWatchdogTimeout(leaseTimeMs), but I really need different leasetime at different locks.


1392
Introduce BatchOptions object

Currently Batch settings exposed as RBatch method which is not convenient and contradicts common API design.


1393
RMI Garbage Collection in Redis

Each of the RMIs seems to be put in a namespace under {redisson_rs}  How are RMIs being garbage collected or do we need to run another process to do our own garbage collection for RMIs?
We are using 3.6.5 on a Redis cluster at Amazon.
What we appear to be seeing is that the RMI jobs are never purged from the DB.  Most of our RMIs are set and forget.
Our code generally looks something like this:
The server code
The client code
What we are seeing
The specific key/value pairs for the RMI seem to grow unbounded, until Redis runs out of memory to process more jobs.  We have been looking for someway to delete the job once it has been completed, but are not sure how to do this.


1394
'reconnectionTimeout' setting in unavailable. Please use 'failedSlaveReconnectionInterval' setting instead!

use Version 3.6.5


1395
PermitExpirableSemaphore to be able to make expirable permit to a normal permit

Once a permit is acquired as an expirable permit, there should be a way to remove the expiry and make it to a normal permit.


1396
java.lang.NoSuchMethodError java/lang/CharSequence

Im using Redisson 3.6.5 and Java JDK 8


1397
Can't update cluster state

Hi,
I am getting below error message when one for the node goes down from the cluster (3 node master/slave cluster).  version of redisson (2.7.4).
Above message is keeps on coming. And on subsequent call to redisson leads to below exception.
Thanks
Vikram


1398
ClassCastException with StringCodec while testing non sticky session on Tomcat

I am getting this error on Tomcat 7 and JDK7:
Can anyone point out what was the issue?


1399
setDatabase is no use

but no use
when getKeys ,it return all keys ,but not the key of one db


1400
java.lang.IllegalStateException: Redisson is not in cluster mode!

I am trying to connection AWS elasticache with redisson, but get this error
And here is my code used to create redisson client:
I am using 3.6.5 redisson library


1401
NullPointerException for RLiveObjectService.delete?

if there is not a model class exist for "key", it will throw a NullPointerException?
here may return null.


1402
Request org.redisson.client.RedisTimeoutException during high load

Hello,
I'm using redisson v3.6.5 with Redis 4. I have 3 masters and 3 slaves nodes for 5 tomcat clusters. However during high load, my team experienced a lot of org.redisson.client.RedisTimeoutException exceptions such as below:
Could you please point me to the direction, as I'm lost with these issues here?
Thank you.
Kevin


1403
none




1404
none




1405
Add async methods to RLiveObjectService interface

No description provided.


1406
getKeysByPattern is returning less number of keys in version 3.6.1

Hi,
We were using redisson version 3.5.2 and getKeysByPattern was returning all the keys matched for a particular pattern. When we upgraded to 3.6.1, the method seems to be broken and returning less number of keys than the keys actual present in redis.


1407
Publish a request id in a redis event

This is a feature request.
It's not always easy to associate a redis event with a specific request, e.g., when you don't know whether a put would result in a CREATED or UPDATED event.  It would be nice in a request to optionally provide a request id, which would then included in the published redis event to help with this problem.
thanks, Mitchell


1408
ConcurrentModificationException - Pub/Sub using SerializationCodec, redisson 3.6.5

I have noticed occasional ConcurrentModificationException while using RedissonTopic.publishAsync. We are using it in multi threaded context, but I think this method is supposed to be thread-safe, right?
Stack trace:
We have noticed this error after upgrading from redisson 3.6.1 to 3.6.5.
This is using Redis server in sentinel mode with one master and one slave. Redis info:
This issue occurs rarely, under moderate load 50 - 100 messages/s.
Could you please check what might be the cause of this, and is there any work-around available.
Thank you!


1409
Netty 4.1.23 regression

We notice that netty version used in the latest redisson version is not stable.
take a look at


1410
Why RBitSet.set(...) does not return anything?

Return value
Integer reply: the original bit value stored at offset.
But RBitSet.set(...) methods are of type void despite their async counterparts having return type of RFuture<Boolean>.


1412
TimeoutException

How to solve this problem?


1413
Exception in thread "main" org.redisson.client.RedisException: ERR unknown command eval. channel

if you have this error ,check your redis server  version,  and confirm   eval command  open


1414
Tomcat Session replication inconsistences

Hi,
I have a tomcat cluster with 2 servers, both having the Redisson Session manager for non-sticky session replication. Whenever a request is served for the first time by a server, a new session is created with session attributes. Next time if the second server receives a request with same session id, it should create a session in memory and fetch the attributes from Redis. Sometimes it does fetch all the attributes and sometimes it does not. This random behaviour is really getting annoying.
I've tried to use REDIS as the read mode instead of MEMORY. But the application gave me some problems(IllegalMonitorStateException). That's why I was not able to test it.
After looking at the code, I've seen one problem. If we are using the MEMORY read mode and all instances have the same session with all the attributes; whenever an instance updates an attribute it will be persisted on Redis but the other instances won't check this update if they already have a value stored in memory for that session. This is obviously discouraging.
I am wrong about my findings? And how can I solve my problem?
Thanks in advance.


1415
setPingConnectionInterval for replicated servers configuration is not propagated to underlying MasterSlaveServersConfig

Hey,
When I set setPingConnectionInterval in the replicated servers configuration it's not propagated to underlying master slave configuration:
My current understand that ReplicatedServersConfig is used to create MasterSlaveServersConfiguration In the MasterSlaveConnectionManager in.
In this method setPingConnectionInterval is not copied and default value is used in MasterSlaveServersConfiguration.


1416
RedissonBoundedQueue expiration seems odd

Could someone help me to understand how expiration works with queue.
I found several expire method seems like they working fine, but after expiration it needs to initiate queue with trySetCapacity because it is not possible to add element there.
Also i found that expire works not per element, it sets for whole queue which i also don't understand, so there could be some strange things if i will set expire for 10 seconds and after will try to set for 20 seconds,  every element will be expired after 20 seconds.
I don't say that is a bug i just want to get proper information about expiration in queues.
Thanks for every answers.


1417
HOW TO GET REDIS TIME  IN REDISSION?

How to get redis server time in redission?


1418
throw exception when use RPermitExpirableSemaphore.tryAcquire

use Version 3.6.5


1419
AWS ElastiCache ClusterServersConfig DNS rediscovery failure

We are connecting to AWS ElastiCache - Redis cluster using a Route53 DNS endpoint with Redisson v3.6.5
When we change the cluster in the Route53 corresponding lookup change is not happening in Redisson. It is still looking up the old cluster nodes.
Netty libraries used are as follows


1420
Can Redisson KryoCodec default support 0-arg constructor object

As the immutable object is wildly used nowadays can redisson's KryoCodec supports it by default
when get the kryo instance from the pool using following code Objenesis helps do the trick
related issue


1421
none




1422
SSL connection to Azure redis failed

I caught Certificate Exception same as #1296,
The issue is that "allAddrs" size equals to 1.
Can you explain the condition?
the cluster contains 6 nodes (3 masters,  3 slaves),
all of them have static IP address and a unique port.
for example:


1424
sentinel switch-master no work

Hi,I have a Redis setup with 2 nodes (master, slave) and 1 sentinels .
redis version is windows 3.2.100 .
redisson version is 3.6.5.
When master is failover,redisson can not failover to new master automatic.
my code:
Is that my code's error or redission's bug?
I find out the reason.
In SentinelConnectionManager's Constructor, loop all sentinelAddress using SENTINELS command to find all sentinels. If there is only one sentinel, List<Map<String, String>> sentinelSentinels = connection.sync(StringCodec.INSTANCE, RedisCommands.SENTINEL_SENTINELS, cfg.getMasterName()); ,the code result will be empty.


1425
Feature request - I would like the ability to specify redis channel name

Currently, when subscribing an application to redis events, via adding a listener, there's no easy way to specify a channel name.  The problem with this is that in a clustered environment, where each member of the cluster is responsible for updating the same redis keys, e.g., session keys, then all members of the cluster will receive all notifications for all the updates, even if they are only interested in the updates that they made.
One way to get around this is to specify a unique channel name for each member of the cluster, resulting in only being notified of the updates that it is responsible for.
I have been able to achieve this by subclassing the Redisson class, in my case the RedissonMapCache, and overloading the channel naming methods.  I've demonstrated that this works.  One problem with this is that without additional modifications or extensions to Redisson, it won't work with batching.  Ideally, if one could provide a mechanism for modifying the channel name, that would be great.
thanks, Mitchell


1426
java.lang.NoClassDefFoundError: org/redisson/RedissonLock

use Version 3.6.5


1427
Spring cache not expired properly


Spring Cache should expire with given TTL making it footprint stay at the same level

Spring Cache footprint constantly grows
Steps to reproduce or test case
The Spring Cache data items seem not to be evicted by Redisson if other keys in the same hash are accessed before in periods lower than Spring Cache expiration time, even if this access is performed for different data items.
E.g. imagine a case where there is a Spring Cache region named "test-cache" with TTL of 5 minutes.
That leads to a problem of uncontrollable cache grows, as the cache is almost 100% guaranteed to be accessed in the period if individual item's TTL (see screenshot):
You can see non-expiring Spring Cache in the following redis-cli output (it is production instance output, so no "test-cache" there, but check "ContentService.findAllByContentGroupOrdered" instead that has grown to 27256 members - should be around 100 in a normal case):
Sampled 33 keys in the keyspace!


1428
none




1429
ClassCastException when receiving messages of different types

Hello,
I need to be able to publish different types of messages through a single channel.
I try to explain my senario with an example.
App X publishes messages of type String and Integer to one channel.
App 1 catches the Integer objects and App 2 only wants the Strings from the channel.
Thanks for helping me...


1430
can use netty3




1431
Cannot Read Avro encoded Object from Redis after changing Java Class


I don't know if that's the way it works, but I was expecting that I'm able to add a new field to a class, and the deserialization from Redis would be Backward compatible with the "old" schema for the class.

The  is that the Read operation from Redis (RBucket) explodes, with all kind of deserialization/parsing errors, depending on the type of the new field. But it breaks always.
Steps to reproduce or test case
I just created a simple Java Class. Then I initialize the codec for my redisson client in this way:
and I'm able to write and read my object instances from Redis. But After I add a new attribute to my Java Class, then I'm not able to read my saved objects anymore. If I remove the field, then everything starts working again.
singleServerconfig


1432
Invalidated session in one tomcat is still used in another tomcat instance when relogin

Hello,
I am using redisson tomcat session manager in docker environment. I have 2 tomcat containers and want to share the sessions with redis. I can see the sessions information are stored and retrieved on redis.
However, I have an issue that an invalidated session is used because the invalidation is done in another tomcat. The steps that I've done is:
Login request goes to tomcat1 and a session is created.
Any request after login (e.g. query) goes to tomcat2. The same session is used, and it works fine.
Logout request goes to tomcat1 and the session is invalidated.
Try to re-login and the request goes to tomcat2 and it gets a session.
The problem occurs here. When a request done after re-login, it goes to tomcat1, but the session is not there, and my application throws an error.
I have debugged through the code and I found that:
When the first login request is done in tomcat1, the getSession method is called and findSession method will not find any sessions, therefore a new session is created in the memory of tomcat1 and stored to redis.
When a request (e.g. query) goes to tomcat2, the findSession method will look into the tomcat2 memory first, and if it could not find it, it will find the session info in redis, and then create a new session object in the tomcat2 memory and put the session information from redis into it. (Correct me if I'm wrong)
When logout, it goes to tomcat1, the session is invalidated, it is removed from the tomcat1 memory and also the session info is removed from the redis. This means the session in tomcat2 memory is never removed at this point. (Again, correct me if I'm wrong)
Therefore when re-login request goes to tomcat2, because findSession method will get the session from the memory first, and the client still has the same session id, it will get the session from tomcat2 memory which has already been invalidated in tomcat1 and used it in the request without updating to redis.
Finally after re-logged in, when trying to make a request and it goes to tomcat1, the session does not exist because the findSession could not find the session neither in tomcat1 memory nor the redis. Therefore the application will throw an error because it checks first if the session exists before making a query request.
My question is what behaviour do you expect in this case? Is the findSession method already working as expected?
Or do I miss something in my application? (e.g. do I have to always check the "session:isValid" should be true everytime I do login? (because it's not described in the documentation usage guide))
Thanks.
Regards,
Ricky.


1433
Concurrent calls to RemoteService should not result in an exception


Concurrent calls to RemoteService should not result in an exception

Concurrent calls to RemoteService should result in an exception
Steps to reproduce or test case
Redis version
4.0.9
Redisson version
3.6.5
Redisson configuration


1434
RedisTimeoutException in RBlockingDeque

Hello.
When I try to get a result from a blocking deque, I get RedisTimeoutException.
I expect that after 1 second I will get null value.
Redis version
3.2.100
Redisson version


1435
Incorrect results from RBitSet.setAsync

I believe the issue is in RedisCommands SETBIT_TRUE and SETBIT_FALSE that use BitSetReplayConvertor that, by the look of it, is implemented to return true if Redis sends back the same value as was passed to SETBIT. Meanwhile the docs say:
Return value
Integer reply: the original bit value stored at offset.
So the implementation should be something like:
In fact, you dont event need two different RedisCommands.


1436
Can I use RScript to run a lua script which inserts data into RMapCache?

It's not a bug, just don't know how to do that and googled for nothing.
I can use RScript to insert data into RMap, but as I observed RMapCache entry's value is prefixed by ttl and max idle time. Can I generate that prefix by hand and then concatenate the generated value and the real value in lua script?


1437
none




1438
where can I find more example/quick start/demo ? the quick start on github too short...

where can I find more example/quick start/demo ? the quick start on github too short...
I want more example/quick start/demo to replace Jedis...


1439
NoClassDefFoundError when using FstCodec

I'm using redisson tomcat session manager 3.7.0, and tried to set codec with FstCodec, but got error during tomcat startup. Did I miss anything? :


1440
org.redisson.client.RedisTimeoutException




1441
RedissonListReactive don't implement readAll and there is no method that uses LRANGE


Get all the elements from a list at once using the reactive API (a method that uses LRANGE)

I have to use RList to get all the elements at once or the iterator from the RedissonListReactive but that last one take ages.
Steps to reproduce or test case
Redis version
Redisson version
3.7.0
Redisson configuration


1442
RLocalCachedMap memory leak when using EvictionPolicy.WEAK


Weak references should be cleared.

It seems that even when using static Strings for keys and values and only fastPut method the OOM error occurs after several thousands of invocations.
Steps to reproduce or test case
I have created a separate repo to easier reproduce the problem:
Redis version
4.0.9
Redisson version
3.7.0


1443
How do I get redis server nanoTime?

redis cmd time return
but redisson time() method only return
I want to get  1)+ 2)  ,please help me
Thank you.


1444
Why RTransaction do not have getBuckets method?


RTransaction should be same to RedissonClient, have the method:getBuckets , return batch result

Steps to reproduce or test case
Redis version
Redisson version
3.7.0
Redisson configuration


1445
RedissonRedLock algrithm improvement

Imagine you have 5 masters, when a client has managed to acquire 3 locks, based on the RedLock algorithm it is deemed to be a winner, hence he can carries on the logic after the lock, however when a network partition happened, he lost one lock. Other clients will then able to acquire a majority
By making failedLocksLimit configurable, the decision on how much risk he is willing to take to use the lock is on the user himself. In some cases he may want N/2 + 2 or +3 etc., to be a valid minimum requirement.


1446
ElasticCache clusterserverconfig - TTL is not working as expected

i am using clusterServersConfig for my ElasticCache Redis Cluster, with redisson 3.2.0. Cluster has 1 shard with 2 nodes.
The cache is not expiring after 1sec as expected. Also calling CacheEvict explicitly doesn't clear the cache.
Anything missing in config here?
Cache config is as below mentioned.
maxIdleTime: 1000


1447
Redisson in cluster environment cannot use the same node when iterating a set

When I try to iterate a set collection in the cluster environment, I'm getting some odd result: some entries are missing. So I've checked the below issues:  #277 and #230.
I have 9 Redis nodes. 3 master nodes, which each one has two replication node. So the Redisson can execute sscan command from alternative two slave nodes.
I turn on the debug logging, I notice that Redisson has changed connection during each command execution with default load balance strategy.
detail logs like this:
So I simply trace the source code,
In the class BaseIterator, it could store the current query connection correctly with a field.
protected RedisClient client;
Then, it passes the client info to the function async of the class CommandAsyncService , which the parameter source contains it.
The most disturbing part is this:
When trying to get a connection from MasterSlaveConnectionManager connectionReadOp, it will not consist with the previous client connection, but to get a new slave connection according to the master-slave entry. So this will get a different connection than the last.
like this:
At last, here is briefly my test code
Hope to make sense, thanks~


1448
Some scheduled jobs not getting executed.

In my code I am scheduling 50000 jobs but only 49999 jobs are being executed when I set workers of executor service to 3, however when I set workers of executor service to 2 all the 50000 jobs are getting executed.
When I schedule 10000 jobs and set worker to 4 all the jobs are getting executed but when I set it to 5, 2 jobs are being skipped.
Why some jobs are not being executed?
Anyone help me in understanding this behaviour of Redisson, I am not able to debug this.
Redis version
4.0.9
Redisson version
3.7.0


1449
Default value of `threads` in Config

I was viewing the documentation of Config class and I found the above line, can anyone explain what is the meaning of current_processors_amount.



1450
Viewing scheduled jobs in Redisson

I am using scheduled redisson as a scheduler, after I have scheduled the jobs how can I view all the scheduled jobs and status of the jobs that have already got executed.
Also I wanted to view total executor services currently present.
Redis version
4.0.9
Redisson version
3.7.0


1451
Job distribution among several RedissonNodes.

In case when there are multiple RedissonNodes how the jobs get distributed among them and is it possible that jobs can get executed by both Redisson Nodes (Duplicate execution of scheduled job)


1452
Extend RScoredSortedSet object to support Redis 5.0 commands

ZPOPMIN, ZPOPMAX commands already implemented by pollFirst and pollLast commands
BZPOPMIN, BZPOPMAX


1453
Redissonnode VS ExecutorService worker

How running multiple redissnnodes differ from running more workers on a single redisson node?
How to view all the RedissonNodes?


1454
ClassNotFoundException on Classes under WEB-INF/lib

We upgraded Redisson tomcat session manager from 3.6.3 to 3.7.0, and got ClassNotFoundException on classes under WEB-INF/lib. After reverted back to 3.6.3, error was gone. We are using SerializationCodec and are under java 8 / tomcat 7.


1455
setPingConnectionInterval for single server configuration is not propagated to underlying MasterSlaveServersConfig


Setting the pingConnectionInterval on a single server config should enable periodic ping on connections.

No pings take place.  Similar to #1415, this appears to be due to SingleConnectionManager.create not copying the configured value to the MasterSlaveServersConfig.
Steps to reproduce or test case
Redis version


1456
How does executor service gets associated with RedissonNode?

Anyone please clarifying the following details :
redisson.getExecutorService("w1"); This line in the above code creates a new instance of ExecutorService as described in the configuration but this instance of ExecutorService is not linked to any RedissonNode still the job is being executed. Is the executor service instance described in the configuration shared by all the  RedissonNodes or each RedissonNode will have the different isolated instance of ExecutorService?
Does the same executor service instance which is used to schedule the job will also execute the job or job will be executed irrespective of the executor service instance through which it was scheduled.
Redis version
4.0.9
Redisson version
3.7.0


1457
Unable to create RedissonClient

Sometimes get an error during check if Redis is connected: getObject().get().getNodesGroup().pingAll()


1458
ReadWriteLock timeout does not work as expected

I wrote a simple test to check the ReadWriteLock.
The behaviour
First case: Read thread finishes executing properly, write thread hangs forever
Second case: Behaves as expected. Read thread locks, sleeps and unlocks. Write thread hangs until the read thread finishes and then locks and finishes.
What I see in redis in both cases at the beginning:
What I see in redis in both cases after some time:
The rwlock_timeout entries expire in both cases, it seems like no one is updating their timeout in redis.
In the first case, where the readThread finished running but the lock1 entry never expires and is stuck forever like this:
What I expected
In the first case when the read thread finished running I'd expect the read locks to expire after some time and unlock the lock1 entry
In the second case I'd expect the rwlock_timeout entries not to expire since the read thread is alive, it sleeps but it is alive.


1459
CommandAsyncService gets blocked at high concurrency [without OutOfMemoryError]

Hi,
While running a load test on jmeter of 200 users with ramp up time of 10 seconds and number of puts per user equal to 10, threads are getting  stuck. In this test we are using RTransaction and doing load testing on a single key by putting random values for a single key.
here is the stack trace:
Steps to reproduce or test case


1460
Why RedissonTransactionManager do not support Suspend Transaction?

RedissonTransactionManager  do not rewrite
protected Object doSuspend(Object transaction) throws TransactionException
method


1462
Error while using RedissonSessionManager at tomcat(java.io.IOException: java.lang.ClassNotFoundException: org.springframework.webflow.conversation.impl.ConversationContainer)

I am seeing below error while using RedissonSessionManager with tomcat. I have followed the default configuration that was provided at.
Configuration is working fine in multi node environment with session replication at redis, but for every request I am seeing this error. Can you one please help on this.


1463
none




1464
redis session count more than visitor count

i used redisson in tomcat8 to mange session.and i have a problem that: site real visitor count only 100,but redis save session count is 1700.i don't understand the reason.


1465
redssion shiro jackson problem

hi:
i have a problem when i use redssion manager session and shiro save data.problem description is under:
if i want to change the jackson,how i can do?


1466
Subscribe timeout


No exceptions

Why is I keep getting these subscribe timeouts? After restarting service it works allright for, like, 24 hours, then I get a lot of subscribe errors. I have a pretty big connection pool, so I don't see why I keep getting it.
I mostly receive this error with RLock, which I use to synchronize. Should I tune my configuration somehow?


1467
RedissonLocalCachedMap can not init with NullPointerException

RedissonLocalCachedMap can not init with NullPointerException when ReconnectionStrategy is ReconnectionStrategy.LOAD
I think the LocalCacheListener is null ;The line 160 in source code org.redisson.RedissonLocalCachedMap.java ,listener is null because it create in line 164;
Redis version 4.0
Redisson version 3.7.1


1468
Redisson executing previous jobs on the schedule of newly submitted jobs.

I previously scheduled 5 jobs (old jobs) they executed successfully. After that I scheduled another 5 jobs(new job) but this time the previous 5 jobs got executed on the schedule I gave for new job. Can anyone explain me this behaviour of redisson and point where I am making the mistake.
For this experiment I runned 4 redissonnodes in standalone mode with configuration as described below.


1469
How does redisson balances load among several RedissonNodes while scheduling jobs.

No description provided.


1470
Redisson API to get the number of subscribers subscribed to a particular channel

Redisson API to get the number of subscribers subscribed to a particular channel.
PUBSUB numsub test
How can we get the number of subscribers subscribed to a particular topic in redis as it was possible using the above command.


1471
Redisson CROSSSLOT Keys in request don't hash to the same slot. channel

I scheduled some jobs first then I run one RedissonNode in standalone mode. and I got this error.
I have used the below code for scheduling the jobs.
Previously it was working fine but I have suddenly started getting this issue.
I am running 3 node redis cluster, with one replica
redis version 4.0.9
redisson version 3.7.0


1472
Implement PUBSUB CHANNELS, PUBSUB NUMSUB and PUBSUB NUMPAT commands

As requested in #1470 by @Himanshu4


1473
Error while using RedissonSessionManager at tomcat(java.io.IOException: java.lang.ClassNotFoundException: org.springframework.webflow.conversation.impl.ConversationContainer)

I am seeing below error while using RedissonSessionManager with tomcat. I have followed the default configuration that was provided at https
Configuration is working fine in multi node environment with session replication at redis, but for every request I am seeing this error. Can you one please help on this.


1474
Invert ZPOP score/element order

Score/element order has been changed around in RC2. See: redis/redis@0a698e4


1475
RSet can not guarantee element unique.

TestBean is


1476
NullPointerException when using setPingConnectionInterval in Pub/Sub mode


setPingConnectionInterval should ping redis Pub/Sub channel periodically and re-subscribe if pong is not received during specified interval. No exceptions should be thrown or logged by sending PING or receiving PONG messages.

There is NullPointerException thrown and logged as error when pong is received.
Not sure if connection check and recovery would even work in this case.
This is copy/paste from our error log:
This is also logged as WARN by redisson, related to the same event:
Steps to reproduce or test case


1477
RedissonScoredSortedSet uses wrong codec for some score methods


The codec specified in the constructor should be used only for values, not for scores.
Redis commands : RedisCommands.ZSCORE and RedisCommands.ZSCORE_CONTAINS

Codec for scores sometimes uses LongCodec sometimes uses "codec". For backward data compatibility should always use LongCodec when accessing scores.
Steps to reproduce or test case
Create a ScoredSortedSet with non default codec and use getScoreAsync / containsAsync methods
Used to work fine with Redisson Version 3.5.7, when upgraded to 3.7.1 ScoredSortedSet stopped working. Codec
Works fine with this change:


1478
Delete/modify scheduled jobs in redisson

How can I get control over already scheduled jobs in redisson and do operation such as delete/modify on them.


1479
Implement RBatch commands queueing on Redis side.

Current implementation of RBatch object accumulates all method invocations in memory on Redisson side before send them to Redis. This approach may lead to OOM exception if accumulated batch is too big.
Introduce executionMode setting to allow accumulation of all method invocations on Redis side.


1480
Redis INFO call stopped working after 3.7.1 release


Call Redis INFO on a given node in a cluster and it should return a blob of info for that given node.

When the redisson client is preparing to send the redis INFO call, client2key returns null for the given redisClient which only happened to me during INFO calls, not any writes or reads. This is the commit that I believe caused this behavior. fe98d0a#diff-bb90b8f5c06abce59014861b02cecd93
It seems the issue is the hashcodes are different only when making the INFO call (That i know of) because the channels value changes.
So when doing the get for client2key, it gets nothing. For Writes and reads that i tried, the hashcodes for the clients are the same
Steps to reproduce or test case
Spin up any redis cluster and simply call .info() on a node in the .getNodesGroup()
Redisson configuration
default redis cluster config with 7 nodes in the cluster. 3 Master and 4 Slave


1481
Cluster Mode: Master fails over to slave, when slave fails over again redisson client retains connection to previous dead node.


Redisson is able to send read and write commands to the 2nd newly elected Master.

This is the topology:
When testing various failover situations, I ran into a situation which causes the redisson client to get stuck using a bad connection when making the write calls, however the thread that is polling for the topology is fine. The situation is the redis process dies on a Master node I am writing to, a slave is then promoted to master. The redisson client is still in a GOOD state. The redis process dies on the new Master, a floating slave is then promoted to Master. At this point, the redisson client is now STUCK using a bad connection to a dead master.
Steps to reproduce or test case
Run 7 node cluster, I believe this is the minimum to reproduce this as you need an extra floating slave to promote after the first Master/Slave pair dies. For Master 1 slots 0-5460 (M1), kill the redis process. This should cause it's slave (S1) to promote to master and the floating slave (FS2) to attach to this new master. Then repeat kill the redis process on S1 which was promoted to master and FS1 should be promoted to master. The redisson client will now fail reads/writes because the redisson client connections are to the old S1 node despite FS1 now being the new master but does not fail to poll for CLUSTER NODES because I believe it is using a separate connection pool/thread to do that.
Redis version
3.2.11
Redisson version
3.7.0


1482
none




1483
RedissonLocalCachedMap - "readAll*()" and "values()" methods could read from local cache only?

The performance benefit of using RedissonLocalCachedMap over RedissonMap is negligible when getting all data from the map via readAllKeySet*(), readAllValues*(), readAllEntrySet*() and values(). The readAll*() methods still gets data from server, values() method is not overriden in RedissonLocalCachedMap.
Would it be possible to read data only from the local cache in these cases?


1484
do as the redisson3.7.1 RRateLimiter wiki,but it does not work!




1485
tryLock waitTime no valid

hello, I have test the tryLock with waitTime, but find it has bug. My test is as follows:
As you can see, the second thread faild to acquire lock but the lock is released during 2 seconds...please tell me ,thanks


1486
Occasional  ERROR:Search domain query failed.




1487
jvm create to many HashMap Nodes cause many YGC

question
java project springboot+redission only, RedisCluster scanInterval 1000ms,jvm create too many HashMap.Node, cause YGC quickly, I see ClusterConnectionManager.java source
Steps to reproduce or test case
RedissonClient redisson = Redisson.create(config);


1488
How to provide timezone with schedule in job?

How can I provide timezone in scheduled tasks according to which tasks should be executed.


1489
Warn:"Invocation of destroy method 'close' failed on bean with name 'jCacheCacheManager'"


I imported Redission in spring boot using distributedLock,but the log always show this WARN



1490
Add Redis Streams support

New feature of upcoming Redis 5.0


1491
Redisson not executing jobs requiring external dependencies?

I have one RunnableTask which makes a HTTP request and hence needs a dependency of HTTP client. This job looks like this.
Now I am scheduling some jobs using this code.
After this I launched a RedissonNode in standalone mode. Now when the time for the execution of this jobs come, I am getting following error.
Anyone please explain why this is happening and resolution for this issue.


1492
Add CL.THROTTLE command for Redisson Client

I'm using the Redis Cell module for keeping track of rate limits on certain keys. Unfortunately with Redisson this means I have to use the low level client for now but it would be nice to include a method for the CL.THROTTLE command used in Redis Cell module with the high level client.
This is not related to RRateLimiter which to my understanding is for throttling calls to Redis itself.
Redis Cell


1493
Acquire Methods in RedissonRateLimiter Are Not Functional

Issue since Redisson 3.7.1
Line 125 of RedissonRateLimiter.java throws a null pointer exception when the time unit  parameter is null. When you call the acquire methods it passes a null for that parameter. Basic unit tests for the acquire method would have caught this.


1494
Jobs scheduled with cron expression not running

I have used two methods to schedule the jobs. In method-1 I have used line-1 to schedule the job and in method-2 I have used line-2 to schedule the job. The problem I am facing is that method-1 is working fine but when I comment the line-1 and use method-2 instead the jobs doesn't get executed and I get the error as described below.
@jackygurui @mrniko kindly look into this.
I am using redisson 3.7.2 in standalone mode and redis 4.0.9.


1495
Avoiding serialization/deserialization of a class.

When I am sure that I will be definitely having a class already loaded in memory, is there any way to avoid serialization and deserialization of whole class.


1496
Redisson Class loading

As per my understanding, Redisson serializes the class at the time of scheduling the job and deserializes it at the time of execution of the job. If the class is already in memory at the time of execution of the job  then what does redisson do.
Kindly explain me this in details and also correct me if my understanding is not correct.


1497
Missing PubSub messages when using connection ping


setPingConnectionInterval should send periodic ping messages and keep channels alive, but this must not affect any other type of messages on channels.

When using setPingConnectionInterval some messages will not be delivered to listeners after being published. I have a test code which can reliably reproduce this issue:
Output of this code will produce varying results each time, but it will never get all sent messages, like this:
However if connectionPingInterval is set to 0 (disabled) issue is completely eliminated, like this:


1498
none




1500
How to specify start time and end time for expression?

@mrniko @jackygurui
If I want to schedule a job with certain cron expression, how do I specify that job should only run between some start and end time, whenever its execution according to the cron occurs. Like it is provided in quartz.
@mrniko
I also feel there should be support for cron expression with delay as well.


1501
How to execute some code after execution of job, something like post listeners?

How can I perform some task after execution of some job?


1502
Is there a way to set ExpiryPolicy at cache entrylevel for redis jcache implementation instead of setting at the cache level?

Steps to reproduce or test case


1503
How to inject taskId in runnable?

Since I get taskId after scheduling the task, how can I provide taskId to the RunnableTask, so that I can have taskId during execution of task.


1504
How to schedule one time jobs in Redisson?

How to schedule a task that would run at particular time, currently I tried to do this with cron expression but it is giving error as described here.


1505
Redisson redlock performance with azure redis cache

Hi I have a distributed application that servers user requests. I want to implement distributed locking to synchronize access to user's data if multiple requests for the same user come in.
I'm using redisson with azure redis cache in cluster mode with 3 masters, 3 slaves for this purpose. My incoming request rate is 700/s, with total request processing times ~30-40ms. I've set the redisson cluster config as below (pool size=320, lock_wait_time=3000ms, lock_expiry_time=3000ms). However, I notice that in spite of tuning the connection pool size from 250-700, a small portion of requests fail while waiting to acquire the lock.
Questions:
Is my usage of redisson redlock below correct?
Any recommendations on how I can tune the config to resolve the "failed to acquire lock" errors?


1507
In MapCache, idle timeout is not refreshed upon replace


When using redisson MapCache expiration I would like a replace to refresh the idleTimeout, so that a field does not expire as long as it is replaced within the idleTimeout period.  Note that replace returns the old value, so strictly speaking the value is accessed.

Fields are expired after idleTimeout regardless of whether their values are replaced or not.
Steps to reproduce or test case
a test added to RedissonMapCacheTest, I would like it to pass:


1508
Too many open file handles with Redisson 3.7.0


Redisson 3.7.0 shouldn't leak file handles.

After upgrading from Redisson 3.5.5 to Redisson 3.7.0 With Elasticache cluster I noticed file handles are left open and within an hour all the handles are exhausted causing AWS ECS to terminate the service instance. The issue goes away once I revert back to 3.5.5
Steps to reproduce or test case
Use Redisson 3.7.0 with AWS ElasticCache Cluster.
ElasticCache cluster. Following is the Spring code to configure redisson with cluster:
I've configured pool size at 20 and minimum pool size at 5. Scan interval is set at 2000 milliseconds.


1509
Exception in thread "main" java.lang.NoSuchFieldException: No such field:




1510
Do redisson store classes by creating extra keys or serialize and store in one key only?




1511
getClusterNodesGroup().pingAll() vs getNodesGroup().pingAll()

Is it any difference between this checks? I use getNodesGroup().pingAll() for pinging nodes with cluster config as well. Is it correct way or should I change check on getClusterNodesGroup().pingAll()?


1512
"URGENT"java.lang.ClassCastException:(while returning objects in nested class) Redisson gives the feature of nested object?

I am getting "java.lang.ClassCastException: org.redisson.RedissonMap cannot be cast to src.ClientProfile" error. can someone tell me why?(client profile also have 2 classes inside it).


1513
Mitigating Concurrency Issues

Hi,
I was wondering what the standard approach is to Mitigate possible Concurrency issues when using Redisson as a spring data source.
I am working on an application that gets information from a source application and then layers updated over the top before delivering the updated information to the client.
The updates in this case are built for several sources, each one has its own queue.
When a new message is placed on any given queue my app reads the message from the queue, and attempts to create or update an updateObject in my redis cache.
My problem stems form the fact that messages are constantly being placed on these queues and updates to the updateObject are likely to come in quick succession.
Im concerned that this will lead to concurrent read write issues:
I have attempted to solve this using @transactional and the RedissonTransactionManager but it doesn't seem to be halting the second messages update while the first message is still updating.
Any advice would be really appreciated,
Thank you


1514
none




1515
Not able to build redisson locally

While building the redisson locally, I am getting the following error:
In stable release version I can see 2.12.2 and 3.7.2, I am using 3.7.2 what is the purpose of other release 2.12.2, what is the difference between both.


1516
RMap.readAllValues() returns Number as string


When we use addAndGetAsync the value of key is incremented or decremented.

RMap.readAllValues() should return values as 0-> 1, 1- >2 but instead returns values in the form og
0->"0", 1->"2" where the Number class is a string value.
Iterating through this collection causes a class cast exception.


1517
Support for endTime in scheduleWithFixedDelay() method?

Currently when we schedule the job with scheduleWithFixedDelay() method, it takes only initial delay and delay. But if I do this then this will keep running the job forever. I think there should be version of scheduleWithFixedDelay() method which supports endTime as well.


1518
CustomObjectInputStream doesnt work for proxied classes


Classloader passed into CustomObjectInputStream is not used to load proxied classes.
In my case redisson cant deserialize org.springframework.security.oauth2.client.token.AccessTokenRequest class

Following exception is thrown during class loading:
Caused by: java.lang.ClassNotFoundException: org.springframework.security.oauth2.client.token.AccessTokenRequest
Steps to reproduce or test case
Redisson configuration


1519
Add iterator with batch size param to all collections

No description provided.


1520
none




1521
Feature Request: Locally cached MultiMaps

Hi,
I was working with multimaps and wondered, while they have a cache variant, why don't they have a locally cached variant?
If nothing speaks against it, could one be added?


1522
Using Redis Transaction MULTI crashes in java.lang.NumberFormatException: For input string: "QUEUED"



Steps to reproduce or test case


1523
none




1524
RedissonRateLimiter acquire() method blocks forever

The acquire method should block until a permit is available, but it blocks indefinitely instead of the remaining time until a new permit becomes available. From my testing I have found that it doesn't acquire a permit when one should be available based on the rate and interval I tested. If I set the rate to 1 every 5 seconds, it should take a loop of 10 single permit acquires approximately 50 seconds to complete. Instead it acquires the first permit, then blocks forever on the next acquires call.


1525
none




1526
Live Object service meet NullPointerException when new field add to old RLO


add new field to RLO, use get method will get default value.



1527
RSemaphore example ends up in "Unable to decode data"




1528
Redisson Not able to serialize and deserialize external objects?

I am running Redisson Nodes in standalone mode, at the time of execution of this job, I am getting following error.
How can I inject such dependencies in redisson, I think this use case is quite natural, and should be definitely be accommodated.


1529
Add DUMP and RESTORE commands support

No description provided.


1530
none




1531
why 'readonly' command is going to master everytime i send read operation at ReadMode.Master_Slave


'readonly' command should not go to master everytime i send read operation.
'readonly' command is going to master or slave only onetime at first when making connection.

'readonly' command is going to master everytime when i send read operation.
because of added 'readonly' command, master is not distributed throughput
Steps to reproduce or test case
make Redissonclient with ReadMode.MasterSlave
send read operation
redissonClient.eval(Mode.ReadOnly, "return redis.call('get', 'something')"...
actually, read operation is distributed propery, but master node get plus 'readonly' command. even though 'readonly' comman is not working at master node and not affecting anything functionally.
however this is big problem which increase throughput and cpu utilization on master node. finally, it is same as not distributed


1532
Lot of connections remain in TIME_WAIT state after Redisson shutdown

No description provided.


1533
will there be React native support?

No description provided.


1534
severe bug !! when sending read operation to new slave loading previous data after failover

Steps to reproduce or test case
on each servlet request, i send read command like below to redis, in this case, it is problem.
result = redissonClient.getScript().eval(Mode.READ_ONLY, script, RScript.ReturnType.VALUE), keyList, argvList.toArray());
on each servlet request, i send read or write command like below to redis,  in this case, it is ok
result = redissonClient.getScript().eval(Mode.READ_WRITE, script, RScript.ReturnType.VALUE), keyList, argvList.toArray());
send read operation each reqeuest on servlet server continusly.
slave is loading data for syncing with master. it takes 10 minutes to load all data completely.
during 10 minutes, servlet server is going strange behavior and throuput is very lower and don't return any exception. i think some threads is hanging around Redisson connection with new slave loading data.
actually i expected returning error with timeout. why it is not returning any error until slave is completed loading data.
after 10 minutes which completed load data from slave. it is going back to normal and throuput become higer.
however, read operation with Mode.ReadOnly is going both master and slave not going to slave only.
when loading data at slave, redisson is sending read operation to slave. and read opeartion thread is hanging aroud somewhere in redisson.
read operation with Mode.ReadOnly is going well to slave only. however after failover, read operation is going both master and slave not going to slave only.


1535
HyperLogLog.addAll adds only one element

No description provided.


1536
Scheduled task not working


I want to create a simple scheduled task with redisson & kotlin.

I get an exception everytime
Steps to reproduce or test case


1537
org.redisson.RedissonShutdownException: Redisson is shutdown




1538
aliyun redis not support

when i use redissonClient.getMapCache,put any key. get error :ERR bad lua script for redis cluster, all the keys that the script uses should be passed using the KEYS array, and KEYS should not be in expression. only in aliyun redis.
aliyun redis must uses KEYS array in lua. Can you give me some suggestions?
Steps to reproduce or test case


1539
Redisson stops executing commands found during tests with RBoundedBlockingQueue


Probably throwing an alert message or slow down but not stuck in infinite cycle.

Stops executing commands
A lot of exceptions logged


1540
none




1541
Slow Redis Sentinel Initialization on Start (update from 3.6.5 -> 3.7.3)

Hello,
I'm updating Redisson lib from version 3.6.5 to 3.7.3. But I saw that Redis Sentinel initialization takes more times in the newer version 3.7.3. Is there's a new parameter to be aware of that could explain/solve this slow initialization ?
I'm using the default Redis Sentinel configuration unchanged since version 3.6.5.
Regards,
Steps to reproduce or test case
Check connection initialization on Sentinel mode with Redisson on version 3.6.5 vs version 3.7.3


1542
Multiple ReadLocks are not sharing locks properly after WriteLock releases

Hello!
I've found something that I believe is a bug in Redisson's RReadWriteLock implementation where multiple ReadLocks seemed to become or at least behaved like WriteLock when it tried to lock on a lockpoint that another WriteLock has already acquired a lock, then released. Because of that, ReadLocks are not sharing the lockpoint like it should and are taking turns in locking the lockpoint. Theoretically, this will have a performance impact on applications that expected Redisson to have quicker locking mechanism based on inclusive locking mechanism but under the hood, it is not inclusive and those applications will spend some time to wait for locks to complete.
I have tested this with Java's ReentrantReadWriteLock and it has worked exactly what I'd expected it to be.
Note: I have only tested this on a single Redis server. I did not test this on clustered Redis servers.

Writer Thread locks
Reader Thread 1 fails to lock and waits
Reader Thread 2 fails to lock and waits
Reader Thread 3 fails to lock and waits
Writer Thread unlocks
Read Thread 1 locks
Read Thread 2 locks
Read Thread 3 locks
Read Thread 1 unlocks
Read Thread 2 unlocks
Read Thread 3 unlocks
This behavior matches Java's ReentrantReadWriteLock behavior exactly.

Writer Thread locks
Reader Thread 1 fails to lock and waits
Reader Thread 2 fails to lock and waits
Reader Thread 3 fails to lock and waits
Writer Thread unlocks
Read Thread 1 locks
Read Thread 2 fails to lock and waits
Read Thread 3 fails to lock and waits
Read Thread 1 unlocks
Read Thread 2 locks
Read Thread 3 fails to lock and waits
Read Thread 2 unlocks
Read Thread 3 locks
Read Thread 3 unlocks
This behavior does not match Java's ReentrantReadWriteLock behavior exactly.
Steps to reproduce or test case
I have written a test code for you to review, download, and test.
The link to my code is here:
The test code includes two test suites that runs a control test using Java's ReentrantReadWriteLock and an experiment test with Redisson's RReadWriteLock.
Each test suites has two test cases where one of the test does multiple ReadLocks locks on the lockpoint before WriteLock locks on it, and another one tests multiple ReadLocks locking on the lockpoint after WriteLock has locked on it. The failure on the latter test on Redisson's RReadWriteLock is what has prompted me to open this issue ticket. Java's ReentrantReadWriteLock passed that test.
Overview:
To run the test, run mvn test with Maven to test the code.
Single server with default configuration created by Redisson's Config class.


1543
Implementing Job Queue

Hey there,
I'm trying to understand how to implement a job queue using this awesome library.
I thought about this flow:
New tasks are pushed to a pending tasks queue.
Tasks taken for execution will be be popped from pending queue and pushed to in progress tasks queue.
After X time inside progress queue, the task will be considered as expired and will be moved to a delay queue with a given delay (each task will have a different expiration time).
After X time in the delay queue, the task will be moved back to the pending queue.
If the task was executed properly, the task will be moved to a processed tasks queue, which will be consumed for further calculations.
For the in progress tasks i thought about using priority queue / scored set.
For the delay queue i thought about using, well, the delayed queue.
Problem is I struggle about the durability of it all, I'm afraid the server will crash the second i pop something (before i get to add it to some other data structure) and I will lose tasks data.
There is a feature for this library that I'm not aware of and could come in handy?
I would really like to stick with Java and not move to python's celery or something like that, but haven't found something to ease the process yet.
If this question is not for this place I'd be happy to hear where should I post it.
Thanks and have a nice day :)


1544
Global config codec is not registered in codec cache


When deserializing nested data structures the nested structure should use the codec instance assigned to the redisson config using setCodec.

The nested data structure is serialized using the default JsonJacksonCodec codec ignoring the one set on Config using setCodec.
Steps to reproduce or test case
Create a new JsonJacksonCodec using a non-default ObjectMapper instance.
Assign that instance to Config using Config.setCodec.
Stored a nested data structure such as a RBucketReactive inside of a RSetReactive, and store a POJO inside of the RBucketReactive that's dependent on the configuration of the ObjectMapper used previously.
Attempt to retrieve the value from the RBucketReactive instance by iterating the RSetReactive contents and observe that Jackson deserialization will fail due to using a defaultly configured ObjectMapper.
All defaults except for registering a new Codec.


1545
LiveObjectService - ClassCastException when using multiple ClassLoaders


RedissonLiveObjectService creates proxy objects that are instanceof the given entity class.

When using a different ClassLoader when loading the Class-To-Proxy for an LiveObject than when loading the Redission library all proxies creations will throw a ClassCastException.
This is most likely due to the line.
I think redission should use entityClass.getClassLoader() instead to make sure that the generated proxy object will be assignable to the given entity class.
(As soon as spring-boot-devtools is removed from the classpath and there is only 1 ClassLoader around everything works perfectly fine)
Steps to reproduce or test case
I've created a minimal repository that shows the error simply by running ./gradlew run in the project.
If is removed everything works fine.


1546
Tasks scheduled with timezone not working.

The problem I am facing is that, the task gets executed only at first occurrence of the cron and remaining occurrences doesn't get executed. However when I don't specify any timezone then everything works well.
To reproduce this the timezone which you provide should be different from your local machine.


1548
Redisson threw MOVED redirection loop detected

Steps to reproduce or test case
I updated redisson from 3.6.3 to 3.7.3, and use RLock for distribution system, It had no problem when it was in 3.6.3, but now it threw a exception above.
Feel sorry I have no idea how to reproduce manually. It ran a while and then the exception threw.
I used ClusterServersConfig as cluster mode configuration by default with just setting scanInterval property.


1549
Connecting to AWS ElastiCache Redis in cluster mode behind NAT

I want to be able to use Redisson when Redis Cluster is behind NAT. I can think of following solutions:
Disable auto discovery and use ElastiCache Management Nodes for all request (prefered approach recommendation in aws doc).
Disabling auto discovery by manually registering all nodes in Redisson.
Provide customer provide DNS mapping
I am using AWS ElastiCache Redis in cluster mode where AWS creates a management endpoint for whole cluster and separate endpoint for each master node. My whole cluster is behind NAT, so when Redisson tries to discover all the nodes in the cluster it find their local IP not the NAT IP, as a result it fails to connect to clustered nodes.
Redisson discovers all the nodes in the clusters and tries to connect to them. However it fails because those IP/endpoints are behind NAT.
Steps to reproduce or test case
Create an AWS ElastiCache Redis stack in cluster mode. Create a NAT on top of it and try to connect to the NATed cluster.


1550
Connection is closed per command execution for master node used as slave in readMode = MASTER_SLAVE

This issue leads to new connection established per Redis command invocation and therefore performance degradation for master node used as slave.


1551
How to use RKeys.findKeysByPattern() with Redisson Live Object(RLO)

Hi,
I'd like to ask a question about RLO and keys matching. I'm new to Redisson Live Object(RLO)
I have POJO, and with a String field annotated with @Rid.  I'm able to use rLiveOjbectService.persist, and .get to save/retrieve the object based on the field value just fine.
Questions:
I have several RLO whose keys fit a specific pattern. I want to call RKeys.findKeysByPattern() to get all the keys that fit the specific pattern. Then I'll call rLiveObjectService.get(class, key) on the keys returned to get to all the objects that fit the pattern.
However, it seems like findKeysByPattern doesn't work with RLO?
From looking at the actual redis data, it seems RLO doesn't just use the value of the field annotated with @Rid as an actual redis key. It seems to do something special with the actual key name, so RKeys.findKeysByPattern() doesn't work anymore.
What is the recommended way to get all the RLO objects that match a specific key pattern? Is it possible?
Thank you so much


1553
Add RRateLimiterReactive

No description provided.


1554
Add reactive version of FairLock

No description provided.


1555
Add RGeoReactive

No description provided.


1556
Introduce RSortableReactive interface

It should be implemented by RScoredSortedSetReactive, RSetReactive, RListReactive


1557
StatusListener onUnsubscribe Not effective

not effective
please help me,thanks


1558
Getting issues while using Redisson Tomcat session manager to share one redis instance among multiple tomcats

Hi,
I am trying to use one redis instance for multiple tomcats to make session storage centralized for my application. But i am getting below error.
As far as i understood redisson is not able to get the session created previously and then it goes on to create a new one. Because of this every time i use application on one tomcat to login it creates new session and when i come to other tomcat to use the same application its not able to find the created session and goes on to create a new one.
But i do see all the sessions created in redis and being stored properly. Its just that redisson is not able to read the session.
Below are my config:
I am using redisson 3.7.4


1559
none




1560
How to make Redisson update a cluster status with new nodes and new IPs

Is there a way to make Redisson client query the sentinel for Redis hosts in new IPs on a configured interval? or... should scanInterval be doing this?
Elaborating, we have a Redis cluster with a Sentinel cluster, in a Kubernetes environment, so when Redis nodes are taken down and new ones arise, they have different IPs, and the old ones no longer exist.
Reading online I'm aware of:
But working with Redisson 3.7.4, clients keep logging that can't connect to some Redis node for days.
Maybe the problem is that Redisson is not contemplating that nodes can change IP, or it only contemplates the IPs changing behind steady DNS names, but not sure.
Is there a way to solve this problem?

Redisson clients to get updated nodes when a Redis Kubernetes cluster is rebuilt and new nodes arise with new IPs. (no DNS names involved)

When the cluster is rebuilt, clients keep logging connection errors for days.
Steps to reproduce or test case
Having a Redis cluster, with a Sentinel in front of them, take down Redis nodes and bring up some new ones.


1561
RTransaction Unusual Locking Problem

Hi mrniko,
We have two methods:
As per our test we invoke method 1 and then immediately invoke method 2. The second transaction waits until the first one finishes and seems like the first transaction takes a pessimistic lock on one of the keys of the map being used here and we are totally fine with that.
Now we have another method in a different test scenario:
As per our previous test we expected a deadlock situation in this scenario, since transaction1 has the lock over the key and transaction2 is trying to alter it. But in our test both transactions commit successfully and maintain order.
Please explain the ambigious locking in case of these to scenarios. Thank you.


1562
How to get All the Keys from org.redisson.jcache.JCache

I had implemented cache as per jsr107 by using Redission.
Can you please guide How can i get All the Keys (Complete set of Keys)from JCache.
Thanks,


1563
RedissonClient Get operation




1564
Spring Cache setting TTL on keys, not working as expected

We are using redisson with spring cache and setting ttl on our keys.:
Redisson version is 3.7.0, Redis instance version 4.0.10.
We are using redis single server.
TTL settings is here:(with time to live of 10 seconds)
Questions:
with ttl settings shown above, after the cache value is set, in redis command line, every time I type command "ttl chatContext", it shows -2, not the remaining time to live.
(it seems redisson is not making use of the redis ttl setting?)
with the above ttl setting, after we put value in cache,
if I keep querying the value of the "chatContext" value in redis command line, by typing "hgetall chatContext", then this value does not time out no matter after how many seconds.
if I do nothing after the value is put in cache, and just wait for 10 seconds, then query the value of "chatContext" cache, its value is not available anymore, which is the expected behaviour.
If we use cacheManager.setCacheNames(Arrays.asList("chatContext", "otherCacheNames")); then the cache value will never expire, the ttl settings of 10 seconds are ignored. Code is shown below:


1565
none




1566
Only Linux launch error: io.netty.handler.codec.DecoderException: CommandDecoder.decode()

Like error #1295
Windows is OK, but Linux error!


1567
Redis node failover triggers 30x spike in Commands to the failover shard (using RBatch object)

Redis node failover triggers 30x spike in Commands to the failover shard
Additional Description: We have Elasticache cluster with 2 shards* 6 nodes in each shard. Whenever a node failover occurs, the commands (HashCommands) that shard processes increases by 30x (For ex: ). No change in the incoming requests to service but the request/ commands processed by Redis goes up by 30x. Once we redeploy service, Redis commands to that shard will come to normal state.
Updated redisson client to latest version. With redisson client update, we are seeing a performance hit. Latencies are increased by 25%. We haven't verified whether the issue is happening in latest version or not.
Appreciate any inputs to debug what's happening here.
: Failover should be handled gracefully
: Failover leads to increase in traffic to Redis
Steps to reproduce or test case:
Failover Primary in one of the shard


1568
can we have an extra API on getNodesGroup

currently in Redissn class, we have the following API
can we expose an extra endpoint in Redisson class where we can get only certain Node type like Master?
the request comes up when we are doing healthz check on our system, our system uses healtzh hook which deletes to redisson to check the health status of redis, currently, what we are doing is redisson.getNodesGroup().pingAll()
which is not optimal, we would like the system to still work properly even when one slave is down, can we expose an extra API on this ?


1569
"RedisConnectionException: SlaveConnectionPool no available Redis entries" even when slave is reachable and connections established.


Since slave connections are present, connection exception should not occur

In our redis cluster of 3 nodes, redisson client is failing with following exception:
However, the client host does have connections:
Typically, we see the following log when slave connection-pool is populated on client startup:
But, for the failed slave (172.16.62.4), during client startup, the above log never came.
The number of idle connections for failed slave was less than slaveConnectionMinimumIdleSize. It was 29 instead of 32.


1570
Spring session integration error

Spring Session should be able to serialize/deserialize the Spring session > security context via Redisson as documented
Spring SecurityContextImpl fails to deserialize when its put in a Redisson map.
It deserializes ok in a regular HashMap, leading to the conclusion that this might be a Redisson issue.
Steps to reproduce or test case
The test case demonstrates the problem by replicating the behavior of the RedissonSessionRepository::load() method


1571
none




1572
RMapCache's addListener  become invalid

I have two redis in one virtual ip by keepalived,and I use RMapCache's addListener monitor data change
everytime datachange can notify me

from sometime,datachange no longer notify me
Steps to reproduce or test case


1573
Continuation to the Issue # 1562 (How to get All the Keys from org.redisson.jcache.JCache)

Hi Nikita Koksharov,
Thank you so much for your replay.
I can Use Iterator but it will take more time to iterate each entry for capturing the key.
is there any other way to do this.
Tried with client.getMap() it is taking less time.
For the region with 39450 keys
Iterator approach took 6301 ms
rmap.keySet() took 1377 ms
Here my concern is when i use rmap.keySet() i need a new client, i can't use the client in jcahe. Can you Please Suggest any other approach for this.Please find my code snippet for getting keys in both below.
Thanks in advance.


1574
Jcache removeAll(Keys) Method is not working ***

Hi,
Please let me know if anything is Wrong from myside.
Thanks


1575
redisson.getNodesGroup() returns Nodes where both redis-server and redis-sentinel are not running.

the issue is like #1330, but they are different.
I am not sure if this issue is being fixed in newer version, but this is for sure reproducible in 2.11.3, following is the steps to reproduce.
having 3 redis vms running in Sentinel mode, current redisson.getNodesGroup().size() is 3  ---> as expected
bring down one of the redis boxes by shuting down both redis-server and redis-sentinel
redisson.getNodesGroup().size() is 2 ----> as expected
bring the node up agin, redisson.getNodesGroup().size() is 4 ----> something is wrong here.
running steps 1-3 once might not reproduce the issue, but running it twice like following steps 1,2,3,2,3 will surface this issue, in fact it will lead the node size growing into 4, 5 and more.
Following is what I did in the class RedisNodes.java


1576
org.redisson.client.RedisTimeoutException: Redis server response timeout (3000 ms) occured for command

org.redisson.client.RedisTimeoutException: Redis server response timeout (3000 ms) occured for command:


1577
Redisson continuously send lock request to redis after redis cluster master-slave switch

Evn : jdk 7, redisson version: 2.11.4,redis version:4.0.1,enable redis cluster with 3 masters and 3 slaves.
After my redis cluster occurs an master-slave switch and then I try to get a lock, but redisson starts getting out of control, it continuously send Lua script command to get lock, while redis cluster return a MOVED error because of master-slave switch early, it seems that the redisson didn't know the master-slave switch and continuously send Lua script command to the same server to get lock. Approximately redisson sends 150000 lock request to redis in 5 seconds with merely more than a dozen application lock request. The network traffic between the redisson server and redis server rise up to 150Mbps, then it becomes normal after restart the redisson server.
The getting lock code general show below,(I just receive 10+ lock request):
The network packages general show as below:


1578
Why I am getting java.lang.AbstractMethodError errors?

Below code to schedule the job.


1579
redisson keep sending lock request to redis due to redis cluster master-slave failover

i use redisson redLock in my project, i think redLock should be work in any case, below is my code,
but when redis cluster code master-slave failover, redisson failed to acquire lock and keep sending acquire lock request, below is request:
then send same request again and again... cluster response again...


1580
Redisson stand alone giving classNotFoundException

When we try to run java -cp core-1.0-SNAPSHOT.jar -jar redisson-all-3.7.3.jar single.json, classNotFoundException should not occur
we get classNotFound Exception


1581
Can't write command batch to channel. ·

Can't write command batch to channel:.
If redis block for some times. then redis recover.
but redisson still use broken connection.
I found the tcp.socket not exists , bu we use it .
why we not close it in   CommandBatchService.checkWriteFuture


1582
Redisson Session Manager for tomcat is not able to serialize/deserialize session object when multiple web application (war file) share same session.

hi, Need a help.
our organization was using oracle web coherence for session management. there are around 15 modules deployed as war files which share the same session with different context for each war file.
Coherence uses :: com.tangosol.coherence.servlet.AbstractHttpSessionCollection$GlobalScopeController in order to Share Session Information Between Multiple Applications. There is no class visibility issue by coherence session manager between applications sharing same session.
see LInk:
section: 4.2.2.1 Sharing Session Information Between Multiple Applications
Each context places some of its class in the session.setattribute and when using weblogic + coherence there was no issue with class visibility in session when the context gets changed during the user flow.
Now, our organization is trying to migrate to tomcat + RedissonSessionManager. however there are issues with the redisson session manager. one class loaded in one context is not visible by session manager when the context gets changed. So, session manager is complaining about ClassNotFoundException as it does not have visibility to the classes which were loaded in session when the control was in previous session.
Please let me know if there is any feature AVAILABLE in redisson session manager like oracle coherence has which makes it capable of viewing all the classes in the different war files (different contexts).


1583
Channel Inactive but  the event not catched by ConnectionWatchdog.channelInactive()

I find the Channel Inactive , but  the event not catched by ConnectionWatchdog.channelInactive()
so the connection not reconnect .
then it throw  "org.redisson.client.WriteRedisConnectionException: Can't write command batch to channel"
for the socket not exists


1584
Memory Leak when I try to create client


It should't have memory leak.
Steps to reproduce or test case


1585
'reconnectionTimeout' and 'failedAttempts' setting in unavailable.

I config with the version of 2.12.5,it warn that "'failedAttempts' setting in unavailable. Please use 'failedSlaveCheckInterval' setting instead!"
but the document haven't update.document here!


1586
java.lang.ClassNotFoundException: com.fasterxml.jackson.databind.jsontype.TypeResolverBuilder


after built project and run on vps(java 1.8) error appear, in intellij everythink work


1587
some suggest of set with ttl

would you be consistent


1588
about bucket set with ttl return hashmap?




1589
java.lang.IncompatibleClassChangeError: Expected static method org.hibernate.cache.internal.DefaultCacheKeysFactory.createEntityKey

No description provided.


1590
Command execution timeout when calling CMS.QUERY in CountMinSketch module

When applying module CountMinSketch, calling CMS.QUERY using redission client to call CMS.QUERY command to get value, Timeout exception is throwed out.:
I use the code:
Before I already ran a command on redis-cli:  CMS.INCRBY  key item 1
And, I ran a command: CMS.QUERY key item  using redis-cli and it returns  1) (integer) 1
I also try sending  the above CMS.INCRBY  command using redission api and  the comand is running successfully.
obj can get or contain the value 1 inside.
set CountMinSketch as a module for redis and launch redis.
I am using redission 3.7.5


1591
In CommandsQueue , the preceding request will block the request behind.  how did you handle it?

In CommandsQueue , if the previous request was responsed for a long time.
Then the  behind request will block , how did you handle it .


1592
At least two sentinels should be defined in Redis configuration

error:  At least two sentinels should be defined in Redis configuration


1593
problem about RLock.lock() interruptedException?

RLock.lock() does not return anything, is that mean a thread can always get the lock?
After i saw the source code of lock funcation, it calls lockInterruptibly and catch the InterruptedException, it means that when a thread is interrupted by other thread, it will stop waiting and return from this lock function.
so I tried a example in such way:
There are two threads in my example, thread-1 gets the lock, and thread-2 is waiting for the lock, then main thread interrupts thread-2, and in this way, thread-2 actually does not get the lock, but thread-2 still stops waiting and return from lock() funcation and continues to do the business which should be locked.
should i use the interruption status of current thread to check if the current thread has got the lock?
Thank you very much!
Steps to reproduce or test case


1594
Shade or unpackage snakeyaml

Redisson is packaging snakeyaml inside it's own redisson-all.jar library. This version is not shaded
When using Redisson as a Session Manager in Tomcat, Redisson has to be loaded in one of the class loaders above the webapps (Bootstrap, System or Common). Since redisson-all package snakeyaml, it will take precedence over any snakeyaml provided by the webapp.
As a result, any application that use a snakeyaml's version different to Redisson may crash.
Consider shading the snakeyaml implementation treat snakeyaml as a transitive dependency which could be overridden.

Redisson and all other applications (ie Spring) are able to load yaml files.

Steps to reproduce or test case
Install redisson in Tomcat in either of the following class loaders: Bootstrap, System or Common.
In a webapp, using spring 5.0.8, load a yaml configuration file.


1595
Non Sticky Session with tomcat 8: Session loaded in second node triggers new session event(tellnew)

We are using Tomcat 8 session replication and some attributes are set in session listeners whenever a new session event is created. Configuration details are given below.
When a request for a session (created in node 1 goes to node 2) is loaded from redis cache, we are getting the following error as one of the listeners is setting an attribute and the Session's isValid attribute is false at the time.
 is that for sessions loaded from redis cache, "session created" event (tellNew) should not be triggered.
A probable solution would be to disable notification when setting the session id (ie) setId(id, false) in  RedissonSessionManager.findSession function.
Steps to reproduce or test case
Add this listener to the application's web.xml
org.eclipse.birt.report.listener.ViewerHttpSessionListener
Start the loadbalancer and all tomcat nodes. Login to the application and browse through the application.The above error will be logged in the log files for the node that is trying to load the session from the redis cache.


1596
RExecutorService task execution performance regression.

RExecutorService task execution process got performance regression about x5 times, after #1468 had been resolved


1597
questions about redisson

These are questions about redissons rather than issues.
I plan to use redisson in our company project, Use RLocalCachedMap to cache some business orders, but still have some questions about RLocalCachedMap since I can't get them from Wiki, API, Issue discussion in GitHub.
read from map of RLocalCachedMap will always return the NEWEST data in real-time.
clearLocalCache just clear the local data in JVM, it will not clear the data in Redis server, next read of clearLocalCache will sync the data from redis server to local JVM, right?
How to get a Pro version of redisson, please send a email to haiyang.pan@gmail.com


1598
none




1599
Spring webflow is throwing NoConversationException when we use RedissonSessionManager

I am using redisson-tomcat-8 3.7.5 version at tomcat level and my application is using spring-webflow.
Facing below error when web-flow is proceeding from one state to another state.  Could you please suggest what I can do to get rid of these errors.
PN: My application is not configured for spring-session dependencies and it solely depends on tomcat.
Caused by: org.springframework.webflow.conversation.NoSuchConversationException: No conversation could be found with id '1' – perhaps this conversation has ended?


1600
Driver Support for Redis Engine version 4.0.10

Hi,
I'm using Hibernate-reids library for second level cache, can i point to the redis Engine version 4.0.10 ?
as per the documentation it is mentioned that it has tested this with redis server 3.x. with Redisson 2.3.x.
as per my opinion i'm using Redisson client 2.12.5 and  if Redisson client supports redis Engine version 4.0.10 then Hibernate-reids also should support.
Please provide your inputs.
Thanks in Advance.
Srinivas


1601
Accumulation of MapCacheEvictionTask in Memory

When the RMapCache entries expire, the MapCacheEvictionTask should be cleaned up.
MapCacheEvictionTask is leaking memory as more and more RMapCache gets created.
Steps to reproduce or test case
We create millions of RMapCache a day. Over the course of a few days, the MapCachEvictionTask object stays in memory and is never cleaned up.


1602
unlock fail and expirationRenewal still execute

unlock success
unlock  fail
Steps to reproduce or test case
unlock ()
client -> redis service network problem
unlock throw Exception
network recovery
expirationRenewal still execute


1604
Lock watchdog does not monitor read locks.

Hi, when we acquire multiple (concurrent) read locks and process a task for longer than the Config.lockWatchdogTimeout, we get errors when unlocking.
Code to reproduce (wait the watchdog timeout):
int threadCount = 100;
Looking into Redis for the ttl of different keys, I noticed:
The key 'mytestlock' gets an extended ttl
The key '{mytestlock}:UUID:THREADID:rwlock_timeout:1 is not set with new ttl and the key disappears before the unlock is called.
We tested with Redisson 3.5.4 and 3.7.5.


1605
Using RScheduledExecutorServiceAsync to scheduleAsync a task is getting executed  before timeout/delay

I expect the output after 1200 seconds.. but I see it after 5 mins .. 300 seconds
The scheduled CallableTask should be executed after the delay has expired and not before that


1606
Why RedissonRedLock only unlock the acquired locks in the release stage?

I expect that RedissonRedLock will release all the locks when it fail to acquire the lock
I learn about redlock from this page: Distributed locks with Redis, and it tell me that we should try to release the lock in all instances even if the lock was not acquired successfully, since may be we have executed the command successfully but the redis instance failed to send the response to the client.


1607
lexicographically sort with ALPHA modifier

It looks that Redisson doesn't implement ALPHA in sorting. In Redis ALPHA  prevents "ERR One or more scores can't be converted into double".
I found ALPHA only in  redisson-spring-data (RedissonConnection.java).
Should I send PR?
readSort returns Set with null


1608
DecoderException thrown when calling RMapCache.entrySet().iterator()

Hi,
I am working on a v1.5.15 Spring Boot project using Redisson v2.12.5 and Redis v3.2.10 on CentOS 7.
I am storing an object as a value (using  the JsonJacksonCodec codec implementation) and the key is a String (using the StringCodec codec implementation) in a RMapCache. When I put data into the map there are no problems at all and I can see it on a GUI Redis tool but when I try to get it via RMapCache.entrySet(), the iterator() method throws the following exception:
But RMapCache.get(key) method successfully returns elements from the map.
Everything works great if I run the same code using a RMap instead of a RMapCache.
Please find attached a small Spring Boot project to reproduce the error. Configuration values can be found in resources/config/application.properties file and the bean definition in resources/application-context.xml.


1609
Unable to find maven artifact

Hi everyone,
This is more a question than an issue. I'm using Spring Boot 1.5.x with Spring Data Redis 1.8 on top of JDK 1.8+ and I'd like to replace the Jedis client with Redisson. I was able to find the artifact org.redisson:redisson:3.7.5 on the Sonatype maven repository but I can't find org.redisson:redisson-spring-data-18:3.x in order to register a RedissonConnectionFactory bean. I forked and compiled the repository locally, but the artifact version I got after the compilation was 2.12.x which targets JDK 1.6+
Best,


1610
Redisson reconnection issue in Kubernetes

When Redis in single server mode stops, its pod takes some time to restart. Redisson client should eventually reconnect
Redisson connectionWatchdog detects that redis is down and tries to reconnect but quickly stops trying, before redis is newly available.
IP address does not change as redis is exposed via a kubernetes clusterIp service.
Redisson never reconnects to redis.
Steps to reproduce or test case
Deploy redis helm in single server mode. Connect a client from a pod inside the cluster. Stop redis pod manually.


1611
RedisConnectionException thrown if client-name is set and retry-attempts is zero

Redisson should start properly when client-name property is set and retry-attempts property is zero in a single-server configuration.
Redisson starts properly if retry-attempts is set to 1.
The following exception is thrown and the server does not start:


1612
RMap.putAll() inside a Rtransaction takes alot of time and finally fails

While putting 50000 entries in RMap using putAll method, we are getting the following error:
Below is my configuration:


1615
lost route to host

sometimes  it is happened,restart the  consumer is well work


1616
Slave unable to switch DNS in AWS ElastiCache ReplicatedServers

We are trying to switch the redis dns using route53 on aws elasticCache Service.
While the master gets switched successfully but slave give the following error


1617
I found two problems about Scheduled Jobs in redisson3.7.5

I am using scheduleWithFixedDelay to create a scheduled job, initialDelay is 0 and delay is 10m. When the job was running, I found the job's interval is 5min.
I found the problem was created by ff..requestId, because the ExecutorOptions.default() is 5m.
Debug the code, I know startTime is System.currentTimeMillis() + delay, but 'ff'..ARGV[2] is System.currentTimeMillis() + retryInterval. In my program, delay is 10m, retryInterval is 5m, so 'ff'..requestId is before requestId in zset named {jobName:org.redisson.executor.RemoteExecutorService}:scheduler. So, the job's interval is changed to 5 minutes.
Another problem is that {jobName:org.redisson.executor.RemoteExecutorService}:retry-interval was deleted when only one Job was running and first run() was finish.
When tasksCounterName's value is 0, tasksRetryIntervalName is deleted. But tasksRetryIntervalName can't be reset.


1619
Task scheduled with delay more than 1 hour timeout prematurely.

Task scheduled with delay more than 1 hour should not timeout prematurely.
Task scheduled with delay more than 1 hour are timing out  prematurely.
Steps to reproduce or test case


1620
none




1621
Redis- Master/slave role detection through DNS

Master connections should be created on new master.
We are using Elasticache with 1 master and 1 slave. The redis endpoints are behind route53 record sets. When we swtich the endpoints in route53 to point to new master and slaves. The redisson is pointing to incorrect slave.
Steps to reproduce or test case
where route53 recordsets are pointing redis-slave-1.dev.com to read endpoint of a node which is master.
and redis-slave-2.dev.com points to read endpoint of node (slave).
If we change the recordset redis-slave-1.dev.com (earlier pointing to master) to point to read endpoint of a node which is slave and we also switch redis-slave-2.dev.com (earlier pointing to slave) to point to read endpoint of node (master), then this error comes.
The following logs are found:
Then all the writes to redis are returning error with:
Please note that redisson is easily able to detect master/slave and able to switch connections when doing promotion of a slave.
It is also able to detect the DNS change successfully if the master endpoint is replaced by another cluster's master endpoint.
But, when we switch the DNS in a manner so that the earlier recordset which was pointing to a master now points to a slave and vice-versa, redisson is unable to detect it.


1622
Redisson Sentinel not executing scheduled task on Master-Slave Failover

I am running Redis in Sentinel Mode with 5 Sentinel, 1 Master and 2 Slaves. I am scheduling a task with Redisson. It is executing the scheduled tasks normally but if i bring down the Master and a new master is elected by the sentinels, redisson doesn't execute the previously scheduled task. Newly scheduled tasks are getting executed.
Observation: The previously scheduled tasks are getting executed on restarting redisson node.
Redisson Node should execute the previously scheduled task after master-slave failover
Redisson Node doesn't execute the previously scheduled task after master-slave failover.


1623
Avoid to create connection per RRemoteService/RScheduledExecutorService worker

No description provided.


1625
Regression: DNS resolver failing to find valid DNS record

The DNS resolver should find valid DNS records. The hostname I'm having trouble with worked in 3.5.0, it is failing in newer versions.
I opened a ticket with Netty first thinking it was a problem with the resolver itself, but after trying different Netty versions, it appears to be a configuration issue with how Reddison is calling the resolver.
See netty/netty#8261
Exception thrown:
Configure a top level domain someDomain on a DNS server you own
Configure a host under the new top level domain someHost.someDomain
Configure multiple resolvers  on the DNS client machine that will run the Netty code. i.e. 8.8.8.8, 192.168.1.1, and 10.0.0.1 (I have 3 resolvers configured, each pointing to different DNS masters  - global DNS, local personal private network, company private network over a VPN)
Configure the search domain to not match the top level domain, i.e. search.otherDomain on the DNS client machine that will run the Netty code
Configure redisson to connect to someHost.someDomain
failure during configuration.


1626
Deadlock with RedissonLock used by JCache

We've ran into a number of issues with using the Redisson implementation of JCache via bucket4j in production for rate limiting.
JCache.put(K key, V value) calls RedissonLock.lock() with no lease time, resulting in RedissonLock's creating a 'watchdog' thread that continuously renews the lease on the lock in Redis. We are using the default 'lockWatchdogTimeout' of 30 seconds so this thread runs every 10 seconds. What we've seen is in rare cases this watchdog thread never gets canceled, meaning it continues renewing the lease indefinitely until the instance containing the thread is restarted. This causes deadlock of all other threads trying to grab the lock and can ultimately bring down an application as threads build up.
Threads using RedissonLock will wait forever for a lock to be released. There is no timeout when waiting for the lock.
The 'unlock' method in RedissonLock can fail for a number of reasons -- e.g., timing out trying to unlock with Redis after 3 seconds (this happened in our case). When the unlock fails the watchdog thread is not canceled. This means the instance would have to be restarted to release the lock.
A 'watchdog' thread should not exist. This is prone to issues where it never gets destroyed and a lock is held forever. A lease time should be used to ensure the lock is never held forever and somehow it should be verified that the lock is still held by the caller when making updates with it (an atomic check at update time) in case the first thread doesn't execute its update within the lease time and another thread grabs the lock.
Threads should not wait forever for the lock. There should be some configurable timeout.
A timeout on 'unlock' should be retried, but the lease time in 1 should handle any failure to unlock. If for some reason the 'watchdog' thread is kept, the unlock needs to ensure it is canceled if it fails.


1627
Does anyone tried integrating mockito with redisson?

I just tried write an unit test for a function using Redisson, but it seems impossible to return a faked RSet data set only by a mocked RedissonClient. Or, usually which library you all used to mock a Redisson client?


1628
redisson RMapCache method addAndGet throw org.redisson.client.RedisException: ERR Error running script:ERR Error running script

throw exception like below
but use Integer is ok


1629
Adapt the change of terminology from Master-Slave to Master-Replica

As per redis/redis#5335 discussed, the community is moving to a different terminology than the one has been established for many years. For good or bad, this is the only future. Redisson needs to evaluate and adapt accordingly.
Please, no offending comments here.


1630
RBucket




1631
List value in a RLocalCachedMap returns String

I have the following RLocalCachedMap defined:
When the following line gets executed:
I get an exception:
Seems like may be related to previously submitted issue, however I am using List (not RList)


1632
Constant Unable to send command! errors with pingConnectionInterval config

Once we added pingConnectionInterval = 1000 configuration, randomly after a period of time the server is unable to perform any operation on redis. Having the following error on every request:


1633
Empty RBoundedBlockingQueue's capacity increases when using poll(timeout)?

Problem
I have an empty BoundedBlockingQueue. Whenever I invoke poll(timeout) the queue.remainCapacity increases when timeout occurs. This does not happen when using poll(no-timeout). See simple test below.
I'd expect capacity/remainCapacity to not not increase


1634
Add reliable task executor implementation based on RedissonStream

No description provided.


1635
documentation on expireAtAsync is incorrect

In documentation:
timestamp is not "date in seconds" but "date in milliseconds" ! as it uses


1636
RedLock slow performance when one redis instance is down

According to RedLock Algorithm, Step 2 RedissonRedLock#tryLock should fail fast if redis instance is unavailable:
During step 2, when setting the lock in each instance, the client uses a timeout which is small compared to the total lock auto-release time in order to acquire it. For example if the auto-release time is 10 seconds, the timeout could be in the ~ 5-50 milliseconds range. This prevents the client from remaining blocked for a long time trying to talk with a Redis node which is down: if an instance is not available, we should try to talk with the next instance ASAP.
RedLock#tryLock blocks for duration equal to config.retryInterval * config.retryAttempts on each tryLock attempt.
Such behavior makes business code not able to consume messages at requried rate, which in turn leads to other negative consequences.
Setting config.retryAttempts=1 and config.retryInterval=50 does not work, since initial commands are not fast enough and connection establishment fails.
Other timeouts doesn't seem to have relation to this issue.


1637
RMapCache.putAll() doesn't provide functionality of setting ttl time

RMapCache.putAll() doesn't provide functionality of setting ttl time


1638
redisson failed to parse /etc/resolv.conf and/or /etc/resolver




1640
Spring boot fail to start when I use redisson-spring-boot-starter

I have tried to use redisson-spring-boot-starter in this sample project :
But unfortunately it doesn't work, I get this error at startup:


1641
[Scala] Unable to store objects that hold complex datatypes (that are not one of the dataypes of Redis)

Saving objects that hold String, Int, or methods within them does not work.
I am trying to perform simple set and get operation on objects and following the Redisson Object Holder example (similar to the way we do using redis-cli: redis.set('mykey', 'myvalue')). Simple examples like storing Int, Str key-values work fine, but setting class objects that have methods within them is not working. For example redis.set('mykey', mymlengine) does not work. mymlengine is .scala file that holds several methods (Please look at examples below that will help replicate). Could please help with this?


1642
none




1644
Custom URLStreamHandler is stripped off internally

I am running in Google App Engine Standard environment, which does not allow me to create/write to any files. The sslKeystore and sslTruststore configuration parameters are required to be URI objects. So I created a custom URLStreamHandler and created a custom URI out of the certificate object in memory.
This should work as expected.
However, it does not work as expected. Instead the custom URLStreamHandler is stipped off in RedisChannelInitializer.java, line number 140: However, in RedissonChannelInitializer.java, line 140, InputStream stream = config.getSslKeystore().toURL().openStream();`, when uri is converted to url using toURL().
So I have modified the source code as follows and it works as expected for me.
Change the type of sslKeystore and sslTruststore variables from URI to URL in RedisClientConfig.java and BaseConfig.java.
Change the line 140 in RedisChannelInitializer to remove toURL().
On a side note, I tried to push this modification to the redisson github repo on a new branch and then request a PR. But looks like I do not have some permissions as I get back a 403 response code.
git push --set-upstream origin sslKeystore
remote: Permission to redisson/redisson.git denied to psubramanian2007.


1645
support for tomcat websocket session

Will existing Redisson tomcat session support tomcat websocket session too?
Tried persisting manually and encountered serialization exception.
Looking into the code it seems redisson session extends standardsession and might not support websocket session. Hence the question. Tried writing my own impl of RedissonWebocketsession, but guess my newbie status with redisson was a stumbling block. Need to learn/understand more before i attempt it.


1646
DNSNameResolver warnings in log using AWS Elasticache

I see this warning with stack trace below in  our application log when using redisson version 3.8.1 going against AWS Elasticache 3.2.6.  Wondering what is the cause of this? We are using netty 4.1.29.Final


1647
Object mapping problem with Hibernate 5.3 and JCache

I tried to setup second level caching with Redis, Redisson and Hibernate 5.3. Since redisson-hibernate only supports hibernate (4.x, 5.1.x, 5.2.x), I tried the JCache setup.
The example program crashes with the following exception if the first cache item should be written to Redis. Probably the Object Mapper (codec) configuration is incorrect:


1649
none





1650
redisson-spring-boot-starter 3.8.1 doesn't works

Redisson configuration
Because the file is encoded as UTF-8+ BOM instead of Utf-8. Causes PropertyLoaderUtils.loadProperties(resource); reading this file is garbled.
the key of the property as follows :


1651
org.redisson.tomcat.RedissonSessionManager renders tomcat8 useless if Redis server is down

Exception thrown if Redis-server is down, causes apps to stop working.
This might be an intended behavior, but the presence of the centralized session backup is not mission critical for our system (only used for failover). But using this session manager will actually introduce a new critical error to our system, when/if the Redis server goes down.
A flag/setting where communication errors with Redis would be logged instead of causing a "crash" would be highly appreciated.
Tomcat uses the local session to service the request and ignores any store/find session issues related to communication with Redis-server.
An Exception is thrown.


1652
Memory leaks with LZ4/FST/netty

I'm using LZ4Codec to serialize and deserialize my data. I'm noticing some unclosed streams which are wasting a lot of heap space.
These are the screenshots from the heap dump I took which shows the problem.
Steps to reproduce or test case
Using RLocalCacheMap and Composite Codec try to serialize and deserialize a few 100 objects. Do not shutdown redisson.


1653
Time to connect takes around 2 seconds

When I am trying to connect to redis it takes around 2 seconds. This started happening after I upgraded to 3.8.1 maven. This is the code used to connect. I initialize the connection every single time and close it down. Is there something I am doing wrong or is this a bug.


1654
Warning with sensitive user data dispatched by CommandDecoder

When RedisTimeoutException occurs just throw the exception to the user code without printing any warning messages or at least do not include result of the GET command
We are storing sensitive data in redis cache. On rare occasions when GET command fails on timeout org.redisson.client.handler.CommandDecoder#completeResponse method prints warning message containing the command result which in our case is sensitive data stored in our redis cache
this is happening here : org/redisson/redisson/3.7.3/redisson-3.7.3-sources.jar!/org/redisson/client/handler/CommandDecoder.java:442
Since our code is also using slf4j for logging, this warning message is printed to the same file as other log messages and then is flushed to our log managing server.
At this point we don't have control on this data and thus it will appear in our logging server. Due to GDPR concerns and inner regulations in our company we need to anonymize all user data stored in our systems, but it is hard to do when we have no control on the data dispatched to logs.
While we will seek how to patch this for now, we think that other redisson customers could suffer from the same problem as we are and kindly ask you to remove sensitive contents from warning messages or set log message level to trace or debug or allow user code to control this.


1655
how can i write codec with Fastjson

Redisson serialization will write class information by default, I want to write it with fastjson, but I don't know how to write


1656
Unable to use anonymous runnable with scheduler

When submitting runnable as anonymous class we fail on NPE in getClassBody method
redissonClient.getExecutorService(name).scheduleWithFixedDelay(() -> do something, 1, 1, TimeUnit.SECONDS)


1657
How to use spring beans inside executor service task

Hi,
Is it possible to access spring beans from within executor service tasks somehow?


1658
CommandAsyncService blocks indefinitely [without OutOfMemoryError]

Similarly to #889
throw exception
Thread indefinitely park
Using RMapCache and configure maploader to DB(oracle).
Shutdown DB,
3.RMapCache get operation will be blocked.


1659
RRateLimiter.tryAcquire with timeout blocks forever

If it's not possible to acquire a permission before timeout elapses, tryAcquire should return a boolean false.
Even if the timeout elapses, the method tryAcquire keeps blocked
Steps to reproduce or test case


1660
Which readMode to use?

We have Redis cluster with 6 nodes (3 masters and 3 slaves), and using redisson 3.6.5. In redisson cluster setting, we applied default value (SLAVE) on readMode.
Here are some questions on this setting:
What will happen if one of slave node fails? Will redisson detect the error and switch to master on Read, or it will try to connect to Slave only and throw exception?
If we use MASTER_SLAVE, read operation will go to master/slave randomly or it has a way to go to slave first, and then master when slave fails?


1661
Unexpected ClassCastException during RBatchReactive execution

Calling RBatchReactive.execute() should complete successfully.
RBatchReactive.execute() triggers a ClassCastException to be thrown from org.redisson.command.CommandBatchService.handleSuccess(CommandBatchService.java:224) with the message of org.redisson.misc.RedissonPromise cannot be cast to org.redisson.command.BatchPromise
Steps to reproduce or test case
This was occurring in some code that looks like the following gist:
Due to the nature of the code in question so mild anonymization has been applied to it.


1662
RMap#putAllAsync() should allow configuring batch size

putAllAsync() itself should take care of the batch size, or at least allow the user to provide some chunk size. Increasing direct memory allocation is not a permanent solution because the input map size is indefinite.
When large number of objects are passed to RMap#putAllAsync(), the following exception is thrown:


1663
UnsupportedOperationException thrown when using Spring Actuator

I am trying to use Spring Actuator with redis as a single server but I'm getting UnsupportedOperationException at RedisHealthCheck so the application is considering redis DOWN
Actuator is able to perform health checks to determine the status of Redis server
java.lang.UnsupportedOperationException is thrown when Actuator tries to do the Redis health check


1664
is not active! error while using pingConnectionInterval flag

Since started to use the parameter pingConnectionInterval after a while the service being up we start getting the following errors on all redis operations:
Eventually leading to messages of the type:


1665
RBlockingQueue doesn't retrieve element

.takeAsync().whenComplete will retrivehead of the qeueu and evaluate it
we are not retrieve element from qeueu, but in redis I can see them.
But if offer from same service it's work
Steps to reproduce or test case
I have two microservices frirst retrive elements with RedissonQueueBundle
Second just offer element directly


1666
Unexpected exception while processing command while taking a lock on a key

Note:Same scenario works as expected when there is no exception or error inside the try block.


1667
Deadlock while obtaining lock

Thread gets stuck while obtaining lock.
The same lock name was likely concurrently obtained and held by another thread possibly on another jvm, and then released.
Observed intermittently.


1668
Can Redisson be used for Tomcat session and application cache? Getting java.lang.ClassNotFoundException on read

I have a webapp using Redisson to handle Hibernate cache, application cache and session persistence.
However, each time my webapp client attempt to READ back from Redis, Redisson give back an java.lang.ClassNotFoundException on every object saved in Redis.
If I remove all lib from the lib folder and disable the session manager, the webapp client work perfectly.
I suspect a class loader conflict, as Redisson's classes are loaded inside the Server Class loader, while the webapp classes inside the Webapp class loader. The sessions objects are working as all is handled at Tomcat level, but the client is jumping between both class loader.
Anyone was able to get both working altogether, or is it require to use 2 Redis Java client implementation, one for the Session and the other for the Webapps?
Tomcat sessions are saved.
Object are saved and restored from Redis in the Webapps
Tomcat Session are saved and restored.
Webapps objects are saved but cause a "java.lang.ClassNotFoundException" upon restore.
Create a plain tomcat instance.
Put redisson-all and redisson-tomcat jars in lib folder
Create a war with a 2 serializable entities and a servlet that read and save said entity in the session And the client directly (caching).


1669
Dynamic map name in @Cacheable RedissonSpringCacheManager

Is it possible to use dynamic map names based on the parameter names in @Cacheable
Unable to set ttl and other configurations for dynamic maps
Steps to reproduce or test case


1670
Redis address can not load when I use redisson-spring-boot-starter: 3.8.0/3.8.2

When I use the config: spring.redis.cluster.nodes=redis1.test:3000  or redis or rediss, the application can not startup.
the env is:
startup successfully
Got error:  Illegal character in scheme name at index 0: [redis1.test]:3000
Steps to reproduce or test case


1671
Redisson Exception : java.security.InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty

I am connecting to AWS Elasticache Redis via Redisson from my Amazon EC2 instance. After lots of request of redis connection, I get the following issue. Anybody has solution for it?


1672
SnappyCodecV2 doesn't decode properly underlying data encoded by FST codec

No description provided.


1673
Timeouts during fail-over with single slave

During fail-over with a master and single slave Redisson reads may fail. I would like to request that new modes be added to org.redisson.config.ReadMode MASTER_PREFERRED, and SLAVE_PREFERRED (like Lettuce) to allow robust reads.
Redisson should be able to continue providing the application with reads / data instead of timeouts.
Steps to reproduce or test case


1674
Leader Election Recipe?

Sorry if this isn't the correct forum for this question.
Could redisson be used to perform leader election in a cluster? I don't really feel like adding Zookeeper or Consul to our current mix.


1675
RSemaphore not compatible with java.util.concurrent.Semaphore

Just out of curiosity, why doesn't the org.redisson.api.RSemaphore interface extend the java.util.concurrent.Semaphore interface?


1676
Redisson script caching

According to the Redis documentation, script caching is recommended, using EVALSHA and EVAL only if Redis server does not have the script already loaded, but I don't see this behavior in Redisson when using EVAL.
This seems to be supported in Spring spring-data-redis using the default ScriptExecutor.
Is there any script caching option I am not aware of? Is this going to be implemented if missing?


1677
NPE in CommandDecoder

It should get the entry save into Reddis
I got the following exception :
Steps to reproduce or test case
It is very hard to reproduce. It does not appears each time. I only got this error during a load test. It is very random.
We are in Spring 5 with spring-session-core in 2.0.5.RELEASE.
Redis is used to store the httpSession data.
Here is the redis data :
i also got NPE with this message


1678
Redis Response Timeouts comming too often in ENA enabled AWS

Our application using Redis. We are facing response timeout problem and not sure what is the underlying cause.
If we use ENA enabled AWS instances, the problem occurs too often, if we use non ENA the timeout happens once in a while.
Below is sample log:
if we access redisson frequently, the issue would be observed in an hour. keys=1 million on M5.2xlarge.


1679
Question about clearLocalCache()

Thanks for authoring and maintaining this great project.
We are considering moving over to Redisson to make use of it's local cache feature as it provides a performance boost comparing directly retrieving data from redis. Run into this when trying to clear local cache, seems like the cache was not cleared, everything stills stays. Is this the , what would be the best to way to clear all caches, could you shed more lights on this please?
Clears local cache across all instances
Local cache is not cleared, everything in local cache persists
Steps to reproduce or test case


1680
BlockingQueue.take method doesn't survey failover (regression)

No description provided.


1681
RedisException caused by NPE

We are using redisson session manager in our application, and got RedisException sometimes due to NPE.
No exception should be thrown.
Error found randomly, and no more information where NPE was from.
Stack trace:


1682
none

Why is there such an error?


1683
org.redisson.client.RedisResponseTimeoutException: Redis server response timeout (10000 ms) occured for command: (EVAL) with params: [if (redis.call;




1684
redis server too many connections and last command is client




1685
redis server too many connections and last command is "client"




1686
Question regarding codec for Result Set

Hi I am trying to use redis-graph with redisson and have trouble figuring out how to read the result set that redis-graph (https:) returns.
A typical result set can look like this.
(empty list or set)
Ive tried a regular bytearray but get only the last line and then it times out.
Any tips?


1687
Default values for local cache in RedissonSpringLocalCachedCacheManager

What are default values for the mentioned below properties?
Are these values from LocalCachedMapOptions::defaults()?
I see that local caches work, but only ttl, idle and maxSize are defined.


1688
redisson-all-2.13.2.jar not compatible with jdk 1.7 version




1689
none

[]


1690
ReplicatedConnectionManager shuts down executor it doesn't own

When we pass an executor in the redisson config, redisson should never shut it down.
ReplicatedConnectionManager calls stopThreads from the parent class MasterSlaveConnectionManager.  The stopThreads method calls executor.shutdown() without checking who owns it.
Steps to reproduce or test case
This example should call stopThreads in the ReplicatedConnectionManager constructor because the config doesn't have any node addresses:


1691
Redisson reconnection issue in SingleServer mode

Hi,
actually our real application is running on Azure but I was able to compile a small application to demonstrate this issue locally. The main issue is that the reconnect behaviour of Redisson seems to be unreliable. Sometimes it works and sometimes it doesn't which seems to be rather independet of the choosen configuration options except for the retryAttempt and retryTimeout options. If those two options are too low the application is not able to recover in any case but this is expected behaviour of Redisson as far as I can tell.
Example project: redissondemo.zip
Am I missing something here?
Any help is appreciated!
Redisson is trying to reconnect after a failure / failover of the Redis server.
Redisson seems to be trying to reconnect but fails always except on a few non-reproducible occasions.
Steps to reproduce or test case
If everything seems to be running fine, stop the docker container with "docker stop ".
Wait some time and then start Redis again. I tried different intervals but it didn't seem to matter that much.
Depending on the set of choosen configuration options 1 - 3 the DEBUG log output varies but the end result is the same: no reconnect is going to happen. I tried it with option combinations "1;2;3", "1;3", "2;3" and with significantly lower values for the retryAttempts (option 3.1) such as 3 e.g.. As soon as the connection is lost any retry attempt seems to fail.
Although there seem to be exceptions from this behaviour. Sometimes the ConnectionWatchdog is taking action and is actually able to reconnect to the Redis server (Used configuration options: 1;2;3):


1692
Add configuration to EvictionTask min and max delay

I would like to be able to set the max and min delay times for the EvictionTask job, so i can ensure that the task will run every 5 seconds for example.
The task will increase the time between checks to until a max of 1800 seconds.


1693
Redisson can't resolve short DNS name

Since version 3.8.2 Redisson failed to resolve short DNS name.
Steps to reproduce or test case
Configure redis full host name (in our case
redis-test.domain.com)
Add search domain "domain.com" to  /etc/resolv.conf
Verify that short name can be resolved with nslookup:


1694
Command execution timeout for redisson on lambda with aws elasticache

I am running redisson in AWS Lambda functions connecting to a Elasticache redis cluster. The worflow of each lambda consist in 3 batch requests on average (2 read and 1 write).
No command execution timeout errors
Every once in a while redisson returns command execution timeout while fetching the cluster status through the command CLUSTER_NODES. Stacktrace is:


1695
Command succesfully sent, but channel [..] has been closed

I have an AWS ElastiCache for Redis server running in non-cluster configuration. The connection is TLS enabled. Once in a while, we get this error when servers try to establish the connection with Redis server.
Steps to reproduce or test case
Once in a while whenever the services tried to connect to Redis server, I'm getting this error.
AWS Master-Slave Configuration with TLS enabled.


1696
none




1697
none




1698
How to dynamically switch databases

How to dynamically switch other databases?


1699
delayedQueue cannot  get elements from blockingQueue





1700
org.redisson.client.RedisConnectionClosedException received. MasterSlaveServersConfig.create function skips setting keepAlive flag.

The value associated with the key
When I debug happy case I am seeing the actual redisClients in connectionFutures in async method of CommandAsyncService have keepAlive = false. I suspect this may the root cause.
The connections seem to go stale after an unknown duration (verified that the server timeout is not affecting this)
Looking in more detail, I see MasterSlaveServersConfig create(BaseMasterSlaveServersConfig<?> cfg)
in MasterSlaveConnectionManager.java file is not setting keepAlive flag.
This is extremely hard to repro and I couldn't debug a failure case yet; but it seems like we cannot rely on redisClient abstracting connection handling unless we are missing a config.
Please advise.
Steps to reproduce or test case


1701
none




1702
none




1703
none




1704
Transactional RLocalCachedMap takes alot of time while putting

: Transactional put Should take slightly more time than normal put
: Taking almost 3000 times more time


1706
What is the best practice for setting local caches ttl against Redis caches?

Is it correct if Redis cache ttl is the same as timeToLiveInMillis for local cache?
MY_CACHE:


1707
RLocalCachedMap fetches results even after disconnected from Redis Server

: Should provide multiple strategies to choose from like whether to allow reads or not while disconnected
: Reads are allowed by default


1708
RedisException: ERR max number of clients reached. channel:

I have been using redisson in my application, since last couple of weeks, I have been getting this error. Kindly help me root cause this issue.


1709
All lua script are sent to slot 0 only

We use Reddison as a client for high load sharded Redis cluster consists of 8 nodes. Main use case -  big number of relatively small lua scripts. We use code like this to do it. (Used version is 3.7.5, but I believe same behavior is in trunk)
RScript script = redisson.getScript();
Long result = script.evalSha(RScript.Mode.READ_WRITE, loadedScript, RScript.ReturnType.VALUE, keys, values);
After some performance tests we noticed that load on Redis cluster nodes is uneven - CPU utilization on node which holds '0 slot' was two times higher then on other nodes. It happens because Reddison sends all scripts to '0 slot' and then this node have to 'MOVED' script to correct node for processing. This overloads '0 slot' node.
So we have to find a workaround to send scripts to correct node:
Long result = script.evalSha(correctMessageKey, RScript.Mode.READ_WRITE, JsonJacksonCodec.INSTANCE,  loadedScript, RScript.ReturnType.VALUE, keys, values);
So I wonder if this a bug or feature?


1710
Missing code on version 3.8.2 at Maven Central

Hi,
When I debugged the class MultiDnsAddressResolverGroup and compared with this commit:
I found that the code deployed to https is missing this line (that is supposed solve the issue).
Maybe this code is missing in the compiled version too?


1711
Question regarding AWS elasticache

I am new redis and AWS elasticache and I am working on a legacy codebase which uses oracle coherent caching. I need to replace it with AWS elasticache and Redission does that. But me being new not able to find how to actually use Redisson for this. Elasticache endpoint is private so that cant be passed to redission client.
Please help me with providing an example so that i can actually progress on this
Thanks
Steps to reproduce or test case


1712
Questions about performance of RLocalCachedMap

I'm playing with the Redisson's great feature for near cache, then did some benchmark testing on it.
It brings a huge performance boost compares to directly interacting with redis, however it's takes much longer than "real" local cache, especially for put operation, around 100~200 times longer. For instance, each Redisson fastPutAsync takes around 175536ns, while real local cache finishes in 1060ns; Redisson get takes 9737ns, real local cache takes 151ns. This can become quite noticeable for read/write intensive applications.
From the reading on document/wiki on RLocalCachedMap, it essentially keeps a local copy of the cache in application's memory, performance should be roughly the same as real local cache. Any thoughts / suggestions on the slowness of RLocalCachedMap please?
Thanks.


1713
java.lang.ClassCastException: java.lang.Integer cannot be cast to java.lang.Long

I got some classCastException :
Here the payload that redisson trying to decode :
If we check into the source code
at l:103 with see that you are trying to cast into a Long. On older version you used to cast it into an Integer.
Unfortunately i cannot decrease my redisson version because i have updated spring session in 2.x.x .
I think you can keep a cast into an Integer. I don't think people will configure the session ttl to more than 2147483647 seconds.
Steps to reproduce or test case


1714
none




1715
none




1716
Unable to send command! Node source: NodeSource

The issue happened on multiple servers minutes after deployment
Steps to reproduce or test case


1717
RLocalCachedMap Subscribe timeout




1718
Exception occurred when redis cluster master-slave failover




1719
Redisson 2.13.1+ no longer work on Java 1.6

Redisson 2.13.1 and above have the class files compiled with version 51.0 (Java 1.7), and will no longer work on 1.6.


1720
ZREVRANGEBYSCORE issue

We use a score sorted set to store our user story timelines, these scores are in the form of timestamps
should return the list of stories but it returns empty.
Steps to reproduce or test case
When i run the same command from the redis terminal it returns the values


1722
Jcache public V get(K key) Method

Hi,
I'm Using Jcache with AWS Redis in replicatedServersConfig, but observed jcache get / put operation is always using  master node to for both read and write operations.
in my view get request should go to slave (read) node, put request should go to master node.
Please suggest anything to be changed in my configuration / correct me if i'm wrong.
my cache config:


1723
RedisResponseTimeoutException at getLockedLock for read operation in "replicatedServersConfig"

Hi,
I'm using jcache  implementation and using AWS Redis servers in "replicatedServersConfig", i'm getting response time out exception at "getLockedLock" method. raised another issue  related to jcache.
Please do the needful.
Thanks,


1725
RedissonClient.getMap("mapName") return only 100 datas

when i try to get all values in a map redisson return only 100 values


1726
Add RObject.getSizeInMemory method

No description provided.


1727
none




1728
Does RedissonRedLock support Redis cluster Master/Slave mode?

In this issue#1333 (comment)  I found that RedissonRedLock supports Redis cluster mode. In the Redlock algorithm, I don't think it supports  Master/Slave mode.The description is:
In the distributed version of the algorithm we assume we have N Redis masters. Those nodes are totally independent, so we don’t use replication or any other implicit coordination system.
I am troubled. Does it support  type of  Redis cluster 1 ?
If it supports then how do I add a configuration, whether the master and slave are added or only the master configuration is added.
Which type should I choose,or they are all wrong?


1729
Local embedded redis stopped working with 3.9.0

Redisson should be able to connect to local redis running on port 6614.
Redisson won't start and throws this error:
So a few things to note.
I'm only having this issue with 3.9.0. 3.8.2 works just fine.
I tried replacing the address with "redis://127.0.0.1:6614", and I got the same error:
I also tried removing the "redis://" part and only include "localhost:6614" or "127.0.0.1:6614", and I got a completely different error, which is:


1731
sentinel bug?

spring.redis.sentinel.nodes=192.168.1.241:26379,192.168.1.241:36379,192.168.1.241:46379
Steps to reproduce or test case


1732
Add own Hibernate cache implementation

Current 3rd party implementation https seems is not developed anymore and doesn't support hibernate 5.3


1733
Unable to send command on Azure Redis

Hi,
I would like to ask for your help because I experienced a lack of connection with the PaaS Azure element of Redis Cache last Saturday.
The exception thrown is related to CommandAsyncService, please find in the attachment.
I’m using version 3.6.5 of redisson, in the following you find redisson.conf.
It seems that in that day the tomcat running on a VM could not write on Redis with commands HMSET and DEL, throwing the exception mentioned before. The immediate solution was to restart tomcat service so that connection was re-established.
Do you know if this issue is fixed in later versions? What would you suggest to do in this circumstances?


1734
ScheduledExecutorService schedule does not run subsequent executions

If execution of the cron task takes longer than its period, then subsequent executions should start late, but not removed.
When the cron task takes longer then its period, the subsequent scheduler is removed and the task is never run after.
Steps to reproduce or test case
Worker to run JobA:
When the worker starts it will execute the JobA only once. I checked the Redis and the scheduler key under JobA is removed after. This happens when the task takes longer to complete than rate.


1735
Can redisson allow 1 sentinel with configuration?

In each ENV, redisson works fine. I understand at least 2 sentinels can guarantee master->slave failover, but in our SMALL ENV, we only have 1 master, no HA required. we are forced to use redisson old version(3.6.0) as it allows 1 sentinel. The reason why keep sentinel here is to make it no difference with M and L environment, we can use very same redisson configuration and code in each ENV.
My suggestion is to make it configurable, so that redisson reject 1 sentinel configuration by default but allows user to enable it in case needed.
When in SMALL ENV, redisson will throw below exception:
throw new RedisConnectionException("At least two sentinels should be defined in Redis configuration!")
Steps to reproduce or test case


1736
cannot stop by shutdown in spring data redis, redisson 3.9.0,Maybe a bug

spring use:


1737
Spring Boot starter fails with NPE on redisProperties.timeout reference

Spring Boot application using redisson-spring-boot-starter runs without exception and connects to Redis server.
Spring Boot application fails to start with stacktrace due to NullPointerException in RedissonAutoconfiguration. The issue is that there is a reference to RedisProperties.timeout that calls timeoutValue.getClass() without first checking to see if the value returned is an Class and thus the NullPointerException is thrown. Added a spring.redis.timeout value to the configuration avoids the issue, but that shouldn't be required.
Steps to reproduce or test case
Only basic spring.redis.host and spring.redis.port configuration


1738
Add RTopic.countListeners method

No description provided.


1739
Add spring data redis 2.1.x support

No description provided.


1740
Custom classes using Jackson must explicitly enable TypeId serialization if final

Objects for values used in redisson classes such as RMap and RBucket can be  non-final classes without annotating explicitly.
When serializing non-final classes using Jackson, the type id is not used.  When reading such classes, redisson always explicitly passes Object.class to Jackson for deserialization which requires type id in "@Class" field causing missing typeid exception.
This is more of a problem using Kotlin due to final being the default modifier for classes, and the only modifier for data classes.   The errors and solution are non obvious.    Registering modules or explicitly attempting to force enableTypeId via ObjectMapper configuration does not work.
Annotating  the classes with @JsonTypeInfo(use = JsonTypeInfo.Id.CLASS, include = JsonTypeInfo.As.PROPERTY)  or forcing non-final classes, and not using any kotlin 'data' class does work.
Steps to reproduce or test case
Suggestion: The core cause is in the Redisson JsonJacksonCodec Encoder and Decoder.
The Encoder calls objectMapper.writeValue() using the object instance supplied -- this internally will resolve to the instance class (not the declared class of Object). The default Jackson encoding behaviour will only add type id if this is a non-final class.
The Decoder, on the other hand, explicitly passes in a Object.class as the type to deserialize. Object.class is ALWAYS non-final so will always require type id.
This fundamentally cannot work without additional type information being stored in redisson. Suggest, as Jackson APIs allow, to allow for passing in the and storing the class used when creating container objects and collections so that it may be explicitly passed instead of Object.class. Creative use of generic class instantiation can partially solve this in pure java for generics.


1741
tcpnodelay

Steps to reproduce or test case


1742
Old master connection still existing in MasterSlaveEntry.writeConnectionPool after switchover(changeMaster)

In MasterSlaveEntry, after switchover(changeMaster), all oldMaster connections are kicked off from writeConnectionPool.
If changeMaster happens, meanwhile  old master connection is during reconnecting, old master connection will still exists in writeConnectionPool(even it becomes slave).
See below logs from example:


1743
Fundamental API design flaw -- with respect to encoding and serialization

The stated purpose of the library behaves as documented and expected -- i.e. users should not need to be aware of implementation and it should "just work".   One stated goal/priority for reddison is that users can use existing or new java classes 'As Is' and simply use reddison as a transparent native object database.   This is a very compelling feature (which has been attempted many times over the last 30+ years).  Considering the maturity and feature rich nature of the product I nievely assumed that this would 'just work' as intended (of course accepting some edge cases that are problematic.)
In particular, with the variety of codecs, including Jackson -- which is if not the single most used JSON data mapper/serialization library, atleast in the top 3, that if a class could round-trip serialize with Jackson that class would be equally usable with Reddison -- this is explicitly stated (with some caveots).
By leveraging the work of existing encoders (like jackson) it is natural to assume that this is not magic -- it would work 'as good as' whatever encoder was configured, so if one has domain knowlege in that encoder and has created classes which behave nicely with that encoder then Reddison would indeed be a transparent 'Drop In' -- and be able to use the the other really awesome features provided.
It simply does not work this way, and can not work as stated with the existing APIs.
I believe this is due to a fundamental difference in how various encoders/codecs work, and not fully understanding the subtleties.   Some encoders work by always storing the type information with data so that deserialization is possible from the data alone with no external context or special per-instance configuration.    Other encoders (such as Jackson) prioritize round trip to user controllable serialization formats.   The concept being that the codec can be configured such that the output (JSON in this case) is produced in a form that either pre-exists (must be matched exactly) or 'user friendly' (intentionally undefined -- but again, assumed to exist and must be matched).
To achieve this, the default mode, and in fact almost all features of Jackson are designed to NOT embed type into the JSON data itself, but rather to make use of the serialization or deserialization dynamic context (and other out-of-band configurations) to be able to parse 'arbitrary' JSON 'as is' into the expect type.   This is fundamentally different approach and goals then codecs which produce 'black box' output and instead focus on minimal or no out-of-band context needed to round trip Java objects.
The side effect is that in order for Jackson to function properly (i.e. in the use cases it was primarily designed for), type information MUST be provided out-of-band in order to deserialize.
The exception, which is not commonly used, and which recently has been shown to be a severe security problem,  is the special mode of embedding type information with each JSON element.
These modes are not interchangeable and have non-compatible requirements, and in general are 'all or nothing' -- you must code for one or the other mode explicitly and consistently.
The current Reddison APIs cannot handle either mode correctly in many cases.  For example, RBucket, without extreme hacks, cannot round trip most non-primitive objects -- even basic Java Bean or POJO.
This is NOT solvable by simply overriding the codec and tweaking it somehow -- because internally, in intentionally non-exposed implementation code, the necessary usage of the core Jackson APIs are incorrect and inconsistent in at least a few places.   The default Jackson codec uses a non-standard configuration of the ObjectMapper which is not able to round-trip consistently given the implementation of the deserializer (which in many places pasess a literal Object.class as the target type)
I have found that it is possible to hack this on a case by case basis by 'creative' (i.e. probably will break many other things) mangling of the codecs -- on a per use basis -- It still requires every API call to use a distinct codec taylored for the type,  and I have no idea what will happen with nested RObjects -- or other internal code -- What this demonstrates, in my opinion, is that the API itself needs to be enhanced slightly to accommodate the behaviour of codecs which need out of bound type information,
not by making this a burden on the users -- particularly since this relies on understanding many details of the private implementation of Reddison to work -- with no assurance that ones understanding is fully correct or that the undocumented internal implementation will not change.
This essentially makes Reddison unsuitable for large classes of its intended use cases.  That is sad, as I was looking forward to making use of the AWESOME features it does provide -- to be blocked by a few fundamental API flaws.
Recomendation:
Solving this problem is not complex, but it cannot be done cleanly by end users, it needs to be implemented internally and exposed through the APIs.
There are various other products which do this exact thing that can be used as a model for what is needed.
Essentially -- every API which deserializes a user defined object MUST have some mechanism of providing the target class explicitly. For example: Jackson itself has a Class argument for every method which does deserialization.   This is not just an 'advanced' feature, its necessary for all but a few special cases.
cache2k https solves the problem by making use of a rarely known, subtle feature of Java which provides a way to prevent type erasure of generics. E.g.
This subtle 'trick' of creating a anonymous type explicitly (note the "{}" at the end -- critical), allows the cache to access the generic parameter types and use them later as needed for deserialization.
Using the first suggestion, I believe all it would take to make RBucket.get() to work properly is to add the class argument to get
Yes this is ugly and yes this breaks some of the simplicity of implementing interfaces that do not have this signature -- but at least it works reliably and doesn't require the end user to have deep domain knowledge of both the codecs and reddison to handle basic simple java classes as the framework is designed to do.   This would have to be done likewise to all the methods which deserialize top level objects.   Once the top level class is properly deserialized, all its internal references will work fine (if you allow Jackson to do it for you)  -- Jackson will use the declared type of the parents reference variable to deserialize the children.   All the subtleties of how to get this to work are then defered to jackson and whatever customization one needs to do via annotations and configurations are all Jackson problems.
That way you could truly state that "If a class round trips through Jackson using the provided ObjectMapper then Reddison will work correctly for that class without changes or custom configurations needed"
I do not know the extent this affects internal code -- this is why I am not attempting to implement this as a PR -- I suspect that I would need to fully understand all the intricacies of Reddison to make sure I got all the cases correct -- I believe the author is the best source of this domain knowledge.   By the time I fully understood all the code enough to make this change, I would probably end up writing my own version -- which is exactly what I did NOT want to do when I discovered Redisson.
Note that these suggested approaches are NOT simply having the user customizing the codec -- the codec is not the right place to store per-type per-use information, that needs to come from the callsite directly, either in the creation of the R or in its methods -- One could still store the necessary class information in the codec as is done in the JsonJacksonMapCodec -- but 'hide' this from the user -- that is an implementation choice.
For JVM Languages which handle generics 'better' , such as Kotlin, one could write a wrapper around Reddison to provide the simpilier APIs and manage the explicit class arguments in the wrapper.
This is what the Jackson Kotlin module does
Most of this module is a single source file that provides 'extension functions' which convert the generic template types into explicit class types to pass to Jackson.
This is not possible in pure Java, which is why cache2k uses its subtle 'trick' during the cache creation to extract the generics class types.
Note: that the problem exists in Reddison even without user supplied classes begin generic/templates --
this is an issue with even basic POJO type classes with no inheritance, generics, or other 'advanced' features -- Reddison simply does not supply the API's necessary to deserialize these properly using codecs like Jackson which require out of band (or context provided) type information.
You just cant get there from here ...
Note: I was very surprised that such a simple use case failed -- until I checked the test cases in the examples and all of them which would have triggered these problems were using basic types (String, Int, Long) not custom classes.  Those types do not need any out of band type information so they do work just fine.   Similarly, the Reference class handles this problem in its own way (and may in fact be unnecessary if the above suggestions are implemented -- not sure)
Steps to reproduce or test case


1744
RDelayedQueue got delay long time when offer a task with negative time

offer an element with delay time (-2515194, "2018-11-20 20:00:52") when create time is "2018-11-20 20:42:08".
I expect that it transfers to readyQueue right now.
but after a long time I got it from the readyQueue at "2018-11-20 21:00:10".
Steps to reproduce or test case


1745
Add stream() methods with paging support

Add follow methods:


1746
in MASTER_SLAVE readMode ,when master down,and read will be slow...

In MASTER_SLAVE read mode, when redis master node closes, read will slow down. Is this a bug?
Here are my operations:
I started three redis server processes, (6379, 7379, 7380), 6379 as master and 7379, 7380 as slave.
Then I started three Sentinel processes (26379, 26380, 26381) to monitor the redis cluster.
Then I started redisson client by this config:
Then I read and write randomly to redis cluster:
Then every 50 milliseconds I can get a result.
But when I kill redis master node (6379), the get command of redisson will become very slow, which is jstack information.
Redisson version


1747
org.redisson.client.RedisConnectionClosedException




1748
RedisConnectionClosedException




1749
not support redis command APPEND

why redisson not support  redis command APPEND , decrBy?


1750
Local Embedded Redis does not work with 3.9.1

Here is the other issue I created.
Just like the other ticket, as soon as I downgrade to 3.8.2, everything works just fine.
Redisson should be able to connect to local redis running on port 6614.
Redisson won't start and throws this error:


1751
Issues with RBitSet - Value does not stick

I am new to Redis and Redisson. I am trying to set a RMap<String,BitSet>. I call the put method on my RMap object, but when i do the get, I always get a empty BitSet. If i use RMap<String,RBitSet>, iterating over the map results in a "java.lang.ClassCastException: org.redisson.RedissonReference cannot be cast to org.redisson.api.RBitSet"


1752
The Redisson connection to Redis master node will break down after Redis slave node is up from down

We have application using Redisson to access Redis cluster(3 masters+3 slaves).
We have a test case which is to shutdown one or more Redis slave nodes then take it up.
We don't expect there is any Redisson Connection broken on the master nodes since we only take action on the slave nodes.
It is found after Redis slave node is shutdown and taken up, the Redisson connection to its master node will be broken.
By checking the Redisson 3.9.0(also the latest 3.9.1), it is found after a slave node is up, on its master node, Redisson will try to release the connection from all others except this slave node.
Here "all others" has included the connection from the application.
MasterSlaveEntry.java: Function "public boolean slaveUp(URI address, FreezeReason freezeReason)"
Not sure my understanding is correct or not.
Steps to reproduce or test case


1753
how to use the watch in redisson?

i try to use watch commond in a lua script,but it doesn't work,throw the exception like this
"This Redis command is not allowed from scripts"
so, does redisson have a way to support watch?


1754
none




1755
Spring Session keyPrefix setting isn't used in session name

No description provided.


1756
[ANNOUNCEMENT] EOL of 2.x version by 1st February 2019

I decided to drop further development of 2.x version by 1st February 2019. Its amount of downloads takes less than 5% of total downloads and decreasing each month, according to maven repo statistics. If you haven't yet moved to 3.x version then I recommend to plan such migration in the nearest time.


1757
ByteArrayCodec does not work with RedissonSession

having this config for the redissonclient and using @EnableRedissonHttpSession should not fail with ClassCastException
using above configuration and RedissonSession we get a ClassCastException
Steps to reproduce or test case
follow but also add ByteArrayCodec as the default codec


1758
3.8.0 Heap dump analyzer concludes ClusterConnectionManager is #1 heap memory leak suspect

Summary
noticed heap memory slowly increases in service
service uses Redisson's 'getList' operation
heap dump analyzer shows ClusterConnectionManager as number 1 heap memory leak suspect due to 1 instance grew to 1.8GB size (screenshots below)
Question:
is this expected for one Redisson instance to have ClusterConnectionManager grow to 1.8GB?
Steps to reproduce or test case
use Redisson getList operation under load


1759
setting to expire time

Description
Hello,i am using spring boot redisson starter in version 3.8.2. I am confusing with the expire() method and remainTimeToLive(). I learned that the remainTimeToLive() method return -1 to indicate the key will never expire,-2 to indicate the key does not exist.However,in the method expire() ,when passing -1 will result in the key not exist,passing -2 will result in the key never expire.
I gets the result by my own test case.I want to know, if that is the design or is a bug?
Thank you!
Steps to reproduce or test case


1760
RedisTimeoutException when ha switched

none


1761
Spring xml file can't set pingConnectionInterval to BaseConfig

The redisson-1.2.xsd file dose not add the pingConnectionInterval(ping-connection-interval) attribute to "baseConfig" , so when using the spring xml can't set the pingConnectionInterval properties to BaseConfig. Can add the pingConnectionInterval attribute to the redisson-1.2.xsd file?


1762
none




1763
Race condition in RedissonLock subscribing to pubsub channel

We are currently using redisson for, among other things, distributed locking. In our use case, we can have hundreds of unique fair locks being acquired many times, usually for short periods of time (~1-2 seconds).
During testing, we noticed that sustained load eventually, but consistently, results in threads failing to acquire the lock. To try to pinpoint the problem, we added extra logging in various places in code path used by RedissonLock. What we found was that it sometimes took a long time for the lock to subscribe to its pubsub channel, by which point the unlock message was already published. This results in the thread waiting on entry.getLatch().tryAcquire(ttl, TimeUnit.MILLISECONDS); until failure.
In other words, the sequence of events seems to be:
thread 1 acquires a lock
thread 2 tries and fails to acquire the lock, initiating pubsub subscription
thread 1 releases lock (semaphore is not released since nothing is waiting on it yet!)
thread 2 completes subscription connection and waits on semaphore, eventually timing out
There seem to be two places where this delay happens:
Acquiring an AsyncSemaphore in  the PublishSubscribe::subscribe method
The 'await' call in RedissonLock::tryLock
Are we missing something here? It seems strange that it can take upwards of several seconds for the lock to subscribe to its pubsub channel.


1764
NPE in CommandDecoder

We've problem with redisson-tomcat 8-3.9.1. / redisson v3.9.1. After sime kind of classes modification, the session manager stops working consequently it stopped Tomcat. Tomca'st log contains following fragment:


1765
none




1766
RoundRobinLoadBalancer doesn't distribute load equally if one of slave nodes was failed

No description provided.


1767
Spring Session does not work with default JSON codec when CSRF token is put to session by spring




1768
Problem with radius() method and AWS ElastiCache cluster and readMode=SLAVE

A call to retrieve the items from a RGeo key based on radius should work in an AWS ElastiCache replicated setup using readMode SLAVE
Since all these calls are considered read-only by Redisson as opposed to write by Redis/ElastiCache, they are all sent to read-only slaves. We get the exception below instead. Please note I've masked actual IP addresses and host names with x's, and replaced the key names and coordinates.
Steps to reproduce or test case
Configure Redisson to use a replicated ElastiCache cluster with readMode=SLAVE and use radius() method for a RGeo object


1769
Unexpected ClosedChannelException during operation

This error occurs regularly (about every 3-5 minutes), I’ve noticed that when it happens the freeSubscribeConnectionsAmount  is 0, could it be related to that?


1770
Documentation for Redisson reactive collections

Is there anywhere I can read about how to use Redisson reactive collections, especially queues and maps?
I found practically nothing about it in the documentation.


1771
RedissonSessionManager - Tomcat - User Session expiring 30 minutes after initial session creation regardless user is actively making transactions and ttl being reset.

redisson session manager is creating sessions which is getting expired after 30 minutes even if the user is actively making transaction. Who is controlling the session expiry?  in tomcat web.xml session timeout is set as 30 minutes.  when user is making active transaction, redis desktop manager is showing that the ttl value of the session is getting reset to 30 however still the session is getting expired exactly after 30 minutes of initial session creation. so definitely ttl value which is getting reset to 30 minutes is not deciding the session expire. which factor is expiring the session? How and where that parameter can be set for redisson session manager so that session does not expire when user is actively making transactions.
If user is actively making transactions, same session should be active all the time since the time user is active.
Session manager  expiring the session after 30 minutes since initial login/session creation time even if user is actively making transactions.
Steps to reproduce or test case


1772
Redis URL not start with redis:// after update to 2.14.1

Run successfully
Steps to reproduce or test case


1773
Reddison tomcat session manager - unhandled exception

We're using : Tomcat8.5
When develop it might happen, that serialized session is not able to deserialize due modification in Class
(add/remove fields), in such cases redisson throws java.lang.ClassCastException, it's quite OK. But session manager doesn't catch it in findSession() method:
would be better if it catch it and return no-session.


1774
Redisson Spring Boot doesn't start properly without lettuce or jedis in classpath

No description provided.


1775
two thread get the same lock by trylock?

Steps to reproduce or test case


1776
3.7.5 , Unable to get connection! Node source: NodeSource Azure Redis Service

Connect the Redis service and get the correct value.


1777
NullPointerException in Spring Session

Unable to decode data.


1778
Pooled connection closed after MOVED redirection

No description provided.


1779
Implement Spring Data ReactiveRedisConnectionFactory

No description provided.


1780
JsonParseException: Unrecognized token '': was expecting ('true', 'false' or 'null')

On the redis-cli, when I run:
It is throwing an exception.
Caused by: com.fasterxml.jackson.core.JsonParseException:


1781
Parse URI error,  Illegal character in authority at index 8

Hello ,I got a error when starting up the application.


1782
RCacheMap.putIfAbsent unconditionally updates TTL if not absent

Steps to reproduce or test case


1783
Add getCountDownLatch, getSemaphore, getPermitExpirableSemaphore, getFairLock methods to RMap

No description provided.


1784
Documentation of custom builds.

If I build the source as-is I get the 2.4.x version of Redissson, but say I want the 3.9.x version instead. What's the correct way to do it? I can't find any documentation about custom builds.


1785
Add getSemaphore, getPermitExpirableSemaphore, getFairLock, getLock, getReadWriteLock methods to RMapRx and RMapReactive

No description provided.


1786
Add getReadWriteLock, getCountDownLatch, getSemaphore, getPermitExpirableSemaphore, getFairLock methods to RSet and RSetCache objects

No description provided.


1787
Add getReadWriteLock, getSemaphore, getPermitExpirableSemaphore, getFairLock, getLock methods to RSetRx, RSetReactive, RSetCacheReactive, RSetCacheRx objects

No description provided.


1788
What is equivalent of JPA entity manager in Redisson

Not an issue looking for some help with Redisson.
I would like to use Redis as a cache manager in order to cache JPA entities coming Coherence Caching. I am new to Redis and with my research found out redisson to be a good solution for the problem. So i am using Redisson Live object as replacement of JPA entities but i dont know to handle those in Redis Cache like JPA entity manager what shall i use in Redisson in my spring boot application
Steps to reproduce or test case


1789
Redisson sentinel mode error - At least two sentinels are required

I am using Sentinel mode for Redis. I am using Redisson Client version 3.9.1
The configuration of Sentinel using Redisson:
I am running two sentinel servers and one Redis master with no slave. This is just a setup on my local environment.
Output of some commands:
Whenever I am running my Spring Boot Application, I get the following error:


1790
can redisson be aware of data change in redis

When I change data in Redis using 3rd Library other than Redisson, e.g., Jedis, I'd like Redisson be aware of that and sync the changes to local cache.
Don't know yet, so I ask.
Steps to reproduce or test case


1791
Implement Cuckoo filter

No description provided.


1793
Sentinel Connection does not recover after +tilt mode entered on a slave

Client connection recovers after one of the slaves recovers from the tilt mode
Client stops communicating with slave, and all commands to that slave time out
Steps to reproduce or test case
Client running on the master node gets the down and up events
But the client never recovers. From this point on, write request to master work fine, but readonly calls, which routed to slaves  time out and redisson considers this node disconnected although it is connected , and retries forever
The Big problem with this, is that it creates instability in our app, and the partial operation of Redisson in this situation is confusing.
This happened after we upgraded to 3.7.1 and did not change configuration of Redis


1794
DecoderException




1795
Android URI Fatal ERROR




1796
none

No description provided.


1797
none




1798
RMap.getAll throw ClassCastException




1799
Unable to connect Redis with SSL over Route53  in AWS.

I have created Redis5.0.0 cluster in AWS with in-transit and auth enabled.  I also have entries in Route53 that point to Redis cluster.
When I use Route53 URL, I am unable to connect to redis cluster. When I use direct end points of Redis cluster, connection is successful.
Issue I identified: While using Route53 URL, certificated were issued by different host as compared to Route53 URL. Thus, certificate could not be validated.
How do we disable SSL certificate verification?


1800
Fallback on DB if Redis cache fails to handle requests

Caused by: java.nio.channels.ClosedChannelException


1801
Redisson spring XML configuration and lockWatchdogTimeout

Have possibility to set lockWatchdogTimeout property in xml redisson:single-server configuration.
Possible only in "by hand" creation of Redisson client.
Please, explain, how to do it now the best way, when client is creating using xml-config.


1802
NPE in CommandPubSubDecoder




1805
[Gradle] Android Studio URI Fatal ERROR




1806
redisson-tomcat-8 share session

Steps to reproduce or test case
1.login the gy-center sys, test some apis
2.wait long time such as 2 hours not to operate gy-center api
3.the 500 Internal Error occurred like screenshot


1807
init so slow

I found in spring boot 2.0.3 redission init so slow


1808
RMapCache element expiration doesn't work with map size = 1

No description provided.


1809
drainTo when only one element exists

queue should be empty after calling drainTo()
if only one element exists, after calling drainTo() element still exists in the queue
Steps to reproduce or test case
create a redisson blocking queue
add only one element
call drainTo on the queue


1810
java.lang.IllegalArgumentException: Redis url should start with redis:// or rediss://

Deserialization works as expected when key doesn't exist on given node
Exception is thrown


1811
The connection not reconnect

related #1583   Channel Inactive but the event not catched by ConnectionWatchdog.channelInactive()
I think it is the same as #1583 ,  when I use kill -9 redisPid, then restart the redis, it seems work fine. But when the program run one or two days,  this issue appeared. I guess there may be a network problem that caused ConnectionWatchdog.channelActive not to be triggered. Is there any parameter setting to avoid this problem?
The exception stack:


1812
none




1813
RedissonSession#changeSessionId doesn't change the id in redis.

When call RedissonSession.changeSessionId(), the session id did not change in redis. So, when call another request , redisson cannot find the session in redis.
Steps to reproduce or test case
spring boot autoconfig with single mode.


1814
zRevRangeWithScores does not work properly in Spring RedisTemplate

I found a problem with the command declared by ZREVRANGE_ENTRY in the RedissonConnection class. It should be ZREVRANGE, not ZRANGE.
redisson version :3.9.1


1815
Wrong command timeout for check master functionality

When usingreplicatedServersConfig configuration you cannot set low retryAttempts & retryInterval without getting command execution timeouts for the check master functionality, which ensures that the client knows which nodes that are master and which aren't.
The timeout for getting a connection, sending the command and waiting for the response is calculated by retryInterval * retryAttempts in the version of redisson that we use currently (2.8.24).
From what I can see the command timeout calculation was introduced in following issue, #1280 (commit was kinbod@387ed74)
It actually seemed to have changed in following commit, 338f9d0, which is included in a later version than we use currently. Now the command timeout is instead set by what timeout value you have set. This commit would probably get rid of the exceptions for command execution timeout for our application, since it uses timeout instead of retryInterval * retryAttempts.
I suggest a change to make this a configurable value for the replicatedServersConfig. This would make it would be possible to have very low values configured for timeout, retryAttempts & retryInterval without it affecting the check master functionality.
Since checking if a node is master is scheduled to be done periodically in the background it is not that important, at least for us, that this will timeout quickly. It is however important to us that we do timeout quickly for the app/user initiated commands. Making this value configurable would make sure that it possible to configure redisson for such a scenario.
The timeout for checking if a node is master or not, using INFO REPLICATION command, should not be shorter than the total time of command timeout and server response timeout for user/app initiated commands. I expected the time for the timeout to be calculated as (retryInterval * retryAttempts + 1) + timeout to give it the same amount of time to get a connection, send the command and await the response as user/app initiated commands.
The timeout is calculated using retryInterval * retryAttempts. This seems wrong since it makes the total timeout shorter compared to an app/user initiated command. I would expect it to be at least the same amount of time by default.
Steps to reproduce or test case
Add a latency toxic higher than 50 ms to one of the redis nodes, and ensure that your java application uses the address and port exposed by toxiproxy.
Update your java application to use the redisson configuration defined in this issue.
Start your java service..
You will now get exceptions starting with the message text:
Command execution timeout for command: (INFO REPLICATION)


1816
Can't execute CLUSTER_NODES,which version solved?

@mrniko hello,i had view some close issues,but i dont know which version  really solved this problem.
redis on port 7001 is master
redisson version:2.8.2
the following is my error log


1817
how to set the 'pingConnectionInterval' attribute in spring xml?

Steps to reproduce or test case


1818
Add Hibernate Region Factory with JNDI support

This factory should locate Redisson in JNDI tree rather than creating a new one.


1819
Add Tomcat Session Manager with JNDI support

This manager should locate Redisson in JNDI tree rather than creating a new one.


1820
Redisson exception message include password as plain text which is insecure when print in log

Exception stack/message print password as:


1822
none




1823
Why does readAllValues not using local cache in LocalCachedMap?

LocalCachedMap.readAllValues() should be very fast, using local cache and should  not query redis.
LocalCachedMap.readAllValues() cost 100ms+ to read 800+ POJO objects.
In redis-cli monitor, I saw incoming query by redisson


1824
Alleviate threadId dependency

If threadId can be replaced with a generated controlId it will be perfect to use in no thread centric programmation like, fibers or kotlin coroutine.


1825
Command execution timeout for command: (INFO REPLICATION)

Steps to reproduce or test case
Already checked the network latency, CPU, memory, everything seems to be normal when the exception happens.
This happens around once a day or less, pretty consistently, usually during midnight when system is idle. Seems to be related to reconnection / retry strategy, already tried to bump up retryInterval and retryAttempts following the suggestion in #576.
Full stack trace:
Any inputs are welcome, thank you!


1826
Redisson will try to connect to removed nodes

Redisson seems to keep the connection to the removed node, and try to reconnect after I shutdown the node. As the figures shown, I had removed 11.4.66.112:43791 and the log confirmed the node had been removed. But Redisson was still trying to connect to the node. After resetting and restarting the node, Redisson reconnected to it and leaded "CLUSTERDOWN Hash slot not served" exception.
When will Redisson distribute the new version that fixed some bugs about "MOVE"?


1829
none




1830
NPE after upgrade to 3.10.0




1831
RBlockingQueue.pollFromAny should honor slots

RBlockingQueue.pollFromAny should send the appropriate number of BLPOP instructions to the appropriate number of masters in a redis-cluster configuration.
RBlockingQueue.pollFromAny sends a single BLPOP instruction regardless of hash-slots and sometimes returns a CROSSSLOT error.
Steps to reproduce or test case
Set up a multi-node redis-cluster with multiple slots ranges going to different masters.
Connect redisson to redis-cluster.
Call RBlockingQueue.pollFromAny with at least two queue names that reside on different masters.
See exception thrown.


1832
none




1834
ERR command eval not support for normal user

No description provided.


1836
LRUCacheMap ArrayIndexOutOfBoundsException

No ArrayIndexOutOfBoundsException
Throwing ArrayIndexOutOfBoundsException when setting object into HTTP session using setAttribute
Steps to reproduce or test case


1837
RGeo.pos broken

geo.pos(element) returns a map
Throws exception for trying to cast an ArrayList into a Map
Steps to reproduce or test case
It seems that on RedissonGeo.java line 137 you are using a ListMultiDecoder rather than a GeoDistanceMapDecoder or something more appropriate.  I tested this on 3.7.3 and it was still there.  You should probably have had a unit test for this API.
Couldn't confirm 3.10.0 due to inability to find list of dependencies to import


1838
Unable to decode data & NPE

the code run in high concurrent environment appear so many of the exception


1839
changeMaster failed cuase constantly "RedisTimeoutException: Unable to get connection"

Master connection pool can be re-established later even if participal changemaster failed in redisson.
If participal changemaster failed,  then always throw "RedisTimeoutException: Unable to get connection" and cannot be recoverred.  And seems there are two masterEntry target to both old and new master address.
Steps to reproduce or test case
If any changeMaster activity failed and got "Can't change master to: redis: error, then masterConnection pool will not able to get connection in later phase even master connection recoverred.


1840
Could  `RSetMultimapCache` support Read-through strategy?

RSetMultimapCache support Read-through, Write-through and so on.
Read-through strategy
If requested entry doesn't exist in the Redisson Map object when it will be loaded using provided MapLoader object.
Write-through (synchronous) strategy
When the Map entry is being updated method won't return until Redisson update it in an external storage using MapWriter object.
Write-behind (asynchronous) strategy
Updates to the Map object are asynchronously written to external storage using MapWriter object. Threads amount participate in write operation execution in background are controlled by writeBehindThreads setting.
This feature only available for RMap, RMapCache, RLocalCachedMap and RLocalCachedMapCache objects.
Steps to reproduce or test case


1841
NPE at startUp onMessage ·41 ·

Steps to reproduce or test case
I got this issue at my application startup. It is not happens at each startup


1842
none




1843
Why function of SingleConnectionManager.create skip set keepAlive?

Actual client is keepAlive
Actual client is not  keepAlive
Steps to reproduce or test case


1844
How to disable logger?

slience log


1845
RedissonClient still points to failed AWS Elasticache Redis node when failover happens

I tested AWS Elasticache Redis failover (manual test). First I started my app which creates one  Redissonclient. It established 67 connections to primary Redis node. Then I manually did failover primary test.
All 67 connections point to new primary Redis node.
33 connections still point to previous (failed) primary Redis node, 34 connections point to new primary Redis node.
Steps to reproduce or test case
Start my app which creates one Redissonclient.
Go to AWS Console, Elasticache, Redis and select redis cluster you are using. It shows all of nodes of the cluster. Check the primary node, go to Action and select "Failover primary".
Wait for a while, run step 2 command, out of 67 connections, half of them are pointing to previous primary node, half of them are pointing to new primary node.
From AWS Console, if you select previous and new Redis primary nodes, then look at "Current Connections" of CloudWatch metrics, you can get the same result: Redisson client points to both previous and new Redis primary nodes. Following screenshot shows Redis primary node failover from 003 to 004.


1846
Slave connection will not recover from freeze mode after failover

Hi!
I am testing failover behavior of redisson on AWS Elasticache in replicatedServers mode with one master and one slave. I am using read mode MASTER_SLAVE. After the failover is finished redisson correctly detects the new master and redirects all traffic to the master. The slave needs around 5 minutes to recover on Elasticache. Redisson is continously checking that connection, but after recovering that connection it does not move traffic to the slave.
Traffic should again be load balanced between master and slave after failover is completed.
Connections to master and slave are established but all traffic is routed to master.
By debugging i identified that the slave connection will remain freezed with FreezeReason Manager.
Steps to reproduce or test case
Start app with replicateServers mode with one slave and one master
Start failover on AWS console and wait until it is finished.
Watch traffic on slave. -> nothing


1847
org.redisson.client.RedisTimeoutException: Subscribe timeout:(7500ms)




1848
DefaultSavedRequest cannot be cast to SavedRequest

I did it according to your configuration.But there was a problem:
so,what should i do?


1849
Question about api(RMap,RSet....) use

If there are 10000+ values in a RMap. Why do I take all the values out when I use it?
for example:
RMap<String, String> rmap = redisson.getMap("TEST")
Then this map is full of all values.But  I just want to store a value in the map, no need to take out all the values. I just want to get a instance of RMap whithout all of value.


1850
DefaultSavedRequest cannot be cast to SavedRequest

I did it according to your configuration.But there was a problem:
java.lang.ClassCastException: org.springframework.security.web.savedrequest.DefaultSavedRequest cannot be cast to org.springframework.security.web.savedrequest.SavedRequest.
so,what should i do?


1851
Fails when trying to read yaml config

To load config values from redisson.yaml
Tries to load redisson.json first and aborts even if redisson.yaml is present
Steps to reproduce or test case
Create a redisson.yaml config and without a redisson.json config present.
The error is in RedissonRegionFactory.java on line 126. A possible fix would be to nest the config loading like it's done when loading a file without the class loader.


1853
RBloomFilter.expire only deletes Bloom Filter hash, not string

Problem
I initialize a bloom filter like this:
mostly is works,but sometimes the key likes "Birth:Msg:100000000901:612" is not deleted,and the config hash is deleted
Env details


1855
Unable to decode data +PONG

Steps to reproduce or test case


1858
RMap.readAllKeySet() not working : Its calling HGETALL instead of HKEYS

Accorking to Redis command mapping RMap.readAllKeySet() should internally call HKEYS but its calling HGETALL
Error:
Steps to reproduce or test case


1859
none




1860
Why does RMapCache is designed to use Hash instead of simple key-value structure?

I am curious why RMapCache is designed to use Hash instead of simple key-value structure? Simple key-value can use TTL while Hash cannot. What benefit does RMapCache get when using Hash compared with using key-value?


1861
Tomcat Session expires in Redis earlier than scheduled by Tomcat

No description provided.


1862
simple type, class java.lang.Object

Type Exception Report
Message Unexpected exception while processing command
Description The server encountered an unexpected condition that prevented it from fulfilling the request.


1863
Connection problem when using Cluster Servers: URISyntaxException: Illegal character in scheme name

The above code throws an IllegalArgumentException exception.


1864
RedissonSessionRepository subscribe and process too many keys

In RedissonSessionRepository.onMessage(), if a body not starts with "redisson_spring_session:", just return.
In my application, there are other keys contains char ':'.
RedissonSessionRepository try to HGETALL a session key not exist.
It's not necessary and print a lot debug log:
acquired connection for command ...
Steps to reproduce or test case


1865
Problem to deserialize object with jackson

Hi guys,
I have two applications, one read and another write on redis:
My entity
For save i use this code:
The value is saved in redis just like that:
My problem is when I try to read the redis list at another java application.
I have a method that use this code to read the list:
But when i execute the project i receive this error:


1866
Spring cache abstraction with redisson stored all cache data in one map.

I am using redis as cachig solution with Redisson as java client client.
I am doing it with sping cahce abstraction.
So my I have noticed redisson sotres data in redis as whole map and inside that map I have all my cahce data.
Is it possible that I can store all data individually as key value directly to redis.
Currently,  The way data is stored in redis is:  it has one TestsCacheMap and inside that map all the cahce data is stored
TestsCacheMap
Problem with this: If I am using redis cluster then this map will be stored in one redis node so all my data will indirectly stay on one node at a given time.
But I am looking for the way which directly stored key value in redis:


1867
RedissonSessionManager throws java.lang.ClassNotFoundException if readMode=MEMORY

No description provided.


1868
Return the same object in http request processing when session.getAttribute is called, add any "mutable" objects return from session.getAttribute to a tracker that will update Redis session key values at the end of the request processing

When web application gets an object from the http session, then the same object should be returned during the request processing instead of returning deserialized version of the object each time.
Also each object that is "mutable" should be kept track on and at the end of the request processing should be updated to Redis server as web application could have altered the object without invoking session.setAttribute
When in readMode=REDIS each time session.getAttribute will return a new object instead of returning the same object returned by the first session.getAttribute during request processing.
When web application retrieves an object from the session and alters it then at the end of the session the Redis server won't be updated with the updated copy of the object.
Steps to reproduce or test case
Try to get the object in readMode=REDIS and each time a new copy is returned during the same request processing
Try to update the object returned by session.getAttribute - the modified version of the attribute won't be in Redis server at the end of the request processing and the next request processing will have the old version of the object deserialized from Redis server


1869
Can't delete/cancel scheduleWithFixedDelay Job which is running

redisson 3.10.0
When a scheduleWithFixedDelay job is running, cancel the job using cancelTask, the job can be terminated. But when the job is over, the taskId will be inserted into redis again.


1870
RateType.PER_CLIENT in RRateLimiter does not work.

Each client should acquire their own permission when using RateType.PER_CLIENT in RRateLimiter.
When one client acquire the permission, the other client fails to acquire the permission at the same time even though using RateType.PER_CLIENT.
Steps to reproduce or test case
 By the way, I checked the source code of  method "tryAcquireAsync" in class "RedissonRateLimiter" , I found the condition judgment below does not work:


1872
Getting Redisson is shutdown

Not throwing RedissonShutdownException
Throwing RedissonShutdownException
Steps to reproduce or test case
One of our WAR did not start and I thing this have something to do with RedissonShutdownException


1873
throws exception when invoke shutdown method in redissionClient




1874
java.lang.NullPointerException when trying to get attribute from session

Steps to reproduce or test case


1875
RScoredSortedSet.iterator() search by pattern

Steps to reproduce or test case


1876
search by pattern

Steps to reproduce or test case


1877
Caused by: java.lang.IllegalStateException: incompatible event loop type: io.netty.channel.epoll.EpollEventLoop

Caused by: java.lang.IllegalStateException: incompatible event loop type: io.netty.channel.epoll.EpollEventLoop
Steps to reproduce or test case


1878
java.lang.IllegalMonitorStateException

Steps to reproduce or test case
Normal spring MVC + spring boot project.
The uuid value in the redssionClient in multiple threads is the same.
Do you need to create a new redissonClient every time you request it?
I am simulating 1000 requests and this exception appears about 5 times.
My English is poor. Sorry.


1879
RedisTimeoutException after long time of running

Redisson must reconnect to the server if the connection is lost.
It seems to didn't even try to reconnect.
Steps to reproduce or test case
We are using AWS as the Redisson hosts, and OVH as the Redis server host (with a ping between 10 to 30 ms max from one server to the other one).
Let the server run for some hours (3hours seems to be enough), then try to do a request to the server.
You'll get this kind of error:


1880
radiusWithPosition returning RedissonReference instead of actual type

There seems to be a weird bug when using RGeo with radiusWithPosition(params) method.
Following code snippet:
throws
java.lang.ClassCastException: org.redisson.RedissonReference cannot be cast to com.abilium.project.map.entities.CustomObject
However, using this.geo.radius() returns the object list correctly.
Steps to reproduce or test case


1881
Constructor threw exception; nested exception is java.lang.NullPointerException




1882
"RedisException: MOVED redirection loop detected" is popped out after Redis Master nodes down and up

We have application using Redisson to access Redis cluster(16 masters+16 slaves).
We have a test case which is to shutdown one or more Redis Master nodes then take them up.
We expect after the action above(Redis Master nodes down and up), the Redisson can still find the right node when accessing Redis.
For example, there 2 Servers 192.168.0.78 and 192.168.0.79.
There are 8 master Redis nodes on 192.168.0.78 with port 6000-6007, the slaves of the 8 masters are 6100-6107 on 192.168.0.79.
The same, there are 8 master Redis nodes on 192.168.0.79 with port 6000-6007, the slaves of the 8 masters are 6100-6107 on 192.168.0.78.
The test case is that all the Redis nodes on 192.168.0.79  are shutdown then taken up.
So after shutting down, all the Redis nodes on 192.168.0.78 become Master. And after the Redis nodes on 192.168.0.79 are taken up, the Master Role of 6100-6107 on 192.168.0.78 will be switched back to 6000-6007 on 192.168.0.79, which is done by another script according to our function definition.
At that time, Redisson will report the exception like below:
The below is the information of "monitor" on 192.168.0.78:6103:
It seems the request which should be sent to 192.168.0.79:6003 has been sent to 192.168.0.78:6103, which makes 192.168.0.78:6103 get extra load.
So it means the Redisson sends requests to the wrong Redis nodes after the action above, which is regarded as a wrong behavior.
Steps to reproduce or test case
Like the "", setup Redis cluster on 2 servers with each having 8 masters + 8 slaves, the slaves should belong to the masters on the other server. Then shutdown and start all the Redis nodes on one server. Meanwhile, keep the Redisson sending requests to the Redis cluster.


1883
RedisTimeoutException: Unable to get connection

Should work without any exception.
Getting the following exception intermittently:
Steps to reproduce or test case
I have no idea when this occurs.
ReplicatedServers. Please let me know if any specific setting is required.
What are the possible reasons for this exception? How to fix this?
Well, we don't have too much load on the servers.


1884
none




1885
connection closed exception not ignored in Chinese environment

ignored exception "java.io.IOException: An existing connection was forcibly closed by the remote host"
So do you have any idea to ignore it?
Steps to reproduce or test case
In chiness system environment:


1886
About RedissonRedLock,is it right?

The upper code shows that we can get 3 locks from 3 masters, but it’s not sure,sometimes we can get 3 locks from only the same master,for example:String lockKey = "iBePL";
I hope I misunderstood the sample code


1887
RBatch bug when redis sentinel slave restart

use Rbatch to perform LRANGE requests
I use redis sentinel mode.
When using Rbatch to perform LRANGE requests. If the redis slave  restart at this time, the redisson client will replay the LRANGE request until the program is restarted.
Steps to reproduce or test case
use Rbatch to perform LRANGE requests(Keep request pressure)
restart redis slave(sentinel mode)


1889
Huge log messages

Issue similar to #1035 (redisson 3.10.1), probably introduced in commit 60352b8 (or may be f095327).
Recieve big message, get timeout, tens megabytes log message:


1891
After Redis failover, the number of connection to the new slave is 1 instead of 34

I just realized issued #1845 had been closed. This issue is related to #1845 fix.
I have verified that previous master node was added back as a slave node after failover with release 3.10.1. Thanks for the fix. But the number of connections to the salve is only 1 instead of 34. Is this expected? I tested a couple of times and got the same result. Following screen shot shows two tests. I started the app, Redisson established connections to both 003 and 004. Then I did failover from 003 to 004. After failover was done, there was only one connection to 003. Then I restarted the app to make sure Redisson re-established connections to both 003 and 004. I did failover from 004 to 003. After failover was done, again there was only one connection to 004. ( You can run netstat -nt | sort +5 | fgrep .6379 | grep -n ^   from app box to see the connections)


1892
RStream.readGroup use timeout parameter error

Steps to reproduce or test case
rStream.readGroup(groupName, consumerName, 10, 5, TimeUnit.SECONDS);


1893
RFuture.cause() method should return CancellationException and not throw it.

Code to reproduce the issue:


1894
how to run test unit

Hello!I have two question:
First: I download the source code and when I want to run test unit,I find it could not work.I used "maven test" command. Here is document to tell me how to run test unit? or can you tell me som key message about how to run test unit?
Second:I don't konw  how to use ".travis.yml" . Is there have document?
thank you very much!


1895
none




1896
Netty buffer leak during failover and RBatch object exection

No description provided.


1897
Spring session renaime failed when session ID changed on Redis cluster


Redisson Session exception:


1898
Redisson version upgrade causes "Invalid request data"

I was using Redisson 3.9.1 without any problem. I updated it to 3.10.1, and got this error.
Invalid request data: Exception while fetching data (/policy_example1) : Unexpected exception while processing command, Exception while fetching data (/policy_example2) : Unexpected exception while processing command, Exception while fetching data (/policy_example3) : Unexpected exception while processing command
I downgraded it to 3.9.1 and ran again, and it worked.
Why is it happening and how can I fix it?


1899
Unable to decode data.

Steps to reproduce or test case
I don't have exact steps. but I have the following information:
It was working earlier with redisson 2.14.1 with Oracle java 7.
It is broken with redisson 3.10.1 with OpenJdk java 8.
How to fix this?


1900
Command execution timeout for command: (AUTH) when ElasticCache with TLS

org.redisson.Version - Redisson 3.8.0
Redis version 5.0.0
Redisson returns:
Command execution timeout for command: (AUTH).
From the same instance that executed the code above, I can connect to the redis instance with redli:
to discard connection / environment problems.
I could not find in the documentation how to tell redisson that it should use tls. Is it supported at all?


1901
RMapCacheRx does not follow the contract "(onError | onComplete)?"

It must be called one of "onError | onComplete"
Both of onError , onComplete not called
Steps to reproduce or test case


1902
Problem with readGroup and messages created before group

Hi
I am trying to use the new stream feature of Redis 5.
According to the documentation of Redis when I use xreadgroup and mark > I should get all messages that never sent to any other consumer regardless of the time the group was created.
On the example on Redisson wiki I get only  the messages that was added after I created the group.
I don’t see an option to call readGroup function in redisson with > sign to get all messages.
Can you help me with that?
Thanks


1903
Convert the key of the stream message to json

Hi
When I use stream with Redis 5 on redisson I get an error of trying to convert the key of the stream message to Json.
Is there any possibility to try to decode only the value to json?
Thanks


1904
Why the redis cluster port [nodeAddresses] in redission.yaml file should be slave(non-master) node port? 04

Both master or slave port can be configured at the config item [nodeAddresses].
Should be slave(non-master) node port, but why? When I configure master node port, below exception stack block always appears, output the message saying that the configured master node port cannot be connected.
Steps to reproduce or test case
Redis server installation version is 5.0.3, start the cluster mode with command:
2.Check if all redis slots have been covered or not:
3.Configure the redission.yaml file:
4.Run my Springboot service(from main() in Application), exception then occured:
When I try to configure the port with slave port(30004,30005 or 30006), however, it worked well:
I'm curious about how this happened, since all slots have been already checked to be covered and the log says all nodes have had been connected before the exception message printed out. Hope someone can help to analyze this issue and discuss with me, thanks a lot!


1905
Custom codec not working after version 3.10.0

We have been using a custom KryoCodec(overriding the built in one) for a while but after version 3.10.0 this no longer works. The change that affects us are introduced by the following commit: 37b58db
I've spent a little bit of time looking into what's going on and it looks like there are issues regarding classloading since we got all sorts of exceptions now, especially lots of com.esotericsoftware.kryo.KryoException: Unable to find class on classes that we have been serializing without problems til now. The root cause is of course  java.lang.ClassNotFoundException:x.y.z
I've attached the relevant code with the working and non working solution:
The only change on the latter is the addition of the new constructor which now is required.


1906
RInject enhancement

Motivation
Currently it requires some boilerplate work to acquire a desired object in remote tasks. It would be better if the desired object can be obtained via object injection.
Currently it is not very easy to inject a bean of collection type via Spring's autowire function.
The work is to overcome the above difficulties while provide an easy to access Redisson provided objects via injection methods.
Enhance the RInject annotation's capability in general:
to allow direct injections of RedissonClient, RObjects and RLOs
to allow specify codec used to create RObjects and RLOs
to allow RInject support object creation based on Redisson expression when target type is a super type or interface.
Enhance the RInject annotation's capability in Spring environment:
to have everything from above.
to allow RInject behaves similar to @Autowired that can provide lookup/creation and injection of RObjects and RLOs in Spring environment.
to allow RInject behaves similar to @value that can utilise SpEL expression and Spring property expression to provide dynamic runtime injection of RObjects and RLOs in Spring environment.
to allow RInject support object creation based on Redisson expression when target type is a super type or interface.


1908
2.14.1 works fine vs 2.15.1 giving RedisResponseTimeoutException

Should work fine
RedisResponseTimeoutException
Steps to reproduce or test case
I have no exact steps. But, my code works fine with 2.14.1. With 2.15.1, 2.15.2, 3.10.2, it always fails.


1909
SpringBoot 2.1.2 Hibernate 53 L2 Cache

I am getting the following error when starting the server:


1910
Question: does fair locking work when used from within multiple Java VMs?

Hi,
I'm interested in using the fair locking feature from Reddison. But it looks like it doesn't work properly when used from within multiple Java VMs. Unless I'm missing something.
The reason: Reddison uses the thread ID when acquiring a lock. A thread ID in Java is not a UUID, but an integer that's unique only within a single VM:
Could anyone clarify this please?


1911
Spring Cache Manager Default TTL and MaxIdleTime

How can we provide a default TTL and MaxIdleTime to a set of Regions?
Specifically, I'm using Hibernate with Redisson and would like to have to Set of Cache Types
Right now i would have to add every domain class manually in the SpringRedissonConfig.


1912
[Suggestion] Return RxJava2 specific types in RObjectRx

So I recently noticed the existence of RedissonRxClient which returns RObjectRx with Flowables.
To me this is a missed opportunity. One of the biggest reasons I prefer RxJava2 over Reactor Core is that it has distinct types for 1 element, 0..1 element, and 0 element, instead of just having Mono.
Steps to reproduce or test case


1913
Rename RedissonMap then set value in map , the value will put in the old map

the 1 will move into 'bbb' map, but the 2 will put in the 'aaa' map,not the new one 'bbb'.


1914
Redis stream not working at all in 3.10.2

Hello
I am trying to make the stream example work with new redisson version 3.10.2 .
I get ArrayIndexOutOfBounds in class StreamIdDecider.
While it assume having 3 parameters. First one number-number key value.
This is not true input to this class is not these arguments.
Can you take a look?
Thanks


1915
Redis create group with empty stream if does not exsist

Hi
I think it would be nice and will be much better to give the user an option to use the mkstream when creating a group.
This option create the stream attached to the group if it does not exist.
Please take a look here:
redis/redis#4824
Thanks
Ziv


1916
why RRateLimiter has not method like getRate() or getRateInterval()?

Steps to reproduce or test case
Redis version
Redisson version
Redisson configuration


1917
none




1918
none

Steps to reproduce or test case


1919
Allow to redefine CacheKeysFactory in Hibernate Cache Factory 5.2+

Using hibernate.cache.keys_factory setting


1920
RedissonNamespaceHandlerSupport fail to load at Tomcat startup

The scenario is a Spring based application deployed on top of Tomcat 8 configured to use the RedissonSessionManager.
At startup, Spring initialization try to discover on classloader the namespace handlers including the org.redisson.spring.support.RedissonNamespaceHandlerSupport provided with the reddisson-all.jar library.
At this point the init of this handler fails with a NoClassDefFoundError probably because the Tomcat classloader cannot see Spring dependencies that are loaded by webapp classloader.
Unfortunately, after this WARN, the RedissonSessionManager doesn't work properly and new sessions are not stored on Redis.
Here the complete stacktrace:
After some tests, we try to solve this problem by removing the following files from redisson-all-3.10.2.jar:
so there is no need of Sprint integration in our case.
There is any solution/configuration we can adopt to avoid this error and keep the original library?


1921
setPingTimeout deprecated without any note

According to this commit org.redisson.config.BaseConfig#setPingTimeout became deprecated. But there is no migration or deprecation note.
Are there any notes on this? Maybe this config option became redundant?


1922
Feature request: default values for YAML

Support providing default values for environment variables in YAML.
For example:


1924
Default codec change causing an error on the server( version 3.7.2->3.10.2)

Yesterday I upgraded the redisson version from 3.7.2 to 3.10.2, causing the decoding to fail. The investigation found that the default codec has changed and is completely incompatible with the original default codec.


1925
Regression of RBatch result performance decoding

Appeared since 2.12.2 / 3.7.2 version


1926
none




1927
FSTCodec memory leak

several puts (5-10) into a MapCache guarded with a Lock seems to accumulate the payloads in thread locals. The payload is large (several Mb) and the pod (dockered spring boot app with 700 Mb max) goes out of heap. The app running with redisson 3.7.5 has no such problems.


1928
Transactional RBucket object doesn't respect transaction timeout

No description provided.


1929
Redisson hibernate entity cache TTL and MaxIdleTime not being set - default region used for entities 2nd level cache

The TTL and MaxIdeltime once set should auto-evict the hibernate entity beans cached in redis.
The beans are not auto-evicted when TTL expires and the idle time has elapsed.
Steps to reproduce or test case
Step 1)
Create a simple entity bean (Say - com.jhipster.demo.blog.domain.Tag)
Step 2)
Annotate the same with the following
Step 3)
Try to set the TTL and config via code
NOTE: The auto-eviction with TTL set at code level works for Spring cache only not hibernate second level cache for entity.
Step 4)
I also tried to set the TTL and max idle time via application.properties file
NOTE: I thought of using the application.properties file (since I am using spring boot, this file is auto picked)
I got this idea of overriding the default from the following Redisson link -
In that link I see default properties being set for  all entity like -
So I thought I can set the same via spring boot application.properties file
Anyhow both Step 3/4 does not set the TTL correctly for me and the entity is not auto-evicted.
NOTE: The auto-eviction with TTL set at code level works for Spring cache only not hibernate second level cache.
I am using the single server mode and the configuration is the defualt as outlined in the link below for "singleServerConfig"
NOTE: I am using Hibernate 5.3.7, Spring boot 2.1.2, Redisson 3.10.2 version.


1930
Why does LocalCachedMap.readAllValues() need to avoid reading phantom value?

This is to avoid reading phatom local values.
Originally posted by @jackygurui in #1823 (comment)
However mrniko said If element has been added/removed then invalidation message sent to all LocalCachedMap instances and element evicted in all of them.(#592 (comment))
What mrniko said means local cache will be synced by Redis pub/sub mechnism. If so, why does jackygurui said LocalCachedMap.readAllValues() need to read redis value to avoid reading local phantom value? Since local cache value will be synced, I think there is no phantom local values.


1931
RBucket compareAndSet can`t return Boolean.TRUE

I have a method:
I excpet return true,but it still return false;
it still return false
Steps to reproduce or test case
just first set an list object, then call this compareAndSetTaskBuckets method,it always return false


1932
redisson-tomcat-9 session manager does not work with Async servlets

My software is using JAXRS with AsyncResponse.
I tried to use Redisson to store sessions of Tomcat 9.x in Redis, but I always get an exception.
I checked this exception and the reason seems to be that the UpdateValve class seems to call the default constructor of the Tomcat ValveBase class without a boolean flag indicating that it should support Async servlets.
This is a big showstopper since all servlets in our software are async and we don't want to convert them to synchronous ones since that will have a big impact on thread use and overal performance!
Session object properly deserialise
Steps to reproduce or test case
Try to use redisson to access session objects from an async servlet


1934
Live Object write/read Bug

firstname=aaa   not store in redis.
looks like bytebuddy proxy has problem.


1935
LocalCacheView.toCacheKey StackOverflowError




1936
RStream.listPending throws IndexOutOfBoundsException

IndexOutOfBoundsException arise when there are no elements in group


1937
redlock unlock fail




1938
3.10 can't read data of SetCache set by 3.9

After upgraded to 3.10 from 3.9, it has trouble in reading data of SetCache, a NullPointerException was raised.
I found these was something different between two formats created by 3.9 and 3.10


1939
tryLockAsync and lockAsync methods of RedissonMultiLock object get hang

No description provided.


1940
redlock unlock question




1941
Evict delay bug

evict old keys even with acceptable delay
eviction delay is too big due to bug
Steps to reproduce or test case
use cache with ttl 10min or 1hour.
in EvictionTask#run is delay that starts with 5seconds and is multiplied by 1.5 if no eviction is needed. therefore in first 10 minutes without evicting is many times multiplied and resulted to delay 110 or 165 seconds. that is CORRECT.
But after 10 minutes running evicting is started and this delay remains at this big value and is NOT decreased due to BUG. In production is this delay very big and redis is not fast enough in evicting and available memory is fulfilled. Jedis consumes under 100MB, redisson consumes 1GB(config limit) in short run.
Redisson configuration
SingleServer and also on SentinelServer


1942
RedissonAtomicLong.get blocks indefinitely

Stack info:
Steps to reproduce or test case
Small probability and we can't reproduce, maybe related to bad network
Redisson configuration
cluster default config


1943
SingleServerConfig constructor visibility

Shouldn't the constructor of SingleServerConfig be public, as all other BaseConfig subclasses are? I know I can create it using new Config().useSingleServer() but I would prefer to have it public for some Spring custom properties.


1944
Search domain query failed.

The DNS resolver should find valid DNS records, I am trying to connect to the redis hosted on azure. I looked at the existing similar issues but looks like this issue still exists.
Steps to reproduce or test case
Redisson configuration
Spring Boot Redisson example


1945
SENTINEL_SENTINELS can not get anything, why?

when run this code :
sentinelSentinels size  is 0
Why?


1946
Method 'findKeysByPatternAsync' always get all the keys

For this code
it always return all matching keys?
In case the number of keys is very large , I need to get keys in batches. There seems to be no way out.


1947
Will map got from redisson need to persist after putting new elements?

For example, got a map from redisson:


1948
Insert string garbled

Save a string, the prefix is garbled when it is taken out.


1949
EXCEPTION when deserializing modified class with FST Codec

When trying to de-serialize a modified class ( add/remove field ) it fails and it throws an exception.
When it cannot deserialize an object, it should ignore the cache as if it did not exist and call the method again and cache the new object...


1950
PriorityBlockingQueue doesn't release lock after reconnect on network

reconnect to network
there is a lock  name redisson_sortedset_lock:{testqueue} which dosen't release,it seem's like it can't release lock cause network boke,however it get a lock before network boke.
Steps to reproduce or test case
1.run code blow
2.disconnect your network
3.wait a few minute,then reconnect your network


1951
none




1952
Please catch and handle exceptions when reading/writing sessions

We're using Redisson tomcat session manager 3.10.0, and got exceptions as below:
Redisson should catch the any exceptions happened during read/write sessions and returned null instead of throwing them to client.
Exception thrown on page:
Caused by: java.lang.RuntimeException: class not found CLASSNAME:com.sun.proxy.$Proxy228 loader:WebappClassLoader^M


1953
null exception in RedissonLocalCachedMap.java:741

no exception in readAllMap
NullPointerException happened in
Steps to reproduce or test case


1954
memory leak in getLocalCachedMap, redisson version : 3.10.3

no memory leak
memory leak
Steps to reproduce or test case
run the attached code


1955
RedisOutOfMemoryException

No errors should be thrown after setting maxmemory-policy :volatile-lru, maxmemory:4MB.
When I am using two threads to put values through redisson to different database with limited memory(maxmemory-policy :volatile-lru, maxmemory:4MB),  error like org.redisson.client.RedisOutOfMemoryException: command not allowed when used memory > 'maxmemory' sprang up, and the database was flushed by redisson.
But I replaced to use Jedis(2.8.0) to test again, no such exceptions came out, and the database was not flushed by Jedis. The items which exceed 4MB  can be deleted by redis automatically because of volatile-lru policy.
Steps to reproduce or test case
Run commands on redis-cli, config set maxmemory-policy volatile-lru  config set maxmemory 4mb
Run the code twice(Two threads) using different database with type to 0.
singleServer, refer to the codes for details.
Codes I run


1956
Redisson Map Cache Event Notification doesn't work with HPE's NONSTOP OS

Redisson Map Cache Event Notification doesn't work with HPE's NONSTOP OS.
This is because of the endianness.
Below logic is there in MapCacheEventCodec.decode(ByteBuf buf, State state, Decoder<?> decoder) method,
Here, if it is windows, buf.readIntLE() is used, or else buf.readLongLE() is used. But for HPE's NONSTOP OS, buf.readLong() has to be used.
To fix this, two classes has to be modified,
RedissonMapCache - Like how isWindows is being set using "Windows" substring, isNonstop boolean also can be initialized using "NONSTOP" substring
Also, while initializing MapCacheEventCodec, need to pass isNonstop boolean.
new MapCacheEventCodec(codec, isWindows, isNonstop) - in all the 4 places
MapCacheEventCodec - Need to declare isNonstop boolean and initialize(in constructor) based on the isNonstop boolean that is received from ReidssonMapCache
Also, in the decode method, like how isWindows is being checked, need to check isNonstop and use buf.readLong() if it is NONSTOP as given below.
Could you please fix this in Redisson code?


1957
none




1958
Add tomcat session manager with mutiple Tomcat instances session Iterator

request.getSession().getSessionContext().getIds();
This method return ids are same  as Redis store.
When session is created by other tomcat instance, This method return ids are less than Redis store.
Steps to reproduce or test case


1959
ClassNotFoundException is thrown by Tomcat Session Manager in readMode = MEMORY

No description provided.


1960
none




1961
Not null value is returned after ttl expires

I wrote the following code:
And then I expect, that rmap.get("1") will return null, but it returns previously set value.
I tried to debug library code and found the following:
AbstractCacheMap removes value from cache and so get(Object key) returns null
after that RedissonLocalCachedMap/RedissonMap.getAsync() goes to Redis and my value there still exists
so RedissonLocalCachedMap calls cachePut(cacheKey, key, value), and expired value is again in cache


1962
RLocalCachedMap.destroy() method doesn't clear local cache

No description provided.


1963
Add getCountDownLatch, getPermitExpirableSemaphore, getSemaphore, getFairLock to RMultimap object

No description provided.


1964
Add XINFO command to RStream object

No description provided.


1965
RedissonClient shutdown() error

shutdown successfully
There are errors on Eclipse console ,sort of


1966
Deadlock after Redis timeout

After a Redis response timeout, Redisson needs to be resilient and back to normal operation after Redis timeout and allow to lock and unlock critical sections again.
After a Redis response timeout between attempts, Redisson adds the lock to scheduled renew task and never remove them. So, the application enters on a deadlock due to a lock renewed even after unlock.
The task can run on the same thread due to reentrant lock feature, but when the task runs on another thread a deadlock occurs.
Steps to reproduce or test case
Start Redis
Run the test application (https) with a simple locked task.
Force a timeout on Redis runnning a client pause command: "CLIENT PAUSE 5000"


1967
Building Cache Memory Problem with Rmap

When we use RMap, we find that memory can't be released, which leads to frequent fullgc in the production environment. Is there a solution or optimization update of relevant modules now?
The version we used was 3.8.2


1968
AWS ElastiCache Redis Cluster & Redisson-OOM

We are currently facing some issues with ElastiCache/Redisson without being able to determine the root cause so far - thus I'm giving it a try here ...
We've set up ElastiCache in cluster-mode (3 Nodes) - and configured Redisson correspondingly.
We are using distributed locks and some RMapCaches. The caches have a max-size (thus LRU-eviction) and TTLs set for both lock as well the cache entries.
During the last few months we ran into a couple of out-of-memory-related outages - that is Redis runs OOM, not the client.
The memory consumption is usually staying constant (limited by the LRU policy and TTL) for weeks but then tanks out of of the blue.  Per "step", the memory consumption does pretty much double. The "step down" in memory takes 1-2 hours before stabilizing on a lower level.
According to our statistics, the number of keys remains constant - less than 100 of which 15 belong to the caches and the rest being TTLed-locks. The number of keys (entries) per cache is also constant - with either well below the size ceiling or the LRU is recognized (=ceiling not exceeded).
I'm wondering whether somebody has seen a similar issue?
With Redisson 3.10, there's a new option to determine the size of an RMap - so we'll use that to investigate further - but I suspect that the size of individual cache entries (which, in theory, could cause this) is not the reason. If we had huge entries, we'd expect to see a recovery after the TTL period, but this is not the case.
Just from gut feeling, it feels as if this is somehow related to a replication - that would at least explain those "steps" to some degree.


1969
ClassCastException in Netty/Redisson when executing RMapCache.valueSize(...)

We are using an AWS ElastiCache Redis 4.0.10 cluster with Redisson 3.10.3 and following a
cache.valueSize(id);
where cache is a RMapCache we can spot the following in our logs:


1970
Is it  possible to impor  MultiLock  trylock performance?

This is a extreme situation, I need get a multilock that contain tens of thousands of locks, It will take several minutes, Is it  possible to impor  MultiLock  trylock performance?


1971
Bug: Tomcat with 'updateMode=AFTER_REQUEST' will not remove attributes

Hi all!
We use Redisson with the tomcat-8 integration. Because this is a legacy application with mutable session objects we have to use updateMode=AFTER_REQUEST.
The problem we faces is that this update mode will not be able to sync removed attrbutes to redis and inform other running tomcat instances. This is bad because our other instances of Tomcat ends up using removed attributes.
It's actually easy to spot the bug if one inspect RedissonSession.java#L267-L276:
You can see that removeAttributeInternal only does publish the removed attribute if updateMode=DEFAULT. This would be fine if Redisson somehow stored which attribute names which was removed so that they also was synced in the store function triggered by  the UpdateValve.
The problem is that store will only save the current attributes (see RedissonSession.java#L278-L303) on the session, and not the removed attributes. Handling removed attributes will require that Redisson  keeps control of both the added and the removed attributes within one request cycle (the same attribute may be added and removed multiple times).
How can this be fixed?
Solution 1: relax AFTER_REQUEST
I would argue that you actually want all session attributes to be synced as soon as possible. But in the rare scenario where you operate on mutable session data you would do an extra force-update after the request completes.
The proposal would be to replace AFTER_REQUEST mode with FORCE_UPDATE_AFTER_REQUEST. Then all addAttrbiute & removeAttribute should be synced as soon as possible, the same way you get with the DEFUALT mode today. But in addition you will get all attributes synced after the request completes. This would be easy to implement as it will only require removal of the if-guard inside the removeAttributeInternal function.
It could also be beneficial if one is able to specify a white-list of attributes known to be immutable.
Solution 2: Redission keeps track of removed attributes
In this solution Redisson needs to keep track a map of removed attributes during a request cycle and make sure to remove these attributes from redis and notify all other tomcat instances. This will be more complex to implement correctly than solution 1.


1972
the last version can be used to AliyunRedis?

and how i configuration it ?


1973
RedissonMultiLock should implement RLock interface

No description provided.


1974
none




1975
High memory consumption in netty theads

We are on version 3.7.2 and only using RMap, RScoredSet and are facing the same issue in production where netty threads used by redisson consumed 12GB of total 16GB of allocated heap space in one application and 8GB out of 16 GB on another application . One observation i have made is that netty threads had created around 275,000 thread local maps with each consuming around a fixed amount of heap. It all seems to be related with weblogic context aware classloader because it is shared by all the netty threads.
Since the heap dump is quite large I will be attching the screenshots.
@mrniko setting  -Dio.netty.allocator.useCacheForAllThreads=false had no effects


1976
Security Breach - password passed in exceptions

When an exception is thrown upon the AUTH command the exception contains the actual password as a param. This happens because LogHelper.toString called by RedisConnection.async nowadays accepts a "Object..." all the time, and LogHelper redacts the password only when a single object of the type CommandData is passed.


1977
RMapCache eviction fails if process is terminated

I am using RMapCache to handle my distributed collections.
When adding to the map, i use:
So the key should expire after 20 seconds. This works, if the process is not terminated before the expiration timestamp. However, if the process dies for any reason, the key never expires.
By observing this behavior, I have concluded that is the Java process that makes the Key expire. I would like Redisson to use Redis EXPIRE behavior for keys, so that the Java process is not responsible for expiring the key.
This way, i will know for sure that the key will expire after the given time, even if for any reason the java process dies.
Is this possible to do with Redisson?


1978
RStream.readGroup method doesn't handle empty result properly with Redis 5.0.3

No description provided.


1980
Connecting to a sentinel Redis 5.0.1 server fails with `NOAUTH Authentication required`

I should be able to connect to a sentinel node of Redis 5.
I am trying to connect to the sentinel node of a Redis setup in AWS, and I am getting the message:
NOAUTH Authentication required.
Steps to reproduce or test case


1981
Connecting to a sentinel Redis 5.0.1 server fails with `NOAUTH Authentication required`.

I should be able to connect to a sentinel node of Redis 5.
I am trying to connect to the sentinel node of a Redis setup in AWS, and I am getting the message:
NOAUTH Authentication required.
Steps to reproduce or test case


1982
Poor performance when using ReplicatedMode

Hi,
For a while I've been using a single redis instance, therefore configured in SingleServer mode. Recently I decided to add a read replica into the mix for failover protection. Also assumed I would get a performance boost too... I was wrong!
Below are some performance results. The test writes 10,000 objects into the cache with a random key. The test runs 10 times. For each key, I measure the time it takes to do a GET & PUTASYNC.
The results are really surprising;
The ReplicatedMode is MUCH slower than SingleServer using the default read mode.
Changing to MASTER_SLAVE read mode helps, but it's still much slower with lots of spikes in the perf.
Average is pretty good and the max is usually much less than 100ms.
ReplicatedServers Mode
Average is quite a bit slower here but the max is massively slower!
ReplicatedServers Mode using ReadMode.MASTER_SLAVE
Things get interesting here. Averages are all over the place, low as 1.9ms but high as 25.7ms. Max is generally lower, but it's still eratic.
So, my questions are;
Is this expected? I assumed replicated mode would be a performance improvement.
Is there anything I can do to improve this. If I can get the replicated performance similar to single server that would be ideal, if possible. Right now the only option might be to not have a read replica which will be a real shame.
Thanks in advance!
Details


1983
CommandAsyncService produces RedisExceptions without a causal exception

RedisException stack traces from CommandAsyncService should contain a causal exception wrapped inside a Redis exception. At least that's what I would expect from this code in CommandAsyncService:
I'm seeing a small number of sporadic RedisException stack traces without any causal information. This is all there is:
Looking at the redisson code, I can't quite see how we would end up with an unsuccessful future without an exception.
Is the causal exception swallowed somewhere?
Are there conditions under which the future can fail without an exception?
Steps to reproduce or test case
No test case unfortunately.
This happens very sporadically, and only under load.


1984
none




1985
Does redisson use of jackson for serialization of a custom class annotates said class with JsonTypeInfo?

According to Redissons documentation, it uses Jackson as JSON codec, using the @Class field to store the type.
How does redisson set this configuration to jacksons object mapper? The only way i know is to decorate the class with the @JSonTypeInfo annotation, but this means that for every serialization / deserialization of the class, the @Class field will and needs to exist.
I have a rest service that receives a json of a custom class without the @Class annotation, so i cannot afford jackson to always require the @Class field in deserialization.
Will using said custom class in a RBucket cause my custom class to be annotated by JsonTypeInfo, if not, how does redisson manage to set that for some deserializations of a custom class a @Class field is required, but for others it is not?


1986
RBucket does not support GetAndSet with a TTL for the set operation

I want to do a get and a set simultaneously but the getandset() method of the RBucket does not support setting a ttl for the key.
I have tried to use an RTransaction and obtaining the bucket from the transaction instead of the client, but calling get() on the bucket always returns the value.
Is there any way to perform a get and a set with ttl using the RTransaction for RBucket types?


1987
Error deserializing RBucket with jackson Codec

I am using lots of RBuckets which serialize with Jackson Codec:
        config.setCodec( new JsonJacksonCodec());
In a stress test environment, sometimes happens that i get an error when asking for the value of a bucket, and i see that the problem is in the deserialization of the JSON:
Any idea what is happening? The error seems to be totally random and non deterministic. Redisson handles serialization and deserialization entirely, so i do not know how an invalid character is being stored in Redis.
Is there a way i could attach to a listener to gain some insight on this process? Something like being notified right before saving the bucket to redis, so i can check for that character (CHAR-1) or when reading?


1988
Add getMultiLock, getRedLock methods to RedissonClient, RedissonRxClient and RedissonReactiveClient interfaces ·88

No description provided.


1989
spring boot started incorrectly, but unlocking can work properly ·89




1991
java.lang.NoClassDefFoundError: org/hibernate/cache/spi/support/DomainDataRegionImpl

No error
When starting hiberate-redisson53 with hibernate-core-5.3.2.FINAL i got this error


1992
Redis Clients always use the same Sentinel

When using Sentinels with Reddison 3.10.4, the reddison clients always select the same sentinel server due to the predictability of the backing ConcurrentHashMap
In a large enough cluster this causes the CPU load on that Sentinel server to be considerably higher than the other servers.  The following PR
#1979
Shuffles the sentinel list so that clients distribute the load to all sentinel servers.


1993
Where are configured cache settings ? ·93

Hello,
I am using dropwizard. The factory class and redisson.yaml path  is configured in config.yaml in databsase properties
hibernate.cache.region.factory_class: org.hibernate.cache.ehcache.SingletonEhCacheRegionFactory
Where should i configure cache settings, in the same file ? From where redisson read this properties ?
Thank you


1994
Error: java.lang.NoSuchFieldError: INSTANCE on start

Hello
I have changed to hibernate-5,2,2,Final and redisson-hibernate-52
And i'm getting this error on start up


1995
Redisson 2.15.2 didn't support jdk6

As the document said, Redisson 2.15.2 should support jdk6.
Redisson 2.15.2 didn't support jdk6
Steps to reproduce or test case


1996
Acquire multiple permits when using the PermitExpireableSemaphore

Redisson includes an implementation of the permit expirable semaphore which can only acquire or release a permit. This may limit the usage. I added the interfaces that acquire or release multiple permits at once by adding a sorted set to memorize the permits acquired each time. It works in non-fair mode.


1997
none




1998
RoundRobinLoadBalancer not load balance reads

I am using following basic code to point to elastic cache configuration endpoint. (I have also tried adding all 6 node addresses, but no change of behavior).
I have an elastic cache cluster with, 3 shards (2 nodes each, 1 replica)
When I just put 10,000 to a cache, and later read them, in cloud watch I can see cache hits coming only from one node(first node). But cache size in bytes in each node shows each node keeps replicas of the data set. I would like to distribute the reddison read requests among read replicas.


1999
Redisson 3.10.4 usage with managedexecutor as external executor service gives lifecycle shutdown method errors.

Upgraded from 3.8.2 to 3.10.4 Redisson community version and started seeing this error as we use Redisson in a Jboss application server with managed executor service.
Does this create any issues with Redis behavior?
The managed executor spec considers this as valid behavior.


2000
Question :  Redis (cluster mode enabled) Cluster's Endpoints

Hello,
Its a Question and NOT an issue
Currently we are using Redisson with our self-compiled and installed Redis Server on an ec2 instance and due to scalability concern, we are moving with AWS ElastiCache Redis Cluster.  Already our application is using Redisson Library, not just as a client, but also our application heavily using acquire Lock and Unlock on any given key using either "RLock" or "RReadWriteLock"
Now, I have aws ElastiCache Redis (cluster mode enabled) Cluster's Endpoints and Node Endpoints - but I am unable to connect to Redis Server;
I followed this Redisson Configuration Wiki -  I tried
Neither configuration was able to connect to Redis Cluster. I can connect to these server using Redis CLI, however with Redisson Library, I am not able to connect.
Please can someone help me with some sample example with Redisson Config to connect Config/Primary Endpoints.


2001
none




2002
redisson client  connect sentinel to Read Data

I init client like this :
But error reporting when I run the program , please see the following exception information:
The server's IP is the sentry machine's IP,What's the problem?


2003
ERROR org.redisson.client.handler.CommandDecoder - Unable to decode data.


No exception and return the command result


2004
Map entry listener when application scale(multiple replicas) for RMapCache

My application running with multiple replicas, so each replicate have map entry listener
I am doing some task (database update) on entry expire, so in my case, each replica get notify and each replica executes update query in the database.
Any solution/suggestion to avoid this scenario.


2005
removeListener method of RTopicReactive and RTopicRx interfaces throws NoSuchMethodException

No description provided.


2006
Improvement for YAML Support: Read from a child yaml block

Current YAML support expects to provide separate YAML file which has redis configs only. But in real world, redis clients will be used with in a  main application(which also bootstraped from a main yaml file).  It's convenient to support creating Config from a block of some main yaml file as follows.
Even now I can get ClusterServersConfig created pointing to the clusterServersConfig block as in following example, but Config API does now allow to pass a ClusterServerConfig.
Suggestion:
If you can make Config class's following method public, then users can inject ClusterServersCondfig(or any other type) and create a Config object from a existing big yaml file.


2007
Pub/sub subscriptions lost on master failover

When a primary node fails over, redisson appears to detect this and correctly pick up the new primary. However, after this point, pub/sub subscriptions no longer work.
This occurred in our production env when AWS Elasticache triggered a failover by itself. I was able to reproduce using.
Here's a log from the client during the failover:


2008
Springcache @sync allowNullValues set false not work




2010
Error deserializing Json with Optionals after version 3.10.1. Object mapper behaves unexpectedly  · 10 ·

Deserializing Jsons that contain Optionals. In buckets or maps, with JsonJacksonCodec or TypedJsonJacksonCodec
ObjectMapper does not behave as expected, it does not deserialize Optional even though the provided ObjectMapper has the JDK8Module.
The issue resides in org.redisson.command.CommandAsyncService#getCodec. More specifically:
I've managed to trigger NoSuchMethodException (by providing an anonymous class JsonJacksonCodec() {}) there so that  codecToUse = codec; ObjectMapper works this way.
ObjectMapper is replaced in org.redisson.codec.JsonJacksonCodec#createObjectMapper
Steps to reproduce or test case
Try to deserialize any object that contains an Optional.


2011
Add remainTimeToLive method to RLock object

No description provided.


2013
o.redisson.client.handler.CommandsQueue  : Exception occured. Channel:




2014
JCache.getAll throws RedisException: too many results to unpack

All entries are returned.
A RedisException is thrown:
Steps to reproduce or test case
Add more than 10k entries to a JCache.
Just wanted to wonder if it is a correct behavior and there is just a limit of entities I can retrieve in one batch or it is actually a bug somewhere.


2015
none




2016
none




2017
Fetching data from RMap is slow. 11000 entries in RMap taking total 207mb. Is there  a way to make it fast. Every minute my cache is updated. so,I want to fetch all entries in RMap every minute.

RMap containing 11000 entries(RMap<String, Map<Integer, Data>>). Total size 207 mb.
Time taken to retrieve all keys - 8-10 seconds.
My Rmap is getting updated every minute. So i need to get data from RMap every minute
Is there a way to fasten get call.


2018
RLock.unlock method returns true if lock doesn't exist

No description provided.


2019
none




2020
Tomcat Session Manager issue in Load Balance environment with redMode MEMORY

We have a 2 instances of tomcat running in front of apache (with sticky session).
We have a single redis instance and we are using the redisson tomcat 8 session manager (setup in the context.xml in the /conf dir). Version redisson-tomcat-8-3.7. Tomcat version 8.0.32.
This is similar to bug #1311 . We have a session timeout of 30mins.
What is happening:
User logs onto instance 1, session created.
User uses session on instance 1
Apache loadbalancers the request over to instance 2 (perhaps load was too great on instance1)
New session created on instance 2 and loaded with session info via redis, user carries on without loosing session. All good so far.
15 mins later user makes another request and apache loadbalancers back to instance 1. User carries on without issue.
User keeps using their session on instance 1.
7)On instance 2 the session timesout after 30 mins. This then invalidates the session on instance 1 even though the user is still using it and user looses session . This is the problem.
It seems that  in RedissonSessionManager.java -> startInternal() -> onMessage() when receiving a AttributesPutAllMessage is NOT updating the timing on the session (at least in readMode MEMORY)  and then tomcat MangerBase times the session out. I can see session values session:lastAccessedTime and session:thisAccessedTime are sent in the map, however debugging into superSetAttribute() on Tomcat 8 does NOT update these member variables, and therefore the session timesout.
I made a local patch to test my thoery by calling session.superEndAccess() instead:
This now works as expected. However I'm not sure this is the best implementation and looking for your guidence/fix. This is consistently reproducable.


2021
none




2022
redis server response timeout (3000ms) occured for command

This paper:
I tried many way, but there has been no redis overtime this solution. Hope to get a great god for help, thank you.


2023
Redisson sessions that never dies - missing TTL

For the record, we are using Redisson 3.10.4 with Redisson Tomcat 8.
In som cases we end up with shallow sessions without a TTL that fills up Redis. These junk sessions should probably not end up in Redis in the first place, but due to our complex application that is the situation for now. Anyway, there should be a guard in the Redis code that avoid sessions beeing created without a TTL. I'll explain why this happens and a suggestion for a solution which we are running ourselves in production.
This particular case arises when a request includes a session id which is neither stored locally in Tomcat or in Redis and it is immediately abandoned(no more interaction with the session). Then the public Session findSession(String id)  code in RedissonSessionManager is triggered, it doesn't find the session of course, but a new empty session is created and persisted in Redis where they stay forever. The fix is obviously to setMaxInactiveInterval on the session, which we in fact have done. But to accomplish this we have overriden the default RedissonSessionManager with out own custom RedissonSessionManager and added only session.setMaxInactiveInterval(getContext().getSessionTimeout() * 60), reusing the logic used when creating new sessions. Ideally we wan't to avoid having a custom RedissonSessionManager to solve what should probably be part of the default RedissonSessionManager.
@mrniko Could you please add this task to the next milestone?


2024
Improve Write Behind and Write Through strategies

Reconsider MapWriter object - introduce two methods instead of current four.
Remove MapOptions.writeBehindThreads setting
Add MapOptions.writeBehindDelay setting
Add MapOptions.writeBehindBatchSize setting


2025
Use RMap<String, Map<Integer, Integer>> show exception: java.lang.ClassCastException: java.lang.String cannot be cast to java.lang.Integer · 25 ·

when user RMap
throw java.lang.ClassCastException: java.lang.String cannot be cast to java.lang.Integer


2026
none




2027
Whats the meaning of freeConnectionsAmount?

Hi
When our server reach some load we are getting this errors from Redis:
I have read a lot about this error in the issues but i cannot find how to solve :-(, what i have notice is that the freeConnectionsAmount is equals to 1, can this means that our code is unable to create more connections and this is what is causing the problem? I also see that freeConnectionsCounter=64 so this means that there are free connections?
Redisson version: 3.10.1
Best Regards.


2028
none·




2029
WARNING: Illegal reflective access by org.redisson.misc.URIBuilder

Hello, i have just migrate my project from Java 8 to Java 11 and i have encounter the following warning message when i am loading a redissonClient:
I am using Intellij IDEA 2019.1 (Community Edition), Java 11, Redisson-3.10.5, on Windows 10 and Ubuntu 18.04.
Does anyone has the same issue? Thanks


2030
 ERROR CommandDecoder - Unable to decode data. reply: $85998717

I am doing a POC on Redisson. We added 600K  records as List into Rmap
While doing dlMap.get(key); it is causing the above error.
The good thing is , it is working fine if users list is 150k.
UserList is a list of Users object. is there a way i can get rid of this issue. or even better if i can get a particular user object say having user.getId = 181062
Thanks for the help in advance.


2031
hadoop - yarn application failed due to Error: io.netty.util.internal.StringUtil.indexOfNonWhiteSpace with redisson-3.10.5

Hadoop yarn application should run successfully
2019-04-07 23:15:58 INFO  [THREAD ID=LTM-worker-thd-128] Job:1406 - Task Id : attempt_1554192178061_15274_m_000003_2, Status : FAILED
programatic configuration with sentinel servers


2032
NullPointer 3.10.6

No NullPointer Error


2033
(redisson-tomcat)Can't connect to sentinel server. Unable to connect to: redis

Can't connect to sentinel server. Unable to connect to: redis:


2034
connection error when Redis Cluster deployed in kubernetes fail over

Redisson is not able to send request to redis cluster deployed in kubernetes when master/slave are down.
Below are the exceptions caught when requests were sent to Redisson; the exceptions are alternating (i.e. I got exception #1 in one request - then got exception #2 in an other request for the same test)
exeception #1:
exception #2:
Steps to reproduce or test case
Deploy redis cluster in kubernetes (3 masters: redis-cluster-0, redis-cluster-1, redis-cluster-2; 3 slaves: redis-cluster-3, redis-cluster-4, redis-cluster5)
Kill redis-cluster-0 and redis-cluster-3.
Wait for redis-cluster-0 and redis-cluster3 to have state RUNNING and READY
Kill redis-cluster-1, redis-cluster-2, redis-cluster-4, redis-cluster-5
Send requests to see exceptions
I am using redisson reactive clien


2035
FstCodec can't deserialize ConcurrentHashMap based object with package visibility

No description provided.


2036
[Promotion] scan get results in an unperdictable order  on redis-cluster mode

In  Redis cluster mode, when we use scan to get the keys with in a pattern mode like (test_key*), we want to get the results in a certain order.
In  Redis cluster mode, when we use scan to get the keys with in a pattern mode like (test_key*), in on redis instance, we can get the keys in order, bug in different nodes, the order is random.
Steps to reproduce or test case
1: a redis cluter with 2 master and 2 slave
2 put kv like :
3 : we scan the keys with test_key* in the following way
Some times we get the reuslt :
while some times ,we get the result :


2037
RedissonLock.renewExpiration will refresh forever

If the lock key no longer exist the refresh should cease
The renewExpiration() method ignores the return value of renewExpirationAsync() and reschedules itself forever
Steps to reproduce or test case
Should be as simple as manually removing a lock entry key from redis.
On a side note, another thing we noticed while looking into this is that renewExpirationAsync() does a scripted call that returns 0 or 1 depending on HEXISTS. It seems unnecessary as according to the redis docs about PEXPIRE, it does the same thing out of the box in a single command call.


2038
Password support for sentinel.conf requirepass config option

Sentinel support for authentication with password was added in Redis 5. Redisson will authenticate to Redis Sentinel's started with requirepass <password.here> in sentinel.conf.  The work around for now is to simply have the sentinel's not run in protected mode even if Redis Master/Slave instances have password requirements.  This works, however when auth is required on the sentinel nodes (as set by sentinel.conf requirepass <foo.bared.blahblahblah>) themselves, RedissonClient cannot perform commands to the sentinel nodes (Sentinel Sentinels, Sentinel Master, yada yada)
Commit adding authentication support for sentinels: is that RedissonClient sends the auth with a password value that's set in a config.
Redisson does not appear to authenticate with the redis password stored in BaseConfig, and there doesn't appear to be a place to add one in the SentinelConfig.  On Spring boot application with redis password set and requirepass in sentinel.conf, startup has the following error:
Steps to reproduce or test case
Start a Redis Master, Replica, and Sentinels all with requirepass set to some value, then attempt to get RedissonClient with SentinelServersConfig set up, setting password to whatever your password is, master name to whatever your master name is, and your nodes as appropriate.
Due to sensitive nature of passwords, names etc, these will remain abstracted in my configuration snippet here.  None of these values are null, they are all set via a configuration setting.


2039
java.lang.NoClassDefFoundError: com/fasterxml/jackson/core/type/WritableTypeId

In springboot 2.1.4
the jackson-core version is 2.8.7
How can I resolve this version conflict?
I tried to filter the jackson-core in spring json, but it didn't work.


2040
Add support for Reactive and RxJava2 interfaces for RemoteService object

No description provided.


2042
WriteRedisConnectionException HANDLING

handle org.redisson.client.WriteRedisConnectionException for example same way as others in spring CacheErrorHandler
I try sentinel, master-slave and also single server redisson config. In each configuration is problem when cached method with sync=true and connection to redis server is broken or redis server is down.
IF WE USE method without SYNC=true then exception is similar but is HANDLED by org.springframework.cache.interceptor.CacheErrorHandler and is behavior OK


2043
Possibility of broken connections on the pool

When using a fixed connection pool of min=64 and max=64 to every node (masters and slaves) on cluster config. Redisson is able to open a healthy connection pool of 64 to each of the nodes
It seems that on some cases when our app container (dockerized app) starts there might be some network/warm up issues (also seen by getting a few CLUSTER_NODES and CLUSTER_INFO timeouts during startup) leads to some connections on the pool to be broken. No issue is easily observed at low traffic after but after increasing a bit the load, it seems some requests to those instances (we deployed 20 instances and 2 ended up like this) fail with timeouts. This doesn't seem to happen to instances that started and opened all the connections properly at startup but seems this faulty startup instances remain in a broken state and do not recover and/or re-create those broken connections.
On any case, as said, this only happens on those cases during startup. So that's our primary hypothesis. If any logic can be put into place to deal with potential broken connections on the pool or some monitoring of the pool we can enable or some config we could do differently. Please advice
example timeout:
Steps to reproduce or test case


2044
none




2045
RedissonSemaphore doesn't take linux machine's down into account, like RedissonLock do

when machine is down, RedissonSemaphore should release it never released.
Steps to reproduce or test case


2046
UpdateValve should be removed from engine pipeline in RedissonSessionManager instance stopInternal method

When ReddissonSessionManager is stopped using stopInternal() it should clean all supporting valves that were added into engine pipeline
RedissonSessionManager will leave UpdateValve in the engine pipeline
Steps to reproduce or test case
Redisson configuration


2047
UpdateValve is executed outside application classloader

without application classloader which could lead to ClassNotFoundException
Steps to reproduce or test case


2048
Maven build fails with: Failed during checkstyle configuration: cannot initialize module SuppressionFilter - Unable to find: suppressions.xml

Maven build to be successful
Maven build fails with Failed during checkstyle configuration: cannot initialize module SuppressionFilter - Unable to find: suppressions.xml
Steps to reproduce or test case
Do mvn clean install on root directory


2049
none




2050
about helm redis-ha deploy

i deploy https to kubernetes use helm. default values.yaml.
java client startup error:
At least two sentinels are required
why?
but use Replicated mode it's ok.


2051
none




2052
none




2054
Redis Cache Read Latency Increase with Time

We are using ElastiCache Redis (version 5.0.3) as our cache server and Redisson 3.8 as our client.
Here are the write and read code.
We find that with time on, the cache read latency will increase, for example,
after the deployment, in the first 3 days, the latency is almost same, keep 2 to 3 milliseconds.
in the next 3 days, the latency can increase to 20 milliseconds. It will keep increasing.
This latency increase has no relation with traffic.
At the same time, I find that that the redis cluster cache miss provided by AWS (The number of unsuccessful read-only key lookups in the main dictionary. This is derived from keyspace_misses at Redis INFO.) will increase from the very beginning (after the deployment).
We can do deployment to fix the issue.
After the deployment, the latency and cache miss go to normal.
Please help me to fix the issue.
Thanks.


2055
none




2056
JCache.removeAll method doesn't notify Cache listeners

No description provided.


2057
Numerous RedisConnectionException :Can't aquire connection to...

Numerous RedisConnectionException occur in production environment for no apparent reason.
The same deployment is used in other production environments without problems.
The first guess would be a configuration or environmental issue.
The stack trace is:
The error probably happens when trying to read data from Redis cluster as I see access to "SlaveConnectionPool".
Please note we set an expiration time for each entry in the cache.


2058
RListMultimap Listener

Hello friends
Actually I'm new at working with Redis and Redisson. I'm going to develop a client server application in which multiple clients send an image(my data type) and a key to a unique server.
So I've selected RListMultimap as my desire data structure.
Inserting and retrieving data is ok but I need a listener to be fired whenever a new data enters to my RListMultimap.
I've looked for it on the documentations but I haven't found any thing yet.
I'll be thankful if any body helps me.


2059
Add Async, Reactive, RxJava2 interfaces to JCache

No description provided.


2060
none




2061
Wrong logic for Map in RedissonLiveObjectService:persist method

In RedissonLiveObjectService class, while copying and persisting map Entities in persist method, the "for" loop just accesses empty Redisson map instead of right map object, it causes no any map entity is copied and persisted into redis.
Redisson version: from 3.5.3 to 3.10.6


2062
Redisson no longer supports auth in sentinel clusters older than Redis 5.0.1

As of version 3.10.5, Redisson no longer supports sentinel clusters that have a master password but no sentinel password. The commit 4ee3074 changed the MasterSlaveConnectionManager to set the sentinel and master password to the same thing so if they differ the client will be unable to connect. This breaks any software using Redisson that connects to a sentinel Redis cluster with a password that is older than 5.0.1, when sentinel auth was added.
A potential solution would be to add a sentinelPassword field to the SentinelServersConfig class representing the sentinel password and have the existing password field only represent the master password. It would change the meaning of the existing password field as well as force the MasterSlaveConnectionManager to be aware of the sentinel password, so that fix might require some thought from someone more familiar with the codebase than I am.

Redisson should be able to connect to a sentinel cluster with the following configurations:
A master password but no sentinel password
A sentinel password but no master password
Different passwords for the master and sentinels
The same password for both the master and sentinels
No password for either
Only the last two are currently supported in Redisson. Redis as of version 5.0.1 supports all of them and before version 5.0.1 supports 1 and 5.

Attempting to connect to a cluster with a master password but no sentinel password and giving the client the master password results in this error:
org.redisson.client.RedisConnectionException: At least two sentinels should be defined in Redis configuration! SENTINEL SENTINELS command returns empty result!
This does not cause an error in 3.10.4. The same error occurs if the master and sentinel passwords differ and the client is given the master password.
Attempting to connect to a cluster with a sentinel password but no master password and giving the client the sentinel password results in this error:
The same error occurs if the master and sentinel passwords differ and the client is given the sentinel password.
Steps to reproduce or test case
Start a redis master/slave cluster with requirepass and masterauth set to password
Start 3 sentinels with auth-pass set to password and either requirepass set to differentpassword or no requirepass set at all.
Set the password in the sentinel config to either the master password password or, if set, the sentinel password differentpassword.
Attempt to connect to the Redis cluster.


2063
Redisson 3.10.6 with liferay 7.1 tomcat 9 and redis 5.0.4

No exception
On liferay / tomcat start i see this error:

Steps to reproduce or test case


2064
Reference leak on timeout of async operations in 3.10.3+

Timeouts of async operations should not produce reference leaks.
Timeouts of async operations appear to produce a reference leak, in the form of a listener to the shutdown promise associated with the connection manager.
Steps to reproduce or test case
Perform async Redisson operation (e.g., BlockingQueue.pollAsync) with a short timeout in a loop (allowing the timout to expire). Observe growth in memory usage over time, and/or inspect with VisualVM or similar.
issue appears to have been introduced in 3.10.3 in CommandAsyncService.handleBlockingOperations, around line 975. When the AtomicBoolean "skip" flag was introduced, a statement removing the listener from the shutdown promise on timeout was removed. I believe removing the listener would eliminate the leak. Here is a screenshot of visualvm inspecting a heap dump showing the reference chain.


2065
Add Local Cache for JCache

No description provided.


2066
Rename RListMultimap then set value in map , but old value can not output




2067
redisson don't detect if new sentinel added to sentinel group.

Steps to reproduce or test case


2068
Composit codec getMapValueDecoder confuse

CompositeCodec.getMapValueDecoder uses mapValueCodec.getMapKeyDecoder() instead of
mapValueCodec.getMapValueDecoder()
Is it a typo?


2069
RedisTimeoutException: Unable to get connection / Command execution timeout for command

I have two types of RedisTimeoutExceptions as below.
Can anyone give me an advice on how to fix this error?


2071
NullPointerException and ClassNotFoundException from trying to decode values




2072
RRateLimiter allows permits exceeding

During first permits aquisition call RRateLimiter allows to acquire permits more than defined in rate.


2073
MILLISECONDS option added to RRateLimiter.RateIntervalUnit object

No description provided.


2074
Is this a bug of Redisson?

Error Message


2076
Which API is used to monitor expired keys?

Which API is used to monitor expired keys?
Jedis:
Redisson? I didn't find it.


2077
Redisson Pub/Sub Successful, but RTopic publish method return 0 when use cluster and register some executor service workers

the subscribers should be 1
the actual is 0
Steps to reproduce or test case


2078
om.fasterxml.jackson.databind.exc.InvalidDefinitionException: Cannot construct instance of `org.redisson.codec.FstCodec`, problem: sun/misc/Unsafe

in jboss can't use org.redisson.codec.FstCodec


2079
10X Performance boost for JCache.putAll method

No description provided.


2080
none

[]


2081
none




2082
none




2083
Redis Cluster issue while using Redisson

Hi, 
We have 3 master and 3 slave node redis cluster architecture and
we're trying to put around 16000 keys in redis cluster cache.
Out of this 16K keys all the keys are distributed on all the 3 master node(based on hash slots).
each of the master nodes gets ~5k approx successfully But below error is printed near about 15744 key(sum of all the keys on 3 master nodes collectively).
We are completely stuck on this as out of 16k keys 15743  keys gets successfully but on 15744th key its thows the above exception every time.
Can anybody please let me know when we get this error & what should I fix to eliminate this error.
All the key put will be successful
Getting exception" java.lang.IllegalArgumentException: 16 > -1"
Steps to reproduce or test case


2084
UpdateValve needs to execute manager.store only once at the end of the request

UpdateValve needs to execute manager.store only once at the end of the request
UpdateValve could invoke manager.store() multiple times per request processing, for example if the request processing involves includes and/or forward of the request to another servlet/jsp to complete request processing
Steps to reproduce or test case


2086
none




2088
NIO - when does read happen?

I'm reading the source code of Redisson and I'm having a hard time tracing down when the read operation happens during the whole NIO thing with Netty. I'm not seeing OP_READ being explicitly set, or read() being called... The closest part I'm able to see, is: from processSelectedKey in NioEventLoop, but it doesn't make too much sense to me...
I was able to figure out how the write part works, and I'm sure I must have missed something... Can someone please help me understand this? Thanks!


2089
"Unable to send command" from time to time

Hello,
I'm using for tests Redis 4.x version on a single master node with a Redission java client.
I'm making concurrent hget requests trough getMap().get() from about 20 threads.
nettyThreads is configured to 100


2092
none




2093
none




2094
ERROR Exception occured. Channel:| CommandsQueue.exceptionCaught(153)

Running for a while will happen.


2095
is this is a bug ? release() method in org.redisson.pubsub.AsyncSemaphore.java

should this line be :
please check ,thanks


2097
Exception when use RedissonRedLock + RedissonMultiLock

I'm trying to introduce RedLock algorithm in my project, I have 3 Redis nodes, and I need to lock several keys in each thread. Here is my implementation:
no exception
Got exception with message: ""org.redisson.RedissonMultiLock cannot be cast to org.redisson.RedissonLock""
Steps to reproduce or test case
the root cause is this code in method tryLock(long waitTime, long leaseTime, TimeUnit unit) of class RedissonMultiLock.java:
It trys to cast rLock to RedissonLock, but in my case the rLock is RedissonMultiLock. By this implementation, RedissonMultiLock actually can not group any RLock types but RedissonLock.


2098
Get data sanity after RBuckets get error.

Because of some errors, Our redis mixes some different serialized data
Some data use StringCodec. Some Data use JsonJacksonCodec.
In this case, when using mget get data, if the <n-1 of result of mget have a decode error, then the ByteBuf will not be cleaned up, causing the next command to get the wrong data.
getStringValue("test3") return test3
getStringValue("test3") return test1
Steps to reproduce or test case


2099
RedissonFairLock timeout drift

We've discovered additional conditions that produce timeout drift as originally described in #1104. To summarize the issue, we see that the timeouts in the redisson_lock_timeout sorted set created by RedissonFairLock can gradually increase over time to be hours or days in the future despite the queue only containing less than 10 threads; this condition continues until the fair wait queue empties, or one of the threads dies and the rest of the threads are forced to wait for the far in the future timeout on the dead thread to lapse (this creates a dead lock-like situation).
I'll provide a PR to follow shortly with test cases and proposed changes to fix the issue. We greatly appreciate feed back on any misunderstanding of the issue described here and will do the same for feedback on the PR.
The expected behavior is that which is documented in the second paragraph of 8.2 Fair Lock:
All waiting threads are queued and if some thread has died then Redisson waits its return for 5 seconds. For example, if 5 threads are died for some reason then delay will be 25 seconds.
As an example that replicates this documentation, given we have 7 threads trying to take one lock, we expect the redis data structures to contain roughly the following after a 7 threads try to acquire the lock once using RLock.tryLock(threadId) in order with short delays between:
1) lock name of the 1st thread
2) "1"
3) lock name of the 2nd thread
4) lock name of the 3rd thread
5) lock name of the 4th thread
6) lock name of the 5th thread
7) lock name of the 6th thread
8) lock name of the 7th thread
9) lock name of the 2nd thread
10) lock timeout + 5s
11) lock name of the 3rd thread
12) lock timeout + 10s
13) lock name of the 4th thread
14) lock timeout + 15s
15) lock name of the 5th thread
16) lock timeout + 20s
17) lock name of the 6th thread
18) lock timeout + 25s
19) lock name of the 7th thread
20) lock timeout + 30s
In the above we see that the 7th thread will need to wait 25s after the lock expiration (based on the lease time) until it can acquire the lock if the 1st to 6th threads die.
Additionally, we expect that when a thread leaves the queue voluntarily either by wait timeout or by acquiring the lock, that timeouts adjust regardless of where the thread was in the queue. For example, if the 3rd thread in the above example left the queue via a RedissonFairLock.acquireFailedAsync call due to wait timeout, the sorted set would then be expected to be:
1) lock name of the 2nd thread
2) lock timeout + 5s
3) lock name of the 4th thread
4) lock timeout + 10s
5) lock name of the 5th thread
6) lock timeout + 15s
7) lock name of the 6th thread
8)  lock timeout + 20s
9)  lock name of the 7th thread
10) lock timeout + 25s
And the 7th thread would then only need to wait 20s after the lock expiration to acquire the lock if the other threads died.
In one of our usages of redisson we use the fair lock using 3-6 servers using each a single instance of Redisson running roughly the following code in one thread per server:
We observe that since the work done within the locked portion of the code can take only ~100ms that the 6 server threads running this code quickly churn through the lock queue without issue, though a queue is always present since there is little time between when each thread unlocks and locks again. If we take periodic snapshots of the redisson_lock_timeout sorted set, we tend to see that the timeouts increase in increments of 5s over time until the timeouts are hours or days in the future. If one of the servers is killed, then we observe that the other servers stop doing work and are timing out trying to get the lock due to the dead server's lock holding the first position in redisson_lock_queue with a timeout in redisson_lock_timeout that may be hours or days in the future. We expect that under the case that we lose one server of 6, that the timeout values will be in the range of 10 to 35s in the future at any one time (5s lease time + 5s thread wait time * position in queue). It may be said that the above lock usage itself may be foolish, but its mostly working except for the chance of deadlock.
Steps to reproduce or test case
I'll provide a PR for this issue to follow with additional test cases added to RedissonFairLockTest. However, what we started with was a modification of the testTimeoutDrift where we changed the wait time from 500ms to 3s and changed the lock holding time from 30s to 100ms (see Thread.sleep(30000)); with this test case, instead of the tryLock failing due to wait timeout, the threads are able to lock and unlock the lock quickly. The new version of the test, the test fails with a timeout drift into the futre, in a similar way that the test failed in #1104.
The PR will contain other test cases with the hope that we cover all code changes and produce the expected behavior described above.
We run a single redis server for use exclusively by redisson


2101
io.netty.handler.codec.DecoderException: CommandPubSubDecoder.decode() must consume the inbound data or change its state if it did not decode anything.




2102
CommandsQueue thread-safety?

In CommandsQueue, the following:
In sendData method, do QueueCommandHolder command = queue.peek(); and is it guaranteed peek returns what has just been added? If another thread added a different item before sendData, we can get a wrong item for the current command, right?
The queue is a MPSC queue, which is thread safe in that case,  but here multiple consumers are actually peeking data from the queue.


2103
RedisConnectionException: Not all slots are covered! Only 14044 slots are available

It should work without error.
Getting a follwoing error while my application is accessing the redis cluster in aws:


2104
HttpSessionListener#sessionDestoyed isn't invoked (Tomcat 8)

Description
I have two nodes:
sessionDestroyed event must be handled by both nodes
sessionDestroyed event handled only by N1
Steps to reproduce or test case


2105
ClusterConnectionManager generate lots of map lead to memory leak/oom

we use redisson as lock, in our test env,  we have 3 master nodes, 3 slave nodes, and we use these jvm arguments.
and memory increase over time. look at this.
and I found there's an scheduled thread to do this every scanInterval(default 5000) ms,
is this a problem?
Steps to reproduce or test case
we set redis cluster nodes and password only.


2106
always use one thread to do cluster change check

Steps to reproduce or test case
in our test env, we set log level debug, and there's some output for redisson, I found redisson always use one thread to do clusterChangeCheck, no matter how many times I relaunch.
I read source code, and I found default nettyThread is 32, why does redisson just use second thread?
we only set cluster nodes and password.


2107
RStream.readGroup doesn't work properly with TypedJsonJacksonCodec

TypedJsonJacksonCodec should decode messages within stream to specific types.
JSON is decoded to LinkedHashMap rather than to specific type.
Steps to reproduce or test case


2108
redissonClient.getKeys().deleteByPatternAsync




2109
none




2110
Fails to store Tomcat 8 Session in Redis

Hi,
I am using "AFTER_REQUEST" update mode in Redisson Session Manager configuration to ensure that mutable session attributes are in sync with the session stored in Redis
But it fails with this exception :
Caused by: java.lang.RuntimeException: Class org.apache.catalina.session.StandardSessionFacade does not implement Serializable or externalizable
This is my configuration:
Please advise what is wrong ?
Steps to reproduce or test case
I am running Tomcat 8.0.14 version and Redisson Tomcat
Redisson configuration


2111
RedisResponseTimeoutException




2112
RScoredSortedSet

No deletion after removing the last N.
Which api?


2113
GEORADIUS with STOREDIST support

georadius GEO  73.9064 18.5453 10 km STOREDIST userResultSet
userResultSet key points to a sortedSet which is sorted by distance.
Redisson currently only supports the STORE option
georadius GEO  73.9064 18.5453 10 km STORE userResultSet
This creates a sortedSet using the hash value.
Steps to reproduce or test case


2114
none




2115
Redis connection fails to re-establish

Redisson in single server mode should reconnect after the connection is unavailable for some time.
Redisson fails to re-establish a connection to the Redis server.
Steps to reproduce or test case
At some point, when Redis is needed, an error is reported when trying to
Debug logs when the connection is unavailable, and redisson is trying to reconnect:


2116
Can I get the lock's owner?

I want to get the lock's owner name when i lock fail.So I can know who prevent me to get lcok.
Can i get it?


2117
Expose async entrySet with keyPattern and count, RedissonMap#scanIteratorAsync?

Async API for org.redisson.api.RMap#entrySet(java.lang.String, int)
There is only sync API available.
Steps to reproduce or test case


2118
org.redisson.config.SingleServerConfig has no public constructor

SentinelServersConfig,MasterSlaveServersConfig,ClusterServersConfig,ReplicatedServersConfig all has a public constructor except SingleServerConfig, it makes SingleServerConfig hard to extends. Why not defined SingleServerConfig consistent with a public constructor?


2119
none




2120
Memory leak using Sentinel

I am getting a memory leak when I try to connect to Redis using SentinelServer and the server is unavailable.
I create a separated thread trying to connect in a loop and the memory consumption increase over time. My RedissonWrapper code:
Simulating the error:
1 - Turn Off the REDIS SERVER
2 - Execute the code (Spring Boot)


2121
Explanation of Config connection/thread settings

I am fairly new to Redisson and had a few questions I would like clarified. I read through the documentation, but the description of config settings weren't very helpful to me.
For every RedissonClient, a connection pool is created with a set min idle size and max size. How is each connection exactly used? Does each operation use a connection? Are ops batched into one request and sent through the connection?
When we set the threads parameter (setThreads), what are these threads used for? Connecting to redis? Deserializing?
When we set the nettyThreads parameter, what are these threads used for?
What is relationship between nettyThreads, threads, and connectionPool? What are important things to keep in mind while tuning these parameters?
Thank you!


2123
Clearer documentation regarding pattern topics

The following is an excerpt from the documentation regarding pattern topics:
The pattern string looks like a regexp even though it is a glob string, which confounded us.
Please clarify the documentation, both in the code example - for instance by replacing "topic1.


2124
Why calling releaseConnection(entry) every time when a RedisConnection is created?

My understanding is that the counter in AsyncSemaphore should decrement by 1 when a new connection is added to the pool however by calling releaseConnection(entry) in the runnable,  the counter is added by 1, which means after minimal idle size of connections are created, the counter will be the same as it was before the pool is initialized.
Please help me understand this, as I think more than max pool size of connections would be allowed to exist in the pool, since counter is not decremented after the pool's initialization.


2125
RedisTimeoutException: Unable to send batch after 3 retry attempts

We observe around 2qps errors (RedisTimeoutException: Unable to send batch after 3 retry attempts) that increase in a "step" up fashion. See image:
This graph is the traffic sent to redis in the same timespan:
As a side note: we are running 2 kubernetes pods, each with one RedissonClient that cumulatively are making requests/seeing the errors from the graphs above. The interesting thing to note is that for about 9hours after we start the pods (creating a new client in each) and send them traffic, they perform fine for around ~9hours and then the errors begin. We hypothesize that there is some issue in how the connections are managed.
Steps to reproduce or test case
Create 2 RedissonClient instances
Send between 400-850qps of traffic (variable) for around a day, where traffic includes batch ADD and PUT commands.
Observe failures.


2126
RedissonReactiveSubscription

this well always return null


2127
none




2128
after following the link we are getiing the below errors




2129
RMapCache addListener

Hi friends,
sorry if my topic is duplicated. I've looked for my question but haven't found any answer yet.
my question :  is RMapCache's onCreate event fired as a multi thread function?
for example: if I have multiple clients that produce data endlessly, is it possible to get produced data concurrently with onCreate event? or it's fired consecutively?


2130
Redis cluster health check fails while cluster is up

I have a Spring-boot app with Redisson and actuator.
All system components are up and running: my app, Redis cluster, etc.
The health-check API is being called at "/health" (backed by actuator).
Please note that running the "CLUSTER NODES" command on the cluster (either with one node or several nodes) completes successfully:


2131
none




2132
Permanent kv (ttl=-1) was found in Redis while using Tomcat Session Manager

All the timeout kv will disappear automaticlly.
Some permanent kv still alive, and whose ttl are -1.
Steps to reproduce or test case
Using Tomcat Session Manager normally
Details
First of all, after using Tomcat Session Manager for a long time, I found many kv in Redis and their ttl are all -1.
Then I cleared Redis and did a simple test, first I put config content to tomcat in context.xml, then open a page but not did login action. I found a ttl=-1 kv.
And second I did login with user name and password, I found another kv, but the ttl is session timeout second and was reducing automaticlly.
After a while (longer then timeout config value), it disappered. But another kv (ttl=-1) was still alive.
In my expected case, all the kv will disappered automaticlly. That is to say, after a long long time and if nobody do login action, the Redis server will be empty.
Do anybody has some advise for this issue?


2133
RedissonClient CreateError  in my Production Environment

Development environment ,it run ok ,i use it well.
development-right-log, in my Production Environment it didnt work ,and throw those Exception.


2134
none




2135
Use maven packaging for redisson project as jar instead of bundle

Steps to reproduce or test case


2136
ClassNotFoundException thrown during SeriazliationCodec.decode

No ClassNotFoundException to occur
ClassNotFoundException occur during object deserialization
Steps to reproduce or test case


2139
Purpose of returning RFuture in setupMasterEntry

As I'm following through the code, the method setupMasterEntry is executed in a single-threaded context, so what is the idea of the RFuture? The caller of this method is essentially "blocked" on this method until it's done. Am I understanding this right? If the caller expects a Future to be returned immediately, all the heavy-lifting work has to be done by a different thread, which is the basic idea of the Future/Promise model.
Please correct me.


2140
`redissonClient.getRedLock` does not work well with Read-Write block in a multi-JVM environment.

Then call lock.tryLock() first, return true.
Then call lock.tryLock() after the previous call has been made, now it should return false because there is a readLock under the same name.
Then call lock.tryLock() first return true as expected.
Then call lock.tryLock() after the previous one, now it return true i.e. have both write lock and read lock on the same ReadWriteLock.
Steps to reproduce or test case
As described above.
In case if this is useful information, if replace getRedLock with getMultiLock it actually works. Also if having only one JVM it also works.


2141
[HELP]Default configuration hasn't been specified!

startup
get error


2142
org.redisson.RedissonShutdownException: Redisson is shutdown

SUCCESS
Redisson is shutdown
Steps to reproduce or test case


2143
Redisson warning ,redis sentinel node added and down frequently!

Steps to reproduce or test case


2144
Question about design of readWriteLock

If thread1 set expire 5000ms ,and then thread2 set expire 1000ms, then thread2 shutdown.
In this case,thread1 will lose its lock.
I think we can change code like this
And the rwlock_timeout key will be not required.
Am I right? Where is the problem?


2145
CROSSSLOT Keys in request don't hash to the same slot

We have a testing redis cluster environment with only 1 master and 1 slave. When using redisson client with RedissonBinaryStream to write byte array to redis server, we encountered the exception logged below.
Successfully write and read from Redis Cluster using RedissonBinaryStream implementation
Seeing exception:


2146
redisson fails to connect to slave node

redisson fails to connect to slave node.
successful connection.


2147
Non thread-safe initialization in RedissonObjectBuilder

Spring bean created successfully
Steps to reproduce or test case
We have several spring beans that initialise in prallel


2148
none

[]


2149
none

[]


2150
Redisson throws NPE when host name contains underscore in it

Redisson version 3.10.7


2151
redisson RRemoteService.getFreeWorkers api code issue?

it seems RRemoteService.getFreeWorkers api code issue?
from the document RRemoteService.getFreeWorkers, I get the follow description
Returns free workers amount available for tasks
Then I find the source code
are you kidding me?
why remove? it should be get


2153
The PRINCIPAL_NAME_INDEX_NAME key is not created in redis

What I want to do is depending on PRINCIPAL_NAME_INDEX_NAME in redis to control the Spring Security's maximum session management through SpringSessionBackedSessionRegistry class.
The first look at RedissonSessionRepository.save() confused me that it is an empty method which says "session changes are stored in real-time". In comparison, the standard RedisOperationsSessionRepository.save() of spring-session-data-redis has codes to create PRINCIPAL_NAME_INDEX_NAME. In fact, these codes are in RedisOperationsSessionRepository$RedisSession.saveDelta().
The PRINCIPAL_NAME_INDEX_NAME key is created with Spring Security's principal information
The PRINCIPAL_NAME_INDEX_NAME key is not created
Steps to reproduce or test case
Using Spring Boot 2.1.3/Spring Security 5.1.4/Spring Session 2.1.4, during which the Spring Session java configuration is:


2154
Redison Deployment error




2156
Add pendingRange method to RStream object

No description provided.


2157
Issue with reading record from RMapCache and ttl

I'm getting a timeout when I try to read some keys from an RMapCache.  This also seems to trigger a catastrophic out of memory error in the application
This should generally print true/false, and it works most of the time.   But about 1 key out of 500 or so, this throws a timeout error.
In debug mode, I'm getting the following information, with a hard error.  If I do this on production, with this key, the server will fail within about 30 minutes.


2159
none




2162
Is jdk11 Perfectly Supported?

Steps to reproduce or test case


2163
Add implementation of ReactiveSessionRepository

No description provided.


2164
Containerizing Reddison client for Tomcat

I am thinking of the possibility of separating out the Reddison client from Tomcat container. Is there any way to do that? or do I always have to use RedissonSessionManager with Tomcat? I am using AWS Elasticache Redis. Thanks.
Redisson version - 3.10


2165
All reads happening from Master even in ReadMode.SLAVE

Reads to be disctibuted across primary + replica servers for ReadMode.Master_Slave and ReadMode.Slave
All the reads are going to primary server
Steps to reproduce or test case
We are using Aws elasticCache redis instance ( 1 primary 1 replica )
I have tried both useReplicated and useMaterSlave configs below
Also note I have tried both read modes ReadMode.SLAVE and ReadMode.MASTER_SLAVE


2166
Bloom filter size can't be greater than Integer.MAX_VALUE*2L?

Why bloom filter bit size limit Integer.MAX_VALUE*2?not Integer.MAX_VALUE or other value?
@mrniko can you tell me the reason?


2167
changeMaster question

In method private void changeMaster(URI address, ClientConnectionsEntry oldMaster, RFuture<RedisClient> future), parameter oldMaster is assigned masterEntry, however on complete of the future of setupMasterEntry, masterEntry is already assigned a new value which means oldMaster changes as well. How can this oldMaster get ahold of the "old master" as the code intends? After hours of reading the code my brain is slow, so I must be wrong. Please help me understand this.


2169
Why do locks fail occasionally?

Here's how I use it:
But there are still high concurrency issues
Two of the same information is generated
Request to solve
thank


2170
org.redisson.client.RedisResponseTimeoutException: Redis server response timeout (3000 ms) occured after 3 retry attempts. Command: (EVAL), params:

question:
when i get allvalue of a key, occured RedisResponseTimeoutException,why? the numbers of the values is 10000 or more .
Steps to reproduce or test case


2171
Add RRemoteService.getPendingInvocations method

No description provided.


2172
if waitTime == -1 and leaseTime != -1,multiple threads get the lock at the same time

if waitTime == -1  and leaseTime != -1,multiple threads get the lock at the same time
Thank you


2174
RStream.getInfo throws java.lang.ClassCastException

No description provided.


2175
Redisson throws RedisTimeoutException before timeout has exceeded

Redisson throws RedisTimeoutException after timeout has exceeded.
There is a race condition where Redisson may throw RedisTimeoutException after retryInterval has exceeded but before timeout has exceeded (in a nutshell when there are bursts of commands, commands will timeout even if timeout hasn't passed if retry interval is set to 0).
line 765 in CommandAsyncService seems suspect as it uses retry interval for the initial timeout value..
Steps to reproduce or test case


2176
Hibernate 5.4.3 final

Hi everybody
I'm trying to configure hibernate (5.4.3 final) with redisson (3.11.0). I use RedissonRegionFactory by default but i want that expiration.time_to_live be 10 seconds.
How should the correct configuration be?
hibernate.cache.redisson.RedissonRegionFactory.expiration.time_to_live = 10000 ???
Thanks in advanced.


2177
usage of weak ReferenceCacheMap on org.redisson.command.CommandAsyncService#CODECS  may cause frequent recreation of code

Hi,
We noticed recently there are a lot of org.nustaq.serialization.FSTConfiguration instances around in our jvm service(with redisson 3.6 installed and FstCodec enabled).But according to the comment in the javadoc, construction of org.nustaq.serialization.FSTConfiguration is very expensive, which should be cached and reused.
After some digging in redisson's code, I get some clue, it may be caused by the implementation type of org.redisson.command.CommandAsyncService#CODECS . By design, codec construction should be limited, mostly old ones from the ConcurrentHashMap stored in the ReferenceCacheMap should get returned. But since CODECS is a weak reference cache map, the ConcurrentHashMap is possible to get removed by GC. And since there is only one possible strong reference to the ConcurrentHashMap, which is a local variable in org.redisson.command.CommandAsyncService#getCodec,  the possibility of CODECS getting cleared during a GC event is very large.
the declaration and usage of org.redisson.command.CommandAsyncService#CODECS  is included in the following snippet.


2178
UpdateValve should be installed only once, remove MessageListener from topic when SessionManager stopInternal is invoked

UpdateValve valve should be installed only once for tomcat pipeline but if there are multiple web application each one will instantiate a new RedissonSessionManager and each startInternal() will install it's own copy of the UpdateValve, more over the UpdateValve  have back reference to RedissonSessionManager, so remove this reference in order to have only one UpdateValve installed for the tomcat pipeline and allow proper RedissonSessionManager garbage collection.
When we have Redisson client set in JNDI which is shared between web applications we need to remove MessageListener from the topic when web application is deinstalled during stopInternal method of RedissonSessionManager
Each web app will create it's own RedissonSessionManager instance which will result in multiple UpdateValve instances installed into tomcat pipeline
MessageListener is not removed from redisson topic which will cause web application class loader memory leak as MessageListener have reference to codecToUse which in turn have reference to application class loader


2180
Subscribe timeout - after master re-election

Please delete this issue, needs more work before filing. I cant delete myself.
see #2181


2181
Subscribe Timeout Exceptions - After master Re-election

None, or fewer Exceptions (just during failover period)
After a master re-election (and not otherwise) a constant percentage (about 1%) of the requests fail with this exception until the Redisson client is re-initialised manually with a pod bounce.
Steps to reproduce or test case
I'm running 3 redis (master, slave, slave) alongside 3 sentinels.
I'm running a constant load of requests through a redisson client which can run indefinitely without any issue. 
When I introduce a chaos script to trigger a failure of the master and thus a master re-election I start to see the errors, yet only for a very small percentage of the requests (but that percentage remains constant indefinitely until a manual restart of the redisson client happens)
Each request acquires and releases an RLock with a chance of collision with another request being 1 in 100.
If I lower the collision probability to be 1 in 10000 this problem almost completely disappears to the point where I lose only perhaps a single request, during the failover period (which is the expected behaviour for the higher collision case also)


2182
none




2183
@Transactional and RLock.unlock()

As can be seen from the above, transaction committing occurs after the unlocking operation. Is there a possibility that other threads will have concurrent problems because the thread has been unlocked before the transaction has been submitted?
I tested it with JMeter and found no concurrency problems between unlocking and committing transactions.If you know, please let me know. Thank you.


2184
ignore




2185
add default entries in MANIFEST.MF file and extra Build-Time entry as well

Currently there is no way to tell when a jar file has been build - This feature request is to add Build-Time manifest entry so that we could tell when it was build/rebuild as often if release version is not changed (e.g. providing patches via rebuild of the master code) once the modified version of the jar file is created we can't tell if it contains the fixes or not by simply having a file inside the jar to tell us when it has been build. Also some of the jars that are created do not have the default implementation entries and/or specification entries
Each jar to have default implementation/specification entries and have a build time - optionally if we have git branch / commit into MANIFEST.MF would be beneficial as well.


2186
distributed web application will throw exception if the session attribute value is not Serializable but we are having Codec that serialize the attribute values using different approach than java Serialization

If we want to serialize object with codec other than SerializationCodec as the values are not Serializable for example and if the web app xml have the distributable tag when we try to set attribute into the session that is not Serializable an exception will be thrown that the object is not serializable.
Redisson codec other than SerializationCodec and web application that have web.xml tag distributable


2187
RedissonSession setAttribute do not check if the value is null before removing the attribute name from removedAttributes collection

RedissonSession setAttribute do not check if the value is null before removing the attribute name from removedAttributes collection
Steps to reproduce or test case


2189
Microsoft Azure and Redisson: Unable to init enough connections amount

Context
We are in the process of migrating to Microsoft Azure and are planning to make use of the Azure Redis Cache. Because of this, I am in the process of investigating Redisson and have been for the most part impressed by the performance and feature set.
However, I have been running into this intermittent issue for a few days now. Every now and again, when the application starts up, Redisson will throw an error, telling me that it's only able to initialise 31 of 32 connections. My experiments with Lettuce didn't seem to run into anything similar to this.
Anyone have any thoughts or suggestions on things to look into to resolve this? Is there something particular about Azure Redis Cache that might need to be configured? Does Redisson need all 32 connections or would reducing the required number potentially resolve this?
Successfully connects to Redis every time.


2192
none




2193
Suggestion

Jdk1.7 is still used a lot, what is the corresponding version?


2196
Can't seem to run Redisson tests on OSX Mojave 10.14.2

Should be able to run the tests using mvn or intellij on OSX
After uncommenting line 245 in RedisRunner, I see these output lines repeating forever instead of a test being run:
Steps to reproduce or test case
I've tested the redis-server commands as expected to be run via Redis Runner manually on the same environment and see no issues starting the redis process, it seems like there is some issue when the tests are running the same commands though, via ProcessBuilder.


2197
Command execution timeout for command: PING

I am experiencing a lot of command execution timeout exceptions mainly for PING as well as other operations intermittently.
I have been back and forth with AWS customer support and I can conclusively say that there exist no CPU, memory and N/W constraints that were faced during any of the timeouts seen.
Further, we have captured and analyzed the TCP dump on the client side to reveal nothing on the network side.
Any help in this regard is much appreciated.


2198
RKeys getKeys block with empty REDIS

getKeys should return even with an empty redis
getKeys block and never return


2199
org.redisson.client.RedisResponseTimeoutException: Redis server response timeout (10000 ms) occured after 3 retry attempts.

[]


2200
HGET implementation in Redisson

Apologies if this is something simple that I've missed out
Have been trying to figure this out for a while but can't.
Trying to simply get the value associated with field in the hash stored at key as described in the documentation for HGET
The code used is
However, it seems like this implementation fetches all values stored in all fields in 'myHash' instead of just the value stored in field 'a'. Unsure if this fetching of values happens during redisson.getMap ( More likely ) or map.get()

Redisson issues only one HGET and retrieves only the value of field 'a' in hash 'myhash'

Redisson seems to be fetching values of all fields in 'myhash'


2201
Can't execute SENTINELS commands, only happens to the last sentinel server

I'm using Redis with 1 master and 2 slaves, watched over by 3 sentinels on 3 ports 8359, 8360 and 8361 from a single node. When executing through redisson the program works perfectly fine except that every now and then it spews out this error:
This doesn't really affect anything so far, the sentinels still send data properly to the clients but I have ever wondered what might be the cause of this? It only happens to the last port 8361, the two other ports are unaffected albeit on the same node.


2202
Why do you reinitialize the time of the previous lock when unlocking?




2203
Why do you reinitialize the time of the previous lock when unlocking??




2204
Error creating bean with name 'redissonClient' defined in class path resource




2205
org.redisson.client.RedisTimeoutException:




2206
Redisson 3.10.7 & FST 2.57 - Data is not cleared from ThraedLocal while using Serialization of FST library

When we are saving some data in redis using FST codec then data is not cleared from ThreadLocal after data saved to the redis. This is causing issue of OutOfMemory as tomcat thread's ThreadLocalMap is filled with huge data which was used while FST serialization.
Detail:
Main code requested for putting some data in Redis.
Redisson uses FST serialization to serialize data and then stores into Redis.
FSTObjectOutput which was used while serialization has stored data in ThreadLocal object and it has not cleared data from ThreadLocal after it was saved in the Redis.
I can see ThreadLocalMap contains all the data which was used while FST serialization. Please see below snapshot of heap dump:
Ideally it should clear the data from ThreadLocal, once the data stored in Redis.


2207
o.redisson.client.handler.CommandsQueue  : Exception occured. Channel:




2208
How to disable info logs in tomcat 9.0.21?

In Tomcat 9.0.20 the setting in logging.properties is respected, but in 9.0.21, it is ignored.
Don't log INFO. Only Warning, Error, Severe.


2209
none

[]


2210
RMap write-behind service may execute "put" and "delete" in different order

The order of tasks is not preserved, which is pretty critical if the same key was both added/updated and deleted. Looks like tasks are accumulated in two separate batches, each one is flushed once full. If there are no more incoming tasks, then "deletes" are always executed first.
Check sample code in "steps to reproduce".
In the sample code below I'd expect it to print:
Btw, setting batch size to "1" fixes the issue, which makes sense - all tasks are carried out with delay but exactly when received, so the order is preserved.
But without batching "write-behind" feature isn't really that useful.
Steps to reproduce or test case


2211
none




2212
CommandBatchService Execute Error




2213
how to recover semaphore release failed

if a semaphore release failed (shutdown or net not available),it's there any way to let the server recover the permits? just like expired in Lock


2214
none




2215
renewExpiration not working when manually delete key

renewExpiration normal

1.Multiple spring boot services have been started
2.Get the lock every 2 seconds
3.After the lock is acquired, the lock key is removed through the redis client
4.After deletion, the first few times can be normal, or it may not update the expiration event


2216
batch.getKeys().deleteByPatternAsync does not work

I am new in Redisson, so probably it is a dumb question.
Please give it a look.


2217
return null when not used in pipeline / transaction




2218
RRateLimiter RateConfig  Forced update

I hope there is a way to force  update RateConfig. for example add a method ? forceSetRate


2219
none




2220
Local Cache implementation issues

Hi, I was trying to implement local cache in my spring application and saw that eviction support is not supported in open source version. But that's okay, I tried to set cacheSize and syncStrategy in LocalCacheOptions, but that also didn't work.
So my question is are all options for the local cache are included in the redisson pro pack only?
Because I was not able to configure the sync strategy. I set it to NONE, but regardless of that, it was syncing to other JVM machines.
Also, some other doubts, in some code provided in your documentation:
This doesnt compile in java spring app.
Please provide the resolution asap!


2221
Redisson 3.11.1 with Java 11 and JsonJacksonCodec throws FST errors

No errors in log
I start up my application and this error appears. Why am I getting this when I am not using FST codec?:


2222
How to get the slots range of the ClusterNode

I want to get the ClusterNodeInfo contains the slots range info.
Now i could only get the slots range info by the java reflect.


2223
none




2224
RLock unlock with a different thread that the one that locked gives: attempt to unlock lock, not locked by current thread by node id

I'm using RxJava and as a part of the sequence I use a RLock, at some point (in another process) I unlock it and if the thread to unlock is not the same as the one that blocked I get an exception (see below).
I see that the lock has been done using the pool of redisson-netty, and the unlock is done by the same pool, but there are several threads in that pool, so any thread can potentially perform the unlock.
That should be as simple as tryLock and unlock without having to control anything else right? Do we have to do something specific to ensure the proper behaviour?
The lock gets unlocked regardless the thread that did the lock

An exception is thrown and the lock is not unlocked


2225
How can i use redisson If EVAL is disable?

No error
How can I solve this problem if the DBA disable this command EVAL? He will not able this order for security reasons, he said.


2226
Unable to configure Redis to keyspace notifications

Hello, I'm using Redisson and it works fine in dev environment because I use default config of redis. But when I deploy my app in stage environment it failed to start. The error message is "Unable to configure Redis to keyspace notifications" and I think this is caused by disabling the CONFIG command in the Redis of stage environment. The command CONFIG was disabled by renaming to another wired name so we cannot use that command. But when my springboot app starts, redisson try to set the config keyspace notifications, is there any purpose of this behavior? If I don't want to use event subscription, how can I disable this feature to avoid this Exception?
Thanks in advance.


2227
o.redisson.client.handler.CommandsQueue  : Exception occured. Channel:

Dear sirs, When I just start a simple Demo with Redisson and SpringBoot v2.1.6.RELEASE according to the example of redisson with springboot In GitHub ( where is refence: https), But I run a unit test In my project@SpringBootTest, The test result is OK but throw java.io.IOException below, my redis server is a single localhost not remote or Cluster;
What's The problem of this configuration ,Please help me;


2228
none




2229
Cann't find yaml config file in Springboot when config is not in classpath




2230
Session behaviour mismatch - Redis + AFTER_REQUEST

Redisson session manager should return actual value of value persisted to session.

Redisson returns null for every value previously saved.
Steps to reproduce or test case
but accroding to my opinion, it should return "abcd"
If I use readMode = MEMORY, it is somehow working but currently, I´m experiencing issues with synchronization => getting outdated session / not latest data. So I tried to use readMode = "REDIS". I would expect session to be on every request fully loaded from Session, during request are made to the memory object and at the end, it should be push to Redis.
Maybe it is not a bug, not sure, whether it is intended or not. Otherwise, could you advise how to solve? Or tune config somehow to eleminate outdated session data?


2231
none




2232
How do I use Redisson with SSL enabled?

Steps to reproduce or test case
I'm trying to connect to my Redis provider with SSL. I've downloaded the pem file provided by my Redis provider, and this is how I'm setting up Redisson:
And this is the error I'm getting:
Does anyone have an idea about what I should do here?


2233
none




2234
org.redisson.client.RedisNodeNotFoundException: Node: NodeSource hasn't been discovered yet

Hello. I am using redisson to connect to redis cluster. However, while I am reading from redis (via redisson), I shutdown one of master instance. So I get this error:


2235
Live Object List inside LiveObject not expiring

I have a java.util.List of LiveObjects under a LiveObject. Marking parent LiveObject expires it properly however LiveObjects under the List (inside Parent Live Object)  are not expired and i am explicitly expiring them, is this going to be supported any time soon if not supported already?
Also even if i set expiry of List Objects, List itself remains present in redis DB.
How to handle such scenario as i don't see an option to add listener for RLiveObjectService persisted Objects?
Also is there a way to have the @Rid field part of key (instead of enoded key) in Redis as i need to access the keys from another non java application?
Having key as "redisson_live_object:{fc093839}:com.test.abc.A:Id:java.lang.String" doesn't allow me to build search capability by Id outside java application.


2236
How to properly implement rate limiter hasPermits

Using Redisson latest.
We have queues with messages in them to be sent to 3rd party APIs. We are using the rate limit functionality to prevent 429s from the 3rd party APIs. When we do get a 429, we re-queue the message and try again later. After several retries, it ends up in a DLQ. To prevent this we wrote a hasPermits method on a wrapper around RRateLimiter and RAtomicLong where the atomic long points to the "{" + rateLimiterName + "}:value" key. We then use hasPermits to test whether we should poll the queue for messages or not.
We are now on our 3rd implementation of this method and want to double check it for correctness and/or ask that it be added to the RRateLimter interface.
Our 1st implementation simply checked RAtomicLong::get > 0 . This failed because an uninitialized RRateLimter did not have the corresponding atomic long key and always returned 0.
2nd implementation:
If false we called RRateLimter::tryAcquire(1) because tryAcquire would create the atomic long if it was not present with the correct value and TTL.
If tryAcquire succeeded, we put a token back with RAtomicLong:: incrementAndGet. This caused an edge case where the TTL expired, the key was deleted by Redis and the incrementAndGet created a key without a TTL.  The value would then get decremented to 0 by the next tryAcquire and the rate limiter would never show any available tokens. This probably could have been prevented by using a Lua script or a batch/pipeline.
Our 3rd implementation seems correct, but we want to double check since we've had so many issues. We now:
if -2 (not present), then return true as the next call to RRateLimter::tryAcquire will (re)create the atomic long with the correct number of permits
if -1 (key present, but no TTL), we set the TTL using the configured rate interval. This step would not normally be necessary except to fix the bad atomic long keys created by implementation 2 above.
return RAtomicLong::get > 0
We think this 3rd implementation is now correct, but could be improved by using a Lua script or batch/pipeline to perform the check in a single round trip to Redis. Any feedback would be appreciated. If this could be added to the RRateLimter interface, that would be even better.
Thanks.


2237
[CLuster Node]redisson.getPatternTopic only subscribe one master node channel

only subscribe one master node pattern topic because only use one connection that node map hash slot


2238
RedisTimeoutException on HMGET

Hello @mrniko
We are seeing a lot of RedisTimeoutExceptions with below log snippets


2239
isExists always return false (only RLock return true when locked)

sample code
RLock always work in all redis deploy mode
when we add set mode to MASTER exist return true as expected
clusterServersConfig.setReadMode(ReadMode.MASTER);
redis command works fine
exists and gets return datae


2240
CROSSSLOT Keys in request don't hash to the same slot. channel




2241
RX and Reactive Set Intersection `java.lang.ClassCastException`

Both Rx and Reactive versions of RSet throw java.lang.ClassCastException: class java.lang.Integer cannot be cast to class java.lang.Long (java.lang.Integer and java.lang.Long are in module java.base of loader 'bootstrap') when using intersection(String... names) method.
I think this is happening because org.redisson.RedissonSet#intersection returns an int


2243
ERR This instance has cluster support disabled.

Giving error org.redisson.client.RedisException: ERR This instance has cluster support disabled.
 should connect to the give cluster of two nodes
Steps to reproduce or test case
Adding stacktrace


2244
Redisson map operations are very slow

Example program inserts 50,000 records into an RMap in under a minute (in under 10 seconds if possible).

Example program never completes.  This example is similar but not exactly what we're running.  The real program takes up to 3 minutes to insert 50,000 records.  What am I doing wrong?
Steps to reproduce or test case


2245
none




2249
Not all methods have a async variant

What's the reason that not all methods have a async variant? For example, .getKeys(), which calls .get(RFuture) and return the result.
Redisson version: 3.11.1


2250
redission ScheduledFuture can not be execute after definite time


complete the ScheduledFuture after ten seconds
the schedule task above can not be executed after 10 seconds, the current thread beign blocked
Steps to reproduce or test case
using spring boot org.redisson.spring.starter.RedissonAutoConfiguration, just configure redis host and port in properties file.


2251
Expect redisson-spring-boot-starter to be more optimized

the redisson-spring-boot-starter 's configuration is too simple,Configuration files have to be introduced to configure more features. such as codec、connectionPoolSize and timeout, It's too complicated to introduce more configuration files, Hopefully it will optimize the configuration in spring-boot environment.
Thank you verify much!


2252
none




2253
Redisson issue on Spark


Successfully write and read data from Redis Cluster throught Redisson inside an appache Spark App.
Thanks for your Help !

Failing  with this stack trace when trying to write about  more than 20 items
Everything is OK when limited to about 10 items
Thanks for your help


2254
none




2255
Eviction support in JCache

Right now there seems to be no Eviction support in JCache , where as MapCache supports eviction. Is there any reason for not supporting eviction in JCache ? Are there any plans to support it ?
If there is no eviction support in JCache , what happens when the cache reaches the max memory limit of server?


2256
RedisNodeNotFoundException thrown on Redis Cluster restart

Hello, I am currently experiencing an issue with a Redis cluster on Redisson 3.11.2 while testing how our application will handle major outages.
I am providing the cluster config with the address of one of the master nodes. On app startup, it successfully finds all of the other nodes on the cluster. However, if I take down the entire cluster and restart it, Redisson will fail to reconnect to the cluster when it comes back online, throwing a RedisNodeNotFoundException whenever it tries to contact Redis. (see  for stack trace).
The application reconnects successfully when using a single server setup.
I found this similar issue, #2234 but upgrading to 3.11.2 has not fixed this for me.
Redisson successfully reconnects to the cluster after the cluster restarts.

Throws the following error every time the application attempts to communicate with Redis:
Steps to reproduce or test case
Create a RedissonClient with the config specified below. Stop the cluster and restart it.
If I've missed something or you'd like more information let me know.


2257
none·




2258
none




2259
none




2260
none



2261
Support for rediss:// when using Sentinel

Just wondering if Redisson officially supports the use of rediss: for Sentinel? I can't see the use of that protocol mentioned in the Sentinel setup documentation whereas it is for cluster mode. Also it seems like there are some places where the redis: protocol is hardcoded in Sentinel-related code.
For example in on line 486 of SentinelConnectionManager.java:


2262
none




2263
Upgrade from 3.6.4 to 3.7.3 and receive default configuration hasn't been specified.

I have a redisson-jcache.json in the root of the classpath. The only difference is the library version moving from 3.6.4 to 3.7.3.
Here is the contents of the config file.
This file is located on the file system in a directory which is configured to be read by tomcat. It is found in 3.6.4. I tried copying it to the webapps WEB-INF/classes directory and it still cannot find it so I don't think that is the issue. I have a redis server running locally inside a docker container with tomcat so I know there are no additional changes to the environment. The base docker container has not changed, only the war file with the new redisson version.


2264
none




2265
Large number of Connections opened to redis in case of load 65 ·


Connection count should remain stable even during load due to connection pooling.

When the application is load, there is a spike in number of connections to redis. This starts causing redis timeout exceptions in the application.
Cache manager implementation
Following is how we have implemented the cache manager which is used to handle data transfer to and from redis.
Every time there is a request to get and put things from/in cache we get an instance of RMapCache from redisClient and use that for the operation.
This map is not singleton or pooled. Since this map is instantiated for every request is this causing the spike in connections?


2266
none




2267
subscription data loss 67 ·

redisson toptic.addListener.Subscribers can receive each piece of data in succession;
Subscribers can only receive a few pieces of data and stop outputting content and the idea console without reporting errors. But on linux, all data can be subscribed to by a client directly connected to. / redis-cli.sh.
Steps to reproduce or test case
lose data ,disconnect, listener ,redisson,topic


2268
org.redisson.client.RedisConnectionClosedException: Command (EVAL), .... succesfully sent, but channel [..] has been closed 68 ·


I have three reids nodes, and I have configured three sentinel, now Redis fairLock for redisson, and I tried the following exception multiple times. Redis port my telnet communication is normal.
Steps to reproduce or test case


2269
when I unlock the lock, accept an exception

somebody can help me ?


2270
none




2271
none




2272
none




2273
none




2274
none




2275
the redission can not shutdown

I use single mode redisson to test batch function. However after I have finished the test, I can not shutdown the redissonClient. In the test, if I call rfuture.cancel(), then the redissonclient can not shutdown. If not, it shutdown normally
Steps to reproduce or test case


2276
"ERR max number of clients reached" exception while using redisson jcache

I am using Azure c0 redis instance which has maxClients value set to 250 , which cannot be changed. Now I have an application which uses Jcache implementation of REDIS for caching. Below is the code of redis cache creation:
But when I do a load testing with just 10 users for 10 minutes on the cache I and facing "ERR max number of clients reached" issue. Here is what I have observed, whenever I create a cache instance through the above code, 32 new clients are being created and that is the default value of "connectionMinimumIdleSize" property in redis. But according to the API doc , this property is
"Minimum idle Redis connection amount" and I believe that this number of clients shouldnt be created.
Any help here is appreciated.


2277
ClusterConnectionManager question

Method checkMasterNodesChange is assuming if slots of a partition is to have a new master, then all slots of that partition will have that new master. What if slots of this partition (in previous cluster configuration) are now distributed in different partition/master in the latest cluster configuration?
imagine for slots in currentPart, find method returns multiple different newMasterPart. In this case, do we have a messed up configuration? Please explain. Thanks.


2278
RedissonFairLock deadlock

Seems related to the change on #2099.
We have tried to upgrade to 3.11.2 from 3.10.7 and this behavior started occurring.

The FairLock acquired on high load system without lease time defined.

Redisson does not handle the case of Fair lock without lease time (on high load).
when many different threads are asking for the same lock key the client is stuck and no thread acquires the lock.
Steps to reproduce or test case


2279
default Config constructor not using any Codec

Using FstCodec as default Codec if not specified
Steps to reproduce or test case


2280
How to access localCachedMap wit RedissonBatch?

is getLocalCachedMap not available with rBatch? or is rBatch.getMap() and rBatch.getMapCache() good enough to getLocalCachedMap reference?

rBatch.getLocalCachedMap() is available

Only rBatch.getMapCache() and rBatch.getMap() is avaiable
will using rBatch.getMap() return a local cached reference or will it actually fetch from redis when rBatch.execute is called?


2281
why the ansy method can not ensure insert data crectly

inert data fast and crect
can not ensure insert data crectly
Steps to reproduce or test case
Redis version
I used geospatial method(redisson.getGeo and geo.addAsync) to write data with a data size of 50 million, but found that redisson could not guarantee that all data were written every time.
//In debug mode, I found the futureTask: some compled normally , completed exceptionly, and some unfinished
Meanwhile, I also conducted experiments in the multi-node redis environment, and redisson could not guarantee that all data were written.However, it's only when I'm using the geo. Add () method and I'm writing multiple threads based on Thread class that I can make sure that all the data is written properly.


2282
none




2283
Add JBoss Marshalling codec

No description provided.


2284
redis cluster: RedisConnectionException: Not all slots are covered

environment
test
I test in redis cluster based on redis 4.0.3 and redis 5.0.5, the error is same.redis.conf:
analysis
I guess the error is beacuse redisson use one of my configuration node(8001) to connnet to redis cluster,and then executecluster nodescommand on that node(8001) to get other nodes,not direct use the nodes in configuration.But the node(8001) where cluster nodes is executed always return  private ip(172.16.30.41) while other node's ip is public ip(149.129.48.110),just the same as nodes.conf of 8001.
error
redisson log:


2285
java.lang.AbstractMethodError: org.redisson.spring.data.connection.RedissonReactiveRedisConnection.close()V



Steps to reproduce or test case
spring boot version:2.0.9.RELEASE
when i boot the application,i got this


2286
Circuit Break Hibernate L2 cache, if redis is unreachable.


Redis server becomes unavailable, usage of L2 cache should be bypassed and the application should continue to run.

The whole application goes down, Hibernate can't function. Keep getting connection timeouts.
We have to manually turn off L2 in app config and redeploy the application, this could be prevented by using a circuit breaker.
Steps to reproduce
While the application is running, kill the redis server.


2287
Prevent "split brain" scenario with HA-proxy

With the use of HAProxy server, Redis Sentinels can be configured to allow for automatic failover between the master and slave Redis replica instances for high availability.
HAProxy comes with built-in TCP health check feature for Redis to perform an automatic failover. To avoid having to change Redis IP/Port in the front-end client application after each failover, I have setup HAProxy with the TCP health check to test if a Redis instance is a master or slave. This setup is needed to make sure it only proxy connections to an active master instance. More Info here

Running in the replicated mode, this causes split brain and redisson fails to start with an error "Multiple masters detected".

Redisson should to be able to connect to the ha-proxy ports and run without split brain.
Steps to reproduce or test case
Use HAProxy and Redis Sentinel for automatic failover
Replicated Servers Config with nodeAddresses of ha proxy port


2288
none




2289
query about Redisson at scale

Planning to embed redisson in each of my application instance.  I want to know how redisson behaves in following scenarios.
Q1) a. If application instances scale to a number of 100 or more will there by any challenge from redisson side?
b. Do redisson instances  talk to each other over network? Then such scaling can cause problems.
Q2) If node 1 created a redisson object , are there any restrictions on usage of same object on another node in a big cluster?
Q3) In a big cluster are there any challenges if some of applications instances are shutdown or terminated abruptly?


2290
Spring boot 2.1.7 failed to startup with redisson-spring-boot-starter 3.11.3

Steps to reproduce or test case


2291
Spring boot 2.1.7 failed to startup with redisson-spring-boot-starter 3.11.3


Spring boot starts successfully and works normally

Connected to the target VM, address: '127.0.0.1:63319', transport: 'socket'
but it works well with redisson-spring-boot-starter 3.10.7


2292
LockWatchdogTimeout will cause the IllegalMonitorStateException

redis version: 3.0.504
redisson version:3.11.1
setLockWatchdogTimeout will cause the IllegalMonitorStateException


2293
Did not get Connect callback in high load


Callback for connect should come after reconnecting

Never got connect callback after disconnect CB even server is working fine. (Although Redis server is never disconnected ... I don't know why disconnect CB also come)
Steps to reproduce or test case
Add Callback listener to Redis nodes.
Add 10k data in 1 second to different keys. and observe.


2294
DNS




2295
DNS resolve error


I used redisson master/slave mode and get dns resolve error.
I init the client as followed:
I have 4 master/slave redis nodes(rs1,rs2,rs3,rs4). I found that the program failed 4 times and after that the program successed! The dns resolve failing was from rs1 to rs4 and I guess because I set different DnsAddressResolverGroupFactory instance for each redisson client config, so each redisson client failed one time.

Here is the error:
I want to know why this happened and how to make the program work success at the first run time.


2296
org.redisson.client.RedisTimeoutException

org.redisson.client.RedisTimeoutException:
Unable to send command! Try to increase 'nettyThreads' and/or connection pool size settings
Node source: NodeSource

Not seeing this error

After running for days in hundreds QPS, this kind of error emerges.
Steps to reproduce or test cases


2297
is this a typo of how to install via pom.xml?

Steps to reproduce or test case
I found a typo of how to install via pom.xml in "Used by",  which maybe is missing a letter "r".
Is there such a version for "redisson-3.11.3" in maven repository? I could't find it in mvn repository.
if this is a typo, please help out revamp.
thanks.


2298
none




2299
Redisson netty thread consumes ~100% CPU with RedisTimeoutException

Hi,
The issue being faced is that redisson netty thread consumes ~100% CPU and when a redis operation is performed we get RedisTimeoutException.
In the current set up,
3 redis sentinels and 3 redis servers
2 pods with our application that uses redisson client.
Out of the 2 pods only one pod seems to have this issue.
The pattern of the issue is that it runs with .1% CPU utilisation for few days and,
suddenly there is increase in CPU usage which hits 100%. Once it reached 100% all redis operation fail with RedisTimeoutException.
The CPU utilisation drops down back to .1% if the pod is restarted and the issue doesnt appear for few days.
If the pod is not restarted CPU utilisation continues to be at 100% throughout.
This is happening irrespective of the load even for as low as 1 request per minute.
The exception being faced post high CPU usage is
Redisson netty threads should not consumer 100% CPU, even if it does should release it eventually.
And we should not be having RedisTimeoutException.


2301
none




2302
Is there any requirement for the version correspondence between Redisson and redis?




2303
3.11.3 Constantly repeating sentinel WARN


I should not see any warnings in my logs.

after I had updated Redisson from 3.3.1 to 3.11.3, it started constantly repeating logs, never ending:
Steps to reproduce or test case
we have 9 sentinels. One of these sentinels, the special one, redis is deployed on the same machine as the application itself. I think this is the key to understand the problem. We use docker for redis, sentinels and application.


2304
threads blocked waiting on CountDownLatch

Hello,
We are facing an an issue where some threads get blocked indefinitely waiting on the CountDownLatch in CommandAsyncService.get(). Relevant section of the thread dump:
The reason for why the requests aren't able to complete isn't relevant here (we are deploying redis in kubernetes, and are working through various upgrade/failure scenarios that currently can result in severed connections). However, it's strange to me that the CommandAsyncService.get() method doesn't respect timeout configuration, and simply calls l.await().
Is there any way around this? Please let me know if I am misunderstanding the situation.

CommandAsyncService.get() should throw an exception if the future is unable to complete within a timeout.

Many threads are hanging indefinitely in the CommandAsyncService.get() method.


2305
Jackson mapping for Config raising java.lang.reflect.InaccessibleObjectException with Java


Reading properties from a config file and mapping them with com.fasterxml.jackson.databind.ObjectMapper.convertValue() to a Redisson Config to be working fine.

It seems like with Java 9 module system using reflection is not as safe as before. We are running Java 11 and the following exception is raised when using com.fasterxml.jackson.databind.ObjectMapper.convertValue() to create a Redisson Config from a Map (properties loaded from a config file).
The exception is raised when trying to create a ClassLoader (which is needed in the Redisson Codec) via reflection.
I would like to know if there's any other way to easily create a Redisson Config based on a config file without having to hardcode every property.
If you have something in mind which can be implemented here to avoid this kind of issues we are more than happy to contribute a PR.
Steps to reproduce or test case
We still can't reproduce this with a clear example, in some of our Java 11 apps we can convert to a Redisson Config, but in other ones the above exception is raised. So we are still trying to figure out how we can reproduce this consistently.
That said, the piece of code is something like this:


2306
thread blocked at closeNodeConnections

Hi,
The call to closeNodeConnection waits indefinitely on call to MasterSlaveConnectionManager.closeNodeConnections.
Section from thread dump:

MasterSlaveConnectionManager.closeNodeConnections should throw an timeout exception if the same is not able to complete within a configured timeout.

Thread hangs indefinitely at the request.


2307
none




2308
ExecutorOptions.taskRetryInterval not working as expected


When submitting task with taskRetryInterval option set, the task should run on the next available Redisson executor node when the original executor node was killed.

The task is not retried on the next available worker. Also when the worker node is started again it will run duplicate task on all the available worker nodes.
Steps to reproduce or test case
Submit JobA and then start 2 instance of the Worker lets say Worker1 and Worker2. When Worker1 is running JobA kill that worker, now the Worker2 should try to run the JobA after the taskRetryInterval, but it does not. Now start Worker1 again, Redisson will duplicate the task run on both Worker1 and Worker2.


2309
none




2310
Tomcat-Error on getSession

Errror on get saved session
Steps to reproduce or test case


2311
RedisOutOfMemoryException caused inconsistency

redisson and redis are used ONLY as cache by spring @Cacheable(value="xy", key="ab") annotations.  TTL is set to 10min. no manual access or manual redisson commands are written in code.

after catch RedisOutOfMemoryException redisson evicts old keys to make more space, because redis cannot handle outOfMemory due to redisson creates key "xy" that represents whole cache name and ttl is not set for this key. Value of this key is "map" that contains cache our keys "ab" and cached values. There exists also other redis key with prefix redisson__timeout__set:{xy} that holds TTL.

after RedisOutOfMemoryException there is inconsistency that stored records are alive and is returned from cache after 5 days even we have TTL only 10min. Maybe because redisson first put value to xy cache and next put TTL value to redisson__timeout__set:{xy} cache. if write to redisson__timeout__set:{xy} caused OOM exception then record in xy cache will stay alive forever.
Steps to reproduce or test case
set redis max memory to low value and store bigger data to cache.


2312
when aquire redisson lock , that throw redis response timeout sometimes

redisson.2.2.13
when occouring this problem,the redis has not much qps


2313
Rate Limiter wiki misleading example

In , the example is:
5 permits per 2 seconds
Should it be the following?


2314
Graceful handling of failures for Redisson Tomcat Session Manager

I am using Redisson's Tomcat9 session manager going against Azure Redis Cache
with readMode=MEMORY and updateMode=DEFAULT .
This is mainly for session failover in case a server fails. Sessions are sticky, and so during normal operation, all session reads should be local within Tomcat.
Occasionally all of our Tomcat instances experience Netty timeout errors and requests to Redis fail.  This causes a complete failure of the application, as sessions are unavailable. This failure seems unnecessary, since the session data is available in local Tomcat memory and is not dependent on Redis (except in the case of failover)
Is there any way to get Redisson session manager to circuit break if calls to Redis fail or time out, and fall back to using session data from local memory ? The exception is below. Any help would be appreciated. Thanks!

Redisson Session Manager should fail gracefully and fall back to local memory if Redis calls fail, and Tomcat requests should succeed

All Tomcat requests that use the http session data fail
Steps to reproduce or test case
Issue is intermittent, but occurs when calls to Netty time out


2315
none




2316
DNS issues occuring sometimes with Elasticache

Hello,
We are running in to DNS resolution failures sometimes.
The redisson configuration details are as below
Can you please look in to this. This is happening intermittently(nearly 50% of times)


2317
How to resolve error "ERR unknown command EVAL"?

Redis version
The exception I see is:


2318
Unable to inject SpringBoot beans or use any other Bean in Tasks that doesn't implement Serializable

Hello,
I've tried running tasks Runnable/Callable that have autowired dependencies from SpringBoot and I get serialization errors on scheduling tasks or null pointer exceptions when tasks are about to execute.
I've crawled through documentation very carefully and I've even noticed there is some invalid documentation examples.
Please check out in your documentation Section 9. , 9.4.3. Distributed scheduled executor service. Scheduling a task with Spring beans.
Example code is invalid and it doesn't work.
To summarize:
Is there a way to create Callable/Runnable tasks that have SpringBoot beans as dependencies autowired - Important: that they dont have to implement Serializable interface.
Thank you.


2319
On Reading Locks


Multithread concurrency can be unlocked successfully

Multithread concurrency with only one thread successfully unlocked
Are there any problems with the script here?
When a thread finds the corresponding key, it deletes the whole key. Is it impossible for other threads to find it?
Steps to reproduce or test case


2320
CommandDecoder : Unable to decode data, command: (SMEMBERS)

Code
Exception


2321
Only one sentinel connected in Sentinel Mode using JSON


Redisson add all sentinels

Add only the first one, ignoring the other two.
When the added sentinel and the master fail, even if fail over happens normally with the other 2 sentinels, redisson dont reconnect.
Steps to reproduce or test case
Configure de redisson with Tomcat


2322
RRateLimiter does not provide way to overwrite config


RRateLimiter does not have a setRate/setRateAsync method.
It only has trySetRate/trySetRateAsync methods, so once a rate-limiter's config is persisted to Redis, it cannot be overwritten.

Invoking RRateLimiter.trySetRate twice with different rate-limiter configuration values does not overwrite, since it uses HSETNX instead of HSET operation.
Steps to reproduce or test case
There is no way to overwrite the existing "myRateLimiter" with a different rate, besides modifying the rate limiter name


2324
Add support for gt, ge, lt and le conditions to LiveObject search engine

No description provided.


2325
java semaphores's performance differs a lot in fair and unfair mode

I use a semaphore in a complex system with 300 permits while the background workflow has 1000 concurrent requests. It takes about 7ms for processing after permit acquired.
For unfair semaphore, the delay for acquiring the permit is less than 1ms while delay for fair semaphore is more than 30ms.
I understand unfair semaphore may have a slightly better performance. But why it differs so much?


2326
none




2327
RBlockingQueue.take doesn't throw InterruptedException

No description provided.


2328
none




2330
Writing hashmap using redisson client and retrieving same value using redis-cli

Hi  ,
I am using following code:
I can get the same value back using redisson , But when i see all values using redis-cli , i see following:
How could i avoid this serialization or encoding of data so that i can access the data using some other redisson client ?


2331
Session can't be found

Session xxxxxxxxxxxxxx can't be found

get session from redission

But i found key 'redission:tomcat_session:2905FF64FAF76CCF89DC2FF4CDE7BFB9' in redis client
Steps to reproduce or test case
1、restart tomcat
2、access other tomcat


2332
Difficult with basic operation

Dear all,
I tried to test with redisson lib but I saw lack of basic example.
In redis I set String value, for example SET testkey testvalue.
How can I use redisson to get  the String value of testkey?
Here are my code:


2333
After restarted a slave node of cluster, redisson could not recover from "RedisConnection is not active" exception


The redisson should reconnect and query without exceptions, after the slave restarted.

By contrast, the servers using redisson v3.7.3 recovered as expected.
Steps to reproduce or test case
The redis cluster are composed of 3 masters with 3 slaves.
I did cluster failover on the slave, after the master and slave switched successfully, i did shutdown and restarted the server. After the operations, the redisson threw exceptions when queried the restarted redis node, and could not recovered automatically in half an hour.
Redis version
Other problems
After master-slave switch and restart slave node, I found all redisson(v2.13.1 and v3.7.3) connections increased significantly(almost twice as normal connections), and config timeout set xxx was useless. When i restarted the servers, the redisson connections were back to normal. So is there a reason that redisson do no release idle connections for a long time?


2334
【BUG->redission-tomcat】Access other tomcat findSession cause session invalid

In RedissionSessionManager.findSession()
source code:
Steps to reproduce or test case
1、access tomcat A, createSession
2、access tomcat B, findSession


2335
Calling RSet.getSize() returns the correct size of set, but then set is empty afterward


Call RSet.getSize() returns set size of N, and a subsequent call to RSet.iterator(batchSize) allows you to iterate through all N items.

Call RSet.getSize() returns set size of N, and a subsequent call to RSet.iterator(batchSize) returns an iterator that has no items to iterate through.  Without (first) getting the size, the iterator will iterate through the set of N elements.  For some reason, getting the size (first) makes the set appear to be empty, and there seems to be no method to "reset" to the head of the set, if this is, indeed, what is happening.  Another detail that may also be notable is that, each time I restart my application, RSet.size() returns the expected size, so the data is not being removed with a call to get the cardinality of the set.
Steps to reproduce or test case
Get a set by calling RSet testSet = RedissonClient.getSet("testSet");
Add items to the set with testSet.addAll(Arrays.asList("1", "2", "3", "4", "5"));
Get the set size with int testSetSize = RSet.size();
The size of testSetSize == 5.
Get an iterator with testSet.iterator(5);
Attempt to iterate over the set, but there will be no items to iterate over.


2336
example code to connect to redis in Kubernetes setup

In my Kubernetes setup, REDIS pods get created as following..
So 1 master and few slaves
Output of "kubectl get svc" is like:

I want to connect to both master-slave via Raddison client

I'm not sure how though because there are like following ways!
This is what i am confused with
Could you please provide a sample code on how best to connect to Redis with master slave configuration?
master could become slave and vice versa so how dynamically Raddision would take care of this switch?
IPs of service needs to be configured or IPs of pods?


2337
Redisson session key to much in redis

Redisson session key is keeps increasing rapidly, now there are 300,000 key in redis, but HttpSessionListener can't get any sessionCreated even.


Steps to reproduce or test case


2338
can redisson-lock support on codis or twemproxy or aliyun-redis?

I found that redisson-lock can not run well on aliyun-redis which cluster by proxy like code or twemproxy. Does anyone occour this problem?


2339
Use `Redisson.createBatch` method. It accumulates all invoked commands in one batch command.

You can use it via Redisson.createBatch method. It accumulates all invoked commands in one batch command.
Originally posted by @mrniko in #263 (comment)
How can we exactly do that?


2340
none




2341
RedisClient createBatch() returning null

Here is an example https
Originally posted by @mrniko in #2339 (comment)
I tried using RedissonClient.createBatch(), its returning null. Whereas, RBucket getBucket(String name) is working fine.
Can't figure out the issue behind this. I am extending RedissonClient and initialised its constructor.


2342
Add an Automatic-Module-Name manifest entry

No description provided.


2343
ReplicatedServersConfig vs. MasterSlaveServersConfig

While trying to track down an issue we had with AWS Elasticache redis + Redisson and a botched failover, this question came up -- "What is the difference between config.useReplicatedServers() and config.useMasterSlaveServers()?
The documentation suggests that ReplicatedServers is the right choice for Elasticache but doesn't go into more details. Thoughts?
Thanks
Tony


2344
none




2345
listener execute multi times when register multi topics


the listener execute multi times as the topics` size
execute one time
Steps to reproduce or test case


2346
Add subscribe based methods to RBlockingQueue and RBlockingDeque objects

No description provided.


2347
DNSMonitor UnknownHostException with Azure Redis Cache

While looking through the server logs of our application running on Microsoft Azure, I came across the UnknownHostException below. It seems to occur on average once or twice a day.
Caused by: io.netty.resolver.dns.DnsNameResolverTimeoutException: [/127.0.0.11:53] query via UDP timed out after 5000 milliseconds (no stack trace available)
I found this issue which discusses a similar problem, but I am still seeing the error after upgrading to the latest version of Redisson.
Any assistance would be much appreciated.
Thanks.


2349
Add subscribe based methods to RScoredSortedSet object

No description provided.


2350
scheduled executor service get pending tasks

For the Redisson executor and scheduled executor service, is there a way to get the count of pending tasks in the queue?


2351
Add support of Spring Data Redis 2.2.x

No description provided.


2352
RStream.trim throws exception

No description provided.


2353
How can we have replication of Redis from one DC to another, but control the nodes Redissson connects to

DC's . in LN and US
Want primaries + slaves in US, just replicas in LN
Want Sentinel HA
Want to hit the primaries+slaves in US when runnng service on US, LN would only be used with reconfigure/failover.
But it looks like the connection pool will try to spread over all slaves?


2354
RedissonTopic subscribe lost connection

When using RedissonTopic,subscribe sucess and when publish message, can subscribe message success. Bug after a few days,publish message success, but cannot subscribe message.
I found some errors in redis log:
There no error in my application.
redisson version is 3.10.0
Is connection reset but no reconnect?How can I resolved?


2355
RedissonLock.unlock() hangs infinitely waiting for RedissonPromise


Calls to RedissonLock.unlock() are expected to finish after the lock has been deleted from Redis.

We have experienced several threads locked forever waiting inside calls to RedissonLock.unlock() in our production system within a few hours after upgrading to Redisson 3.11.4 from Redisson 3.8.0.
Steps to reproduce or test case
Unfortunately I am unable to reproduce the problem on my own computer. We have however experienced it on several of our production servers within just a few hours after starting our newer version of the application with updated Redisson version. We upgraded from 3.8.0 in order to receive fixes for bug #1966 - Deadlock after Redis timeout, which we also experienced a couple of times. However right after start we have found some (29) exceptions in our logs coming from internal redisson threads:
After that we were investigating issues with blocked threads by analyzing thread dumps. All stuck threads had exactly the same stack trace as below:
After examining the source code of RedissonLock.java we have found that the NullPointerException occurs probably due to missing timeout object inside task:
I'm not sure if it would solve the root cause why task.getTimeout() returns null, but calls to cancelExpirationRenewal method should not fail with an exception, otherwise, e.g. in RedissonLock.unlockAsync method the future will never receive a result (or a failure):
Please add null check for timeout inside the ExpirationEntry object.
We had to return to 3.8.0 version because of this problem. I think it is quire severe.
Default configuration with sentinel servers.


2356
none




2357
RedisException - ClassNotFoundException

I am getting following exception sometimes in my tomcat app which uses redisson client to connect to AWS Redis. it says java.lang.ClassNotFoundException: com.sun.proxy.$Proxy222 but I have all the jar files in the classpath. Could someone shed some light on this. Thanks
note The full stack trace of the root cause is available in the Apache Tomcat logs.```


2358
RMapCache Elimination Strategy does not work

redisson version is 2.15.2,In a concurrent environment, the number of maps continues to grow, with 4000,000 pieces of data. When replaced by redisTemplate, only 100,000 pieces of data are run at the same time and remain unchanged. All data is set to an hour timeout


2359
Add batched persist method to RLiveObjectService object

No description provided.


2360
Determining the number of running tasks for a RScheduledExecutorService

I have the next example https.
I assume there should be an API with which I could find out if there are running tasks for a given executor manager.

Each time when start the application, a new task is added and the running jobs are duplicated.
Steps to reproduce or test case
Run a example two or more times.


2361
Decoding Issue in RBuckets.get Function


can use a different codec rather than the codec defined in config to encode and decode the object.

it works when encoding, but doesn't work when decoding
Steps to reproduce or test case
the issue should be in the CommandAsyncService.executeBatchedAsync function. when the Redis is not in cluster mode, the parameter codec is useless.


2362
none




2363
none




2364
Transaction Commitasync doest return at all

Trying to remove multiple records through transaction , when executing case after 4,5 successful iteration,  transaction commitAsync doesnt return at all. test generator keeps waiting indefinitely.
around 2k size of testSet
Steps to reproduce or test case


2365
HashCode of Value stored as Map differs

I am using following function code to insert data in redis :
Value is a Map whose key is: JioNSSFSnssai
and Have defined this class as following with over-riding equals and hashcode :
I see that HashCode of values key(JIONSSFSNSSAI) obtained from redis has changes , not sure whats the reason for it ?
As a result I can't perform operations on the obtained Map since equals and hashcode don't match to the same key.


2366
Add Kryo5 codec

No description provided.


2367
Reads failing on replication mode when attempting to read immediately after write

Hello @mrniko
We are facing an issue when using redisson with Elasticache with replication.
We are writing some 100K key value pairs to a map and then renaming it. Then we immediately attempt to read the same. It fails and redisson reports that the key does not exist.
Note that we have default values of read mode (SLAVE) and scan interval (1000ms) . Can you please suggest if changing to MASTER_SLAVE read mode can help in this. Also are there any configurations on redisson that we can try with.
Thanks,
Yash


2369
Migrate data from a Redis cluster to an other


I want to migrate data from an old Redis cluster to a new one programmatically, so I did this :
The problem with this, is that I when I do RBucket::get, Redisson try to decode the value with a class that is not necessarily in the classpath (because that was set by an other microservice).
Is there a way to disable decoding in Redisson ? Or a better way to do this ?


2370
Redis hostname gets a `]` at the end


Connects to Redis on AWS

Netty throws an exception trying to resolve the hostname:
Somehow, there is a added to the hostname, even though my redisson.json does not contain one.
Steps to reproduce or test case
Click this button to deploy the repro example for free on Heroku:
Then view the logs (you may need to restart the app if you want to view the logs in the browser because it crashes).
Or you may run this sample app with a command like:


2371
Connection issue with redisson 3.11.x and Amazon ElastiCache Redis cluster mode

Amazon ElastiCache Redis cluster mode, Redis version:  3.2.4
Redisson version: 3.11.x Community version.
Java version: Oracle 1.8
App: Spring boot 1.5.22 with spring-data-redis 1.8.23
Hi,
When I deploy my app to Amazon dev server, after about 24 to 28 hours, I got the following log:
And my app sometimes throws exception when it gets data from redis.
I have such issue in redisson 3.11.0.to 3.11.4
If I switch back to redisson 3.10.7, then it is ok. Please help to fix it. Thank you very much.


2372
Unable to Create Redisson Session


Session object is stored in Redis

Getting the following error trying to enable session replication via Redisson:
Steps to reproduce or test case
Tomcat Version 8.0.14


2373
Connection refused: no further information




2374
none




2375
none




2376
redisson session

why session is null?


2377
Need details on entry updated

Hi there,
I am using redisson and just imagined a possible behavior on scaled environments.
I have a Redisson Map like that:
Where MyDataSerializable is my custom serializer for redisson.
Where BaseWebsite is a bean stored in database
Imagine I have two instances which have in memory this map entry.
Now one of them update the BaseWebsite's object and then do a "map.fastput(id, object);"
Since the website_id didn't change, when the other instance will do "map.get(id);", will the map entry be refetched and the website's object reloaded or not?
Thanks,


2378
Hibernate with Redisson (L2 cache) : invalidate cache when adding a @Column to @Entity


When I add a @Column on an @Entity, I want Redisson to invalidate the cache, so to do this I manually change the region property in the @Cache annotation.
Is there a better way to do this ?

When I add a @Column on an @Entity with @Cache, I got an exception when Redisson try to fetch the entity in Redis.


2379
none




2380
none




2381
It doesn't work with RXJava 2


That it will work at all

Steps to reproduce or test case
Redisson configuration


2383
Running into RedisTimeoutException. Need help to figure out


few Timeout Exceptions

A lot of timeout exceptions and Can't add slave exceptions
Steps to reproduce or test case
intermittent
Redis version
Azure Redis Cache with 5 shards
My logs are flooded with these exceptions and when I login to Azure portal, I see the CPU metric for Redis spiked to 100%. Any help is appreciated.


2384
none




2385
RScheduledExecutorService




2386
RScheduledExecutorService two usage attention


test RScheduledExecutorService as demo:
and run 2 JVM
Expected: every 10 second only one thread run in one of two JVM

has one run thread in both JVM in evety 10 second
shutdown one JVM ,has two run thread in the other JVM.
is that mean: one JVM schedule task , multiple JVM run as woker?
Steps to reproduce or test case


2387
none




2388
Make write-behind queue fault-tolerant

Store write-behind queue in Redis


2389
RedissonMapCache destroy


after mapCache.destroy() any lookup on mapCache should return null.

mapCache is not destroyed. It is still returning old values.
Steps to reproduce or test case


2390
none




2391
Add poll methods with limit to RQueue, RDeque, RDelayedQueue objects

No description provided.


2392
Question - LocalCacheMapOptions - Eviction Policy/TTL

If I were to set the EvictionPolicy and TimeToLive in the LocalCachedMapOptions when creating a new RLocalCachedMap, does this actually do anything?
Will each entry added to the map get this TTL set to it?  If so, would I be able to configure the redis server to expire entries whose TTL has past?
It is my understanding that the LocalCachedMap does not actually support eviction unless you are using Redisson Pro.


2393
Question - Not need many connection?

Redisson is using non-blocking I/O. so i think not need many connection.
But not exists detail setting connection pool guide in document.
If in many traffic, Will performance increase as connection pools increase?


2394
Question - is it possible to configure redisson to use multiple codecs?

is it possible to configure multiple codecs ?
we are trying to use redisson for tomcat session replication.
not all our session attributes are serializable, so we cannot use codec which relies on java serialization
i was wondering if we can specify in redisson.yaml list of codecs:
something like that:


2395
RedissonRxClient has not SortedSet implemented


To have it implemented



2396
java.lang.NumberFormatException when ZRangeByScore query with -Infinity Double value


No Exception must be thrown

Default Configuration on localhost


2397
RMapCache listener call twice


The map entry listener should only call once When invoke RMapCache#put method.
I found that if use single server, there will be no problem. But when configured in cluster mode, the listener will call twice.

The map entry listener call twice.
Steps to reproduce or test case
Clone the reidsson source code.
Execute unit test RedissonMapCacheTest#testCreatedListener
Before step2 , should create redisson server instance with cluster mode.


2398
Improve thread visibility in AsyncSemaphore

counter variable in AsyncSemaphore is not volatile variable.
but getCounter() method is public, and not synchronized.
getCounter() method is possible access by many thread. (not in now. but may be possible in the future.)
so add volatile keyword to counter variable.
Redisson version
redisson-3.11.5 (latest)


2399
ClusterNodesDecoder throw an exception when getting an unknown flag


When any node of a Redis Cluster has configure "cluster-slave-no-failover yes" which is enable after Redis 4.0,the result of "cluster nodes" command will contains a "nofailover" flag like this
ClusterNodesDecoder should ignore this flag and do nothing.

ClusterNodesDecoder throw an exception
Steps to reproduce or test case
set the config "cluster-slave-no-failover yes" to one slave instance of a Redis Cluster
start a RedissonClient connecting to that Redis Cluster


2401
Node: NodeSource hasn't been discovered yet Error Class: class org.redisson.client.RedisNodeNotFoundException


I am using AWS Elastic cache with cluster mode enabled and after scale out (adding more shards we see below errors from Redisson client on application layer

New node and slot changes need to be auto discovered and scale out should be seam less without failures.
Steps to reproduce or test case


2402
Serialization codec

Question
We are currently using the Kryo serializer, whenever these is a change to the object cached we have to invalidate entire cache else we face serialization errors.
How can we support backwards compatibility for already cached objects?


2403
Interrupted blocking methods aren't canceled

No description provided.


2404
none




2405
none




2406
IBM liberty Codec Error when trying to get session data from redis


Configured session management in IBM liberty below is the configuration inside liberty server.xml, below I also attached teh redis-jcache.yml configuration.  I was expecting the session data to be stored in redis and get back the session whenever needed based on user activity. However I see redis throwing error during decode the data from redis.


2407
none




2408
Redistribution session sharing, memory leak





2409
java.io.IOException: java.lang.RuntimeException: unable to find class for code 52




2410
redisson cannot close

my application is jar project not web application project , init redisson run my task, but redisson cannot shutdown.
redisson have Daemon thread?
how ido to shutdown .when my task run over.?


2411
RMap.get with trigger additional MapWriter.write when load value from external.


RMap.get only put data in Redis when load value from external.

RMap.get put data in both Redis and external.
Steps to reproduce or test case
clear redis data and do get operation which triger MapLoader.load to load value from external.


2412
Dynamic Lock IDs

More a question of use case then an issue -- unless the answer is "Cant do that"
I have some small 'microservice' type processes (running in docker ECS on AWS).  One thing they do is pocess S3 filels on change notificaiton.  Im subscribing to a SNS topic which then gets routeed and load balnced to an avoaible node.   For some operations I want to 'lock' a segment of code identifyed by the S3 Path -- Like a pool of ionotify workers.
Since the spae of possible key values is large and unknown upfront I cant pre-allocate locks.
Rather when a node gets an event I want it to 'lock' such that other nodes if they get the ssame event can be (cooperatively) kept from operrating on the same file at th3es ame time.
(inthe same process or a differnt process) In a period of an hour -- hundreds or thousands of unique keys/files may occur.  The operations while locked may vary from ms to munltiple minutes.  I realize I will likely have to treat these cases differnt -- (keep a map of locked node)
My question is this.  I tried a 'simplistic' approch which carates a NEW lock structure on eveyr eent, passing it the unique IID vailel Then after 'work' is complete releasing the lock.
Other apps may be doing the same thing and they should block in some way sothey dont both operatioe on the same file.   This seems to work --but I dont know if its effective.
For exmaple -- how 'expensive' is it to allodate a new lock.
If I simply 'unlock a loc does that delete it from Redis ?   What do I need to do to 'release' the lock  fully?  THen assumign all went well -- what is the latency to examime a lock ot sed if its sill in use ?
There will be hundreds of uniquie Ids --  Is there a better dataa type for this ?  Maybe a combonation of a Map and Lock ?
Any suggestions welcom.


2413
PublishSubscribeService#freePubSubConnections to be per cluster node?


Subscribe/connect to the cluster node specific to the topic

Great chance to subscribe/connect to wrong cluster node
Steps to reproduce or test case
2-1. subscribe to topic 1, correct cluster node connected/subscribed
2-2. subscribe to topic 2 from different cluster node, but still node of topic 1 is connected/subscribed
When "freeEntry == null", PublishSubscribeService#connect does the right thing by locating cluster node via topic.
Nonetheless, when "freeEntry != null", topic 2 of above reproduction would use connection to topic 1 cluster node. For example of cluster of 5 nodes, we experienced 80% chance topic 2 appeared successfully subscribed, but never notified.
Maybe PublishSubscribeService#freePubSubConnections can be per cluster node ?
Additionally, ClusterConnectionManager#calcSlot parses key out of "{KEY}..." to locate cluster node, any chance to extend it to support Redis format of "keyspace*:KEY" such as the one from redisson/src/test/java/org/redisson/RedissonTopicTest.java please ?
More additionally, any chance to extend ClusterConnectionManager to subscribe/connect to all cluster nodes for non-key based topics "__keyevent@*" such as the ones from redisson/src/main/java/org/redisson/RedissonObject.java & redisson/src/main/java/org/redisson/spring/session/RedissonSessionRepository.java please ?


2414
none




2415
springboot




2416
none




2417
Tomcat Redis Session Manager & Scoped Spring Beans as dependecies problem

Hi,
I'm using Tomcat Redis Session Manager. Our application uses Spring Beans with scoped beans as dependencies:

Autowired session scoped bean member of a singleton bean should preserve its state/value inside same session.

Autowired session scoped bean member of singleton bean does not preserve its state/value inside same session. Right after setting some (primitive) field of this session bean, it returns empty value (e.g. empty string).


2418
none




2419
Unable to decode data NPE




2420
Can't write command: (PING)




2421
WriteRedisConnectionException




2422
none




2423
RedissonMap.getAllAsync return smaller Map<K, V> than expected when load value from external.


RedissonMap.getAllAsync(keySet) can return all correct value when load value from external.

RedissonMap.getAllAsync return smaller Map<K, V> than expected when load value from external.
Steps to reproduce or test case
suppose:
clear redis data
One thread execute redisMapCache.get(key).
Sometimes the myMap.size() is smaller than keySet.size(), myMap.get(someKey) is null.


2424
Add RExecutorService.getTaskIds method

No description provided.


2425
data not persisted after application restart

Just trying out Redisson to see if its right for our product. Whenever I restart my application, all data that I have written to Redis disappear even if the Redis database hasn't itself restarted. Is it because Redisson only works as in-memory and doesn't actually write to the Redis Database?
I am very new to this so excuse me if I am missing something fundamental
Regards


2426
none




2427
Add awaitAsync methods to RCountDownLatch object

No description provided.


2428
Channel subscription process in interrupted methods can't be interrupted

No description provided.


2429
Add RCountDownLatchRx and RCountDownLatchReactive objects

No description provided.


2430
ClassNotFoundException: org.hibernate.cache.spi.support.AbstractReadWriteAccess$Item

I use Redission and Redission-Hibernate and got this error but cannot figure why.



2431
RedissonSessionManager tomcat session timeout in cluster environment even if user is active

redisson session manager is creating sessions which is getting expired after 30 minutes even if the user is actively reading the session every few minutes. This is happening in clustering environment, we have AWS redis cluster cache as server and using tomcat redisson session manager. Our application runs on multiple tomcat instances

If user is actively reading transactions, same session should be active all the time since the time user is active.

Session manager expiring the session after 30 minutes since initial login/session creation time even if user is updating transaction in the beginning and constantly reading the session data.
Steps to reproduce or test case
web.xml set session timeout as 30 mins
using Tomcat manager like this


2432
none




2433
"redissonClient.getMap(redisKey, options)" will return empty after redis service restart

Scenario
Using DB as the persistence data of redis,after redis service restart, redis cache is empty, when "redissonClient.getMap(redisKey, options)", the loader in options is not called.
"redissonClient.getMap(redisKey, options).size()=0"

the loader in options will called when redis cache is empty
after redis server restart, when calling "redissonclient.getmap (rediskey, options)", redisson finds that the redis cache is empty. It should read the data externally through the loader and load it into the redis cache

the loader is not excuted, the data in the redis cache is incomplete after the redis server is restarted
Steps to reproduce or test case
restart redis server, do get operation with options, load data from DB


2434
none




2435
none




2436
Redlock implement

the usage of RedissonMultiLock :
RLock lock1 = client1.getLock("lock1");
RLock lock2 = client1.getLock("lock2");
RLock lock3 = client2.getLock("lock3");
RedissonMultiLock lock = new RedissonRedLock(lock1, lock2, lock3);
so ,according to the redlock algorithm, how should i ensoure lock1-lock3 finally  stored in different redis master in redis  cluster


2437
Redlock implement

he usage of RedissonMultiLock :
RLock lock1 = client1.getLock("lock1");
RLock lock2 = client1.getLock("lock2");
RLock lock3 = client2.getLock("lock3");
RedissonMultiLock lock = new RedissonRedLock(lock1, lock2, lock3);
so ,according to the redlock algorithm, how should i ensoure lock1-lock3 finally stored in different redis master in redis cluster
@mrniko  do not easily close my issue!
i just want to  ask  how should i  "locate locks manually" , i have no idea how to ensure   keys of a  RedissonRedLock  distributed throughout redis masters in a redis cluster
that is to say , if i want get a redlock  in a 3 masters-slavses of  redis clusrer, how shoud i define  3 name of key  to implement    redlock by redisson.
lockkey1  -->  master1;
lockkey2  -->  master2;
lockkey3  -->  master3;
thanks, this is very important  to those use redisson


2438
Reddison AWS ElastiCache Redis Cluster connection issues

When attempting to connect to our AWS ElastiCache Redis instance using the application.yaml configuration below.

Successful connection

I receive the following exception when trying to use the RedissonClient
Steps to reproduce or test case
Created Spring Boot Application (2.2.1), Added redisson-spring-boot-starter (3.11.5)
Created a spring Scheduled function to execute every second that uses RLock to getLock(), then tryLock(), then unlock()
The AWS ElastiCache Redis configuration is using TLS encryption (Encryption-in-transit) , and I'm able to connect using the same information using the instructions provided by AWS here


2439
Add feature to get low level details about redis instances using RedissonClient


We should have a way to get low level details(e.g. memory details, client list etc) about redis instances using RedissonClient.
Or
We should be able to get single RedisConnection from pool of connection via RedissonClient.

Currently we don't have a way to do it. We can get these details from RedisClient object.
Steps to reproduce or test case
RedissonClient is injected into spring container on startup.
I want to get low-level details about redis instances. What could be the best way to do it.
Can I get single connection from pool of connection to get the details?
I am using redisson-spring-boot-starter for connecting to redis instances using RedissonClient.
I am making use of spring.redis.redisson.config=classpath:redisson.yaml property for setting the yaml configuration.


2440
java.lang.IllegalArgumentException: java.net.MalformedURLException: Invalid host:

same exception for all the other nodes of cluster.


2441
set the max block time for method lock()

first ,i  set a key "lock" with no expiration in redis.
then  i use  lock  like the following:
after running,the program was blocking continuously at the  code line of lock.lock();
is this a bug or can i set a parm such as max time of waitting lock?
thanks.


2442
some start error with redisson-spring-boot-starter

I need some help to deal with my problem
Steps to reproduce or test case
my dependency:
when start my springboot application, some error happened,but redissonClient.getLock worked, errors are as follows:


2443
none




2444
Why ExpirableSemaphore does not expire?

@mrniko, could you take a look at this question:


2445
Add RExecutorService task expiration

No description provided.


2446
none




2447
none




2448
Update documentation to RMapReactive

Method 'putIfAbsent' at javadoc says:
But method wrap null as empty Mono and return Mono.empty() instead of null.
Try to check it with this


2449
Spring boot with redisson 3.11.5 fails without optional actuator dependency

It looks like the file RedissonCacheMeterBinderProvider needs a ConditionalOnClass annotation, otherwise it isn't working with Spring boot 2 without the optional actuator dependency.


2451
RRateLimiter Exception----RateLimiter is not initialized

Redisson version:3.11.2
Exception details:


2453
none




2454
Can I config spring.redis.redisson.config in application.properties?

I am using redisson-spring-boot-starter in my spring-boot project, your document writed like this:
can I config properties in redisson.yaml in application.properties of spring-boot?


2455
Unable to retrieve original string stored in HyperLogLog using GET operation on the key

Hi Everyone,
I am in process of backing up the values present in the HyperLogLog data structure in Redis to a backing store on disk, which can later be used for cache misses. I am unable to do the same because of the following scenario, details of which I have mentioned below.
Please let me know if anyone has encountered the same or if have any solutions for this scenario.
Thanks in advance!


Although, on running GET operation from redisson client it is returning string like HYLL]f�b�.
Steps to reproduce or test case
Value returned here is not the expected one.


2456
ElasticCache - How to use configuration endpoint instead of node addresses?

Is there a way to use configuration endpoint with clusterServersConfig instead of using individual node addresses?


2457
exception while retrieving data in RMap , data inserted using RMapCache

Observation ,
do we need to set codec in this case, is fst is default in RMapCache. or RMap


2458
none




2460
RMap.addAndGet is not compatible with get/put methods by using default codec

By using default codec FstCodec, put/get methods is not compatible with addAndGet method. When calling RMap,get after RMap.addAndGet, the program will throw DecoderException.


2462
redis cluster write successfully but read bucket failed


read bucket value properly

get bucket by name, and then bucket.get(), the result is null
Steps to reproduce or test case
get bucket by name and set a value
read the bucket and call the get method
three masters three slaves in local machine


2463
Add MyBatis cache implementation

No description provided.


2464
Caused by: java.lang.ClassNotFoundException: org.springframework.data.redis.connection.ReactiveRedisConnectionFactory

3.11.6 witch spring boot 1.5.7
boot up fail
Caused by: java.lang.ClassNotFoundException: org.springframework.data.redis.connection.ReactiveRedisConnectionFactory


2465
redisson set value and get value from bucket is null


get the set value

the value is null
Steps to reproduce or test case
redis-cli to create a cluster include six nodes
useCluster.addAddress to set and get value


2466
ERR Error running script:




2467
none




2468
none





2469
Add RScheduledExecutorService task expiration

No description provided.


2470
Multiple tomcat instance behind a load balancer

Hi, We are trying to host the application in 2 tomcat instance hosted behind a application gateway(load balancer in AWS). In both tomcat instance we have configured redisson session manager with required jars in tomcat/lib.
Below is the context xml entry:
Scenario:
Bring up instance 1 and login to app, go to a screen and do some changes and don't save yet. This ensures we have logged in to instance 1.
Bring up instance 2 now. Bring down the instance 1. Try to do save on the application now and app throws below error.
Basically we are trying to aim for zero downtime with these 2 instances, so that if one instance goes down, other instance should be able to pick up the application state and continue the execution without user needing to re-login.
Please help us with the above error.


2471
Redisson prints sentinel has down messages frequently

Version 3.11.6

Should not print this logs frequently

When connected to redis deployed in kubernetes and sentinel address is a headless kubernetes SVC.


2472
Cache write behind - Redis Live Object Service.

Hi Guys,
Would there be support on having a cache write behind listener for the RLO service as we have it for RMap ? This is for the use case , if I have Java POJO as a REntity and I have persisted the REntity Object using RLO service . As a result of that , I want to a cache write behind functionality to persist the entity in MySQL.
Regards,
Harish


2473
Subscribe timeout  AND Unable to send command AND Redis server response timeout




2474
none




2475
slave network down reconnect

my configuration
1.slave 7007,7008,7009 vs network down
log: slave 127.0.0.1/127.0.0.1:7007 has been disconnected after 180000 ms interval since moment of the first failed connection
1. Kill the redis process down the network
2. Remove the redis from the cluster by forgetting the live redis.
4.initialize redis data redis 7007,7008,7009
1. Application error log
2. Error log stop after joining cluster with addis node redis 7007,7008,7009
If you look at redisson ConnectionPool.createConnection (), if it fails to establish a connection, checkForReconnect () is called to check if it is reconnected.
If the network was restored immediately after 1, it would be reconnected and the problem would be solved. But the network did not recover immediately.
There will be no information about slave 7007,7008,7009 when the cluster view is fetched after 3 no (Remove the redis from the cluster by forgetting the live redis.)
If I update the cluster information and there is a redis node removed at this time, is it correct that it should be excluded from reconnect check in ConnectionPool.scheduleCheck ()?


2476
Redisson Session Manager session attributes problem

We want to use Redisson Session Manager as a Tomcat Session Manager. It is essential that Redisson is configured as a shared instance in Tomcat since plugins that need access to a shared Session will be used. We found a behavior that could potentially indicate a bug in the session management.
A simplified diagram of our system is shown in the following figure.
The repository with the test project based on Spring Boot is here:

All apps should use the same shared Session which is resolved based on JSESSIONID cookie. The Session should contain attributes with latest values that also include session scoped beans.
When the readMode property of Manager configuration in context.xml is set to REDIS, behavior seems to be as expected (see value of session_attribute_count in response or logs which is incremented by 1 for every request). But with REDIS read mode, session scoped beans are not stored as session attributes.
However, if we change readMode to MEMORY, session scoped beans are stored as session attributes. Behavior is as expected if requests are sent to apps with the same context path (app-a in Tomcat 1 and Tomcat 2). When the request is sent to a different app (e.g. to app-b after being sent to app-a before), the second app (app-b) gets session attributes with values of the last request to the first app (app-a). If the request is sent to the first app (app-a) again, the session attribute values such as session_attribute_count will not continue from the values that the second app (app-b) had set. It also seems that session attributes that are added to the Session by the second app (such as session_attribute_app_b_value) are not available in the first app.
Steps to reproduce or test case
Checkout repository with the test project
Build project with maven (mvn clean verify) to get war files at
Run docker-compose up from project root to set up stack with two Tomcats and Redis
Send requests to following endpoints (use the same session identifier) and inspect response and logs:
Set different readMode property value (REDIS or MEMORY), redeploy docker stack, flush Redis and repeat step 4.


2477
none




2478
upgrade 3.11.6

springboot version 2.1.11.RELEASE,upgrdate 3.11.5to 3.11.6,error
java.lang.NoClassDefFoundError: org/springframework/data/redis/connection/RedisStreamCommands
3.11.6 Can it only support springboot verison 2.2


2479
Add ReactiveTransactionManager implementation

No description provided.


2480
Spring Transaction Manager doesn't handle Redisson TransactionException

No description provided.


2481
none




2482
none




2483
Reactive/Rxjava2 transaction doesn't unlock lock on rollback or commit

No description provided.


2484
RedissonPriorityQueue throws NPE when add() method is called



I'm getting NPE at line 180
Steps to reproduce or test case
I think it is possible looking BinarySearchCode inside the class
please take a  look at the code:


2486
java.lang.ClassNotFoundException: org.springframework.data.redis.connection.RedisStreamCommands

Hello


2487
java.lang.ClassNotFoundException: org.springframework.data.redis.connection.RedisStreamCommands

Hello


2488
java.lang.ClassNotFoundException: org.springframework.data.redis.connection.RedisStreamCommands

Hello
I just submitted two questions that didn't work. The reason is that I pressed the wrong key(ctrl + enter on windows). I'm sorry to be embarrassed. My problem is that I use springboot version 2.1.11.RELEASE and the redisson-spring-boot-starter version is 3.11.  .6, the error is the same as the title. I checked issue 2478 and suggested that he downgrade to redisson-spring-data-21. If it is redisson-spring-boot-starter, what version should he downgrade to?


2489
none




2490
none




2491
Add taskTimeout setting to RExecutorService

No description provided.


2492
none




2493
Encoder NPE

Redisson configuration
Master-Slave Cluster configuration


2494
Issue May Be Need Open Again

#2477


2495
none




2496
none




2497
takeLastAndOfferFirstTo() does not block until an element is available


Calling RBlockingQueue.takeLastAndOfferFirstTo(otherQueue) should block until an element is available.

When the queue is empty RBlockingQueue.takeLastAndOfferFirstTo(otherQueue) returns null immediately.
Steps to reproduce or test case


2498
org.redisson.RedissonRemoteService caches and runs old versions of code


When submitting a task to a Redisson executor service the task is run in the state at the time of submit().
Meaning: when i submit at task at some time X the code in the body of that task must execute exactly as it was at time X. If in the meantime the task code is modified and a new task is submitted at time Y, the code as it was submitted at time Y must be executed.

Both code-at-time-X and code-at-time-Y are executed, randomly. This leads to unpredictable behaviour.
Actually it seems more than one version of the code is cached and one is randomly picked for execution. This was proved by adding log statements.
When restarting the app one of the versions would be executed.
It's not documented how to clear this cache.
Steps to reproduce or test case
BASIC:
Create a Runnable that delegates part of the execution to a spring bean. (using the bean factory obtained from the spring context)
Submit the Runnable in different versions, making sure it "prints" some different debugging output during execution, so it's possible to know which version is running.
CASE 1: in one of the versions i changed the type of data i write to a redis list from string to a json object. BOTH versions were running! That means RANDOMLY some tasks would write a json and some others a string. The service somehow caches the code to run.
CASE 2: the code caching became even more evident when the code was refactored (and one method eliminated). AFTER RESTART the executor service was expecting (for NEWLY submitted tasks) the deleted class to be present, and failed with a no-such-method-error


2499
Add RSemaphore.addPermits method

No description provided.


2500
RedissonReactiveClient,  should aways invoke next method.

always return value, so i can check is exists
Steps to reproduce or test case


2501
NPE when using FST codec only in Elastic cache redis

This is observed only when a key is already put in the map. When key is not available it is working as expected. put operation was successful but after that when we try to get the value of the key, following exception is taken. Using redis elastic cache 5.0.6 with redisson 3.11.3


2502
Tomcat session expires causing session information in redis to be deleted

Background: The use Redis do session sharing. Session is currently shared by three projects
Problem: After logining in to a service, the service does not operate for a long time. When the timeout time set by the service tomcat is reached, even if other services are still in operation, there will be a forced exit. However, as long as one service is still in use, we do not want it to exit because one of the services has reached the timeout period.
Is there a good solution?
Thanks


2503
Provide classloader incase of FST so that it doesnt get the class loader from current thread

Do we have a way to provide class loader when using FST codec. we are facing classNotfound exceptions as the FSTConfiguration is picking up the current thread class loader which is used by RedisExecutor as shown in the below stack trace.
Our proprietary classes are loaded from our class loader. So wanted to understand if we can set the classloader which is used by FSTCodec.


2506
Is there a guide for porting from Jedis?

After running into some threading/scalability issues I'm moving over redission. Would be great if there was a guide for porting from Jedis.
For example, what is the closest resembling API to the jedis.get() and jedis.set() methods?


2507
How to FLUSHALL?

Is there a convenience method for FLUSHALL? Would be super helpful during development.


2508
java.lang.IllegalStateException: Failed to introspect Class from ClassLoader

Deploying spring boot as web application :
The missing class 'org.springframework.boot.actuate.metrics.cache.CacheMeterBinderProvider' is in spring-boot-actuator-2.1.6.RELEASE.jar that is inside the web application inside WEB-INF/lib folder
I guess the issue is because the redisson library is inside tomcat system lib and the introspection happens from the web application -  e.g. different classloaders - I guess redisson tomcat lib can't load classes from war file where the CacheMeterBinderProvider class is located - If I remove redisson lib from tomcat the web application deploys and functions as intended
If I put a break point into org.springframework.util.ReflectionUtils method's getDeclaredMethods
where the exception occur here is the exception stack trace from this method and exception that occur:
The getDeclaredMethods is invoked with parameter "org.redisson.spring.cache.RedissonCacheStatisticsAutoConfiguration" for bean redissonCacheMeterBinderProvider
here is the exception :
Note there are no "org.springframework" libs in Tomcat lib directory (only inside war lib directory).
The class "org.springframework.boot.actuate.metrics.cache.CacheMeterBinderProvider" is defined only inside /WEB-INF/lib/spring-boot-actuator-2.1.6.RELEASE.jar of the war file (no such class inside tomcat lib or another jar file inside the war file)
If I define this inside spring boot web app in the @configuration:
So I can't exclude redisson auto configuration. The javax.cache package is only defined inside redisson;s lib redisson-all-3.11.1-SNAPSHOT.jar - there are no javax.cache packages bundled with the war file


2509
RedissonConnectionFactory does not shutdown RedissonClient on Spring destroy() call

Using Redisson PRO 3.11.6.
The destroy() method on RedissonConnectionFactory is empty. When the RedissonConnectionFactory creates its own RedissonClient using the default constructor or the constructor that takes a Config as an argument, it should be responsible for calling shutdown() on the created RedissonClient. The RedissonClient is internal to the class and cannot be shutdown otherwise.
To safely manage resources, we must use the constructor that takes a RedissonClient argument so that the client has an external reference that we can shutdown.


2510
none




2511
No result for read command on redis cluster(version 5.* ) with password


read from redis cluster  properly
read nothing from redis clsuter
Steps to reproduce or test case
1. redis cluster(5.*) with password
2 run the following code. When we use the following code to set an value(CC) for key(cc),when these codes runs on redis version of 4.*,  CC will be printed, But when it runs on redis cluster of version 5.*, null will be printed. But when we use command (get cc) in redis-cli console, we could get the value 'CC' of key 'cc'.


2512
none




2513
none




2514
none




2515
Lock expiration renewal stops working after connection error/timeout


After a connection problem during expiration renewal, if a new lock is created (with the same key), the expiration renewal should be working.

If an error ocurred in the expiration renewal (ex: connection to redis timeout), it stops working for new locks.
Steps to reproduce or test case
Create a Redisson lock
Force a expiration renewal timeout (ex: restarting redis-server)
unlock (it will throw a exception, as expected)
Create a new lock with the same key
wait for the expiration renewal time
unlock (it will throw a exception, because the expiration renewal is not working)
Default, SingleServer, (LockWatchdogTimeout reduced just for testing)
I believe the problem is in RedissonLock.unlockAsync method, when opStatus is null, the cancelExpirationRenewal method should be called.


2516
With spring boot application redisson by default connect to local host even after providing configuration

I am creating tiny redis cache library for all running java based microservices using redisson. This library will be used by all spring boot and and non spring boot microservices.
I am using below maven dependency for redission:
And using below implementation for redisson bean creation
@Configuration
Above configuration works well when I use this library with non spring boot based application.
But it fails with spring boot based application. I saw that redissonClient try to connect to local redis instance instead of configuration provided by me in application.properties.
It works when I used below configration in application.properties
But being a common library I can not use above configuration for non spring boot based application.
Is there a way where I can force redissonClient to be created with custom configuration instead of default configuration?


2519
none




2520
How can i merge redisson.yml and spring-application.yml ·20

Hi, i just want to change the codec from org.redisson.codec.FstCodec to org.redisson.codec.JsonJacksonCodec, so i write the redisson.yml:
but when i run the application, it calls exception:
in org.redisson.spring.starter.RedissonAutoConfiguration#redisson,i find code
so, i must write server config in redisson.yml again.
Is there anyway to merge  redisson.yml and  spring-application.yml?


2521
How to dynamically fetch node addresses from AWS Elasticache?

How is redisson meant to be used with AWS Elasticache? Would love to see a full example with multiple shards, dynamically fetching node addresses, failover handling, node health monitoring etc.
This link gives a very minimal example, I think a production ready example would be super helpful to anyone using redisson with AWS elasticache.


2522
Subscriptions become zombies when network lost

Steps to reproduce or test case
Establish a connection to a single-server Redis
Subscribe to a topic using Redisson
Kill the network or restart Redis

Existing subscriptions should be closed when connection to Redis is lost
(and/or) subscriptions should re-subscribe when connection becomes possible again

The subscriptions are left in a zombie state where they're not connected and will never receive any data. Even if a new connection from the same JVM is established to Redis once it's available again, and it publishes data on the topic, the zombie subscription never receives it.
It's ok that Redisson doesn't resubscribe when connection becomes available, but at the bare minimum it'd be super helpful if it closes the subscription or gave me an event to listen to or something so that I could handle it myself. I've tried all the options like keep-alive etc and there doesn't seem to be any workaround.


2523
Deserialization the object from redis to RList throws InvocationTargetException

Deserialization the object from redis to RList throws InvocationTargetException


2524
Deserialization the object from redis to RList throws InvocationTargetException

Deserialization the object from redis to RList throws InvocationTargetException


2525
Add tryExecute and tryExecuteAsync methods to RRemoteService object

No description provided.


2526
none




2527
How to build from source and package as single jar without all optional dependency?

Is your feature request related to a problem? Please describe.
Redission collection is used in my application (single jar) and want to package needed classes without all optional dependencies to reduce app size.
Describe the solution you'd like
Split feature (optional dependencies are used) as sub module.
Describe alternatives you've considered
Remove all optional dependencies java classes from my jar (Follow dependency document in wiki). But I don't think it is right approach and whether have potential problems.


2528
Connecting to a password protected Redis Sentinel fails, due to scheme not being forwarded


Given both redis sentinel and redis master/slave are protected by passwords, Redisson should be able to establish a connection through sentinel.

Scheme ( redis or rediss) is not being forwarding from the Redis Sentinel URI to the URI created in order to connect the Redis node.
Following exception is returned:
Steps to reproduce or test case
Setup a password protected Redis Sentinel/Redis nodes and try to connect using useSentinelServers config.
I replicated this using docker:


2529
redisson-spring-boot-starter RedissonAutoConfiguration customizer

In Spring Boot RedissonAutoConfiguration there is the need for post customizing the autoconfigured RedissonClient.
Would you consider a pull request with this functionality?


2530
Delay job execute time is not correct when use RDelayedQueue

Use RDelayedQueue hit an bug.
The code is as below:
I expect the job can be executed after 5 second.
In my prod environment, I found almost all job is executed after 5 second, but only a few jobs were executed immediately(do not delay 5 seconds)
Steps to reproduce or test case
It is hard to reproducde, only a few jobs were executed immediately in each day


2531
java.lang.ClassCastException: java.lang.Double cannot be cast to java.lang.Float

No exception is thrown
Steps to reproduce or test case


2532
none




2535
"RedisConnectionException: SlaveConnectionPool no available Redis entries" even when the slaves are reachable and connections established

We are using Redisson with AWS elasticache redisson cluster. Redisson client throws exception from some of the hosts. Only way to recover is to reboot the EC2 instances/restart the application. Slaves are reachable from the EC2.
Redisson client fails with the following exception eventhough slaves are reachable from EC2.


2536
Updating from 3.8.2 to 3.12.0 breaks.

When I try to upgrade redisson from 3.8.2 to the version after 3.11.2. The following code breaks.
The code should pass, but it throws an error:


2537
RRateLimiter allows permits query

RRateLimiter don't allow query the remain permits for now . so i can not get the permits . i think add a method like :
int remain() may be well.


2538
none




2539
Memory Leak in SentinelConnectionManager ·39

Might be connected to #2120, but I wasn't too sure about that, so I decided to create a new issue instead.
No memory leak?
SentinelConnectionManager is leaking memory because it stores too many connections to the sentinels in the nodeConnections map.
We are using a singleton Redisson instance for connecting to our replicated Redis instance (3 nodes, 3 sentinels). After running for some days, we are experiencing high GC times and OOM errors. Upon investigating the heap dump, we noticed that the SentinelConnectionManager stores nearly 50,000 connection to the same 3 sentinels in its nodeConnections map. However, the sentinels map itself only contains the expected 3 entries.
I tried analyzing and reproducing the leak myself, but I wasn't too successful since I am not familiar with your code. Would be great if you could have a look what could cause such a behavior :)
Unfortunately can't provide the heap dump since it might contain sensitive data.
Steps to reproduce or test case


2541
none




2542
Does the Redisson(BLPOP) support multily key?

Does the Redisson(BLPOP) support multily key?
Just like BLPOP key [key …],When multiple key parameters are given, check each list in order of parameter key, and the first non empty list header element will pop up


2543
RLock unlock always throw an exception what like 'not lock by current thread'

trylock and unlock success
RLock unlock always throw an exception what like 'not lock by current thread'
Steps to reproduce or test case
According to the stack information, the underlying asynchronous unlocking may cause the unlocking to throw an exception.This phenomenon can be reproduced 100%.


2544
lock.isHeldByCurrentThread() verification  before unlocking Exception

RLock
lock.isHeldByCurrentThread() verification  before unlocking
but sometimes exception


2545
Implement port mapping for sentinel and reported master

We are interested in running Sentinel behind a L4 proxy terminating TLS.  This sentinel will report a master at IP:master_port.  This master is behind a second L4 proxy terminating TLS on a port we plan to infer from the reported master_port.   Ideally, Redisson would offer Sentinel + Master over TLS, with the ability to configure a port mapping function to take master_port and translate it to the L4 proxy port terminating TLS in front of the master.   As an aside, our model does not require us to translate either the sentinel or master IP, but the Lettuce example below fully allows that.
Here is the equivalent Lettuce 5.2.2 (due out 2/11/2020) code:
Describe alternatives you've considered
Many.  Including putting the sentinel / master cluster behind an F5 load balancer terminating TLS and let the F5 choose the master.  Clients program to the F5 over plain Redis API over TLS.


2546
java.lang.IllegalMonitorStateException: attempt to unlock lock, not locked by current thread by node id:

java.lang.IllegalMonitorStateException: attempt to unlock lock, not locked by current thread by node id:


2547
there are dead locks in redis

in my app, sometimes there are some dead locks in redis


2548
java.net.MalformedURLException: Invalid host

When using ipv6, we get the following error:
It seems that in org.redisson.connection.SentinelConnectionManager#createAddress, the square bracket is added to the address; then in new RedisURI(), the square bracket was added AGAIN.


2549
ElastiCache/Redis - RedisConnectionException and RedisResponseTimeoutException

We use redis distributed delay queues for queuing data for future process and connecting to redis using node from each shard in cluster. Around 10% of the data is lost due to these errors.
Redis client version -3.9.1
We see RedisConnectionException and RedisResponseTimeoutException**
RedisResponseTimeoutException: Redis server response timeout (3000 ms) occurred for command:".
Here is the complete error.
Redis configuration is below.  We have configured single node from each shard, what is the recommended approach for node configuration, cluster endpoint or nodes from each shard?


2550
Crash connection Redis

Hello
I have a bug in redisson
i have many server who need to be connected on redis
when the first one start all work fine it is connected
but when the second one start the server freeze and there is no error log
it freeze when i call Redisson.create(config)
it's the same program than the first server so i don't understand why it don't work
someone as any idea ?
the only error i've found is this summon when i try to login to the server, it will crash and restart and print me this:


2551
RLock.unlock() results in ERR hash value is not an integer

The following code snippet will successfully create and lock RLock and will throw RedisException unlocking the lock.


2552
Master/Slave mode with master only writer and slaves as reader

I tried Master Slave configuration for redission-mybatis. I want to set 'master' only for writer and 'slave' for read only. But when is set master slave configuration i can see master is also used for reading purpose.
Can i set configuration in which 'master' work only as writer not reader?


2553
delay queue doesn't work after one of cluster node occur master slave switch

Expected behavior
throw follow exception continuous, but the the APP host acctualy has ony 7 connection
thanks.


2554
Improve Redisson Eviction Rate

Our application uses UUIDs for keys and stores them in a RMapCache<String, Boolean>. Clearing 3MB of expired keys currently takes about 10 minutes though even a trivial service load can generate 5-7MB/min. Is there a way to increase the frequency of the eviction task, or increase the batch size of objects that are expired ?
Currently using a default configuration, connecting to a 3-node Redis cluster in Sentinel mode.


2555
Cycled RLO objects with cause RCascadeType.PERSIST infinite loop and stuck

Is your feature request related to a problem? Please describe.
I have about 100,000 redis object should be persist into Redis.
And they are of several data types. each data type will associate with others.
In other word, they form a cycle.
If I use RCascadeType.PERSIST, the program will stuck. Because it is gone into an infinite loop.
Describe the solution you'd like
regisiter rlo class method should record all the classes that user need to persist
add a new method to calculate the class's adjacencyArrays.
persist vertex classes
construct relationships according to adjacencyArrays.
Describe alternatives you've considered


2556
Unable to remove lock automatically

The code is as follows, the lock cannot be automatically deleted, the lock will continue to live


2557
Can you use a service to lock and unlock threads?

I have a redisson lock implementation in my code like:
Distributed lock implementation:
SonarQube complains not having the lock unlocked in the same path as lock. Is there any solution for this? Or can we not have this implementation for redisson locks? It does always execute the unlock but relies on the client to do so.


2558
java.lang.NoClassDefFoundError: org.redisson.misc.RedissonPromise

Working with replicaof server.
Returning data when using RedisDesktopManager. But when I tried to create client following exception occurs with RedissonPromise
I am using implementation 'org.redisson:redisson:3.12.6'
same exception occurs using config.useSingleServer()


2559
Command still hasn't been written into connection?

There was almost no load on the system and it has almost no activity with only one idle connection  (we keep two connections in reserve - connectionMinimumIdleSize: 2) and the freeConnectionsCounter=63  (out of  connectionPoolSize: 64).
How come we received the "Command still hasn't been written into connection" error message? It seems like something was preventing Redisson from sending commands to Redis, resulting in a timeout exception...


2560
Distributed scheduled executor service with Spring Boot

Hello there.
I try to use Redisson for schedule tasks in my Spring Boot application. And I have the next issue: after application restart with graceful shutdown - Redison scheduled executor service is in shutdown state, and all my tasks are rejected with exception
java.util.concurrent.RejectedExecutionException: Task rejected. ExecutorService is in shutdown state
Here is my code:
I use Distributed scheduled executor service like a bean
I use spring boot version - 2.1.7.RELEASE, and redisson-spring-boot-starter with version 3.11.5
Thank you for any help!


2561
zCount 0/-1 instead of -inf/+inf

RedissonReactiveZSetCommands.zCount behaves incorrectly if one of range bounds is unbounded.
if lower bound is unbounded:
btw this is how RedissonReactiveZSetCommands.zRangeByScore implemented.


2562
Dynamically setting TTL

we set TTL into CacheConfig when the cache is initially created. Is there a way to change that AFTER creation?
we are caching an api endpoint and would like to return stale objects even after expiry.
one way to achieve this is to check the downstream api and if not responding then extend ttl to use the existing stale object.


2564
How to properly load redisson dependencies inside a jar file

Hello guys,
I've setup Redission, Redission-Hibernate and Spring Data Cache to work with Spring Boot.
When I start the application I'm getting the following warning:
When I start the application through eclipse application lunch, everything works fine. But when I create my application jar (mvn package), and run it by prompt command and issue a request for a cached resource, I'm getting the following error:
I have checked the dependencies inside the jar and I could find a nested dependency in the lib folder "./BOOT-INF/lib/hibernate-core-5.4.10.Final.jar".
I found the issue 2430, but in my case, all dependencies belongs to the same module.
What I'm missing?
Thanks in advance, Alan


2566
Unable to unlock  when thread isInterrupted

Unable to unlock when thread isInterrupted,Please,RUN it First!!!


2567
Unable to initialize JCache using Redisson's config object

Expected behavior
When using Redisson with JCache with custom Redisson config, this custom config should be taken into account
From documentation:
When executing Caching.getCachingProvider(), underneath config from default json config is used:
Steps to reproduce or test case
Create a simple project with an empty redisson-jache.json(or without the file at all).
Create a cache as explained in the documentation: 14.4 JCache API (JSR-107) implementation -> 3. Using Redisson's config object:


2568
Cache performance is less when compared to map.

We have performed an analysis on how map and cache performs with 50 KB and 1 MB data . As part of it, we observed map performs well compared to cache and also as data size increases the performance is degrading.
But this states better performance with 6 bytes of data even though with open source redisson.
Are there any configuration parameters which will help us to get better performance? If any, please provide the details of those parameters.
Here are the benchmark performance numbers we got for 10000 entries :
The redis configuration file, redisson configuration file and the sample program with which the performance numbers are taken are attached below.


2569
Reading stream throws IndexOutOfBoundsException

Expected behavior
Reading Redis stream containing message without any field-value pairs should return successfully.
Actual behavior
IndexOutOfBoundsException is thrown:


2570
How do i specify default permits when creating semaphore object with RMap

i am trying to create semaphore using below method from RMap interface.
What is the default permits associated with this semaphore ?  i wanted to use Semaphore as an alternate to RLock , so i need a default max permit of 1. I see trySetPermits() method in RSemaphore class.. But is there a way to set default number of permits while creating Semaphore object without having to call trySetPermits() method.
Without a provision to set a default number of permits, how would we achieve the scenario where multiple threads are trying to create a semaphore with same key ? Developer is forced to ensure that everytime a semaphore object is created for a given key,  trySetPermits() method need to be called exactly once in the entire lifecycle of application. Is my understanding right ? what happens in below scenario assuming events happen in same sequence as listed
thread 1 calls rmap.getsemaphore(key1);
thread 1 calls trySetPermits(1); // number of availble permits is 1
thread 1 calls acquire();  // number of available permits to 0
thread 2 calls rmap.getsemaphore(key1);
thread 2 calls trySetPermits(1); // Will this call sets the available permits to 1 again ? What would happen here?
thread 2 calls acquire() // ideally thread 2 should not acquire permit.  What would happen here?


2574
redisson.cache.ReferenceCacheMap causes OOM..

Recently I used redisson 3.11.6 to r/w online redis on our server serivce, however, after it runs few days correctly something bad happens. Yep, it is awful OOM. I dumped server memory file and found that the biggest object is ReferenceCacheMap from redission (see on the pic of jprofiler).. I am really confused about why this object increased all the time and can't be released by GC, I will post some pics, hope anyone can help me to fix this. Thanks a lot.


2575
RedissonLock fails to unsubscribe from channel when a lock is acquired

Expected behavior
The pub/sub channels that are created while trying to acquire a lock with RedissonLock should be unsubscribed when no longer needed.
Actual behavior
Some pub/sub channels are still present (meaning that the client did not unsubscribe) even after some locks are no longer used (either they expired or were unlocked). These channels are never cleaned up (still present after 24h since created). The only workaround to get rid of these is to restart the client.
This was observed because it caused a connection leak. When calling RedissonLock to obtain new locks this returned the error : Subscribe timeout: (7500ms). Increase 'subscriptionsPerConnection' and/or 'subscriptionConnectionPoolSize' parameters. We have increased the limits in order to have a workaround for this bug
Steps to reproduce or test case
use RedissonLock.java implementation with method lockInterruptibly(long leaseTime, TimeUnit unit) to obtain multiple locks simultaneously.
use lower limits for  subscription-connection-pool-size and  subscriptions-per-connection to increase the probability to see the bug
wait until this error shows up Subscribe timeout: (7500ms). Increase 'subscriptionsPerConnection' and/or 'subscriptionConnectionPoolSize' parameters.
connect to Redis server and fetch all lock keys and all pub-sub channels.
if number of pub-sub channels > active locks , then the bug was reproduced
if number of pub-sub channels does not decrease at all long after locks are being created, this means that subscriptions have leaked, active long after these are no longer used in RedissonLock implementation.


2576
How to know if RedissonMap is created at redis end

Is there a way to know if a map with given name is created at redis end. As per understanding, org.redisson.api.RedissonClient.getMap(java.lang.String name) always gives new RedissonMap and only creates interacts with redis when one does any map operations like get/put.
Which means Using org.redisson.api.RedissonClient.getMap(java.lang.String name) will not send any request to redis ?
So how can i know that if a map with given name already exists at redis end using any of the redisson apis?


2579
I find a bug about Redisson,when I use it to set data into redis server.

code:
I want to set "" into redis server,but I find that this data become "",when I check redis server with tool——Redis Desktop Manager.


2580
Add TTL on Comparator

Is your feature request related to a problem? Please describe.
We works with a lot of priority queue associated with Comparator (method trySetComparator). Result : Redisson create object in database like {akey}:redisson_sortedset_comparator, but never remove them.
Describe the solution you'd like
Could you add a parameter to set a TTL on theses objects? perhaps in method trySetComparator?
Describe alternatives you've considered
We have to delete these keys regularly, by hand


2581
Behaviour of RPermitExpirableSemaphores

few questions on RPermitExpirableSemaphore
what is the probability that permit id generated by  acquire() method returns same permit id for different or same key ? In otherwords is there a possiblity of collision of permit Ids in any scenario when acquiring the permit via this interface ?
What happens to the permit when redisson node on which the permit was taken has crashed after permit ? Does the permit expire ? Does the LockWatchDogTimeout come into play here as well ?
How does LockWatchDog Scheduler works ? Is this a single daemon thread or is there a TimerTask triggered for every lock request ? I am looking to understand implementation details of LockWatchDog . can we get a reference to the java class in Redisson Source code that is responsible for prolonging the expiry of keys


2582
Unable to decode data with NullPointer

No exceptions
Actual behavior
Error messages from CommandPubSubDecoder with messages saying:
Use @EnableRedissonWebSession or tryLockAsync (or potentially anything that uses pubsub). Then configure redisson to decode in executor via isDecodeInExecutor. Under decent load it easily throws these exceptions.


2583
spring data redis to redisson api

I've recently used spring-data redis and planning to move to redisson without spring.
How do I migrate this snippet of codes to redisson without flushing / reinserting my previous data.
I tried using RSet but it throws an NPE


2584
Writing to RLocalCachedMaps is seeding the data to redis

Hello Nikita,
In our application we are using RLocalCachedMaps to improve performance. In certain cases we want to persist the data locally and not send it to redis. For that we are writing to RLocalCachedMaps with the assumption that it would not seed the same data to redis. But we see in background that writes to RLocalCachedMaps are also sent to redis. We verified this using Monitor command on Redis Server.
Can you please confirm if we have a way to prevent the writes to RLocalCachedMaps from going to redis. In case if there is any other Map that we should use, kindly let us know about that as well.
Thanks


2585
RPermitExpirableSemaphore and RSemaphore

Does Redisson allows to release the semaphore  (RPermitExpirableSemaphore and RSemaphore) on different redisson client (different jvm) than the one on which permit was acquired ?


2586
Client randomly timeout and won't recover

Hi, we have some redisson client timeout issue.
We run a service with 30+ JVM instances. some instances' redisson client will randomly timeout (about 2 - 5 instances) and won't recover, but other instances still works fine.  The failed instances also use Jedis for some legacy feature, and it works fine too. We had to reboot the failed instances so it can recover.
Redis servers are in cluster mode, we recently scaled our cluster from 3 masters, 3 slaves to 9 masters, 9 slaves, and the problem happens more often.
Here's the timeout exception, hope it helps:


2587
broken connections on the pool

Relate to #2043
Expected behavior
When using a fixed connection pool of min=64 and max=64 to every node (masters and slaves) on cluster config. Redisson is able to open a healthy connection pool of 64 to each of the nodes
and request controller, each HTTP GET request will fetch 100 keys from Redis cluster in batch mode.
stress test 100 concurrency
just after running about 20 seconds and stop the stress test tool.
it will already return an error and never recover.
error log is


2588
'java.lang.IndexOutOfBoundsException' exception in org.redisson.jcache.JCacheEventCodec

I'm using a Redis Cluster over JCache API with Redisson 3.12.0.
This is my codec:
And I'm using javax.cache.event.CacheEntryListener the following way:
When the event occurs, it comes to org.redisson.jcache.JCacheEventCodec failing here:
with this:
Changing buf.readIntLE() / buf.readLongLE() to buf.readInt() / buf.readLong() fixes the issue.
Can anyone assist with any explanations?


2589
Redisson does not propogate security principal

see discourse here:
So the bug comes down to the fact that Redisson uses StandardSession, which does not serialize the security credential at all. Redisson should either:
Implement/Extend it's own Session object
Intentionally replicate security credentials
If a failover event occurs, it should go un-noticed to an end user
The user is logged out during a failover event
Steps to reproduce or test case
So you have two tomcat nodes: A & B, clustered in any fashion (forget I mentioned redisson) of your choosing; let's say they're clustered using the built in tcp point-to-point replication. Have 5 people logged into an application on the first server using standard JavaEE APIs (HttpServletrequest.login) Now turn off server A. Your load balancer starts sending traffic to server B. Their sessions will be there, BUT they will be logged out; one has to call HttpServletRequest.login() again. Upon login, Tomcat destroys the previous session (as it should), nullifying any benefit for clustering the application in the first place.


2590
What happens when Locks are not released because of a thread terminate/crash

When using RLock to acquire Lock, Does LockWatchDog releases the lock when the thread that acquired the lock crashes for some reason without unlocking ?
Does Redisson gurantee that taking a permit on semaphore via RPermitExpirableSemaphore/Semaphore is an atomic operation ? Means what happens when Redis or Redisson gets crashed in the process of creating the semaphore object ? Is there any chance that there is some partial state left on the Redis ?


2591
onConnect, onDisconnect seem doesn't work as expected

We're using the Redis provided by AWS ElastiCache, Cluster mode and we need to handle some logic once losing connections with Redis, so we implement these 2 methods.
I shutdown the Redis manually in order to test these methods. However, it doesn't work as expected.
onDisconnect() is trigged successfully while onConnect() is also trigged unexpectly. Is there anything wrong inside?


2592
Is it possible to destroy session on deserialization issue?

Redisson version: 3.12.1
We have the next situation:
Sometimes we update some of our entities that stored in a session.
After that we get a lot of exceptions in log:
We catch this exception when we trying to get some client session parameters.
And it looks strange because the client already in the authorized zone and have a session, but actually session is invalid, so is it possible to invalidate session on deserialization?


2593
JCacheEventCodec fails to read class name causing ClassNotFoundException

Hi! Thanks for your work! I'm pretty new to this client and now trying to understand how it should be configured.
I'm using single node of Redis (5.0.7) with Redisson 3.12.1 and keep getting an error:
Looking at the source code of JCacheEventCodec I noticed that it reads length of key differently depending on the platform. I'm running Java on Windows machine while Redis is on Linux. Now I want to figure out is it a bug or am I doing something in a wrong way?
BTW I tried to rebuild Redisson with reading key length as long (as if it was Linux or Mac) and the error disappeared.


2594
Listener question (about Lists)

Hey, sorry for disburbing, is there a way or an event to listen to Object change (for example when I call RBucket.set(something) ?
If no, what do you advise me to use instead ?
Thanks in advance ! :)


2595
Map EntryExpiredListener

Sentinel mode
Map EntryExpiredListener is disabled, which is restored after the application is restarted, but will be disabled again soon.
I found that it would work every half hour during the failure, which should be a clue.


2596
tryLock(),Machines are not evenly distributed, and one server never gets the lock

Machines are not evenly distributed, and one server never gets the lock.It's going to last forever


2597
Memory leak or misconfigured

We are having an issue using Redisson with Hibernate 5.3.
It appears the items are getting removed correctly due to the TTL, but their is still a Sorted Set that grows without ever getting pruned.
Any of the " " grow without ever having elements removed.
Current properties:
Add sensible max. Otherwise they are unbounded.
I've traced the code and I don't see any locations where the redisson__map_cache__last_access__set has any elements removed.
In the MapCacheEvictionTask, it does pass in the key, but it is never used in the LUA.
Let me know if I'm missing something in the config. Thanks!


2598
Update dependency to adress Vulnerability CVE-2017 18640

Is your feature request related to a problem? Please describe.
Yes. One of the dependencies (snakeyaml 1.2.4) has a known vulnerability:
The Alias feature in SnakeYAML allows entity expansion during a load operation, a related issue to CVE-2003-1564.
Describe the solution you'd like
Please update to the latest snakeyaml
Describe alternatives you've considered


2599
warnings coming from dependent library fst

Expected behavior
This is observed in JDK11 JVM. There should be no warnings, especially those that indicate that code may stop working in a future release.
Steps to reproduce or test case
Running the app that uses redisson


2600
`addAndGet` operation fail on `RMap` with write-behind mode enabled

We have some counter stored in RMap (LongCodec) so addAndGet operation is used. Unfortunately, following exception thrown when MapWriteBehindTask is invoked.
Steps to reproduce or test case


2601
Memory leak when using cluster mode to read by RBatch

and request controller, 500 threads and each HTTP GET request will fetch 1-10 RandomKeys from Redis cluster in batch mode then sleep 30ms.


2602
Add field "name" to RedissonCache.

Hi, it would be nice to have the ability to set  name for RedissonCache different from map inside cache.
To have different cache in different services with same names in the one redis instance just changing the name of the map inside the cache.


2603
RBinaryStream should expose SeekableByteChannel and AsynchronousByteChannel interfaces

No description provided.


2604
Add RBucketsReactive and RBucketsRx objects

No description provided.


2605
Add RBinaryStreamReactive and RBinaryStreamRx objects

No description provided.


2606
Add SWAPDB command support

No description provided.


2607
Add RPUSHX and LPUSHX commands support

No description provided.


2608
Auto-Reconnect to a Modifed Elasticache Cluster

I am trying to optimize an elasticache cluster clustered mode disabled in productive use by downscaling to a smaller instance type. As we all know, AWS will migrate to new nodes with different IP addresses and the client will need to reconnect.  I would like to configure my redisson client to reconnect fast to the master node so we minimize the downtime as much as possible. What are the best practices to reduce downtime and to connect to new master nodes and slaves as fast as possible? Note that I am using ReplicatedServers to connect to the cluster.


2609
Does any form of visibility / metrics / eventing require Redisson Pro

From what I can tell it does. I don't think this is justified. No one should be using a library - casually or otherwise - without metrics and a basic eventing system.
There's many fine features of this product that I'd be HAPPY with as commercial only, including most of its task scheduling, but metrics is an absolute no-go.
Of course my needs may be different from others, but I ask you to reconsider this. Even providing a basic eventing system that OSS could build metrics from would be great.


2610
RPriorityQueue should extend RQueue and RPriorityDeque should extend RDeque

No description provided.


2612
Add Caffeine as alternative local cache implementation

No description provided.


2613
In a frequent job , sometime lock.tryLock() can not get lock

In a spring boot 1.5.6 application , We have a new job which is running every 30 seconds and try to acquire lock to do something . In recent days the job has tried to acquire one specific lock cause of business , We found from 00:13 on Feb 24  the job can not get the lock but after 15:03 the job can get the lock again . The operation on this lock only in this job .
the code on the lock as below :
Thanks


2614
Add RxJava3 implementation

No description provided.


2615
A WARNING




2616
none

[]


2617
Can RRateLimiter create permits evenly

Is your feature request related to a problem? Please describe.
This doesn't seem to be a problem, I just don't think it is elegant enough.
Describe the solution you'd like
When I use RRateLimiter:
Like this, it will be 4 seconds apart and then create 8 permits in a split second.
I think it is best if it can create 8 permits evenly in 4 seconds. Instead of creating 8 permits in an instant after 4 seconds. I hope it can be smart to create permits every 500ms.
If I use "(RateType.OVERALL, 1, 500, RateIntervalUnit.MILLISECONDS)", this will affect the capacity of the bucket.
Describe alternatives you've considered
I didn't think of a good solution, I just hope that he can create permits evenly according to my configuration.


2618
RRateLimiter cannot update settings

I can provide a demo directly.
Expected behavior
I hope I run the code after changing the rate in trySetRate() and the RRateLimiter can use the new rate.
Actual behavior
In fact it will only use the rate set for the first time.
I checked the KV in Redis and it hasn't changed.


2619
RMapCache Cache expiration on a cluster of Redisson clients

Hi @mrniko ,
I have a query regarding RMapCache expiration events . I have the following use case
I have a backend API which will push data to redis on an API call from a third party system . I am setting a ttl to the key because I want to initiate a process in the background when the key expires.
The process to listen to key expiration events sits in a microservice.
I read in the documentation there is a EntryExpiredListener for RMapCache.
Now if the microservice sits in a cluster and if I am subscribing to key expiration events on RMapCache through EntryExpiredListener in each of my microservice instance then
a) if the key is "123" for example , on ttl expiry would all the instances get the key expiration notification ?
b) if yes , is it possible to shard the key expiration events of RMapCache lets say in 100 expiration events , 50 events go to instance 1 and 50 got to instance 2 ?
c) Whats the performance of key expiration listener if  I have 100000 expiration events to process , if there is only one instance ?  Is there a hard limit in terms of throttling the no of expired events per poll inside redis/redisson?
Regards,
Harish


2620
Inconsistent library versions reminder.

Hi. I have implemented a tool to detect library version inconsistencies. Your project have 5 inconsistent libraries.
Take org.awaitility:awaitility for example, this library is declared as version 3.1.0 in redisson-spring-data/redisson-spring-data-21, 3.1.6 in redisson and etc... Such version inconsistencies may cause unnecessary maintenance effort in the long run. For example, if two modules become inter-dependent, library version conflict may happen. It has already become a common issue and hinders development progress. Thus a version harmonization is necessary.
Provided we applied a version harmonization, I calculated the cost it may have to harmonize to all upper versions including an up-to-date one. The cost refers to POM config changes and API invocation changes. Take org.awaitility:awaitility for example, if we harmonize all the library versions into 4.0.0. The concern is, how much should the project code adapt to the newer library version. We list an effort table to quantify the harmonization cost.
The effort table is listed below. It shows the overall harmonization effort by modules. The columns represents the number of library APIs and API calls(NA,NAC), deleted APIs and API calls(NDA,NDAC) as well as modified API and API calls(NMA,NMAC). Modified APIs refers to those APIs whose call graph is not the same as previous version. Take the first row for example, if upgrading the library into version 4.0.0. Given that 13 APIs is used in module redisson, 13 of them is deleted in a recommended version(which will throw a NoMethodFoundError unless re-compiling the project),  0 of them is regarded as modified which could break the former API contract.
Also we provided another table to show the potential files that may be affected due to library API change, which could help to spot the concerned API usage and rerun the test cases. The table is listed below.
If you are interested, you can have a more complete and detailed report in the attached PDF file.
redisson__fdse__redisson_2020-02-20.pdf


2621
ERR unknown command 'AUTH' while connecting sentinel

Hi,
We met below exception in Redisson 3.12.2, could you please help have a check? There is a small change in MasterSlaveConnectionManager.createRedisConfig() against Redisson 3.10.1:
Is this change relevant?


2622
Redisson entity invalidation with JCache CreatedExpiryPolicy

We are experimenting with Redisson through the JCache implementation. We don't understand completely the behaviour of Redisson using the JCache CreatedExpiryPolicy.
Test
The test has been conducted using a cache with a TTL of 30 seconds and CreatedExpiryPolicy as expiry policy. An entry was created and put into the cache at the beginning of the tests, and checked using a loop. When the TTL expiration happens, we try to put again the entity in the cache.  To do this, we use another loop that performs retries until it succeeds.
Actual behavior
When the entity is invalidated, it is not possible to put again a new entity with the same key for a given amount of time (usually some seconds). We also tried to remove the entity with that given key just after the invalidation, but it is not possible to do that. It seems like the entity is 'freezed' for a given amount of seconds. The duration of this 'freezed' status is not clear to us.
In particular, during this 'freezed' status we noticed the following:
on Redis the entity exists (we checked with redis-cli) with the new value and the same key;
Redisson returns 'null' when we try to get the entity;
the jcache_timeout_set:{cache-name} dataset on Redis (that we think is the one used by Redisson in order to keep track of the timestamps) keeps the old timestamp.
Expected Behaviour
For our point of view, the entity should also be removed from Redis when the TTL is expired (probably at the very first moment in which one tries to get it from redis).
Is the actual behaviour by design? How is the duration of this 'freezed' status established?


2623
getPatternTopic not working

Listener never receives published data


2624
support parsing config file in utf8 encoding with bom

Is your feature request related to a problem? Please describe.
If redisson yaml config file has a bom header, application will fail to start. stacktrace:
File content is like :
Describe the solution you'd like
According to the unicode standard, although utf8 with bom is not recommended, it's valid. So I think redisson should support reading config files with bom.


2625
Reddison live Object as RExpired not correctly clean up index

Persist an Reddison Live Object and cast it as RExpirable. After expiration, the RMap Objects got deleted while the key remains in the index hash object. Find action will still return an empty proxied object.
And delete action on that object will fail because the map no longer exists.


2626
Add NettyHook object

Allows to customize Netty Bootstrap and Channel objects


2627
ARGV[1] get nil when run lua script  through redissonClient.getScript().eval()




2628
org.redisson.client.RedisResponseTimeoutException: Redis server response timeout (6000 ms) occured after 3 retry attempts.

Expected behavior
We use RedissonSessionManager that we hope will share the session of the application in redis
and We use the redis sentinel model.
Actual behavior
type Exception report
Steps to reproduce or test case
This exception occurs on the page or in the background of the application after the user is rare or over the weekend. The application returns to normal after you restart it


2629
Does entrySet with count support sorting?

I have RMapCache on my program, and store values with TTL.
Then, I want to get 100 entries that saved first on this map.
So, i have a question - entrySet with 'count' parameter returns values that saved first or last?


2630
Update dependency to address Vulnerability CVE-2017 18640 that remains since the last update

Is your feature request related to a problem? Please describe.
Yes. One of the dependencies (snakeyaml 1.25) has a known vulnerability:
The Alias feature in SnakeYAML allows entity expansion during a load operation, a related issue to CVE-2003-1564.
Describe the solution you'd like.
Please update to the latest snakeyaml.
Describe alternatives you've considered.


2631
Why is BaseConfig package protected

That prevents anyone from generalizing their configuration if they have to configure for multiple environments.


2632
Overriding toString() method on a live object breaks the object.

Hello,
I discovered that overriding the toString() method on an object annotated with an @REntity results in the object not being stored in redis.
Steps to reproduce:
Then save the object through a RLiveObjectService.
It appears that when I override the toString method but do it with:
everything works fine, which leads me to believe that some method in the live object service is relaying on the toString method to id itself. If that is the case then this library should not be relying on the toString method, but should instead use that line above to get what it needs through reflection.


2633
Why setUseLinuxNativeEpoll has been removed from the config?

Everything's in title.


2634
Add username support to AUTH command

No description provided.


2635
Can't construct a java object for org.redisson.codec.JsonJacksonCodec




2636
LEAK: HashedWheelTimer.release() was not called before it's garbage-collected.

We are getting the below error when trying to bring up the app with has a gradle dependency compile("org.redisson:redisson:3.12.1")
Recent access records:
Created at:
Though we are seeing this error,we are not getting blocked and our app is able to run successfully without any issue.
I need to identify whether this is a false message or this has any impact on our application.
Could you please check and identify this.


2638
Implement Spring Cloud connector

No description provided.


2639
question with RBlockingQueue.poll(timeout, TimeUnit.SECONDS)

Hi, in one of our environments BLPOP doesn't pop the elements, though there are elements in the queue when queried via redis-cli with LRANGE command. The issue happens only in one of the environments, are there any known issues with RBlockingQueue.poll(timeout, TimeUnit.SECONDS) where the timeout is zero? This method is called from a while(true) loop, the functionality works for 3-4 hours and then stops popping the elements. As I couldn't reproduce locally I couldn't attach the reproducible code.


2640
why tomcat 7.0.100 can not load files in directory "META-INF/services/" of spring-web

List load(Class serviceType) of WebappServiceLoader.java can not load files in directory "META-INF/services/" of spring-web.
why here has a slash? delete it will be ok.
And in pre-version tomcat, there is no slash here.


2641
tomcat 7.0.100 can not load META-INF/services/javax.servlet.ServletContainerInitializer file of webApp jars

My web app can not be loaded by tomcat when upgrading to version-7.0.100. My start class is loaded by defining in 'META-INF/services/javax.servlet.ServletContainerInitializer'. In tomcat-7.0.100, WebappServiceLoader.java has a bug:
why here add a "/" in version-7.0.100, which lead to ServletContainerInitializer can not be load.


2642
RMapCache adds some special characters before

My question - what is the special characters in RMapCache.
And how can i read json without this characters by call HGET on raw Redis?


2643
java.io.IOException: Failed to read the next byte

Hi,
I've run into the following exception and searching online does not yield any useful information. This is a Springboot app and the following is the config:
We have multiple apps that are using tableOne and tableTwo, some writes some reads/writes. Each app has multiple instances.
This exception happens after the initialization of tableTwo. TableOne has always been fine. We are able to circumvent this by doing tableTwo().clear() during startup but the following error returns when it is being used. Has anyone run into this issue before or have any guess/insight of what's going on?


2644
Redisson Configuration For AWS ElastiCache

Hi, we are using redisson with elasticache (Cluster Mode Disabled). We have 3 nodes. There are the primary endpoint, the reader endpoint and 3 node endpoints. Which URLs to use for ReplicatedServersConfig.addNodeAddress? Should we add all the nodes URLs, without the primary and the reader endpoints?
Thanks


2645
RExecutorService - Some tasks won't get executed

The setup:
Service A -> Producing tasks to executor service
Service B -> Consuming tasks (RedissonNode)
ServiceA static, ServiceB is autoscaled in N replicas
Expected behaviour
All tasks put into executor service will get executed, tasks counter is reporting correct value.
Actual behaviour
Some tasks won't get executed, the task counter is reporting negative numbers.
Steps to reproduce or test case
I was trying hard to get a reproducer on this but I am unable to simulate it deterministically. But I tracked it down to shutdown of the redisson node.
The best that could be done for reproducing the issue is to run n replicas of RedissonNode(s) schedule hundreds of tasks to the executor service and then shut down and startup some of these RedissonNodes. If for example the task print some random id or stores it somewhere you will find out that some ids are missing even though the queue is empty (the tasks HASH is empty) and counter is having a negative value of exact number of missing tasks.
My hypothesis is that the issue is in org.redisson.executor.TasksRunnerService#executeCallable
if the RedissonInstance is in shutdown state the finally clause will still decrement the counter but as the exception is not thrown the task is not re-queued. But it is a wild guess.


2646
decodeInExecutor=true isn’t compatible with certain replays

Expected behavior
Configuring decodeInExecutor=true works for all replays
Actual behavior
We receive periodic IndexOutOfBoundsExceptions during decoding, because of Netty’s implementation of ReplayingDecoderByteBuf#copy.
Steps to reproduce or test case
We are using  RedissonSessionRepository (Spring Session), and can reproduce by running two application instances. We use ab to creating many sessions on one of them. The other instance receives many messages—created, expired, etc.
I don’t have a code test case, but the issue is readily apparent in the debugger. When the ByteBuf is copied for the executor, the copy is of the underlying buffer—the special behavior of ReplayingDecoderByteBuf is lost. This means that incomplete messages cause IndexOutOfBounds exceptions, rather than having the message rewound and decoding retried once there is more data in the buffer.
I’m not sure if this should be considered a bug in Netty, but I’ve filed netty/netty#10122.


2647
Question about PingConnectionInterval and KeepAlive

In production we saw below error few times. As per some closed issues if we set pingConnectionInterval, will the excess idle connections be closed after idleConnectionTimeout ?
And also enabling KeepAlive solved the issue for any?


2648
Distlock Mutual exclusion problem?

1、assume a Redis cluster has a 5 master node; A , B, C ,D ,E representative node name.
2、Client A  lock to A,B,C three node. lock success.
3、This time B,C Node happen Network partition.
4、Client B lock to D,E tow node, lock success,Satisfy N/2 + 1 ,because have A,D,E three node.
5、Violation of mutual exclusion.


2649
none




2650
Is it possible to restrict session loading/saving to specific requests?

I'm working on a legacy project and trying to integrate Redisson Tomcat. The project uses the session object to store lots of data, and doesn't use setAttribute to do it. Because of this I'm forced to use the AFTER_REQUEST update mode. Since every page needs multiple calls to the server to render the whole process is very slow as Redisson will load and then save the session on every request.
Is it possible to restrict session loading/saving to specific requests? I couldn't see a mechanism which enables it so I thought of injecting a valve before the UpdateValve which will skip it in specific cases. Is there a better way?


2651
RedissonBoundedBlockingQueue drainTo method got infinite hung

Expected behavior
RedissonBoundedBlockingQueue drainTo method will return result.
Actual behavior
RedissonBoundedBlockingQueue drainTo method got infinite hung.


2652
Introduce new API to manage Redis nodes

RedissonClient.getNodesGroup and RedissonClient.getClusterNodesGroup methods are deprecated


2653
RedissonReactiveClient not saving data to Redis

I am trying to use Redission with spring boot. I followed but when I check my Redis data is not saved. What am I doing wrong? I am new to Reactive Programming.
These are setting I am using
After that when I do keys * in Redis  I get (empty list or set) , however when I use normal RedissonClient everything works.
Clearly I am doing something wrong there, I would appreciate if someone can point that out
Thanks


2654
Unable to decode data...InvalidDefinitionException..Collections$SetFromMap..no Creators

The class SetFromMap of Collections don't have no args construct method....
how can i fixed this .
Thx


2656
Spring Data connector sends multiGet (MGET) commands to master instead of slave

Expected behavior
When using a master/slave configuration using Sentinel and ReadMode of SLAVE, all Redis reads should go to the slave nodes.
Actual behavior
Reads of type multiGet (MGET) get sent to the master node.
Steps to reproduce or test case
NOTE: To reproduce, use the Spring Data Redisson connector.
Set up a master/slave Redis configuration using Sentinel and run the Redis MONITOR command on master and slave nodes.
Do a SET on a key. You should see the command on the master node first. The master will send the command to its slaves.
Do a GET on the key. You should see the command on the slave node
Do an MGET on an array of keys including the key you just set. You will see the command on the master node instead of the slave node.
Redisson configuration
Master/Slave using a Sentinel. Connect to Redis using Spring Data Redisson connector.


2658
FstCodec copy constructor doesn’t preserve ConfType of FSTConfiguration

We have the following code:
When a copy of the codec is created by RedisExecutor, the ConfType of the FstConfiguration is always DEFAULT.
This can be fixed by using FSTConfiguration#deriveConfiguration.


2660
FstCodec exception when copying session map in changeSessionId

We’re currently switching from Lettuce to Redisson to handle our Spring Sessions. We’re using FstCodec, because JacksonJsonCodec doesn’t support all of the objects we need to serialize.
We’re getting an exception processing the response from Redis when reading the old map (stack trace at end).
It looks like the issue is that the map’s codec isn’t being passed to the batch command, so FstCodec is being used for both keys and values, rather than the map’s CompositeCodec(StringCodec, FstCodec).


2662
Redisson error when create client

Hello, when I create a client I have an error with netty...
The code:
I use the last version of redisson


2663
Redisson considers XREADGROUP and XCLAIM commands as read only but redis considers them read-write commands not allowing these commands to be executed on read-only replica

Expected behavior
In a sentinel environment with 1 master(write only), 2 slaves (Read only), Redisson Stream's readGroup and Claim method should execute commands on redis master node.
Actual behavior
The XREADGROUP and XCLAIM redis commands are actually write commands in redis but Redisson consider these as read only commands and executes on slave nodes resulting in the following error
from redis:
Steps to reproduce or test case
Use readGroups and claim  method in a  master-slave redis environment with master being write only and slaves being read only


2665
RLock throws java.lang.IllegalMonitorStateException in the thread where got the lock twice

In a spring boot 1.5.6 application, We have below operations on merchant account ,
In PayServiceImpl class , using spring proxy (IOC) to call payHandlerService.balanceFreeze.
It seems (B) throws the exception as below
Thanks


2666
DB count not decreased as expected.

Does mybatis-redisson keep on sending query to DB in background? I changed in project from local mybatis cache in distributed env. to redis cache using mybatis but load on DB is still same. I expected load on DB lesser after using redisson-mybatis.


2667
about reading from replicas

Configuring only few maps for strong consistency:
Can i configure that few maps are read from the replicas and for others where i need strong consistency are read from the master only?
In this way i get strong consistency and also performance for other maps.
If not, can i have  to have two redisson instances with different configurations (one with read from replicas and other w/o )  for doing this?
Preventing data loss for map.
have a copy of map and write to it every time when the primary map changes name the map in such way that slot# is on different redis master when there is a node crash, start using other map as primary map (we are planning to use elastic cache ,hopefully there is a way to get notified which master failed)


2668
use redisson make jvm old generation overflow

Expected behavior
redisson use without problem
Actual behavior
Steps to reproduce or test case


2669
Improve RLock reliability during failover and deprecate RedLock

The main idea behind RedLock algorithm is to overcome losing of lock acquisition during failover since Redis replication is asynchronous. Moreover its effectiveness still subject of dispute.
To overcome this every Redis command execution made by RLock object is synchronized through WAIT command introduced in Redis 3.0.


2670
RRateLimiter delete

Redisson version:3.11.6
Delete the invalid


2671
Sentinelconnectionmanageris not correctly in IPv6 dual stack environments

Note:this ticket is different from ticket2471 and ticket2303
I found the following bugs in the SentinelConnectionManager class,my test environment is as follows,three sentinels(node10, node14, noe15),one master(node14), one slave(node15), the network environment of each node is IPv6 dual stack, and the IP of each node is as follows:
The application program runs in node14 and node15 respectively. The following logs are captured in node14 and printed frequently in the log:
When the application is initialized, we will get all sentinels in the constructor of SentinelConnectionManager by synchronously call (140 lines):connection.sync(StringCodec.INSTANCE, RedisCommands.SENTINEL_SENTINELS, cfg.getMasterName()),debug log as below:
In the function scheduleChangeCheck, we will asynchronously call(446 lines), RedisCommands.SENTINEL_SENTINELS, cfg.getMasterName()). Get the sentinel of the current time point, and the debug print is as follows:


2672
The idle connection does not be released after redis cluster failover.

In cluster mode, when I called cluster failover in redis-cli, the redis-cli client list showed that connection number increased than masterConnectionMinimumIdleSize/ slaveConnectionMinimumIdleSize  while those connections idle time is larger than idleConnectionTimeout. I have tried both redisson verion 3.7.2 and 3.12.4, redis verion 3.2.9 and 5.0.8. So i wander why the idle connection does not be released after redis cluster failover? It's a feature or the problem of setting or just a bug? Thanks for reply.
Here is my setting of redisson:
Here is my redisson connection count and details, and you can see there are many connection idle time is larger than 10s, cmd is NULL, and connection number is larger than masterConnectionMinimumIdleSize, but is does not release the idle connection.


2673
Exception after upgrading to redisson 3.12.4

Earlier i was using redisson 3.11.6, application was working fine.
after upgrading to redisson 3.12.4 , during application startup i am getting this exception


2674
Do we have support for Micronaut framework

No description provided.


2675
How does Redisson handle concurrent requests?

Say I have a page which requires two requests to render. In my session I hold a variable A=1. I use Redisson with readMode="MEMORY" updateMode="AFTER_REQUEST" broadcastSessionEvents="false".
Now I load the page. Both requests fire concurrently, the first completes before the second. The first request goes to Redis, gets A=1, changes it to A=2 and persists the session to Redis. The second request goes to Redis, gets A=1, does nothing and persists the session to Redis. Now in Redis I have A=1, even though I expected A=2.
Does Redisson do anything clever to handle this scenario or is it up to me?


2676
RLiveObjectService  search conditions not working as expected.

LiveobjectService find method not working as expected, I am trying to search an object based on its  properties values, something like this
It should not return any values is condition is not satisfied
Actual behavior
It's returning all the values
Steps to reproduce or test case
Create an object with at least 3 properties, Populate it with random values and store it as live objects
Use something line below-mentioned code to replicate.
Here if
Lets say we have following entries


2677
RTopic.countListeners() unexpected result

Consider the following code:
The countListeners should return 1 per topic.
It looks like the countListeners returns the total of listeners registred for all topics (2 in this case).


2678
RedisNodeNotFoundException after failover in AWS Elasticache

Expected behavior : Redisson should be able to talk to redis without any hiccups while failover is in progress or completed.
Actual behavior  : After failover is completed, redisson is throwing exceptions for a slot which is 1684. It also mentions that it is unable to connect to master in logs.
Why we think redisson is causing issue and not redis:
When the application was restarted which means the redisson was disconnected and reconnected to same configuration URL. Redisson worked fine, which tell us the issue was with redisson and not redis. We could see that all slots were covered via redis console and also via redis-cli. We were able to connect and retrieve data from 1684 slot from redis-cli. Cluster nodes and Cluster info command also shows everything is fine.
Below is the logs of interest:
Steps to reproduce or test case:
While the application was running. We have triggered a manual failover from AWS elasticache console. Which resulted in this exception. It is consistently reproducible.
Redis version: Elasticache Redis 5.0.6, cluster mode, ssl enabled, password enabled. Redisson connects using configuration URL provided for redis.


2679
Redisson is unable to start if first sentinel node in list is down

No description provided.


2680
RedissonConnection#del() doesn’t participate in pipeline

We’ve been experiencing intermittent NullPointerExceptions (stacktrace at end) that appeared to be race condition. The root seems to be that del(byte[] keys...) doesn’t properly participate when a connection is pipelined.
I believe the simplest reproduction is:


2681
ERROR reactor.core.scheduler.Schedulers:319 : Scheduler worker in group main failed with an uncaught exception

I had use the version:
compile group:


2682
Unable to find master entry for local.db.xxx.xx.com/10.80.xxx.xx:6379. Multiple IP bindings for single hostname supported only in Redisson PRO!

We use load balancing to achieve high redis availability,So we're using a domain name to connect to redisson.But now this error occurs:


2683
Error: java.lang.ClassCastException: class org.redisson.api.BatchResult cannot be cast to class java.util.List

Hi, I really want to start migrating to JDK14.
So my question is about JDK14 support estimates?
Since bloomfilter doesn't work right now (which is pretty logical):
java.lang.ClassCastException: class org.redisson.api.BatchResult cannot be cast to class java.util.List (org.redisson.api.BatchResult is in unnamed module of loader 'app'; java.util.List is in module java.base of loader 'bootstrap')


2684
Elasticache and Clustered Redis, question about Configuration Endpoint

Is there a example of how to correctly connect to a Redis Cluster using Configuration Endpoint? It seems like you must add all the nodes to Redisson configuration?


2685
ClassCastException between BatchResult<?> and List<Boolean>

Expected behavior
No exception


2686
RedissonReactiveSubscription is not initialized properly and as a result - no messages are handled

Expected behavior
In case of using through org.springframework.data.redis.core.ReactiveStringRedisTemplate, I expect to handle messages from the channel I subscribed to via reactiveRedisTemplate.listenTo(channel)
Actual behavior
The subscription via reactiveRedisTemplate.listenTo(channel) is happening and redis-cli PUBLISH channel hello returns (integer) 1, but NO messages are handled.
Spent some time debugging, I noticed that anonymous subclass of BaseRedisPubSubListener  is created in RedissonReactiveSubscription.receive() with overridden onMessage(CharSequence channel, Object msg) method which as I understand should handle all the messages from redis channel (by the way, perhaps you could explain why BaseRedisPubSubListener overrides onMessage with empty implementation? ).
In fact the listener handles all messages and swallows it somewhere, debugging the message hits onMessage breakpoint, but nothing happened then.
By the way, in some unexplainable cases (I really don't know how to explain it) somewhere in the code the SubscribeListener is initialized and message that is handled by that listener is handled downstream (happens only in debug mode with some combination of breakpoints placed:)).
But event in that base, a single message first handled by BaseRedisPubSubListener empty implementation of onMessage and only then by SubscribeListener which translates the message downstream.
I tried a lot of times but didn't understand what is really needed to achieve this.
Steps to reproduce or test case
Initialize ReactiveStringRedisTemplate with regular spring config (example attached).
Call reactiveRedisTemplate.listenTo(channel) and subscribe to it.


2687
publish  message  throw exception

rtopic can receive message,  but throw exception on publish message  every time.


2688
Best method to zero-out Bloomfilter

I'm wondering what the best approach would be using Redisson to zero-out (remove all entries) residing in the bloomfilter entry generated by Redisson's RedissonBloomFilter.tryInit() and .add commands?


2689
none




2690
RedissonSessionRepository topic listeners initialization has race condition

We’ve successfully migrated to using RedissonSessionRepository for our Spring sessions, but we get intermittent NPEs right after startup. It looks like the issue is that the first listener is added before all of the topics are initialized, and the conditional matching in onMessage doesn’t go in the same order as initialization.


2692
RedissonSession#changeSessionId expiredKey race condition

We have a number of instances of our app in production, and we’ve encountered a race condition where the same session might have changeSessionId invoked on the same session separate servers. This means one server might receive -2 from PTTL, which isn’t currently handled.


2693
RedissonSession retains reference to wrong map after changeSessionId

When RedissonSession#changeSessionId is called, state is copied to the new key in Redis, but the field remains a reference to the old RMap. Any subsequent session updates in that request will get persisted to the wrong key.


2695
Spring session timeout

The spring session documentation has two spring boot ways of configuring session timeout (spring.session.timeout, server.servlet.session.timeout) Redisson does not make use of either of these, instead you have to set it on the EnableRedissonHttpSession annotation which is not configurable.


2696
SessionExpiredEvent and SessionDestroyedEvent

Inside RedissonSessionRepository is code for publishing session expired, session destroyed, and session created events. Of these, i have only been able to get the session created event to fire. What circumstances trigger the destroyed and expired events?
Have attempted deleting by session id from the repository, deleting directly in redis, and trying to load an expired session from the repository, waiting for the entry to expire on its own. Thank you.


2697
ClosedChannelException during RPUSH and BLPOP

Expected: RPUSH should work without any exception
Actual: WriteRedisConnectionException/ClosedChannelException occured
Steps to reproduce: Intermittent error in production
When doing RPUSH, it's trying on the connection which is busy with BLPOP on entirely on different queue. Can you let me know how to avoid this issues. I have also added ping interval.
This issue is also happening on connections waiting with command BLPOP.


2698
publish return 0 when redisson as client

sentinel mode, 3 node


2699
Simplifying debugging of sentinel connection problems

Is your feature request related to a problem? Please describe.
Yes; it's a problem. It's difficult to debug connection problems when connecting to sentinel servers fails. Example log below. When each sentinel node connection fails, a small warning with no stack trace and real error message is emitted. When finally no connection is made a message with list of servers tried is included. We've no information about the actual underlying problem.
Describe the solution you'd like
Collect the exceptions in a list and output them with stack traces after it's established that no connection was made.
Describe alternatives you've considered
Log stack dumps to INFO or DEBUG.


2700
I don't want redisson connect to some specific nodes in redis cluster, can I do it?If yes, how?

I have a redis cluster with 3 master and 6 slave,and I want redisson only connect to the nodes in config file.


2701
A lot of threads waiting on "org.redisson.spring.data.connection.RedissonConnection.sync"

When I was doing the stress test, there were more than 180 threads (like:org.redisson.spring.data.connection.RedissonConnection.write() ,OR org.redisson.spring.data.connection.RedissonConnection.read(),and org.redisson.spring.data.connection.RedissonConnection.del())waiting for "org.redisson.spring.data.connection.RedissonConnection.sync()". What is the reason for this? And how to solve it?Thank you very much!


2702
ReactiveValueOperations#set result calls onComplete directly without offering Boolean value

The Mono<Boolean> set(K key, V value, Duration timeout) in ReactiveValueOperations  from Spring Data Redis Reactive implies the Mono will return an Boolean to indicate success or fail.
However when using Redisson's Spring Data Redis Integration, the response is either onComplete or onError. It's not revealed in documents that this method should not rely on the Boolean value. It would be easier to use the integration if documents offers these important information.
Besides, the Spring Boot Starter includes spring-boot-starter-web module which conflicts with newer spring-boots-starter-webflux module, which is necessary for Spring Webflux applications.
After exclude the spring-boot-starter-web module from Gradle, Redisson Starter works well. So, can the web module be removed from starter dependencies officially, or, change it to other dependencies?


2704
wheather use the shared instance or a new one, when getting reids object every time?

hi,@mrniko
in the following scenarios, i do not know how to use the API, can you give me some advice?
since the password of the server will be changed, the client needs to get a new redisson object every time to access redis server. then, how to configure the codec?
1、redissonClient.getBucket("a", new JsonJacksonCodec()).set(new Animal());
Whether the above code will cause OOM when used in multiple threads,described in #2574
2、redissonClient.getBucket("a", JsonJacksonCodec.INSTANCE).set(new Animal());
if so, is there performance issue with json serialization and deserialization?
Gilberto Torrezan said "the ObjectMapper is indeed Thread safe. But reusing the same object can decrease the performance of your application, since all - 1 threads can be locked at a given time waiting for the owner of the lock to complete the serialization/deserialization of JSON." in
and, wheather you provide this  instance(JsonJacksonCodec.INSTANCE) to advise not to new  instance every time?
thanks!


2705
org.redisson.client.RedisResponseTimeoutException

Sometimes the following error occurs:
org.redisson.client.RedisResponseTimeoutException: Redis server response timeout (3000 ms) occured after 3 retry attempts. Increase nettyThreads and/or timeout settings. Command: (EVAL),
problem analysis:
After catching the network packet,we found the reason is the redission client use a closed connection (maybe closed by os tcp or redis-server ) in the ConnectionPool.
question:
Because the connection in the connection pool has not been operated for a long time, it is closed by the server, and the connection pool does not know.
I want to konw whether there is a heartbeat mechanism on the redisson client and redis-server(use the default configuration)?
Is there any problem with this configuration?
Is there any invalid connection detection mechanism?


2706
error in RedissonBoundedBlockingQueue

when I use this method in project:
I fount some error like this:
seems like the message's value is too large,bug I'm not sure, and I  can't reproduce the error.


2707
Failover with Elasticache cluster causes excessive failures, RedisNodeNotFoundException

Expected behavior
Elasticache Redis cluster failover on primary should not cause several minutes of failing Redis calls.
Actual behavior
After failover ClosedChannelException caused by WriteRedisConnectionException happen.
Requests timeout and fail with WriteRedisConnectionException.
Note: this looks like the same problem as issue #2678
Steps to reproduce or test case
Run application
Do "failover primary" on a shard from AWS Console


2708
Cache not working for hibernate collection, that is joined by non primary key field

When it's like this:
Every time I getting bs it calls database.
But when we change joining field to A primary key:
It gets bs from cache.


2710
Events per client

Hello, using redisson for http session, the created, expired, destroyed events for sessions are raised on each client. Are there any strategies to isolating this to the client that created the session? Looking at prefixing an identifier, and filtering based on that. Wondering if there are better ways? Thank you.


2711
About asynchronous methods in RMapCache

Hello, Ask a question:
We want to control the data through redis in a high concurrency scenario, but now we have a problem. After reading the methods inside, all of them are asynchronous. It seems that the data retrieval is not correct. Please ask me how to solve this problem. It is my object. Is it wrong?


2712
RSetReactive contains not full equals

redis set has element
Expected behavior
should returen false, because use redis SISMEMBER
Actual behavior


2713
Redisson fastRemove not working in AWS Lambda

Hi,
We use redisson library pom dependency for an AWS lambda code. The lambda job is to evict a cache entry from the AWS Redis cache. The Lambda has stopped working since we have upgraded the redisson version from 3.3.1 to 3.12.3. Looking at the Lambda cloudwatch logs, we can see the following in logs.
But the entry in the cache is not deleted. There is no exception/error in the logs. Is there any known issue related to it or are we missing any configuration in the latest version to make the deletes happen.
We use the following code


2714
RedissonLock.tryLock() interrupted and keep renew lock

Expected behavior
when tryLock is interrupted, watchdog renew listener is cancelled too
Actual behavior
when tryLock is interrupted, watchdog keeps renewing lock, this makes ifinite lock
Steps to reproduce or test case


2715
MapLoader and TTL

Is it possible to load entry into hash map (e.g. RMapCache) and set TTL for loaded entry? What would be workaround if this feature not exists?
I would like to add entries into cache using read-through strategy but to keep that entries with TTL and evicted after TTL.
Thanks,
Marko


2716
Rbatch String values pre append \x00\

Hi,
I am using the below code:
Why are my values appending \x00\x00\x00\x00\x00\x00\x00\ before the XYZ string which is my real value?


2717
none




2718
RedissonReactiveClient getLock and getLexSortedSet is executing on different thread.

So here lockk is printed as true, but redissonReactiveClient.getLexSortedSet(redisKey) cannot execute and directly goes to onErrorResume as it is executing in different thread than lock.tryLock(). I'm new to this reactive style of programming, I don't know what I'm doing wrong maybe there is a better way to lock and get the sortedset? please help.


2719
Storing UUID objects is impossible?

Hey !
Everytime I try to store UUIDs on redis (with a List, a Set, a bucket) and I wish to compare them or use them as a keys to get elements in a hashmap for example, this error occurs, UUID is considered as a string, here is the format in redis:
Caused by: java.lang.ClassCastException: java.lang.String cannot be cast to java.util.UUID
Maybe JsonJackson can't serialize correctly uuids, I sadly didn't find anything interesting about that :/
Thanks in advance for your answer, and sorry for disturbing with weird questions


2720
Master fail over with AWS ElastiCache with ReplicatedServersConfig

We have 1 primary and 2 replicas in our production AWS ElastiCache Redis cluster (cluster mode disabled). All three nodes given to ReplicatedServersConfig as mentioned in. We have set scan interval as 2000, and readMode as MASTER. We are using replicas only for failover, when we tested failover to one of the slaves, the Redisson client still sending the write requests to replica (which is old master) and failing with error org.redisson.client.RedisException: READONLY You can't write against a read only replica.
Does it have to anything to do with readMode? Should we use SLAVE or MASTER_SLAVE?
With readMode MASTER redissonClient.getRedisNodes(RedisNodes.MASTER_SLAVE).getSlaves().size() returns 0, so I assume it will not have old slaves info in the context.


2721
org.redisson.client.RedisException: Unexpected exception while processing command

No description provided.


2722
Use MarshallingCodec by default

No description provided.


2723
RedissonSessionRepository.loadSession fail when there is an empty attribute in session

Expected behavior
RedissonSessionRepository.loadSession throws RedisException
Actual behavior
RedissonSessionRepository.loadSession seccess
Steps to reproduce or test case
1.new Sesssion
2.make one of session key's value empty
3.load session
readAllEntrySet can't read a map with an empty value


2724
none




2725
JbossMarshallingRiver Codec implementation corrupts objects serialized in the thread which had a serialization exception before

Expected behavior
For JbossMarshallingRiver Codec
If I encounter notSerializableException for an object, then any other object afterwards sent for serialization should not be incorrectly serialized i.e there should not be any cascading effects
Actual behavior
On encountering notSerializableException , some objects serialized  in the same thread afterwards throw unsupported protocol version exception during deserialization.
Root Cause
When an encoding exception (like notSerializable) occurs during encoding, Marshaller methods finish() and close() are not called and since the Marhsaller encoder is stored in FastThreadLocal variable,further serialization by same marshaller create a problem. We have fixed same by simply applying try{..} finally clause in our implementation and it works.
Mostly default configuration but with MarshallingCodec


2726
Question about retryAttempts&retryInterval

In our environment, we see randomly long time access due to some commands go to 1 time or 2 times retry.  ~1500ms(retryInterval) passed after connection acquired but not able to send command and go to attempt.
Restart Redis server will recover it.
I wonder to know:
In which possible scenarios Redis command can't be sent to Redis server, and enter retry mode?
Why restart Redis server can recover?


2727
`tryLock` in redis cluster working not properly

Expected behavior
tryLock of RLock can not return true when the lock key still exist in cluster redis.
Actual behavior
Sometimes tryLock can acquire the lock key although it still exists. Moreover, the TTL of the lock key also is reset.
Steps to reproduce or test case


2728
Connection Pool refresh. Redis ips keep changing.

Hi, we have deployed our Redis on Kubernetes and the pods can die. One of our java apps uses redisson. I want to know if there is any setting that if one of my pod dies and a new pod comes up with new IP redisson can get the new IP and refresh the connection pool?


2729
In a sentinel configuration, the configuration subscriptionMode.SLAVE does not seem to work

Hi,
My question is regarding configuration
for redisson pubsub in a redis sentinel environment.
Since redis master node does not seem to replicate topics and subscription to the slaves. I wanted to know how does redisson track on which slave nodes topics have been created. Also,  if a subscription is created on slave node, it will not replicate to anywhere (being a slave) for two logical reasons:
Redis does not replicate topic subscriptions to slaves
A slave does not replicate anything to other nodes in Sentinel
I am asking this question, because I am unable to publish messages with this configuration.
I will be happy to be corrected if my assumptions above are wrong.


2730
Get multiple delayed queues of one queue

Hi all,
I wanna create two delayed queues, whose items can be both transferred to one specific queue. It seems, however, there's no queue name for delayed queues since the function getDelayedQueue only accepts just one argument. So getDelayedQueue(specificDestinationQueue) always returns the same delayed queue, right?
Is there any solutions? Any help would be appreciated.


2731
Problem of 'java.util.Collections$SetFromMap' already exist in V3.12.4

Problem of 'java.util.Collections$SetFromMap' already exist in V3.12.4


2732
Node not discovered

Seeing the following exception in logs which results in command failure:
Is the above issue resolved by: #2234 ?


2733
Bucket cast exception:java.lang.Long cannot be cast to org.redisson.client.protocol.decoder.ListScanResult

description:
When using Redisson's Bucket function, the type conversion error is reported from time to time
such as:java.lang.Long cannot be cast to org.redisson.client.protocol.decoder.ListScanResult
va:193)
Steps to reproduce or test case
The code is called as follows(odd and even will appear):


2734
how to use Redisson Lock if lua 'eval' is forbiddened in Redis Cluster because of not good support?

In Redis Cluster, all keys require in same slot with lua, so 'lua eval' is forbiddened in some case or in company,then how to solve this to use Redisson Lock?
Caused by: org.redisson.client.RedisException: ERR unknown command 'EVAL'


2735
Different DB of same redis instance share session among tomcat instances which belong  to different apps?

When different tomcat instance which belong to different App use a same redis instance, but not same DB , it looks the session shared among instances ......The  session id of B98D3CB43DC1DF0B40C47EA71B45AED7 (exception as follows ) is belong to user of app A, but the exception throwed in app B.....Is it a bug?
Threy use same redis , but different database. Is it not correct usage of redisson in tomcat  session  manager?


2736
org.redisson.tomcat.RedissonSessionManager.findSession Session can't be found

Hi,
I was trying to deploy simple webapp using Redisson manager on AWS Elastic Beanstalk. The redis that I have configured, is also from AWS Elasticache.
I have moved these 2 files to conf folder of Tomcat8, and also the required JARs to lib folder. If I login to box, I can see these files correctly updated in Tomcat directory.
Still when the deployment is complete, if I try to access the application, it does not come up. Even though I am able to see the war getting deployed in Tomcat.
Upon observing the logs, I saw below :
Am I making any mistake here? Redisson version is : 3.12.4


2737
Redisson cannot reconnect to Redis cluster after Redis service is bounced

Hello, I'm current experiencing an issue with a Redis cluster(5.0.7) on Redisson 3.12.0 while testing how our system will handle the outage.
I'm using the springboot+Redisson. The test case will keep writing data to Redis Cluster.  On system startup, everything looks good and cache keys created in all the shards. However, if I take down the entire cluster and restart it again, I saw a bunch of following exception:
Per the output of "CLUSTER NODES", all the nodes' status is "connected"
Expected behavior
Redisson successfully reconnects to the cluster after the cluster restarts
Actual behavior
Throw exception every time the slot is in 2nd/3rd shard, which means slot number is larger than 5460.
Steps to reproduce or test case


2738
How does redisson determine the number of connections to Redis

I use https as my redis-cluster which crates 3 masters ans 3 slaves. I use the following redisson configurations:
On app start up, I use "CLIENT LIST | grep MyService | wc -l" to calculate all the connection numbers on each node and get the following results:
Could u please help to clarify how Redisson determine the connection numbers? or do we have any document that can describe the internal mechanism?


2739
On sentinel failover, connections to the new master are getting doubled

version: 3.12.4
When force failing over the number of connections to the new master are getting doubled. We establish around 6000 connections to redis server across all application servers. We didn't change the default idle connections from 24. After failover we observe 48 idle connection to new master, and it's not coming down till we restart the application servers. Because of this issue we had to change the max connections in redis-server to 20000 from 10000.


2740
Idle connection is not killed after timeout

I use the above settings. The connections is always 2 event the idle time is bigger than 20 seconds.
Did I miss something?
Btw, for the connections in master node, it always 4 and no connection is closed after idleConnectionTimeout.


2741
How to custom rules of acquire lock

RLock base on thredId to judge holder, how can i custom rules like base on an income string?
or is there any way to implements ?


2742
Implement TimeSeries structure.

It should support multiple timestamps per value and entry expiration.


2743
Can't connect to server for AWS ElastiCache Redis

Background
I'm using redis as a lock manager in my application. I set up the AWS elasticache redis server with 1 primary and 2 replicas.
Expected behavior
All Redisson clients can connect to the server
Actual behavior
My application is running on mutiple ec2 instances, there is always some instances(for example 2/10, 5/30) can't connect to elasticache redis server.
Steps to reproduce or test case
When I deploy the application through beanstalk. There is always some instance fail at the healthcheck. When I check the log of those instances. Here is what I found:


2744
Connections are not dropped even idle time is larger than idleConnectionTimeout

connections for Redis cluster
For those connections to 7002/7003, I found that all of their idle time is larger than idleConnectionTimeout.   Could you please help to clarify why Redisson doesn't kill those connections?


2745
none




2746
DNS monitoring for cluster mode

We have a prod env which is using Redis cluster in AWS and aws provide a cluster endpoint. Our redisson configuration is cluster mode. But we just use the cluster endpoint in nodeAddress but not a list of cluster nodes:
When we upgrade Redis cluster,  ip address of all the nodes are  changed. It seems that Redisson cannot figure out the new ip address. It keeps  reconnecting to the old ip addresses and we have to bounce all the micro services to mitigate this issue.
I found that DNS monitoring is not enabled for cluster mode. Do you have any suggestion do solve/work-around this issue?


2747
masterConnectionPoolSize cannot limit the maximum connection pool size

Description : I set slaveConnectionPoolSize/masterConnectionPoolSize to 64. But node 7000/7002(master) has 115 connections
Question_1: Is this a bug?
Description : I waited for a long time to check if those connections can be killed.  Unfortunately, those connections are always alive. It seems that idleConnectionTimeout doesn't work as expected.
Question_2 : I'm wondering if there's something wrong with my configuration or it's a bug?
My Configuration is as followed: Cluster mode


2748
Command execution timeout for command: (SENTINEL GET-MASTER-ADDR-BY-NAME)

Redisson version: 3.12.4
In production we are seeing intermittent error spikes of background sentinel commands timeout failures like SENTINEL SENTINELS, SENTINEL SLAVES, SENTINEL GET-MASTER-ADDR-BY-NAME. Are these related to available nettyThreads? This is happening only in couple of servers, we have around 100+ servers in production with similar settings. At the same time we didn't see any regular application side used commands' redis timeouts.
org.redisson.client.RedisTimeoutException: Command execution timeout for command: (SENTINEL GET-MASTER-ADDR-BY-NAME)
Can you let me know what could be reason for these intermittent errors?


2749
Distributed scheduled executor service

[]


2750
Node for slot: 14296 hasn't been discovered yet. Check cluster slots coverage using CLUSTER NODES command




2751
Tomcat valves need to check getNext() if it is not null first

in UpdateValve,java there is following code (all tomcat valves needs to be checked for such code):
and getNext() could return null if there are no additional valves to invoke
Expected behavior
No NullPointerException to occur
Actual behavior
NullPointerException would occur in Valves that uses getNext().invoke(...), if getNext() return null.


2752
How to stop Redisson connecting to a stale node

We have a Redis cluster in AWS, in which there're 50 master nodes. Each master node has 1 slave node.
One of the nodes looks like
I use nslookup to check the ip address of these dns records.
master(001-001.usw2.cache.amazonaws.com) has ip : 172.31.33.149
slave(001-002.usw2.cache.amazonaws.com) has ip : 172.31.33.51
Our Redisson client keeps connecting to an unknown ip:  172.31.33.151
Per the result of "cluster nodes", I found that the unknown ip is a failed slave node,
Per the AWS console, I'm sure that dns name of the current slave is 172.31.33.51.
So the ip 151 should be stale and we should not reconnect to that address. The retry attempts throw a timeout exception and make cpu/memory usage high, which lead to memory leak issue.
Our system do have connection for the master node (ip 172.31.33.149) and the new slave node (ip 172.31.33.51)
Is there any way/configuration to stop Redisson connecting to the stale node?


2753
Bloom Filter can add by pipeline?

I want to use bloom filter by redisson and set expire.
when data is expired, init agin, I need to execute RBloomFilter.add() too many times.
how can I use by pipeline? thanks


2754
Ratelimiter occur error in aliyun redis

Exception as below:


2755
none




2756
What's the best way to update an attribute outside the normal flow?

I use Redisson-Tomcat with update mode AFTER_REQUEST. I'd like to do an update to a specific session attribute before the request gets to the UpdateValve. I think (ignoring for the moment ClassLoader issues) I can do something like; but is there a better way?


2757
(missing no-arg constructor): org.apache.catalina.realm.GenericPrincipal

Environment:
Scenario:
An app is hosted by two tomcat instances, Tomcat A, and Tomcat B, both are configured with AWS ElastiCache/Redis. The host is registered with AWS Application Load Balancer (sticky enabled).
The user logon to Tomcat A, and the session is cached by Redis -- good.
I killed Tomcat A
Load balancer started forwarding the traffic to Tomcat B -- Expected
The user continue to work wit the app
Tomcat B detect the change, and try to fetch session id from Redis, the I get this error, see stack dump:


2758
RedissonTransactionalMapCache.put() creates entries with incorrect TTLs

When calling RedissonTransactionalMapCache.put(K key, V value, long ttl, TimeUnit ttlUnit, long maxIdleTime, TimeUnit maxIdleUnit), the TTL for cache entries is not set correctly.  The problem is that putAsync is passing the expiration timestamp into putOperationAsync.  However, the code in expect it to be a passed the actual TTL value.
What happens is that when we get here (in BaseTransactionalMapCache)
The ttlTimeout is a timestamp (number of ms since the epoch) rather than the timeout.  This results in the entries being created with what is effectively an infinite TTL.
Expected behavior
Entries are created with the provided TTL
Actual behavior
Entries are created with a TTL of ~50 years
Steps to reproduce or test case
If you check the TTL, using map.remainTimeToLive(key), you will see that it is well over 600.  The value you get back is approximately System.

2759
Do async operations come with ordering guarantees?

Is the order in which async operations are submitted to the Redisson client guaranteed to match the order in which they are actually executed?
For context, I am using RStream.addAllAsync to submit items to a stream, and I need the items stream order to exactly match the addAllAsync call order. Are there any race conditions possible with rapid calls to this method (1-2ms delays between calls) that would result in out-of-order insertion?
Thanks in advance!


2761
I have a question about how can I make sure of member in set or not in set?

Now, I can only get All members, but I cant make sure of  member in set or not in set.
Thanks!


2762
RateLimiter Overall configuration across different nodes

Hi,
I have 3 different processes accessing Redis. I am using the below code to make sure only one node gets hold of the resource for the specified time.
My understanding here is 1 permit is available for every 60 seconds. If one node is processing the code after acquiring the permit, other nodes trying to call acquire should get as false.
Here, other nodes are able to acquire the lock without 60 seconds delay. Is there something wrong with the usage? Please help me understand how would I hold the access on the resource for the specified time.


2763
ResissonSessionRepository  create many  redis  key  like  "xxorg.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAMExxx", but not set ttl, how to deal with?

No description provided.


2764
none




2765
how to config redisson cluster in springboot

No description provided.


2766
RScoredSortedSet.entryRange() can't get entry list under redis cluster?

Redisson version:3.7.5
I created a redis cluster of three masters and three slaves in the virtual machine.
I want to test whether the scoresortedset supports clustering.So I wrote a unit test class
I found that the key and score can be inserted normally in the scoreportedset, but when I try to read the size of the current scoreportedset, I find that the return value is 0.
This is the output:
I tried distributed lock under this condition. It seems that there is no problem, so I am confused about the above problems
I hope you can answer my question, thank you


2767
sentinel: redis://xxx was down

I use org.redisson:redisson-spring-boot-starter:3.12.5.
When spring-boot app with spring yaml redis section
started i see in log file
What's wrong?


2768
JsonJacksonCodec decode occur error

The trace log as below:
field "liveStreamUrl" decode error
redisson: 3.12.5


2769
maxSize on RMapCache

Does setMaxSize() always successfully apply the size limit on cache?
(Why do we have two methods: maxSize and tryMaxSize)


2770
Connectivity issue while using Redis

We have a Redis cluster(running in Sentinel mode) with 3 nodes and we are using Redisson (version 3.10.7) to interact with Redis.
Since last one week, we are facing an issue in our Development environment wherein the client application is not able to connect to the cluster. Continuously older connections are being dropped and new connections are being created. Below is the snapshot for the logger.
We tried below points to investigate the issue:
Restart the client application.
Restart Redis cluster nodes.
Post these restarts as well, the same issue persisted. We were able to resolve the issue by changing the "timeout" property from 0 to 10 seconds in server.conf of Redis. On reverting timeout back to 0 also is not causing the issue again.


2771
Connection leak issue while using Redis-Redisson

We have a Redis cluster(running in Sentinel mode) with 3 nodes and we are using Redisson (version 3.10.7) to interact with Redis. While checking for some other issue, we noticed a high number of client being connected to server.
On further investigation, we noticed the below scenarios.
In case app restart is not done as well, connection remains open even though we have a "timeout" set at server level. Is Redisson leaving the older connection open  and creates a new one in case of redis server crash or network glitch?
Also, I noticed that with each client connection to Redis server,Redis is opening 4 file descriptor. Is this normal?


2772
redis-cli scan 0 COUNT 20 equivalent in redisson

I want to know what is the >redis-cli scan 0 COUNT 20 equivalent in redisson. I have 4  million records in redis and want to iterate through them (with a key pattern)
I tried using Stream getKeysStreamByPattern(String var1, int var2); and Iterable getKeysByPattern(String var1, int var2); but it hangs infinitly.


2773
How can RBlockingDeque.pollLastFromAny() return the queue name?

1.Return List whose size is 2 when use jedis brpop method, the first is the queue name,and the second is the value.
2.pollLastFromAny() only return the value
So how can i get the matching queue name with the value.


2774
Nullpointer exception after logout Tomcat application

Expected behavior
Logout without nullpointer exception
Actual behavior
Logout throws this exception
Tested with updateMode="AFTER_REQUEST" at first, changed to DEFAULT later, exception is still thrown.
It doesn't really affect the application as it happens after destroying the session but it does fill up application logfiles.


2775
Add keyPrefix="" to Redisson Tomcat documentation page

Not much to mention, the title says it all I guess. It's a nice feature but it seems to be missing in the documentation.
Best regards,
Werner


2777
RedissonKeys.unlink uses del instead of unlink

Expected behavior
Redisson configuration
Default single server configuration


2778
RLiveObjectService.merge() method doesn't override collection state

No description provided.


2779
Add RLiveObjectService.findIds() method

Add method to find all stored entiry ids by specified entityClass.


2780
How to update RateLimiter interval?

Hi,
I have created RRateLimiter instance and want to update interval field. If I call trySetRate() it is not updating.
If I remove the item and create again it works. Is there a way to update RateLimiter instance without removing the item?
Please let me know.
Thanks,
Ravindra


2781
How to configure scheduling times?

When using the periodic scheduling method(e.g. RScheduledExecutorService.scheduleAtFixedRate), I want to stop scheduling after a specified number of times. What should I do?


2782
How to configure scheduling times?

When using the periodic scheduling method(e.g. RScheduledExecutorService.scheduleAtFixedRate), I want to stop scheduling after a specified number of times. What should I do?
Thanks!


2783
none




2784
Custom start time when scheduling a task with cron expression

Part of the source code of the RedissonExecutorService class:
As the remark above says,It is possible new Date () as a method parameter.


2785
Add RLiveObjectService.count() method

Count LiveObjects with specified conditions


2786
Extend RLiveObjectService.delete() method to accept multiple ids.

No description provided.


2787
Question about RLocalCachedMap

Nevermind, I think I figured it out.


2788
Why we need to execute SENTINEL SENTINELS command?

In this case, I configured the all intranet domain sentinel node list info.
like this
But I can't start redisson successfully,  it throws a RedisConnectionException with 'SENTINEL SENTINELS command returns less than 2 nodes..' message
Because the first configured sentinel node will be used to execute the SENTINEL SENTINELS MASTER_NAME command when initializing the SentinelConnectionManager, and then try to connect to the returned node list.
But the IP:PORT information of the sentinel node list we return is inaccessible by the current machine(By default, we only allow access via intranet domain), So all these sentinel node failed to register, except the current node(It uses intranet domain access).
Can we add an option to directly use the configured node list without having to execute the  SENTINEL SENTINELS MASTER_NAME command to get the list?
Now, I called dba to restart the sentinel node list, and replaced the sentinel list information, so that the information returned by sentinel list api can be accessed by my current machine, temporarily solved this problem.
However, if my new machine in another network cluster also needs to use redisson to connect to this sentinel cluster, things will become more troublesome.


2789
Redisson scalable put on cluster nodes

Hello:
I am new to Redis. And I wrote a simple code to test hashmap objects in a Redis cluster of 3 nodes.
Then I try the redis-cli to get all hashmap objects. it seems that all pairs are stored on the same cluster node instead of round-robin.
However, when I use the redis-cli to put key and value pairs into the cluster, I can see it is round-robin.
May I know how to put hashmap object in the round-robin way?
In my test environment, redission maven
redis server 6.0.1.
Thanks.


2790
Thread that called tryLock stops in standby state

Hello,
Running the redisServer again does not resolve the issue.
In particular, Scheduler threads cause serious problems.
Is there a solution?
Below is the test code.
This result is Thread dump.


2795
Spring Data Redis 2.3 support

No description provided.


2796
Auto configuration for reactive redis client in Spring Boot

Currently I am using Redisson for locks with the RedissonClient that gets automatically configured via the spring.redis.(host|port|password) properties in the application.yaml which is super convenient.
Now I wanted to include some message handling via reactive topics to return a Flux for a websocket-based subscription. Thus I attempted to autowire a RedissonReactiveClient and noticed it isn't autoconfigured.
I am curious what the proposed way to expose a RedissonReactiveClient bean with the same configuration would look like.


2797
redisson 3.12.5 with error of Can't init enough connections amount! Only 0 from 30 were initialized

redisson 3.12.5
redis 3.2.9
I meet this problem when project startup with multiple replicas in kubernetes, some of replicas with following errors, but some are fine:


2798
org.hibernate.LazyInitializationException: could not initialize proxy - no Session

I want to use to hibernate level2 cache as flow config.
Now for get object at the first time, all things are ok! (that means I want to load 'post' from personnel)
But when I call this function for a second time, in my personnel object the 'post' is null and I get an error as below:


2799
At Android both FstCodec and MarshallingCodec don't run

I get this IllegalStateException:
The problem is, at android, FstCodec call this function:
Thanks for this incredible program, I holpe that this help you to improve it.


2800
RedisConnectionException: Not all slots are covered! Only 10923 slots are avaliable

I use the 7000 port node to create a redis cluster. When the cluster is running normally, the client connection to the cluster is normal. When the 7000 port is the master, there will be an error. 0-5000 solt cannot be added. But when the 7000 port is the slave, it is normal. But in a moment, there will be three retry failures and the connection problem cannot be found


2801
Is tryLock() method expected to return false when redis is not available

Expected behavior
tryLock() method return false after certain time when redis is not available
Actual behavior
tryLock() method is hanging forever
Steps to reproduce or test case
when application starts, the redis server is there, then bring down the redis.
local redis docker without authentication


2802
cluster throw WriteRedisConnectionException while slave become new master after master shutdown

Expected behavior
use new master and everything is OK
Actual behavior
use connection of the shutdown master
Steps to reproduce or test case
cluster three master and three slave
master A, slave B
kill A, then B as master
start A, then A as slave of B
kill B, then A as master
start B, then B as slave of A
kill A, then B as master
now cluster status is OK,
but throw WriteRedisConnectionException because try to use connect of A
ClusterConnectionManager log
WriteRedisConnectionException
Everything is OK after restart java application.


2803
spring-integration unlock error when use redisson

use redisson and spring-integration
Steps to reproduce or test case
this keyCommands() retuen this OBJECT occur recursion.
Maybe,we need override method unlink in RedissonConnection


2804
Unexpected exception while processing command

I use spirng cache and throw this exception  I can't see what is the real exception it throw


2805
none




2806
NatMapper is not applied to the first online Sentinel in list.

No description provided.


2807
redisson lock uncontrolled release.

Hi all,
I am facing strange problems with Redisson lock.
I use the lock without expiration - which means is that watchdog mechanism in-charge of updating the lease time of the lock in redis.
Threads that are using the lock, lock it for time ranging from couple of seconds to 300 seconds or even more.
The problem:
sometimes when a thread(that acquired it) tries to release the lock the thread receives IllegalMonitorStateException , which means that this lock is already released.
One solution was to increase the watchdog timeout - I increased it to 100 seconds and it decreased the number of errors but they still occur from time to time...
I don't want to increase the timeout even more because this doesn't address the root problem.
How can I solve this? is anyone else encountered this behaviour?


2808
Scheduled Executor Example Fails

Expected behavior
This should work according to examples
Actual behavior
Throws exception
Steps to reproduce or test case


2809
SSL connection can't be established if Redis Sentinel discovered by DNSMonitor

No description provided.


2810
Shall the read.me file get updated to use the latest master version of redisson-all jar?

shall this versoin be 3.13.0


2811
Concurrent invoke still may be get null

behavior like #2217


2812
Batch default values not consistent with RedissonClient

For example, in comment it says default value is 3000 ms, but it's actually 0. Does this mean RBatch execution will not timeout and could block the netty channel for quite long time?
Should the BatchOptions like timeout, retryAttempts use the values from RedissonClient?


2813
The first online Sentinel hostname in Redisson config isn't resolved at startup

No description provided.


2814
RedissonSetMultimap has a bug here redisson.getSetMultimap( "" ).removeAll( collection )

Expected behavior
You need judge the size of set when executing hdel
return commandExecutor.evalWriteAsync(BugfixRedissonSetMultimap.this.getName(), codec, RedisCommands.EVAL_BOOLEAN_AMOUNT,
Actual behavior
Steps to reproduce or test case


2815
The  poll(limit) in ReactiveQueue returns a MonoLift instead of Flux

Expected behavior
When call
I expect it returns
Flux
Actual behavior
But it returns below error, and the non-reactive lib is OK, is the reactive function provided in redisson PRO only?
Steps to reproduce or test case


2816
AWS Reader DNS being defined as master during failover

Scenario:
We configured Redisson with 2 AWS DNS endpoints: Primary and Reader. Primary has one node and Reader has 2.
After failover, one of the read replicas got promoted as the primary. Technically, since this happened behind the scene in AWS, we should not see any change to the Primary and Reader.
However, in Redisson log, we saw the type of the Reader endpoint got changed to be Master
Before failover:
Wonder if this is a bug or we didn't configure our Redisson correctly. Any help would be greatly appreciated.


2817
Support for SETXX operation

I have a use case in which I must update a value only if the key exists. This is supported by the SET XX option.
I was wondering if it makes sense to enhance the RedissonBucket class to support a setIfPresent operation(s) - encapsulating the SET XX command just like trySet does for SET NX, or if I should just try to get an instance of CommandAsyncService and run the command myself.
I'm happy to contribute to this feature if it's deemed useful.


2818
StreamInfoDecoder relies on field order of XINFO response

Expected behavior
When using redis streams with redisson, the expected behaviour is, that redisson is able to identify the fields of the xinfo response for streams and fill the StreamInfo type accordingly.
Actual behavior
While switching from redis 5.0.6 to redis 6.0.4 I experienced, that the fields "groups" and "last-generated-id" have switched their positions. The result is, that I get an ClassCastException because redisson tries to cast the String "last-generated-id" to Long "groups".
Steps to reproduce or test case
Use redis Version 6.0.4.
Connect redisson client to this database.
Get stream info with redisson RStream:


2820
Issue in the latest README.md file change of redisson-tomcat

a76949a#r39710042


2821
SyncStrategy.INVALIDATE publish without subscribe possible?

Hi!
We have a redis server with about 600 commands per seconds sent via redisson. And we have some cronjobs that update information in the db (and cache). We are using redisson 3.12.3 with LocalCachedMap with the following options.
The synchronization is working great. However, since the cronjob is setting up new connections then disconnects we often during the peak hours receive errors like so.
I'm thinking that we can either wait longer for the shutdown or configure the instance not to subscribe to updates? I realize that this might be a weird use case, I tried manually constructing the publish command but got lost somewhere in the command encoding. I'm thinking that ideally a new SyncStrategy that only publish invalidation, and doesn't listen to them, would be the best solution for us.


2822
[Cluster] scanning nodes stops if `ClusterConnectionManager#addMasterEntry` fails

Expected behavior
Periodic scan of cluster nodes runs forever (every scanInterval milliseconds)
Actual behavior
Periodic scan of cluster nodes stops when a single master is added to the cluster and Redisson cannot perform CLUSTER INFO
Steps to reproduce or test case
Failure to perform CLUSTER INFO is probably a side effect from another problem but I expect that Redisson can recover.
I'm using a 6 nodes cluster in a VM (libvirt) environment on 3 virtual machines. Each VM hosts one master and one slave in way that master and slave happens to be on different VMs (master1 is on VM1, but slave1 is on VM2; master2 is on VM2, while slave2 is on VM3 and master3 is on VM3 while slave3 is on VM1). Hard stop VM2 which effectively disconnects master2 and slave1. Then I bring back VM2. Former master2 is no longer master so I promote it to be master again by executing CLUSTER FAILOVER on it. After I do so, Redisson attempts to reconnect to master2 but for unknown reason fails with:
All defaults, except useClusterServer and one node address.
Notes
I traced back the issue to org.redisson.cluster.ClusterConnectionManager#checkMasterNodesChange: addMasterEntry returns failed future (e is not null) and  futures.addAll(res); is never executed. As a result result future is never resolved and the next round of scanning is not performed.


2823
RedissonCacheStatisticsAutoConfiguration conditions not matched

Expected behavior
I expect to get metrics of RedissonSpringCacheManager
Actual behavior
But RedissonCacheStatisticsAutoConfiguration not matched to condition @ConditionalOnBean({CacheManager.class, RedissonCache.class})
The reason is that there isn't RedissonCache bean registered in context.
If you dive deep into RedissonSpringCacheManager you can see RedissonCache instance created, but not registered in ApplicationContext and it should not.
RedissonCacheStatisticsAutoConfiguration":{"notMatched":[{"condition":"OnBeanCondition","message":"@ConditionalOnBean (types: org.springframework.cache.CacheManager,org.redisson.spring.cache.RedissonCache; SearchStrategy: all) did not find any beans of type org.redisson.spring.cache.RedissonCache"}]
Steps to reproduce or test case
Fail case:
Configure spring boot cache (see below)
Configure spring-boot-starter-data-redis (ip, port, db)
Use spring cache annotations on objects an methods
check /actuator/metrics
You won't see any cache metrics
Success case:
Repeat all from Fail case (steps 1-3)
Register RedissonCacheMeterBinderProvider on your own
check /actuator/metrics
You will see cache.puts, cache.gets, cache.size metrics


2824
Add RExpirable interface to  RRateLimiter

No description provided.


2825
Topic channels connected to master node aren't resubscribed

No description provided.


2826
volumes for redis replica nodes in docker swaram environment?

We have an application in which we are using Redis as a small database.
We are using Redis in a master-slave configuration in docker swarm environment. We have 1 master node and 2 replica nodes.
For persistent storage we have enabled volumes for master/replica nodes in docker swarm environment e.g if container restarts it can pick data from the volumes file on disk.
Few of my doubts are as below -
Is it necessary to enable volumes for replica nodes?
If we have volumes enabled for replica nodes, in a scenario when replica docker container restarts, will it pick its data from its volumes file on disk? or it ignores that file and only get data after syncing with master node?
Please let me know if you need more information.


2827
org.redisson.client.RedisException occurs after upgrading redisson client

After upgrading redisson client from 2.2.12 to 3.10.6 there are a lot of org.redisson.client.RedisException errors when performing various queries to Redis via redisson.
It seems there are a couple of issues:
There cannot be two applications using different redisson versions at the same time, e.g. App1 with 2.2.12 and App2 with 3.10.6, otherwise the RedisException occurs.
The keys created by the old version must be flushed, otherwise the RedisException occurs.
Expected behavior
After upgrading redisson client from 2.2.12 to 3.10.6 new keys can be created and old keys can be read/updated without errors.
Actual behavior
After upgrading redisson client from 2.2.12 to 3.10.6 new keys cannot be created and old keys cannot be read/updated without RedisException.
Question
Is there a way to avoid flushing the cache in order to avoid the errors?


2828
redisson lock

Hello,
I have a quick question about the redisson lock.
Does the redisson lock is share between all clients ? We have several services/jvm and we want to be sure that these services cannot read / write in concurrently on the same ressources.
We use AWS redis with 1 master and 2 slave.
Thank you


2829
support redis version?

redisson support redis 6.0+?


2830
support of aws unique reader endpoint for Redis

Hello,
Should I use useMasterSlaveServers for an AWS redis (1 master - 2 slaves) with an unique reader endpoint (Amazon ElastiCache launches reader endpoints for Redis)
here is my current configuration
Remember we haven't enabled the cluster mode .. We have only 1 master with 2 slaves.
However we got 2 troubles (redis-2 is the primary, redis-1 and redis-3 are the slaves)
As you can see in the picture, the current connections between the 2 slaves are strange. I know there is load balacing between the 2 slaves. But why the connections fall back to 0 periodically ? Should I increase the maximum idle time of the connections before they are released ?
Then after the failover, 2 services failed to reconnect on the master node. Our other services had no problems with  the same configuration.
It makes no sense to me because the unique primary endpoint and the unique reader endpoint have not changed ... Should I disabled the dns monitoring interval on the redis client ?
let me know if you have answers to these troubles
Thanks


2831
CLUSTERDOWN error handling

Redisson should try to send command later if this error arose.


2832
Blocking commands connected to Redis Cluster aren't resubscribed after Master node failover ·32

No description provided.


2833
none




2834
How to get callback from RDelayedQueue

Use case
When I put the content into delayed queue, I manage to add listener on the content transferring to the destination.
Questions
Is there any methods I can get to listen delayed queue callback when transferring entity to destination ?


2835
Cluster Mode Configuration

From this documentation:
It is written for cluster mode "Minimal cluster configuration requires to contain at least three master nodes"
I want to understand why this limitation is there?
So overall if I have a cluster enable AWS elastic cache with single shard(1 master,2 Replicas) then i can't use cluster mode configuration?


2836
Unable to acquire connection when all connections are free and nothing is in queue..

@mrniko on occasion we are seeing timeouts like this..
from what I gather all connections are free, none are in queue yet it still didn't manage to acquire a connection.. does this indicate all Netty threads are busy decoding a response, in which case we should consider adopting the dedicated executor for decoding, or something else? Currently running redisson-3.11.5


2837
AutoDiscover in Redisson

I have a cluster mode enabled AWS Elastic cache with current configuration 1 shard(1 master 2 slaves) and i wan't to know that if i increase the shards count say to 2, would Redisson able to auto discover the newly added shard nodes?
As per this: Redisson only take the node addesses but AWS also provides the configuration endpoint but i don't see any option to provide that in Redisson.


2838
AWS elastic cache Shards support in Redisson.

I have a sharded AWS cluster enabled elastic cache with multiple shards.
I want to use the Redisson client to interact with my AWS Elastic Cache .
Can this be possible in OpenSource Redisson or it's possible only in Redisson pro?
Also it would be really helpful if you can share a sample code to connect to a sharded AWS elastic Cache using Redisson Client


2839
RedisNodeNotFoundException after redis cluster restart.

Expected behavior
The client to reconnect to new masters
Actual behavior
Seeing this exception
After the redis cluster restart the error is showing up only on a small percentage of instances. The rest were able to reconnect as expected the p95 latency was under 20ms for fetching a single key from a hashset and around 100ms for fetching the entire hashset.


2840
org.redisson.client.RedisConnection memory leak

Seems RedisConnection is leaking in a queue?
Expected behavior
No leak.
Actual behavior
Steps to reproduce or test case


2841
RedisTimeoutException: Redis server response timeout (3000 ms) occured for command: (LPOP) with params:

I am getting below error while trying push a message to RDelayedQueue. Using Redission version 3.6.2. Any thoughts?
Also, below error pop up sometimes.
Below are my settings.


2842
How to retrieve DelayedQueue by name using getDelayedQueue.

Want to understand how to retrieve delayed queue (RDelayedQueue) by name using getDelayedQueue method on org.redisson.api.RedissonClient.
Does it require to call redissonClient.getDelayedQueue(destinationQueue) every time before queuing a message as below or retrieve queue once and use it for every message queuing ?
RDelayedQueue..offer(message, delayInMillisFromCurrent, TimeUnit.MILLISECONDS);


2843
Which API to use to get a config value?

Hi,
I am trying to find the API equivalent to "CONFIG GET"
I found:  getRedisNodes( RedisNodes.CLUSTER ) and cluster info but not config.
Thanks in advance!


2844
Is it possible to access to the data maintained or written by Redisson in Nodejs? And would it be a bad practice?

Hi, I have using Redisson for not a long time, and I realize that I need my old project to access to Redis and retrieve data that is maintained by the current Java code which use Redisson.
But Redisson is not just a redis client but a In-Memory Data Grid, therefore it's quite different and not compatible friendly for nodejs program for it only has pure redis client tools to use.
So the idea I have is:
Write a Java Redisson program as a proxy and serve data for nodejs program.
Figure out how Redisson save data, for sorted set, and Bucket, and write a package for nodejs to decode data from Redis.
Give up Redisson and use pure redis client, like Redis.
Is there any other solutions? Or is there any nodejs middleware for Redisson? Would that be difficult to write one for Redisson(I haven't read much source code of Redisson yet)?
Thanks.


2845
Connection leak if SSL connection got reconnected

No description provided.


2846
Closed connection was taken into use and always get failed.

Expected behavior
IDLE Closed channel should not be used in latter command execution.
Actual behavior
See below log, acquire connection and IDLE connection check happens around at same time, therefore IdleConnectionWatcher closed it. But this connection was taken into use in latter phase and always get "failure: java.nio.channels.ClosedChannelException)], command=(PING),". However, PING cannot recover it.


2847
Using lockAsync with Scala Akka

Hi,
Does lockAsync / unlockAsync and bucket async APIs work with Akka actor using Scala/Play?
I am getting the exceptin below:
java.lang.IllegalMonitorStateException: attempt to unlock lock, not locked by current thread by node id
Is that because of unlockAsync being triggered inside Future of lockAsync? I am using Scala converters to get Scala Futures from these APIs.
If I generate my own thread ids using random long then it does work.
Thanks
Rakesh


2848
org.redisson.client.RedisException: BUSY Redis is busy running a script.

We are using redis delay queue and see below error with around 20k message in queue.


2849
Support for OBJECT command

Hi - I cant find support for redis OBJECT command in RedisCommands. Is there any plan to add support for the OBJECT command?



2850
http is broken

http returning 404


2851
Duplicate execution of scheduled job with multiple RedissonNodes

multiple RedissonNodes has Different system time


2852
Is Redis Labs Enterprise Cluster (RLEC) officially supported?

we are using redisson with en RLEC it does work but not in every case, so the question is does redisson officially support RLEC and when yes how should we configure it? Is there a example somewhere. If there is one and I could not find it, pleas give me a hint :)


2855
Issue with config when trying Tomcat Session Management

I'm attempting to the RedissonSessionManager to handle sessions for tomcat.  I have setup the manager like this in my tomcat context.xml file
and created the following redisson.yaml file
With it set like this I get this error,......
I had to manually add the fst-2.47.jar as well as the objenesis-3.1.jar to get this and I'm kind of stuck now.


2856
Logging: CommandAsyncService.get(RFuture<V> future) and InterruptedException

We notice with small connection pool sizes under load that some promises seem to be interrupted or time out. This is normal behavior, but the root cause is omitted under the stack trace.
Redisson tries future.await(), catching the InterruptedException. In this case I believe future.isSuccess() is unlikely to return true, and convertException will be called. If InterruptedException is the cause for the future failing, we want to preserve that as part of the cause in the stack trace.


2857
RedissonSetMultimap and RedissonListMultimap has a bug here. get("key").delete() will throw exception.

Expected behavior


2862
DefaultSavedRequest cannot be cast to org.springframework.security.web.savedrequest.SavedRequest.

I see this same issues from #1850 but nothing about how it was fixed or what to do.
My setup is redisson-all.3.13.1 and redisson-tomcat-8-3.13.  I have the RedissonSessionManager configured.
Is there something I am most likely missing?


2863
Why the redisson reconnected the connection  and still throw exceptions

using the latest version.
After debugging,I found that when the connection lost,redisson will try to reconnect and it do succeed,but it still throw an Exception.


2864
when GenerationType is IDENTITY, test failed




2865
redisson 3.13.1 Always connected to redis cluster and can not to acquire lock,but no exception

redis version:5.0.8
redisson version: 3.13.1
i have built redis cluster with six instance.and use cluster nodes to view clusters info.


2866
Replace slf4j-simple Dependency w/ slf4j-api

Is your feature request related to a problem? Please describe.
Redisson in https creates a hard dependency on an SLF4J binding, which if you already have a binding in place in your application, causes logs like:
Note the link and warning from SLF4J: http.  This is a random behavior and could be catastrophic depending on your intended logging config versus what Redisson attempts to do. Also note this paragraph:
Embedded components such as libraries or frameworks should not declare a dependency on any SLF4J binding but only depend on slf4j-api. When a library declares a compile-time dependency on a SLF4J binding, it imposes that binding on the end-user, thus negating SLF4J's purpose. When you come across an embedded component declaring a compile-time dependency on any SLF4J binding, please take the time to contact the authors of said component/library and kindly ask them to mend their ways.
Describe the solution you'd like
Remove the dependency on slf4j-simple and replace it with slf4j-api like is recommended by SLF4J.  This is noted in the SLF4J link above and is concisely:
Embedded components such as libraries or frameworks should not declare a dependency on any SLF4J binding but only depend on slf4j-api.
Describe alternatives you've considered
We have considered rebuilding the Redisson jars to remove this dependency, but it should not be there to begin with.


2867
How could i deserialize a value which put by RedisTemplate of Spring from redis?

How could i deserialize a value which put by RedisTemplate of Spring from redis ?
especially when i used RedisTemplate of spring before in my project, and now changed to Redisson.
I get an deserialize failed error.
exception stack as follows:


2868
How Redisson figures out the key slot in cluster enabled Redis with multiple shards?

Does Redisson maintains a map of all the slots available in each master node. Uses this map to figure out the relevant master for read and write and then queries that master? Or
Does it queries a random master it gives the answer where the slot lies and then queries again the new master.
what is the hashing algorithm being used in Redisson?Just for confirmation it should be CRC16(Key)?
Does it hash the whole key or partial?


2869
none




2870
redisson,The current thread does not release the lock, will hava some problems.

yesterday,i test the redisson lock,i use  Apache JMeter to test the concurrency.param: thread number = 1000,  loop = 1.i found when i not release the lock .but other thread can get the lock.
example:


2871
RedissonBloomFilter NullPointerException




2872
Don't release the lock actively, there is a problem in high concurrency

yesterday,i test the redisson lock,i use  Apache JMeter to test the concurrency.param: thread number = 1000,  loop = 1.i found when i not release the lock .but other thread can get the lock.
example:


2873
none




2874
RedissonAtomicLong#getAndSet throws NullPointerException when value does not exist yet

Expected behavior
Either no Exception (just create the value, getAndSet shoudl be able to create the value as well) or documented behaviour
Actual behavior
Null Pointer Exception, but only during first execution. Reproducible if I manually delete the value in Redis again
Steps to reproduce or test case
When the value does not exist yet, counterInDb is not null but calling getAndSet on it without checking isExists as well in the if gives me a NullPointerException at RedissonAtomicLong.java:122. This is quite confusing as
The Null Pointer Exception is from the implicit cast from Long to long, which makes it really hard to spot
There is no JavaDoc warning that this might happen


2875
RedissonAtomicDouble#getAndSet() method throws NPE

No description provided.


2876
error: Provider org.redisson.jcache.JCachingProvider not a subtype

I am running tomcat with Equinox and want to use redisson for session storage. The shared session storage works fine but I have this error in my localhost.xxx.log.
Here is my redisson.config.yaml
I am not actually interested in replacing the caching provider. I'd like to use redisson only for shared session storage.
Appreciate your ideas.


2877
Redis native commands are not supported using redisson client

I wanted to run Redis Native commands using redisson provided low-level client, However.  Some of the commands i see not exposed from
I just explored String and Hash commands, however list of commands not supported might be more.
Usage:
a) Is there are way i can actually run the redis native commands via some interfaces?
b) Any reason why redisson is not exposing complete set of redis native commands? Does Redisson make any effort on a regular basis to support new commands that are offered by Redis?


2878
Better support for subclassing RedissonRegionFactory

Hi, to configure redisson for hibernate only using code (like env variables) i subclass the RedissonRegionFactory and override method createRedissonClient. This works great until i want to take advantage of the property hibernate.cache.redisson.fallback. This property has private access so i cant alter it in the same way as the base class do. My only way forward is via reflections which is hackish...
Could you provide a protected setter or refactor code for fallback-setting to a protected method? Also allow for inheritance in the future. Thanks!


2879
Sentinel hostname isn't used for ssl connection during Redisson startup

No description provided.


2880
hibernate 2LC, multiple tomcat node is causing flush on each node join to cluster

hi everybody,
I am experiencing unexpected behaviour(at least from my perspective) when I try to use RedissonRegionFactory.
what I am trying to do is:
I have a clustered application and all of my nodes are using same database, and I was configured ehcache for second level cache on each node, and when something happened on one entity, I was sending an event to other nodes for evict their 2LC to keep data consitenct over the cluster.  Now I try to replace that eh_cache + event system with one central 2lc provider.
for that surpose,  first node is connecting and configuring redis on its startup.
how I am configuring redis: after first node startup is completed I put a flag on redis to avoid second configuration from other nodes.
I am able to see redis keys/values like this:
I would be appreciated for any idea advice whatever to help to understand why this behave like this.


2881
none




2883
RedissonFairLock deadlock

RedissonFairLock result
Only more than 100 "endLok" were printed.if use RedissonLock,it can be print all.


2884
RMapCache.clear() method shouldn't clear maxSize option

No description provided.


2885
Don't handle empty sentinels list

No description provided.


2886
RedisResponseTimeoutException bug

redisson client config
Expected behavior
get lock and continue to do business logic
Actual behavior
after first time fail and three times retry fail, I got RedisResponseTimeoutException
Steps to reproduce or test case
the prerequisite is
your redis server require a password auth
your redisson client in a NAT
your redis server config have this:
after 5 minute you will get this RedisResponseTimeoutException problem, however the redis server did not receive the request at all.


2887
none




2888
Set Redisson config using AWS ElastiCache as Clustered Mode

Hey there!
What is the proper way to configure Redisson when you have a AWS ElastiCache Redis running as Clustered Mode? I have tried to set using it as follows:
Configuration endpoint: test-rest-encryption.p0vefj.clustercfg.use1.cache.amazonaws.com
For nodeAddress, I have tried to use configuration endpoint and node endpoint but fails in both case (connection timed out): Am I missing something?


2889
sentinel more failure ,You can't write against a read only replica..

use redisson sentinel mode


2890
instead of creating config out of redisson file, get config object from property map

Is your feature request related to a problem? Please describe.
this is not directly related with a problem, but instead of maintaining file and doing io operation, passing config object on-the-fly would be more suitable on my scenario. then I wanted to ask to maintaniers about this.
Describe the solution you'd like
My solution would be to as follows, adding additonal if statement to check object is passed or not
Describe alternatives you've considered
I am currently overriding this method and using this RegionFactory


2891
BITFIELD command support

No description provided.


2892
Unable to decode data. channel: [id: 0x34a72ba5, L:/xxxxxxx - R:xxxxxxxx], reply: ReplayingDecoderByteBuf(ridx=88, widx=88) java.lang.NullPointerException: null

Unable to decode data. channel: [id: 0x34a72ba5, L:/xxxxxxx - R:xxxxxxxx], reply: ReplayingDecoderByteBuf(ridx=88, widx=88) java.lang.NullPointerException: null
thanks for your help


2893
possible concurrent issue in RedissonLock?

When running multiple threads to acquire the lock with the same name, the below error happened from time to time.
Not sure if we need any concurrency control in the ExpirationEntry of RedissonLock? e.g. by simply converting the threadIds to a synchronized map, the issue got fixed in our particular case.


2894
none





2895
RRateLimiter doesn't work

Hi,
I have created RRateLimiter instance.  If I call acquire (), it doesn't work.


2896
Redis Cluster - fails to calculate key slot when missing closing "}"

I have { as part of the key but no } because it is part of my domain which is not intended to be used key hash tags. As a result I get:
Expected behavior
According to Redis documentation missing closing} is fine, use the whole string to calculate the hash slot. Similarly, if there is no string between {and} (i.e. abc{}xyz), use the whole key too.
Actual behavior
Exception
Steps to reproduce or test case
I suggest to modify org.redisson.cluster.ClusterConnectionManager.calcSlot(java.lang.String) like this:


2897
Strange characters on value when read data in other language

Hey there!
I was wondering if it's possible to perform a simple operation like we do on Redis StackExchange (c#) client:
Right now I'm using a Map but I would like to make it simple as this example on C#.
When I try to retrieve values fro other clients like C# or Python, I got some strange characters on value like myv alue.
Is there any option to clear/remove those characters on Redisson and store it as plain string?
Is there any option to store it simple as we do in C#?


2898
Getting Register a custom serializer implementing instantiate or define empty constructor - redis cache on wildfly

Hello, When I deploy my code on Wildfly-19 with Redisson client to connect to Redis cluster. I am getting below error.
Here is my redis configuration


2899
Getting too many cache misses and high cache put after a period

Our solution uses Redisson configuration with a programmatic cache creation using org.redisson.jcache.JCacheManager with a single Redis server.
Caches are created with cache-api configuration and a ExpiryPolicy.
When the application loads for the first time, caches started to be used and for a period they work as expected with high cache hits.
After a period of tests, one (or many) caches start "deteriorating" and cache miss ratio starts to be higher. Cache put time also started to be very high.
We have a screen showing cache statistics. This is one example of statistics after the problem occurs.
At the example, all other caches of same type are working as expected. Just "Usuario.funcionalidades" is having the problem.
The problem always happens with a nested collection in a Hibernate entity.
Have you seen similar behavior? Any clues about how to understand better what is happening?


2900
Indexes of an RLO in Redis

I do the Persistence of a RLO with some indexes, and I have a time for it to expire, however the indices, never disappear from the memory of the redis, can anyone help?
After 1 minute, the object is removed from the redis, OK ... but the indeces are not


2901
debug log command is null

why?


2902
PING command still send on IDLE closed channel

Expected behavior
PING command should not be sent on IDLE closed connection
Actual behavior


2903
Why the value of the lock >1?

redisson-version:3.13.2
I have three servers ,in order to ensure that only one  scheduled task is executed at the same time,
I use lock like this:
But after a while, the value of lock >1,
Although it will not cause an error.But I'm curious about how it happened.
I use Junit to test it: But it didn't reappear.


2904
For the expire method of some RExpirable instances, there should be a bug

For example, RedissonRateLimiter has 3 keys: getName(), getValueName(), getClientValueName(), but expire only sets the expiration time of the getName() key in the parent class. And there is no overwrite expire method in RedissonRateLimiter.
Expected behavior


2905
 Unable to decode data. Unsupported protocol version 252

Expected behavior
Actual behavior


2906
Retry Attempt in Redisson

I went through the below mentioned documentation .
What I understood is, the redisson client will try to retry to execute the command according to this configuration, correct me if I am wrong.
But what I want to ask is , will it also retry to create the client connection while starting up the application according to this configuration?
I tested it by shutting down the redis server and then started the application . It is throwing exception as expected like
But nowhere I see in the log regarding retry attempts.
It would be helpful if you can shed some light on it.
Redis version
5.0
Redisson version
3.12.5


2907
RedisTimeoutException while processing task polled from blocking queue within the same CompletionStage

Hello,
I created two simple tests (in Kotlin but its pretty straightforward to be translated in Java):
And a second one:
I had the expectation that these two tests will work more or less in the same way (i.e. I expected that both tests will pass). Surprisingly first test fails after running several times in the loop . It fails with:
The only difference between these two tests is the async function composition. First test uses thenAccept and second one uses thenCompose, i.e. the difference is in the CompletionStage. Is it expected that first test should fail?


2908
Reasoning behind returning false on RSemaphore

Why do methods such as trySetPermits only return false when the attempt fails? I am trying to debug an issue around using semaphores, and this method is returning false; however, since no exception is thrown, I have no insight into why this is failing.
What would be the possible reasons for failing on this method?


2909
Redisson warning jboss marshlling

I  am getting this warning :


2910
redis tryLock is always reconnect

I interrupt Redis while the program is running;
tryLock retryAttempts  3,the system business will not continue to go down


2911
writeMode=WriteBehind causes Command still hasn't been written into connection error

No description provided.


2912
RedisTimeoutException on ElastiCache being called by Kubernetes

Hey there!
We moved our code to production and we are facing a lot of timeout errors:
It's happening for GET and PSETEX commands. I have found the FAQ with possible solutions like increase nettyThreads and I was wondering if our problem is related with FAQ instructions - our code is super simple, it's a spring boot application with the following implementation:
For now, we don't have massive requests, probably it's missing some configuration or just update Redisson Client because we are using a super outdated version 3.5.6.
Do you have any other suggestion behind update lib? Do you know if is possible set nettyThread using application.properties?


2913
RedissonResponseTimeoutException in HSCAN

The application is throwing RedissonResponseTimeoutException. It is happening when Redisson fires HSCAN command because the code is iterating over HashMap with size of 8.5k entries. Below is the exception message
I tried increasing the netty thread to 64 and retryAttempts to 6 and timeout time to 6000.5


2914
redisson-netty thread lock

Hi,
We have setup Redis cluster and populated key/values. Some Keys contain more than 2M fields. When we call getAll of RMap using redission client, it takes more than 30 mins and goes to idle state. We analyzed the thread dump and noticed the below errors. We are using redission client (3.13.1). Is this known issue with Redisson client?


2915
Only a single pod is working using Redis Clustered Mode

Hey there!
I'm running Clustered Redis on AWS ElastiCache with 3 shards, 6 nodes (cache.m5.large) and using engine 5.0.6. Today, I was facing a lot of RedisTimeout error so I have choosed to upgrade Redisson from version 3.5.6 to 3.13.2.
The timeout error were gone but now I'm facing a strange behaviour.
My application is running on Kubernetes (it starts with 3 pods and can scale up) but only a single pod is working correctly with Redis, the others pods are throwing some exceptions like:
Usually, this exception is throwed when the app make a request to cacheServiceImpl.get("<key>").
The code is super simple, I'm using RBucket to read and insert data:
And for Redisson configuration, I'm using the following: I'm assuming that Redisson is using default values for other attributes. As host, I have tried the cluster endpoint and a specific node endpoint but both cases fail with same excepion.
Any idea where can I look or what can I change in configuration to make it work?
Thanks in advance.


2916
none




2917
IllegalArgumentException: RIVER

Hello,
I use Redisson with Spring Boot Project. While RedissonClient bean is created, IllegalArgumentException: RIVER is thrown. The problem is at MarshallingCodec.java:214 because my computer's language is Turkish. In Turkish, the lowercase of "I" is "ı"(without a dot) instead of "i"(with a dot). Therefore, "rıver"(without a dot) is not found.
I think, toLowerCase() method at MarshallingCodec.java:214 should be toLowerCase(Locale.ENGLISH).
Have a nice day.


2918
none




2919
none




2920
Caused by: org.redisson.client.RedisException: ERR unsupported unit provided. please use m, km, ft, mi.




2921
Thread gets stuck when trying to acquire lock via tryLock()

Expected behavior
The thread should get release i.e tryLock should return false
Actual behavior
Thread gets stuck in Waiting state
Steps to reproduce or test case
This is how we are calling the tryLock and multiple threads are scheduled to call this.
Some threads gets stuck at the Waiting state at tryLock.
This is observed when the shards are being added (Sharding is In Progress state).  After sharding is done then Restarting the application releases the threads.


2922
Object Listener - question

Hi,
Thanks for creating this great library! You also have a great wiki!
Is there any thing wrong with this code? This is a simple example.
I expect the delete event should get triggered. But It does not seem to work.
Thanks.


2923
Redis stream - Can we return Flux instead of Mono?

Redission library is great!  Stream is not exactly like pub/sub. But they do have some similarities.
So, like pub/sub, Can the stream return the flux of messages to make it more reactive style?


2924
RRatelimiter-Can the method of delete and trySetRate support in a transaction?

Problem:
In a production environment, we often deploy more than one application for high availability (HA). There are two steps: delete and trySetRate when update the RRatelimit object. In HA architecture, there will be such a situation: application 1 delete the object when application 2 trySetRate it,  therefore application 1 will update failed.
The solution i would like is support the update operation(delete and trySetRate) in a transaction.
The alternatives I have used in my project is locking object globally when update it.
Redisson Version: 3.13.0


2925
(XREADGROUP) in redisson-spring-data cause READONLY You can't write against a read only replica

Expected behavior
I start to use redis stream as a mq to send log record,  I add a record to the stream in client service , when I try to get the log record from the redis stream I got the exception.
What I Think
From #2663, and redis website, the command XREADGROUP
XREADGROUP is a write command because even if it reads from the stream, the consumer group is modified as a side effect of reading, so it can be only called in master instances.
#2663 fix  redisson/src/main/java/org/redisson/RedissonStream.java method readGroupAsync, so I think maybe org.redisson.spring.data.connection method xReadGroup
should change to use the write operation.
Actual behavior

add a record using redis stream api
try to get the stream message use StreamMessageListenerContainer  and StreamListener


2926
Neither `expired` nor `deleted` listeners are getting events for `RBucket`

This is just creating a ticket for #2922 because it's real.
Expected behavior
Listeners for bucket's deleted and expired should work.
Actual behavior
They do not.
Steps to reproduce or test case


2927
Spring Data Redis connection in multi mode may cause thread hang

No description provided.


2928
Spring Data Redis connection in multi mode causes connection leak if it wasn't executed during RedisTemplate execution

No description provided.


2929
connection leak in sentinelMode and without ssl

(default masterConnectionMinimumIdleSize,slaveConnectionMinmumIdkeSize is 32, masterConnectionPoolSize,slaveConnectionPoolSize is 64)
when sentinel/master/slave node and client network jitter, master/slaves role switching, masterConnectionPoolSize, slaveConnectionPoolSize can't limit connection, use jmap dump heap, ClientConnectionsEntry.freeConnectionsCounter.counter is bigger than 64!


2930
Error when configuring empty password

If I configure a empty password for the standard configuration of redis, an error will be reported when the service starts.
In order to facilitate the migration of the service environment,i reserved an empty password configuration for redis,like this
The service will report an error when it starts


2931
RRateLimiter rate interval might be exceeded if permits aquired at the end of interval and the start of next interval

No description provided.


2932
When performing failover, RedisConnectionException is thrown when accessing the cache after failover.

Please let me know because an unexpected event has occurred.
Expected behavior
Successful access to the cache once failover is complete
Actual behavior
RedisConnectionException is thrown when getting cache
Conditions that cause an exception
I tried it several times, but I have confirmed that this event occurs only when information is acquired from the cache during failover.
Steps to reproduce or test case
State at start:master A, slave B
Step1:kill slaveB
Step2、create slaveC, slaveD
Step3、Fail over Master A
State at the time of error:slave A, master B,slave C
Redisson version
3.13.2
Exception Log
Other
Since this phenomenon first occurred in version 3.6.5, I tried 3.3.12 but the phenomenon did not resolve.
In version 3.6.5, throw WriteRedisConnectionException
I would like support.


2933
Watchdog for RSemaphore

RLock is great mechanism for distributed locking since it has a watchdog for releasing lock when client application is dead.
However, when it comes to reactive version (RLockReactive) it becomes totally unuseful because unlocking can be done only by the thread that performs locking. And with reactive streams this never happens for sure.
Instead, it is suggested to use RSemaphore as an alternative since it is not bound to threads. In general, it does the job. However, when client application becomes dead, already performed lock hangs forever. Setting key expiration time partially solves the problem, however, actual atomic operation time may differ, so it is usually difficult to choose the correct timeout.
Another option is a watchdog, but apparently Redisson one does not work with RSemaphore.
So, is it possible to configure the Redisson watchdog for prolonging RSemaphore expire time? Or the only way out is implementing own watchdog?


2934
Redis Sentinel - RedissonAutoConfiguration (SpringBoot) - StringIndexOutOfBoundsException

SpringBoot application does not start due to the following 'StringIndexOutOfBoundsException' exception when the RedissonClient is tried to be instantiated:
The line of code that fails seems to be this one (RedisURI.java:46):


2935
Bug: LiveObjectService#persist returns empty object

I'm using the Redisson Live Objects 3.13.2 and I have the following object:
Expected behavior
LiveObjectService#delete removes the object immediately and LiveObjectService#persist returns a full object.
Actual behavior
So I have two problems:
When I do this operation(to override the current object):
I sometimes get java.lang.IllegalArgumentException: This REntity already exists. although I'm performing a deletion beforehand. I can get it even if the cache is totally empty before then.
Sometimes after the persist operation supposedly succeed, what I receive is an empty object so when I try to get any field(for example call ReporterObject#getParent a NullPointerException is  being thrown, and when I debug it I see an empty object or not "fully full" object:. In this example I only have sId and type but no id , no rId, no ac etc. As I stated, If I try to getAc() a NullPointerException is thrown. Of course it's not limited to this fields only. Sometimes it's other fields that are missing. Sometimes I get a fully empty object like this one:
Steps to reproduce or test case
I guess use the same object as me.
It might be important to know that I'm inserting those object concurrently(different objects though - no two objects with the same id at the same time).
Hope you can help! Thanks


2936
Does redisson support the client side caching which starts with Redis 6.0 ?

Does redisson support the client side caching which starts with Redis 6.0 ?Or whether it will support the client side caching in the future ?


2937
Reset Jodd ClassIntrospector instance after RLiveObjectService.persist() method invocation

No description provided.


2938
OOM arise during RLiveObjectService.persist() method invocation

No description provided.


2939
Incorrect registration of Sentinel node defined with hostname

No description provided.


2940
org.redisson.client.RedisTimeoutException use RLock

Environment Info:
error:
The online environment has been running for many days without problems, and the above error has been reported recently and it is normal after restarting.
When the error is reported, the application still has 27 connections to x.x.x.22:6370
Except  the connections to x.x.x.22:6370 has errors, other redis nodes have no errors
The application is using redisClient at the same time, but no error is reported,indicating that there should be no problem with the network
question:
I want to know what are the possible reasons for the above error


2941
none




2942
none




2943
ExecutorService - how to specify workers

hi, I wonder what does the workers mean when I register a worker:
Do I have to specify all the workers that might be registered into this cluster? The problem is that the auto-scaling strategy makes it hard to specify the number of all workers, because the number varies in runtime.


2944
more connected clients than allowed

I have setup redis client with setConnectionPoolSize(64) . At heavy load when I check the Redis server it shows connected clients to be  284. I am running 4 replicas of application. I expect it should never go above 64*4 = 256.
No other app is currently connected nor any manual connection has been done to the redis server.
I am not sure whats the exact reason here.


2945
Failure on ProxyJCacheConfiguration

Hello,
I have an application on Spring boot 2.2.6 using Caffeine Cache with @EnableCaching and @Cachable annotations.
And I'm trying to integrate redisson 3.12.5 to only read from a Redis cache.
When the app is starting up I'm getting this error and the app fails to start:
Any clue?


2946
Caused by: java.io.IOException: java.io.IOException: Failed to read the next byte at org.redisson.codec.FstCodec

Using Redisson client to connect to the Redis server. My Java Object has changed recently, added a new variable into my Java Object.
Started seeing this exception since then. How can I use the updated Object.


2947
some closed channel in freeConnections after network jitter

Expected behavior
Actual behavior
Steps to reproduce or test case
use chaosblade, set losspackage 50% and 200ms delay in redis port, keep 5min
start 50 thread to use redisson to read redis (client.getBucket("testkey").get())
i find there are some closed connection(channel) in the free connection pool
i use arthas to attach process, and watch org.redisson.command.CommandAsyncService#async(...int attempt, ...)
when chaosblade execute finished,also have method invoke with attempt > 0,than i find async(attempt > 0) only called by org.redisson.command.CommandAsyncService$6(it's a anonymous TimerTask)#run, getconnection() succes and call sendcommand() but netty writefuture not complete,than trigger the TimerTask, and i watch org.redisson.command.CommandAsyncService#sendCommand, find any connections is closed....and i use netstat -nt to confirm the connection is closed, but their also in the freeConnectionPool.....
the find freeConnectionCounter is bigger than slaveConnectionPoolSize, and freeConnection, allconnection also unlimit at sometime and sometime freeConnections size is bigger than allConnection......
it just like #2929 (comment)
and i reproduce it without RBatch command
i don't know why not check connection and drop it when getconnection?(
in org.redisson.connection.pool.ConnectionPool#connectTo, poll() get a connection,the connection is not actived,just trySetupFistFail?)
and i want know this bug is fixed in 3.13.xx?
thanks for you


2948
MapCache EntryRemovedListener not working

Hello,
I've encountered a  bug when using EntryRemovedListener .
When i run test , i got the errors .
But, another listener as EntryExpiredListener works well
My setup:


2949
how to set rmap hashkey Serializer method?

when I use redistemplate, I can do this:
how can I set Serializer for hashkey or key independently


2950
how to set rmap hashkey Serializer method?

Follow the issue: #2949
when I use redistemplate, I can do this:
I hava known this method, just like
but my hahkey want to use StringCodec, not JacksonCodec, how can I set codec just for hashkey separately.


2951
BloomFilter renmae bug




2952
Sentinel in junit test.

Hello
I want to write junit test in redisson to check my problem with Sentinel.
I found test org.redisson.RedissonBlockingQueueTest#testTakeReattachSentinel and wanted to use it as example for
Sentinel setup, but it's failing to run.
What am i doing wrong?
all other tests run fine


2953
Error: org.redisson.client.RedisConnectionException: SlaveConnectionPool no available Redis entries, with version 3.13.2 and 3.13.1.

Expected behavior
We are using Redisson for AWS elasticache cluster and established connection should work consistently without any exception or error.
Actual behavior
Redisson client fails with the following exception  randomly , have to restart the application.
Steps to reproduce or test case
We are using redis in our multiple microservices and  the above exception happens very randomly in any of the services after some days.
Redis version
AWS elastic cluster.
Redisson version
Tried both 3.13.1 and 3.13.2 but same issue.


2955
redisson clusterConfig getMap method bug

Expected behavior
o is not empty,o1 is not empty;
Actual behavior
The first getMap execution result is not empty, and the second getMap execution result is null;
Steps to reproduce or test case


2957
none




2958
ls

No description provided.


2959
XPENDING causes syntax error in redisson-spring-data-23

Expected behavior
list of PendingMessage
Actual behavior
Steps to reproduce or test case
Seems like command for connection should be XPENDING_ENTRIES, not XPENDING


2960
FairLock is freezed after run more than 9000 times

this is my code.the log will not print after a few minute.


2961
The value stored in RedIS is different from the target value




2962
none




2963
JCache removeAsync throws NPE when remove fails

Test setup:
Expected behavior
Failure reported as original failure cause (RedisTimeoutException)
Actual behavior
Null pointer when Redisson updates stats bean
Notice the explicit null argument
Then the boolean unboxing in the listener
This causes NullPointerException
Steps to reproduce or test case
Have several JCache caches. Start application. Suspend Redis server to force connection timeouts. Call removeAll() on an existing JCache
Default SingleServer connecting to localhost with FstCodec


2964
CommandPubSubDecoder: Unable to decode data & NPE




2965
MasterSlaveConnectionManager allocates superfluous 113Kb of memory for non-cluster Redis setup

No description provided.


2966
function: RLiveObjectService.persist() ,why not have batch method? someone can help me ? persist very slowly one by one.

No description provided.


2967
when i try batch persist, but return result is not correct. please help .thanks.

code like as below:
result will throw exception:
Exception in thread java.lang.IllegalArgumentException: REntity should be attached to Redisson before save.
i think ,current object:xxx always java object, not link to redisson object , if i add some code ,will be normal.
so i think batch persist result why not link to redisson object automatic ?


2968
InternalThreadLocalMap memory leak

Expected behavior
Actual behavior
after long running, application gets oom
Steps to reproduce or test case
our app runs about 1 month
Redis version
cloud service, not sure
very big array(1048576 size) in each threadlocal, new array was created in old-gen and always fail


2969
Distributed exclusive task with Redisson?

I'm using Redisson distributed executor service. A task class A is designed to process a given queue identified by its queue ID. There are multiple such queues. I need to ensure for any time in the cluster, there are no more than one instance of task class A that works on the same queue.
Allowed:
Task class A instance1 working on queue1
Task class A instance2 working on queue2
Not allowed:
Task class A instance1 working on queue1
Task class A instance2 working on queue1
There are a large number of such queues and they change dynamically. So pre-allocation of task instances may not be an option, because the queue ID is dynamic.
How can this be achieved with Redisson executor? If not directly, can this be achieved with some distributed lock or queue?
I have the same question on Stackoverflow as well:


2970
Not able to  remove custom object from RScoredSortedSet JAVA

I have code like above in my application. i am not able to remove custom obj from RScoredSortedSet.


2971
none




2972
Redisson throw an RedissonShutdownException

Hi,
I am facing problem in redisson after a while of running the application. it threw an exception with the following stack trace.
and it failed to recover from that state untill the application is restarted. we also found another exception with the same stack trace
Redisson version: 3.13.2
can anyone help me how shall we recover from this problem without restarting application? also what is the cause of that problem?


2973
All cached Lua scripts are executed on Redis master nodes only.

No description provided.


2974
can i use spring.redis.pool.size to  change connectionPoolSize?

can i use spring.redis.pool.size to  change connectionPoolSize? although use redisson.yaml can set this parameter. however, I want to only set parameters in application.properties, then i can put application.properties in git which used in spring-cloud-config.


2975
Change hostname or port at runtime

Is there any way to change the redissonClient hostname at runtime and force the connexion to the new ip:port ?
I tried to remove listener from the previous client, shutdown and then create a new RedissonClient and a listener with the updated config but when I receive the first message, Redisson is shutdown and throw an exception.
It is possible to use the @RefreshScope from spring boot to achieve this goal ?
Thanks you !


2976
slave has been disconnected after 500 ms interval since moment of the first failed connection

redisson version 3.13.3
After upgrading to 3.13.3, the problem has not been solved.
Report an error every morning, usually once. Both errors occur at the same time.
error 1:
slave  has been disconnected after 500 ms interval since moment of the first failed connection.
error2:


2977
Kotlin classes incompatible with RedissonLiveObjectService

Expected behavior
User should be able to register arbitrary Kotlin classes.
Actual behavior
ByteBuddy throws new IllegalArgumentException("Cannot subclass primitive, array or final types: " + superType); on normal class declarations. This is because Kotlin's classes are final by default. However, to allow sub-classes, even after the open keyword is applied, and constructor keyword declared. ByteBuddy is still failing, with: java.lang.IllegalArgumentException: Can't find default constructor for class
Steps to reproduce or test case


2978
none




2980
[JCache] IllegalStateException: Default configuration hasn't been specified

I have specified redisson-jcache.yaml in my resources folder.
If I add the codec property in the configuration then get java.lang.IllegalStateException: Default configuration hasn't been specified!
If I remove the codec configuration property then everything works fine.
Expected behavior
Config should be parsed successfully with codec property.
Actual behavior
Steps to reproduce or test case
Comment the codec part in config and run agian.


2981
Reads only happening from Master Node for Hibernate L2 Cache in Elastic Cache replicated mode

Redis Setup:
Nodes: 1 Primary and 2 Replica Nodes
002 is Primary, rest 2 are replica node.
What I want to acheive
I want to configure Redis as a distributed l2 cache to improve my application's performance as ~70% of my traffic is read only. I am using hibernate as my ORM, thus don't want to write lots of custom code when there is a standard implementation provided by redisson.
Issue:
I see all the cache hits are from the master node meaning every write, as well as read, is just happening from the master node.
I went through all the issues reported till now to find the solution but none of them were around hibernate l2 cache. Finally found #2165 where its mentioned "RMapCache.get operations modifies data so it can't use slave node. This method updates idletimeout and lasttimeaccess parameters per entry.
You could use RMap object in this case."
And After looking at the code here I found we are using RMapCache<Object,Object> for each region.
This indicates we can't use it correctly for Hibernate L2 Cache as every time I try to fetch a cached object, redisson will write to the master node and my entire traffic will become dependent on a single master node. Which is not very reliable.
Please help with this.
Proof
Cache Hit Rate: You can clearly see its just hitting primary node.
Cache Hits: You can clearly see its just hitting primary node.
Cache Misses:
Happy to provide more details.


2984
Classloading issues with jboss-marshalling and redisson-tomcat

Expected behavior
When using redisson-tomcat to provide a SessionManager for our tomcat installation, we expect the classloader used to instantiate objects should be the current thread classloader, regardless of which Codec is being used. Using FSTCodec this worked as expected. This is to allow the right classloader, Tomcat vs WAR classloader to create the objects which it knows how to create.
Actual behavior
After the switch to the MarshallingCodec as default we are running into issues with the RiverUnmarshaller is throwing errors after calling classResolver.resolveClass(). When a thread from my WAR attempts to unmarshall a class it has loaded, for example org.springframework.security.web.savedrequest.DefaultSavedRequest the classresolver on the RiverUnmarshaller for some threads points to tomcat’s Classloader (URLClassLoader with apache-tomcat paths)
This RiverUnmashaller is a FastThreadLocal<Unmarshaller> decoderThreadLocal which is field on the MarshallingCodec.
I can see in the debugger that the MarshallingCodec has classLoader field of my WAR’s class loader, not a reference to tomcat’s. The configuration object on the same MarshallingCodec also points to the WAR class loader.
The number of threads in this broken state where the classloader being used to unmarshall isn't shared by the MarshallingCodec seems to change on each run, but reproduced pretty consistently.
Steps to reproduce or test case
Running Tomcat 8.5.57.0, deploy a WAR with a context xml with a manager as described
Place objects onto the session and attempt to retrieve them that are instances of classes not on the tomcat classpath directly (only within the war, spring security for example)
See requests fail sometimes, depending which thread picks up the work.


2985
none




2986
org.redisson.client.RedisNodeNotFoundException: Node for slot: 7727 hasn't been discovered yet. Check cluster slots coverage using CLUSTER NODES command

We have an AWS Elasticache cluster, with cluster mode enabled - multiple shards, NO replicas.
When ever a node is replaced, after new node comes up, Redission is not able to discover the new node, fails with
RedisNodeNotFoundException
Exception trace:
Expected behavior
Redisson to discover new replaced node without any issue
Actual behavior
Redisson fails to discover new node with RedisNodeNotFoundException.
After node replacement:
---Put and Deletes are failing


2987
RedisException: ERR Error running script while using RRateLimiter

I currently have an application where I first create a RRateLimiter. I then acquire one permit in a loop and do an operation. This application is intended to run in a distributed fashion. To test the behavior, I set off concurrent invocations of this program. While it works well for the most part, it does throw an error occasionally as described below.
Expected behavior
No error. The thread waits to acquire a permit and does so.
Actual behavior
Occasionally, the limiter.acquire() in the below code throws the following error-
Steps to reproduce or test case
Code snippet in AWS lambda talking to elasticache


2988
Issue in connecting cluster

Hi, I am facing error while connecting to cluster.
It is giving following error:
Let me know if any other detail is required.


2989
Tomcat session deserialisation error for object of Vector type

The session details are maintained in a  Vector class which doesn't have a default constructor
Sample class below:
While deserialising session data , we are getting following error


2990
Redis tomcat session deserialisation fails for vector without default constructor

Expected behavior
We are using RedissonSessionManager to store tomcat sessions to Redis. When session object contains object of type Java Vector  without default constructor, it  throws a deserialisation exception
The session details are maintained in a Vector class which doesn't have a default constructor. When we try to add this to redis session it fails


2991
When RMapCache key-value timeout, try to put("key","anotherValue") immediately, and then get("key") immediately, but it gets a null value

Expected behavior
anotherValue
Actual behavior
null
Steps to reproduce or test case


2992
none




2994
HA Failover: Redisson client maintaining the connection with the previous node, unable to read/write to redis.

Facing the following issue during HA testing the application wtih Redisson Client:
Steps:
Kill one of the masters, the slave becomes the master.
Make the master up after a minute, it then becomes the slave.
Kill the master node(which was slave), the slave becomes the master.
Sometimes its not reproducible in one shot, need to do this 3-4 times.
At this point, redisson is not able to read/write anything to that redis partition  because the client is still taking the previous master(which was killed) and not the promoted slave node.
As per below logs, port 8000 was the master node, which was killed, and the slave node 9000 was promoted to master. But still Redisson is sending the command to the previous master node. We need to restart the application to make it working or make the previous master up.


2996
How can I force Redisson to resolve the Redis server hostname again?

We had an issue where the IP address of the Redis server changed. We saw logs like these from the DNSMonitor:
Detected DNS change. Master rediss: has changed ip from IP1 to IP2
Unable to find master entry for host/{IP1}:port. Multiple IP bindings for single hostname supported only in Redisson PRO!
I saw in response to a similar issue the recommendation to disable DNS monitoring. I tried to prototype (with 3.13.3) on a local PC using the hosts file to simulator a DNS change. But Redisson continues to use the earlier resolved IP address instead of resolving the hostname again. I confirmed with InetAddress.getByName() that I can retrieve the updated IP address, but Redisson is still trying to use the old one.
I also tried to detect the connection drop when the IP changes (using ConnectionListener) and then completely recreate the Config and RedissonClient objects with the hostname, but still the older IP is used, and shown in the exception after failure to connect. I guess it remains cached somewhere?
Is there any way to force a new attempt to resolve the IP?


2997
Delayed queue cannot store data in the target queue on time in cluster mode, but it is normal in single mode

In cluster mode, delayed queue can't put the data to the target queue on time. The timeout data will be put into the target queue when the next offer is made


2998
why RedissonBoundedBlockingQueue pollAsync(int limit) not call redis incrby to increase the queue capacity?

I use the RedissonQueue 'pollAsync(int limit)' method, after i poll some elements, the capacity of the queue did not recovery, at last, the capacity becomes 0, wow , i can not offer element any more!!


3001
CastException when doing healthcheck with spring

Expected behavior
Actual behavior
DOWN because of the exception


3002
Get with byte[] Key

Is there an interface I can use to do get, set and del operations with byte[] keys?


3004
RedissonFairLock blocks indefinitely after threadWaitTimeExpiry

Expected behavior
Threads that are alive and waiting for a RedissionFairLock will always get ownership of the lock it tried to acquire.
Actual behavior
When a RedissonFairLock is locked by long-running Thread T1, and other Threads (T2, ..., Tn) attempts to access the lock and waits for longer than 5 minutes (the default threadWaitTime), even when T1 releases the lock all waiting Threads T2 to Tn hang indefinitely.
This is due to future threads removing "expired" threads from the Queue, when in reality these threads are still alive and waiting for the lock. These "expired" threads never receive the PUBLISH message on unlock.
Steps to reproduce or test case


3005
When performing failover, RedisConnectionException is thrown when accessing the cache after failover.

Regarding #2932, when we confirmed the effect using 3.12.3, the phenomenon was not resolved.
After the failover is complete, access to the new master keeps failing.
Could you please provide the conditions and details of the bugs that have been corrected?
I don't know if it is related to this case,
I'm currently using it in a non-cluster mode configuration where Redisson's addNodeAddress specifies the primary endpoint of the node group.
According to the issue below, you are asked to specify the endpoint of each node.
Is it related to this phenomenon?
As a test, I fixed it so that the endpoint of each node was specified, and the phenomenon that it continued to fail after failover did not occur.


3006
Request retry very quickly and slows down response handle

Expected behavior
one GET command results in one tcp request and done
Actual behavior
one GET command results in tens of tcp request
Steps to reproduce or test case
very hard to reproduce, don't know what caused this
tcpdump below is from a container without error log now(used to have 2 days ago), the application execute scheduled task every 30 seconds so more easy to analyze
in some application, this causes to much request and finally command timeout:


3007
Correct way for scan via reddison client

Hi!
I wan't to use redis scan operation via redisson (like in Jedis).
I'm checked next solution.
For example, i have 3 objects inside Redis and want to retrieve only 2
But instead of retriving 2 objects, getKeysByPattern("some-pattern", 2) returns all keys from redis.
This behaviour is correct?
Anyway, i'am trying to use SCAN operator via Lua scripts.
And this aproach is working one.
But why keys.getKeysByPattern(pattern, count) returns all keys instead of count?


3008
Does redisson work with tomcat singlesignon valve

Hi,
If we have configured the org.apache.catalina.authenticator.SingleSignOn valve in our application, does Redisson push the ssoId also to Redis? Do we have to make any other configuration changes other than what's mentioned in redisson-tomcat Readme for this to work?
Thanks


3009
Running into RedisTimeoutException when using Redisson, ElastiCache in AWS lambda when high traffic comes in

Hi
We are using Redisson to connect to ElastiCache to get RBucket in the AWS lambda. The trigger of the AWS lambda is a SQS(with batch size 10). The logic for this lambda is to get the RBucket for each message from SQS.(Redisson.get(BUCKET_KEY))
When traffic is low, no exception happens(TPS is around 50), but when traffic becomes higher(Max TPS is around 900), the invocation and concerencent number for lambda function is getting higher, and then some RedisTimeoutExceptions are thrown by Redisson. Therefore, the backlog of the SQS is increasing.
Here is the detailed Exception log when executing Redisson.get():
Here is the current Redisson Config, the other
Here are some question I want to get cleared:
I'm wondering what the detailed root cause for org.redisson.client.RedisTimeoutException: Command execution timeout for . Is that means the Redisson configtimout is shorter than expected? But I think purely increasing the timeout seems cannot scale up the capacity to handle the high TPS.
To resolve this issue, how can I modify the Redisson Config to handle such a high traffic? I followed the Redisson FAQ to scale up the config, but not sure how to come up with a suitable config.


3010
cannot be cast to org.redisson.api.RMap

An error occurred when setting the expiration time :


3011
How to get 'last access time of an object'?

Hello,
I see that there is the 'touch' operation on the RObject class but I don't see any method to retrieve the value for last access time.
Maybe is missing the command 'OBJECT IDLETIME'
If yes I can try to add that command.
Thanks.


3012
Tomcat session manager requires serialization or is this a bug?

After successfully setting up Redisson as Tomcat session manager I get the following exception when trying to access the application:
I also received another exception pointing to jboss-Marschalling also in regards to NotSerializableException.
As far as I understood the documentation, it would not be required to fix application code to move tomcat sessions to Redis via redisson. Am I wrong with my assumption?
Trying to solve this issue with different codecs did not work either.


3013
Store a Map<String,SomeObject> in Redis DB from one process and access from another with Redis DB

Hi,
Is it possible to find an example where a Redisson Map<String,SomeObject> is serialized to the Redis DB by a process P1. This Map is then accessed in another process  P2, also P2 should get notified about the updates made to this map by Process P1.
Any pointers to get started with this?
I see MapWriter example on Wiki. Does that example assume Oracle DB beneath?


3014
Redis LiveObject Bulk Initialization

Hi There,
I am using Redis library in my application.
Now I am planning to use RLiveObjectService  for search page (instead of DB will read from Redis Cache).
I do see that there are methods available  in RLiveObjectService for find , get , detele and instert to update Cache
I am looking for method like mergeAll or persistAll using which I can initialize cache during application startup.
Is there any way to achieve this.?
Thanks in Advance.


3015
Deletion RMap key by pattern

Hi guys,
I stumble upon a weird issue for my project. I am trying to delete RMap key by a pattern. I follow the documentation and it seems I could do that by getting the keyset and passing the pattern, and delete the found keys via the fastRemove method.
However It does not work for me.
I am using redisson library version 3.12.3 for Java, and the cache is deployed through elastic cache AWS.
The setup is like the following:
the RMap name is jsonCollectionV3 and the item key inside the map I tried to delete is 100011176limit5offset2 the pattern I am using is 100011176*
Please find below the code I am trying to use to fetch the key pattern from the map and using the fastRemove to delete the key retrieved.
However as per log below and entry in Redis desktop manager, the key is not removed from the map, the size still one.
If you guys can help me point out where did I do wrong, that will be great! thanks a lot. I have tried changing the key format for storing the records and it is not working as well.


3016
Java application is closing in 1 hour even all redisson threads are in waiting state.

Hi,
In one of my java application we are connected with Redis Server running on low compute machine (2 GB Ram, 1 Core) just for shared memory purpose.
Configuration of Redisson is as below
At Redis server side, we also changed tcp-keepalive and timeout as 0 value.
But i am not getting any exception and application is closing after 1 hour. I just only received the update in shutdownhook and thread dump is as below.


3017
Cannot cast object 'UNKNOWN-UNKNOWN' with class 'eu.bitwalker.useragentutils.UserAgent' to class 'eu.bitwalker.useragentutils.UserAgent'

Hi,
I'm trying to setup redisson for tomcat 8, and i'm getting this exception at the start:
I think it may be related to incorrect dependencies? In order to get the tomcat to start withouth errors, i had to manually add some libraries to the tomcat instance because redisson was failing with multiple exceptions related to classNotFound, these are the dependecies i had to add:
This is the redisson.conf i'm using


3018
a question about lock acquisition

I have a question about lock acquisition.
assume two services A and B acquire locks to access shared resources.
A has acquired the lock.
When B tries to acquire the lock. it will find the lock is held by other service(A).
So B will subscribe to the channel, for acquiring the lock.
before B subscribe to the channel,A release the lock and publish some messages.
What happens next?
B is waiting for the messages that is published by the lock holder(A), but A has published the messages and released the lock.
How did you solve it?
I'm sorry I didn't understand the source code,Thank you very much for your work.


3019
RedisConnectionException while retrieving from redis

Faced a problem while using redisson client after random period of time. the generated stack trace is:
the problem that the client does not recover until the application is restarted while another instances using that client is working normally.


3020
A question for method poll(int limit) in RedissonBoundedBlockingQueue

As far as I know, when I put a value to the queue,it will check the size of queue,the value is maintained at the key named redisson_bqs:... ,if the redisson_bqs's value <=0,it won't put any more.
This is the command for method poll():
If it gets the value,  it will increment the value of redisson_bqs by 1.
The following is the command for method poll(int limit)
It doesn't increment the value of redisson_bqs. When The number of times I put reaches the initial capacity, it won't put any more.


3021
none




3022
Is setAPI executable with multiple threads?

Regarding the execution of "API: org.redisson.api.RBucket#set(V value, long timeToLive, TimeUnit timeUnit)", is there a way to call multiple using a netty thread?
I tried the following, but it did not run in multi.


3023
`RBucket.set()` method is fully thread-safe, but I wouldn't recommend to use blocking operations in netty threads

@mrniko
RBucket.set() method is fully thread-safe, but I wouldn't recommend to use blocking operations in netty threads
Doesn't it mean that the blocking operation (such as "RBucket.set()") cannot be thread-managed (multithreaded) only by the logic in redisson without using another library (such as "Spring's ThreadPoolTaskExecutor")?
Originally posted by @mrniko in #3022 (comment)


3024
`RBucket.set()` method is fully thread-safe, but I wouldn't recommend to use blocking operations in netty threads

@mrniko
RBucket.set() method is fully thread-safe, but I wouldn't recommend to use blocking operations in netty threads
Doesn't it mean that the blocking operation (such as "RBucket.set()") cannot be thread-managed (multithreaded(parallelization)) only by the logic in redisson without using another library (such as "Spring's ThreadPoolTaskExecutor")?
Originally posted by @mrniko in #3022 (comment)


3025
RateLimiter Bug on 3.13.3 : bad argument #2 to 'unpack' (data string too short)

My Code
Expected behavior
Actual behavior
first call test() function, works fine, but after 5 SECONDS(after one period), will throw exception
Steps to reproduce or test case
Only 3.13.3 have this problem
There is no problem on 3.13.2
Redisson configuration


3026
How RScoredSortedSet sets a namespace or creates a parent directory

The amount of data is very large, I want to put it in a parent folder,help me


3027
Why doesn't the redisson connections reconnect after the network recovery

Expected behavior
After the network between redisson and redis server recoveried from disconnection, Redisson is able to open a healthy connection pool to each of the nodes
Actual behavior
Connection never recover until we restart the service. This situation  Occasionally happens.
Error Log
We only log the exception message like this
I am curious about some question:
why some log shows "after 0retry attempts"? Does the retryAttempt not work?
What's the meaning of the freeConnectionsCounter and freeConnectionsAmount in the log? The value of  freeConnectionsCounter in the log is 1100 and even bigger than the connectionPoolSize, is that ok?
why the connection never recover?


3028
sessionDestroyedMessage  and sessionCreatedMessage question

question:
we have two server: A, B
when session.setAttribute(key, value); on A server
session.invalidate(); on B server.
session.setAttribute(key, value); on A server,
now session.getAttribute(key); on B server will return null
why this happened?


3029
 java.lang.String cannot be cast to [B thanks for help




3030
Sentinel and Redis Different password

There is no configuration for sentinel password, you are using the same password flag to be used for sentinel and redis, and by that way I am obliged to set the same password for redis and sentinel, so can't we have a different yml property special for sentinel password?


3031
use RBloomFilter contains throw org.redisson.client.RedisMovedException




3032
Is there a fast and efficient way to get a count of all entries in a RMultimap?

With a regular RMap the size() is very quick and efficient but it doesn't seem that there is a way to get the total size of a multimap in the same way. What I mean by total size is the sum of sizes of all of the values (collections) of a multimap.


3033
Understanding sizeInMemory

I'm wondering what exactly is reported by sizeInMemory() method. The doc says it is "Returns bytes amount used by object in Redis memory".
I'm looking at the numbers this method reports say for the RSet of strings and it is much smaller than byte count of the strings stored in the RSet. Does it mean that the data is stored compressed in REDIS?
Also is my understanding correct that for RSetMultimap to find the total size of it in memory one needs to add value returned by sizeInMemory() for the map itself and then the value returned by sizeInMemory() for all of the RSets stored in that map?


3034
`RMultimap.sizeInMemory()` method doesn't take in account size of all associated objects

Expected behavior
Actual behavior
Steps to reproduce or test case


3035
none




3036
Migration form 3.12 to 3.13. FST to Marshalling Codec migration without downtime

We have multiple instance of web app and all pointing to same AWS Elasticache (redis). When new version deployed some of them will use old Redisson lib (with previous default codec, FST).
Any suggestion appreciate to deploy new version with new codec smoothly without downtime?
Thanks in advance
Marko


3037
none




3038
RSemaphore.addPermits() method doesn't work

No description provided.


3039
CommandDecoder - Unable to decode data. reply: $X

redis.txt
Observing Similar Errors in Our Logs since few days
Attached a file with similar errors
Please help me with this
We have a single server config
Thank You


3041
Is redisson-tomcat 3.13.0 compatible with redisson-all 3.12.4?

No description provided.


3042
Allow RedissonClient construction with no redis availability

Is your feature request related to a problem? Please describe.
This is for SingleServerConfigs.
Occasionally during deployment the redis instance comes up after our services. When injecting RedissonClients using Spring @bean or CDI @produces, the RedissonClient dependency will fail with an exception upon construction.
Describe the solution you'd like
When your connection pool minimums are set to 0, RedissonClient instances should be able to be constructed without redis being available.
Any operations with no connections in the pool should attempt a connection. Failing that, fail accordingly. It would be nice to have a "target pool size" in addition to an actual minimum- so that I can have a minimum of 0 but aim to have 10 or more, etc.
Describe alternatives you've considered
We'd have to inject some form of Supplier instead, this is not ideal. The client is the owner of the pool, us doing that is taking on those connection pool management concerns.


3043
java.io.IOException: Unsupported protocol version 252

I am getting a failure due to the issue:
stackTrace:


3044
Old value of RLiveObject's field isn't removed from index

No description provided.


3045
redisson-3.13.1 throws java.lang.ClassCastException for gets when used with AWS Elasticache Cluster mode enabled

Expected behavior
We currently use Redisson 3.11.5 with AWS Elasticache Cluster mode enabled. Gets using RBuckets works well.
When we tried to upgrade to Redisson 3.13.1, we expected gets should work seemlessly without issue
Actual behavior
But When we tried to upgrade to 3.13.1, started to see ClassCastExceptions.
I have tried to look into scenarios on when this was happening.
Looks like it happens whenever redission client is seeing MOVED response from connected redis node
Issue get resovled immediately when we rollback to 3.11.5
questions:
is there something different in cluster mode handling in 3.13.1?
Looks  like 3.11.5 rightly resolve to right slot and node and is able to cast payload correctly. But  with 3.13.1 something is broken.
Steps to reproduce or test case


3046
Implement Watchdog for RPermitExpirableSemaphore

No description provided.


3047
Encountering NullPointerException when a bunch of requests hit the web app in short period

When a bunch of requests hit the web app in short period (e.g. 2000 requests  in 5 min), tomcat-redisson-9 throws NPE attached on the bottom, the issue refers to below line of code.
I've tried with various versions of redisson-tomcat-9(3.12.3, 3.12.4, 3.13.0, 3.13.4), but the issue stick to below line of code.


3049
Is there configs suggestions

Hi, is there any suggestions for configuring these 'size' values based on the config of Redis server
For example, my Redis cluster server:
I know it may depend on the commands I am using, so I just want to know a basic suggestion.
Is there any formula I can follow for configuring?


3050
RBloomfilter need addAll

RBloomFilter only have
boolean add(T object);


3051
none




3052
With Fst Codec during readall java.io.IOException: java.lang.RuntimeException: unable to find class for code 50

Expected behavior
Junit should pass
Actual behavior


3053
Fail to start with Tomcat8

I followed instructions for Tomcat, copied two jars to lib dir, edited context.xml, created conf.yaml, however, keep getting:
Do I need add more libs to classpath?


3054
Would it be possible to add compressed JSON codec?

It would provide for grate portability and at the same time would benefit from smaller stored object size.
We are using memcached in many places at the moment and it utilizes similar approach for the string data.


3055
org.redisson.client.RedisConnectionException: SlaveConnectionPool no available Redis entries. Master entry host: NA:6379

redisson: 3.13.0
@mrniko
i see  this issue was fixed in 3.13.3, and there is no problem, after upgraded to 3.13.3. could you please post the cause of the issue ?  and how to reproduce it ?  thank you very much.


3056
Add RRingBuffer.setCapacity() method

No description provided.


3057
tomcat-redisson session.getAttributeNames not honoring loadedAttributes

Expected behavior
When using readMode=REDIS and updateMode=AFTER_REQUEST
session.getAttributeNames() should include "a"
Actual behavior
session.getAttributeNames() does not include values cached in loadedAttributes map, and goes directly to redis, which has not yet received the new information.
Steps to reproduce or test case
see 86ac2aa for work around that solved the issue


3058
tomcat-redisson session expiration for active session on another server

Expected behavior
When a session is present on multiple tomcat servers, it should not expire and be removed from redis until the last accessed time in redis is old enough to be considered expired
Actual behavior
the last accessed time in memory on each server is checked, and if any of them are old enough, the session is deleted from redis
Steps to reproduce or test case
So we've run into a different issue around expiring sessions.
The scenario where we ran into this problem was with readMode=Redis and broadcast mode off, but it may exist with it on also.
user interacts with server 1
network partition/round robin loadbalancing makes a the next request to server 2 for a short period of time
user interacts with server 1 again (partition over or dynamic load balancing)
user's in memory session on server 2 will expire prior to their actual session expiration since the last access time in memory on server2 is older than server1 or in redis itself.
server 2 expires the session which triggers a delete call, removing the session from redis, even if they were still active on server 1
our tests, which have diverged a little from master looks along the lines of:
so before we expire any session, we make sure that the last accessed time is accurate.


3059
RedissonSession map doesn’t have expiration after changeSessionId is called

We noticed a large number of keys in our Redis server had no TTL set and traced it back to the RMap that backs the session.


3061
Key prefix or custom key serializers

Our company have redis cluster for multiple Springboot apps. We use different redis key prefix between every app by a key serializer, like this:
Now, when we use RedisTemplate to do everything, the key was added a prefix by serializer. But when we use RedissonClient to do everything, we must set the prefix by self every time.
So, is there any way to help us set a global key prefix for using redisson client?


3062
when I use delay queue, I got an exception

where I use delay queue, I catch an exception:
I use the queue:


3063
Unexpected ClassCastException

Expected behavior
Return entity or NULL as expecting
Actual behavior
Throw ClassCastException
Steps to reproduce or test case
This only happens when we upgrade Redisson from 3.10.0 to 3.10.7 and in only happens in one of our environments.
The detail of ClassCastException will be shows like 'Cannot cast 'xxx.yyy.zzz.ClassA' to 'xxx.yyy.zzz.ClassA' (The path are totally the same) or 'org.redisson.spring.cache.NullValue' cannot be cast to '....'
It only happen once and I cannot reproduce from my local.
When I clear the whole Redis, this exception will pause for a while, but after some time, it will happen again


3064
Implement merge(), compute(), computeIfAbsent(), computeIfPresent() methods for RMap-based objects

No description provided.


3065
Unable to connect to Redis server:




3066
Code syntax c error in wiki description

In the picture above, I think it is java code. The modifiers in the code are not correct. Should we use double quotes?


3067
Question about fix for issue 2181

Recently we got below error after Redis M/S switchOver at Redisson 3.10.1:
And i saw it was fixed at 3.11.2 by: #2181
I have one question about the fix: 12e81de
reattachPubSub method was only called in MasterSlaveEntry.slaveDown. What will happen in Redis M/S switchover
in case we configure  "subscriptionMode: "MASTER""? To my understanding:
slaveDown should not impact subscription as we configured Mode to master.


3068
Increased Logging for Tomcat Session Manager

How can I increase the logging from Redisson when using the Tomcat Session Manager? I'm not running into an issue, but just want to know how to do that if needed.


3069
RObjectLiveService # delete: Incorrect representation obtained by the proxy's RObject getName method

Expected behavior
Getting the correct object identifier to remove it.
Actual behavior
There is incorrect behavior when calling RLiveObjectService # delete (T) where T has a name field with an appropriate getter and setter.
Steps to reproduce or test case
Create simple entity
Persist and delete entity
See throwed exception:
in new RedissonKeys(ce).deleteAsync(map.getName()) because the proxy object calls its own RObject # getName method, which corresponds to the entity getter, and returns null. Also with the specified value, the entity is not deleted.
Solutions to the problem:
check the object for system getters and setters that the proxy object has before loading the class into the cache and registering it in the context
check the object for system getters and setters, and, if any, generate additional utility methods


3070
MapCache Update event is not received to the one of the client

We are using map cache to persist the data in the Redis.
We have two clients with local cache and listeners added to the update and remove events.
When an entry is updated in the map cache.
Only one client got map entry updated notification but other client did not receive the update.
Server is not restarted and client connection to the server is also looks good.
On redis server , pubsub numsub is returning 2 as value.


3071
org.redisson.client.WriteRedisConnectionException: Channel has been closed!

When I used 1.11.1 , after application running 2 hour , find this problem


3072
Unable to send PING command over channel

When using 1.13.4 , find this problem after applilcation started.


3073
RObjectLiveService#delete: incorrect behavior of delete(Class<PRoxy>, ID... ) method

Expected behavior
Correct long result with the number of objects removed.
Actual behavior
Current call of RLiveObjectService#delete(Class, ID...) raises an error converting the result to type Long.
Steps to reproduce or test case
Create simple entity with some r-indexes
@REntity
Persist and delete entity
See throwed exception:
E.g. in debug mode, I see that in the RedissonLiveObjectService #delete(Class, ID...)#574 method there are 3 commands to delete both the entity and the entity indexes. The commands for deleting indexes return the result "true", and the command for deleting the entity itself - "long", where the next action is the addition of the results of command execution.
Solutions to the problem:
to identify commands by type (entity, index, etc.) and give the real result of deleting only the main object. Service commands related to the deleted object - do not take into account, otherwise we get unreliable information)


3074
Problems found in executing Lua scripts

1.Environment configuration
2.Official website demo
3.discover problems
When I select the ReturnType as boolean, I find that if the Lua script directly returns false, the result is null, but the Lua script directly returns true. The result can be resolved to be true. I'm confused. Is this a bug? Or did I have the wrong configuration?
3.1 Lua Script:"return true"
3.2 Lua Script:"return false"


3075
Runing with @SpringBootTest Error creating bean with name 'enableRedisKeyspaceNotificationsInitializer' defined in class

error info:


3076
Connections used by block operations get incorrectly reconnected

Expected behavior
connection not reconect if server responses in block time.
Actual behavior
Connections get reconnected, causing a lot of TIME-WAIT connections, and messages may lost in readGroup block mode.
Steps to reproduce or test case
1、readGroup block 1 second:connections get reconnected if  Redis Stream is empty, causing various TIME-WAIT connections;
2、readGroup block 1 second: stream message is put into pending list if Redis Stream responses longer than block time configured in Redisson , because the original connection is already closed by Redisson.
TimerTask in handleBlockingOperations of RedisExecutor is shown below:
I think delay time in newTimeout method should be longer than popTimeout, due to the tranmisson time and waiting time in Redis Server.


3077
Pubsub channel isn't reattached to a new master after slot migration

Pubsub channel should be reattached to a new master after slot migration in Redis cluster.


3078
An object that was put into RMapCacheReactive with zero TTL is auto removed by Redisson

Expected behavior
The object is successfully retrieved.
Actual behavior
The object is not available using Redisson.
Steps to reproduce or test case
Put any object into Redis using RMapCacheReactive with any non-zero TTL (e.g. 1000 ms) by some key K
Wait for that TTL (or a little bit longer). Then try to get it to make sure that it's no longer available
Put another object into Redis using RMapCacheReactive with zero TTL by the same key K
Try to get that object by K


3079
why traverse all the keys?

here HKEYS operation and for loop would be very time-comsuing, I thought the KEYS[1] is renewed when the last lock set. is these traverse necessary?


3080
ElastiCache fail over with primary/reader endpoints not working with replicatedServersConfig

I'm currently working with an ElastiCache Redis Cluster (cluster mode disabled) and I have 3 nodes (1 primary node and 2 replica nodes). I'm working with an application configured with the Redisson Tomcat Session Manager. I'm currently testing the ElastiCache failover. I had to set the retryAttempts to 30, the retryInterval to 1000, and use the 3 node endpoints in the nodeAddresses, but with that I'm able to successfully fail over the ElastiCache cluster without disrupting the application. However, if I use only the primary endpoint (master) and the reader endpoint (replica) in the nodeAddresses an ElastiCache fail over disrupts the application. Are the primary/reader endpoints not supported with the replicatedServersConfig?


3081
CPU Load on RedissonMap.get/put

Good afternoon. Help to understand the problem of high processor load. So, the case:
there is some client that pulls the server to change the state in redis (RLiveObject), for each operation there are multiple calls to ByteBuddy proxy get / set data in redis. Conditional number of operations: 5000 op / s per 1 RLiveObject. The expected behavior is that the processor load will be minimal.
1 redis node and second config - 3 masters, 3 slaves;
How can I fix this problem, please advise?
P.s the same behavior is observed both in the configuration nettyThreads = 4 and nettyThreads = 16, we also used the redis cluster in the configuration 3 masters, 3 slaves


3082
RKeyReactive.getKeysByPattern not using pattern parameter

Expected behavior
If I use redisson.keys.getKeysByPattern("my-pattern*") then executing


3084
org.redisson.tomcat.RedissonSessionManager.findSession Session can't be found

i have see the close question about this  and try it ,but it does not work.
my webproject is based on SSM+shiro


3085
Subscribe timeout: (7500ms)

I Increase two params,but it doesn't work.Can you tell me the reason.
redission version: 3.13.4. I use another redis server ,it works well. which param of redis can effect it?


3086
Unable to init enough connections amount! Only 25 from 32 were initialized. Redis server: my-redis-service/11.99.77.00:6379

No description provided.


3087
org.redisson.tomcat.RedissonSessionManager memory leak

It seems org.redisson.tomcat.RedissonSessionManager leaking memory.
First, memory usage increase time by time even we made no access to application.
Is it normal behavior?
After performing the load test, memory of RedissonSessionManager is not released.
Please help!


3088
setPingTimeout

How to set Ping timeout without setPingTimeout?


3089
duplicated with

duplicated with #2488
Originally posted by @mrniko in #3075 (comment)


3090
How can I change the command name in RedisCommands.java?

Let's say, if I renamed the sentinel command in sentinel.conf, then the redisson client can't find the sentinel command, can we make the command name configurable? Thanks


3091
Can't read after write when data is large

Expected behavior
read success after writing into Redis when data is large
Actual behavior
can't read data after writing into Redis using redisson when data is large
Steps to reproduce or test case
We have a social service in our app, and we store the follower list in the Redis.
When I follow a user, I will delete the follower list of this user on Redis, next time when I load the follower list, I will load data from MySQL first, then call RScoredSortedSet.addAll() to add data to Redis, then call the RScoredSortedSet.valueRangeReversed() to get the data with start and limit.
If a user has a little follower list lower than 1000, it will succeed. But when more than 3000, it will return null first time, and will
return the correct list the second time.
It seems like a consistency issue, but we use the cluster, which will only read data from the master node.


3092
Support google gson codec

Is your feature request related to a problem? Please describe.
I saw there are many codecs that redisson provided,  I want to add one more codec to support json using google gson , any suggestions?  thanks
Describe the solution you'd like
Support json serial/deserial using google gson
Describe alternatives you've considered


3093
RedissonClient#getMap(String) throws java.io.IOException: Unsupported protocol version 109

hello ,
I am trying to retrieve some data from Redis Instance (which I use it as Hibernate 2LC), when I try to get some map data it throws java.io.IOException, and message is Unsupported protocol version 109.
here is my code snippet:
which mistakes am I doing while retrieving the data from map?
(datas are put to Redis by Hibernate)


3095
broken connection not detected

Expected behavior
Actual behavior
we see some redis tcp connection status is ESTABLISHED, but the file descriptor is missing, the reason is unknown, but if redisson use these connections, netty writeFuture always timeout and we get org.redisson.client.RedisTimeoutException
Steps to reproduce or test case
don't know, we experience this twice in last month
hope redisson can provide testOnBorrow or some method to solve this, thanks


3096
Set pingConnectionInterval = 30000 by default

No description provided.


3098
It seems to broadcasting session creation between several tomcat with netty 4.1.52 even if broadcastSessionEvents="false".

I have memory leak issue as I posted #3087.
So, I update netty version 4.1.52 according to #1975
This won't happen if I use redisson-all-3.13.5.jar from url below
Here is my pom.xml making my own redisson-all-3.13.5 to update netty


3099
RRateLimiter.delete() returns false despite apparently removing the appropriate key

Expected behavior
Calling delete() on the Rate Limiter instance returns true when the object is removed from the data store.
Actual behavior
Sometimes returns true, but is returning false after I have called tryAcquire(). Note that the keys are still removed from the store.
Steps to reproduce or test case.


3100
I am using redis queues extensively. Every now and then I see a warning from CommandDecoder.

The following warning:
response has been skipped due to timeout! channel:
Can it have any impact on my normal redis functions?


3101
Problem on Turkish language Windows

Topic listener is not working on Turkish language Windows 10
It works if you change display language to English.
Publishing to topic works fine regardless of the OS language


3102
RBatch doesn't handle MOVED, ASK errors in Redis Cluster

No description provided.


3103
LocalCacheMap key add or remove notification

Hi, I would like to use a LocalCacheMap to cache collections of objects, and reduce the number of requests to redis.  Our use case is one where keys are added or removed infrequently, but we iterate over the entire collection very frequently.
If I understand it correctly, the LocalCacheMap does not add new keys to the local cache when they are added to redis by another application using a LocalCacheMap instance, which means that when we iterate over the collection it requires a SCAN redis command, which is a round trip redis operation.
Is there a way to update the local cache when object are added to the redis cache?  If there were, it seems like it would eliminate the need for the redis SCAN command when iterating.
Alternatively, is there a way to add an EntryCreatedListener, similar to other collection types?  Or piggy back on the LocalCacheMap's own listener to achieve the same?  If I could do that I would then know all the keys to iterate over the collection.
thanks, Mitchell


3104
Failed to switch to the Redis instance during ip address change in DNS

Connect to the Redis instance when it is ready after an ip change in DNS
Failed to connect to the new Redis instance forever even if the new Redis is up and running
The problem is in the two classes:
In function 'monitorMasters' in DNSMonitor.java, there are two lines:
The changeMaster(...) is asynchronized call without return value. So regardless successful or not, the master list is changed to the new Redis.
The fix can be to add a return value to changeMaster(...), and only when the connection to the new Redis is setup successfully then change the masters list. Otherwise, retry to connect to the new Redis until it is available.


3105
The RSet in RSetMultimap doesn't prevent logically equal objects from being stored in it

I'm not sure if this is by design or a bug so posing this as a question.
For the following code:
the test will fail.
Of course if you read the set by calling getAll() it will have only one entry but the duplicates will be stored in the REDIS memory.
Is there a way to enforce uniqueness on put?
Thank you


3106
RSet In RSetMultimap doesn't prevent logically equal object from being stored in it

I'm not sure if this is by design or a bug so posing this as a question.
For the following code:
the test will fail.
Of course if you read the set by calling getAll() it will have only one entry but the duplicates will be stored in the REDIS memory.
Is there a way to enforce uniqueness on put?
Thank you


3107
response has been skipped due to timeout! for PING command

Redisson version: 3.12.4
We are seeing warning log in our production logs
response has been skipped due to timeout! channel:
We have enabled keepAlive and set pingConnectionInterval to 5 seconds to keep the connection alive which was suggestion given for another question last year. Looks like this background PING command has 1 second timeout instead of using timeout configuration, can you confirm?
Looks like these timeouts happen on connections running BLPOP command, in that case can you skip doing PING on blocked connections?
We also gave netty threads equal to max number of connections in the pool, this value varies by service 64, 128, and 256.


3108
RMap's values(pattern) doesn't seem to work on a simple test

The following simple test doesn't seem to work:
Version of redisson is 3.13.4
I'm pretty sure I'm missing something here so didn't post it as a bug


3109
reddison can not stop my program

I wrote a program to test the connection to Redis, it successfully connected to Radis but the program does not stop in the end.
my dependency in Gradle:
when Get thread dump, my console:
I think the problem is in netty, but my netty version is final (4.1.52)


3110
Is there a way to batch read values from the RMap using key pattern?

I'm looking through the documentation and it doesn't seem currently possible to batch multiple values(pattern) calls.
If this functionality doesn't exist will it be possible to add it in the future versions?


3111
High contention on AsyncSemaphore

Hi,
We have a cluster of services that extensively use Redisson 3.13.4. But CPU load and throughput are not equal for all instances. We found that the bigger CPU, then bigger latency and lower throughput. The main difference of such instance is in high contention on AsyncSemaphore object. Is it possible to reduce it somehow? For example, use few connection pools, instead of one or we need to use few Redisson clients?
Here is for comparison node with high and low CPU:
Stack trace from profiler in netty thread:
Thanks!


3112
Redisson upgrade 3.9.1 -> 3.13.4 increased number of Redis processed commands

Hi,
After upgrade Redisson client from 3.9.1 to 3.13.4 we noticed significantly increased number of processed commands in Redis. This seems doesn't impact Redis cluster CPU load, but looks strange, especially because of big imbalance in Redis nodes:
What could it be? Application wasn't changed, only Redisson.
Thanks!


3113
No interface method addListener (ReactNative module)

Redis version: 2.7.1
Error:
topic does find the function getPatternNames(). However, interface method addListener(Lorg/redisson/api/listener/PatternMessageListener) cannot be found in class Lorg/redisson/api/RPatternTopic.
addListener can be found.
Please help me, I am in urgent right now. Thank you very much.
I think when compiling code in Android. The function is removed from the interface.


3114
WeightedRoundRobinBalancer filtered any Master node because it has freeze status.

I configured master-slave configuration for standalone Redis.
I added master to balance map.
When I switched on the monitor on Redis I see that on master there aren't any read requests from my application.
In WeightedRoundRobinBalancer balancer I found that code:
Why a master node always filtered here? It's a mistake?


3115
Redisson don't switch read operation properly when slave is down

I configured master-slave configuration for standalone Redis. readMode = ReadMode.MASTER_SLAVE
When I do on slave debug segfault there aren't operations in a monitor on a master node. Only after timeout in 180000 ms all operations will start to perform on the master node. My code didn't receive any exception from Redisson.
I can reduce a delay by setting up failedSlaveCheckInterval = 3000 parameter but why Redisson didn't switch to slave after the first failed command?
And that more important why Redisson didn't send any command to the master node?


3116
after upgrade redisson-spring-boot-starter to 3.13.5, can`t load config file anymore

Expected behavior
load config file from classpath
Actual behavior
applicaton goes error when bootstrap
Steps to reproduce or test case


3117
RMapCache.keySet inconsistent behaviour

Hello,
I am using redisson 3.12.5
I have this map "REMOTE_SESSIONS" and I am trying to access it using getMapCache ( RMapCache )
After fetching the map I am querying it's keys , using keySet but I am seeing inconsistent behaviour and I am not sure why.
I might be using the library wrong but this is driving me crazy :)
Here is my code
I am doing the following:
Get 10 instances of REMOTE_SESSIONS cache. For each of them print the count given by size and then the actual count , retrieved via iterator traversal.
And I get the following output:
For some reason the actual content of the keySet is varying. This might be related to the fact that under the scenes this is implemented using HSCAN but can't really tell why.
Any idea why this is happening and can I access the keys from a map.
My end goal would be to query the keys using a pattern but that doesn't work consistent either.
Any help is greatly appreciated.
Thanks


3119
RTransaction should be executed in IN_MEMORY_ATOMIC mode

No description provided.


3120
incremental number of connection over time

we face a problem that number of connection to Redis cluster node is increasing until it consumed the max number of open connections (which was set to 4096)
After a period of running the client, we discovered that number of connections from client to a single redis node (slave one) using lsof is more than 100 connections in some cases it exceeded 200 connection despite the configs are set to 64 (see the attached connections.log for open connections from client to redis node)
Is that a connection leak problem or a configuration issue?


3121
Redis is disconnected for a long time, and using redisson's trylock() will cause the thread to wait all the time

Expected behavior
notify thread and return false
or throw redis disconnected exception
Actual behavior
Keep waiting
Steps to reproduce or test case
1.Run application
2.Disconnect redis
3.Execute trylock()
(1)Create a thread pool
CorePoolSize:8
QueueCapacity:200
ThreadNamePrefix:cmdpAsyncExecutor-
(2)Use trylock() in a thread.for loop 10 times
4.Wait a few minutes
5.Reonnect redis
6.View thread status
View thread stack information
We found that the thread had been waiting


3122
How to improve performance for batch lock

Dear:
In my project, we want to lock large number of data at the same time, the max data size will be 200,000.
We found redisson cann't support this kind of scenario, it'll take several hours to lock 200,000 data totally, 20 millisecond
for one record.
Is there any solution for this  big data scenario?
Best regards.


3129
Don't throw the exception of Bloom filter config has been changed in BloomFilter

If we modify bloomfilter's config in redis, it will make contains function cycling constantly.


3131
Add Reliable Topic object

No description provided.


3132
terminate main class with out sessionfactory.close

I have an enterprise program that works with Hibernate and hikaricp connection pool, I just added Redisson for the second level of Hibernate cache.
When I start the Tomcat, everything is OK
But when I run a Main class, everything is done, but in the end it does not terminate.
I know I have to use the class sessionfactory.close but I did not use this method before and it stopped at the end,
It's been like this since I added Redisson.
Is there a solution for me not to use the  sessionfactory.close() ?


3133
java.lang.ClassCastException occurs when RedissonSessionRepository restore a session with JsonJacksonCodec

Redis 3.13.4
When setting a sub class of JsonJacksonCode to RedisConfig.
The restored Session RMAP actually store Integer for maxInactiveInterval, thus class cast exception occurs.


3135
Getting Error while connecting to sentinel using password.

Getting below error while connecting to sentinel using a password. I have kept the password the same for both Redis and sentinel still getting the issue.
Can't connect to sentinel server. Unable to connect to:
Expected behavior
Should be able to connect to sentinel using the same password.
Actual behavior
Getting error - Can't connect to sentinel server. Unable to connect to:


3136
Question on queues and detailed documentation on RStream

Hi, I'm a fairly new user of Redisson and have a question regarding queues and streams in Redisson.
I'm evaluating whether I could/should use RStream or not but unfortunately the documentation and examples I found are very short and didn't come with much explanation of the used methods/parameters and the reasons why.
My use case is fairly simple and could be managed with a queue but I want to make sure an element pulled from the queue was processed by an ack or something similar to prevent data loss in case of a failure.
I found this question on StackOverflow which is basically the same problem I have:
But unfortunately it's basically a monologue by the person asking without a final answer or solution.
Basically I am not interested in features like consumer groups etc. and I'd already be happy if I could have something like in the following example:
Would you recommend using RStream for this use case or is there a better way to achieve what I want with Redisson?
If I can use RStream for this is there a simple example to get RStream working like a RQueue with acks?
Could you provide a more detailed documentation on RStreams?
Thank you!


3137
result of RStream.read method isn't sorted by key

No description provided.


3138
suitable configuration settings

hello,
there are numerous connection settings like connectionPoolSize, connectionMinimumIdleSize so forth so on..
for instance, when I put 100 for connectionPool, it use all of them in course of some load (I monitor redis server with redis-exporter). then I increased it to 200, then it started to use 200.
My question is how can I find suitable settings, is there any hint which I can refer?


3139
Rx API is missing support for cache variants of multimaps

Context description:
The regular (non-async, non-reactive, non-Rx) API contains cache variants for multimap based collections:
But the Rx-ified version of the API does not have the cache variants:
Our problem:
The problem we are facing is that we have a code base that heavily relies on Rx interfaces and that we need the expiration/eviction functionality that Redisson offers for set multimaps, but this combination seems to be missing from the API.
Desired solution
Additions to the Rx-ified API to be able to instantiate multimap caches, so that we can specify expiration for items in the multimap cache using Rx method calls.
Alternatives we've considered
We've considered using the non-Rx-ified APIs, but we'd end up writing our own Rx proxy layer around it since our code base so heavily relies on RxJava. Therefore it seems more logical to add it to Redisson instead, even more so because it looks as though this feature would fill a rather obvious gap in the API (for which there was understandably no time yet, undoubtedly).


3142
Is it able to encapsulate 'isExistsAsync' and 'fastPutAsync' into one Batch

No description provided.


3143
none




3144
none




3145
TimeSeries.iterator() doesn't respect the ordering

Expected behavior
Since timeseries is a sorted collection I'd expect iterator() to respect the ordering. There's a range method which in fact returns the values in order, however it returns Mono<Collection> instead of Flux which means entire set is loaded into the memory, while I'd like to read it reactively in chunks.
Actual behavior
redisson.getTimeSeries("").iterator().next().block() != redisson.first.block()
Steps to reproduce or test case
add multiple elements into the timeseries collection
open a redis desktop manager or use the cli to check the elements are indeed ordered by score
call iterator() method and check the ordering
I've checked also the non-reactive version and seems to work in the same way.



3146
Add ListCache

Is your feature request related to a problem? Please describe.
I'd like to have a possibility to set eviction for a given element while inserting into the collection that keeps the insertion order.
Describe the solution you'd like
Similar to the MapCache and SetCache I think there's a need for a ListCache as neither of the previous ones keep the ordering.
Describe alternatives you've considered
SetCache but it lacks ordering.
TimeSeries but as per issue 3145 the iterator() method does not return the values according to the score.


3147
Null pointer on RMapCache destroy

Hello, I'm getting null pointer exception when try to destroy RMapCache in EvictionScheduler line 74 (remove(String name)). Error occuring on tasks object.


3148
RLongAdder.sum() and RDoubleAdder.sum() methods return wrong result

No description provided.


3149
none




3150
none




3151
none




3152
DNSMonitor switches master and slave frequently

there are three sentinel node, and one master node and on slave node.
redis and sentinel config file in attachment file.


3153
CROSSSLOT error when clearing a redis-spring-data cache

Expected behavior
Calling RedissonConnection.del() with multiple keys when using a clustered connection should delete the keys without error
Actual behavior
"CROSSSLOT" exception is thrown
Steps to reproduce or test case
Should be able to reproduce by simply trying to delete multiple keys that aren't in the same slot using a ReddisonConnection that is clustered.
In my example
Clustered
I ran into this when upgrading from Spring 2.2.x to 2.3.x (Redisson 3.12.0 to 3.13.6)
This appears to have been broken when the check for clustered connection was removed as part of this commit: 8be9008


3154
none




3155
How to get RLock list? Rkeys is not work

Rkeys does not contains RLock keys.  Only me?


3156
Class cast exception when working with RMapCache<String, String>

I have this RMapCache<String, String> stored in redis. Each key has a 30s TTL
Everything behaves normally but from time to time I get this class cast exception which causes a lot of issues down the line.
I can't tell why this is happening , I am using redisson 3.12.5
Any idea what is happening over here ?
We have multiple nodes that are updating the same map inserting and deleting keys , different TTL's for each.
All nodes are time synced
Any help will be greatly apreciated.
Thanks


3157
Implement a reliable RQueue with an ack() method

Is your feature request related to a problem? Please describe.
I initially discussed this idea in #3136.
Describe the solution you'd like
I'd like an RQueue implementation that allows to ack() elements to improve reliability and ensure that an object has been processed by one of the queue's consumers. The following example demonstrates the feature request:
If the consumer that q.poll()ed the element crashes or shuts down before finishing the processing and calling q.ack(), the element will automatically be "unlocked" for another consumer to poll next (e.g. via a watch dog similar to RLocks).
Describe alternatives you've considered
As shown in #3136 I considered using RStream but decided against doing so because the RStreams are far too complicated for simple use cases with only a small number of consumers.
My current solution involves using q.pollLastAndOfferFirstTo(...) and creating locks for the elements that should be marked as in progress to check whether the consumer working on an element is still alive or not. This also involves a periodic task that performs such a check on all items in the "in-progress-queue". This works but it would be great if this could be a feature of Redisson so I could reduce my code to someting similar as shown in the small example above.


3158
Concurrency issues with RQueue::removeIf / RQueue's iterator

Expected behavior
When having one producer and at least two consumer threads (or instances of an application) I expect RQueue's removeIf(lambda) method to remove elements without negative side effects.
I expect the same when using an iterator to iterate over the queue and calling remove() on the iterator.
Actual behavior
There are multiple types of errors that I observed:
I've seen NullPointerExceptions inside the removeIf lambda (e.g. q.removeIf(element -> element.getId().equals("id"))), where element is null (we don't add null elements to the queue).
Other times removeIf does not actually remove the elements from the queue, probably because it did not find the elements in the first place.
As the default implementation of removeIf uses the iterator my guess is that basically the iterator causes this issue and may not work properly when another consumer of a queue modifies the queue while it is used.
Steps to reproduce or test case
I have the following test case which can be used to reproduce the issue. It uses Lombok, Awaitility and Apache's RandomStringUtils for convenience (in case you want to run it without modification). Below I will explain steps to modify the test to get different results.
The test has one producer thread pushing 200 random Strings (wrapped with QueueEntry objects) and one or more consumer threads "processing" these objects (parking them in an "in-progress-queue" - which is the problematic queue).
If you run the test as it is here it will fail because the "in-progress-queue" is not empty.
Modifications to change the test results:
Change the number of consumer threads to 1 in the line marked with (4). Now the test should pass. Change the number back to something larger than 1.
Comment in the RLock and its usages marked with (1). Now the test should pass. Comment the lines out again.
Comment out the removeIf(...) statement (marked with (2)) and comment in the remove(...) statement (marked with (3)) instead. Now the test should pass.
Instead of using removeIf() you could also modify the test to use an iterator and remove elements with it. The results will be similar.
Default single server config with JsonJacksonCodec.


3159
Redisson RMap isEmpty() returns unexpected result

I have a map stored in redis cluster. When I try to get this map to know if a given key exists in it, I am using
It works at most times. But somehow the RuntimeException I defined above will be throw out sometimes unexpectedly. Which means rMap.isEmpty returns true with no exception, while the fact is we do have this key stored in redis.
In addition, I found a exception in another thread,
Does this exception impact the result when I was calling `rMap.isEmpty()'?  And how can I avoid this problem?


3160
Add IdGenerator object

No description provided.


3162
MOVED redirection loop detected with AWS Elasticache redis

Getting following error:
We are using redisson 3.13.4 ( tried with 3.13.6 also) with AWS Elasticache Redis.
For our internal testing we created AWS Elasticache Redis cluster with following configuration:
Connecting to configuration endpoind.
In the error you see 'redis://' but we are using 'rediss://', there is another bug in RedisException where 'redis://' ( without extra 's') is hardcoded.
It was working fine till last week.


3163
none




3164
Will RList<>.add(V) return false ever?

Will RList<>.add(V) return false ever?
It looks like RedisCommands.RPUSH_BOOLEAN command always return true based on below convertor implementation, can you please let's know will it every return false assuming there is no RedisTimeoutException?


3165
Add property to disable redisson in spring boot

Hi!
Is your feature request related to a problem? Please describe.
We use redisson with spring-boot-starter in our project. Unfortunately, sometimes we need to disable caching (f.e. on some environments we don't have redis). When it comes to a spring-data-redis we can just set property:
spring.cache.type: NONE
and caching is disabled, but if we use Redisson then his auto-configuration doesn't let us run the application without a worked Redis connection.
Describe the solution you'd like
Disable the whole auto-configuration when
spring.cache.type: NONE
Describe alternatives you've considered
We can add a new maven profile and exclude the redisson dependency but it doesn't sound well because we get a new profile to maintain.
My current solution
I excluded autoconfigurations:
I made my own auto configuration (based on redisson's autoconfiguration) where I've added
If you agree then I will push a pull request with changes.


3172
redisson-tomcat does not persistent attribute changes properly using updateMode AFTER_REQUEST

Session attributes modified without calling setAttribute are not stored properly in Redis.
The following snippet sets an empty list as a session attribute ("foo") on the first call. Any subsequent call gets the attribute and appends an item ("bar") to the list without calling setAttribute.
Expected behavior
With updateMode AFTER_REQUEST the changes should be persisted to Redis after each request regardless of the missing setAttribute.
So the list should expand by one item on every call.


3173
evalSha/evalShaAsyn returns null for MAPVALUE / MAPVALUELIST returnType

Actual output:


3174
Redisson set a different TTL than the provided in Tomcat web.xml

Expected behavior
TTL same as in the settings
Actual behavior
Steps to reproduce or test case
Set session-timeout in minutes, get the TTL in redis after the session creation, its way higher.


3175
How to set the sessionIdLength in the Tomcat 9 redisson?

How can I set the sessionIdLength in the context.xml?
This didn't worked, the default is 16.


3176
About tomcat context.xml

I am not very clear about the specific role of readmode="MEMORY". If readmode="MEMORY" should be enabled at the same time broadcastSessionEvents="true" this attribute to ensure the consistency of multiple copies of the session? Does readmode="MEMORY" just store an extra session in the tomcat memory? When I simulate redis downtime, redisson will not directly read the cache from tomcat, but continue to connect to redis to get the session.I need help,thanks.


3177
RetryAttempts doesn't work ?

My env: SpringBoot 2.3.3.RELASE, JDK 8, Redis 5.0.6, redisson-spring-boot-starter 3.13.6
My test scene:
Firstly shutdown my redis server
Then start my springboot application
Then restart my redis server
What I expect is: Redisson in the app will retry to connect to  the redis server until connect successfully and the app started normal. But actually redisson didn't retry to do this and the following exception is thrown:


3180
After integrating with spring-data-redis, redisTemplate get  method always returns null

Expected behavior
I want to use redisTemplate and redissonClient at the same time. Based on the above configuration, using redisTemplate can set the value during operation. But the get value is always null
When I remove the RedissonConnectionFactory injected in RedissonSpringDataConfig, redisTemplate will use lettuceConnectionFactory by default. At this time, there is no problem using redisTemplate's get method and set method. The get method can also return normal values.
Actual behavior
redisTemplate's get method always return null
Steps to reproduce or test case


3181
Add a possibility to work with RLocalCachedMap reactively

Is your feature request related to a problem? Please describe.
In highload systems, it may be too expensive to make requests to Redis too often. Using a not reactive approach, it's possible to enable local caching and use RLocalCachedMap to reduce amount of requests to Redis. However, in a reactive system, currenty it's not an option.
Describe the solution you'd like
I think it would be very nice to be able to use RLocalCachedMap reactively.
Describe alternatives you've considered
As an alternative, I have to implement a custom caching logic to reduce amount of requests to Redis.


3182
org.redisson.client.WriteRedisConnectionException even after 3 retry attempts

Expected behavior
With retries enabled WriteRedisConnectionException shouldn't happen.
Actual behavior
We have set netty threads and max connections to 250. When Redission is retrying will it use different netty connection, or attempt using same channel which is throwing newClosedChannelException/ClosedChannelException? It's not clear from below error what other tuning is required in application code.
Steps to reproduce or test case
Intermittent exception noticed in production logs.


3183
Desired TTL is not being set for new cache maps

Hi,
I am trying to set the TTL on the cache map as shown in the snippet below but I am noticing that the TTL is set to -1 and not the value I am passing. Is this the right way to go about setting the TTL for the cache maps? If not what is the right way?
private RedissonClient client;
This is what I see on enabling the debug logs:
So looks like it is indeed trying to set the TTL.
I am using redisson version 3.13.1


3184
none




3185
How to clear Redis cache when deployed to 2 or more containers?

In my Spring Boot project, I have one redis container deployed in Docker swarm cluster. I use it as Hibernate 2nd level cache for the application. I use Redisson client to manually clear the cache using the following code
Now I would like to scale it to multiple containers to withstand failover and distribute the load. If I do that, how can I clear the cache in 2 or more containers at the same time?


3187
Behavior of locks vs conditions like network partition

Hello everyone,
Couldn't find my answer in docs or by looking briefly at the implementation, so posting the question here.
Let's assume a system, where X instances of the same application are working concurrently on processing some data. In general, the instances can work concurrently, but some specific data items must not be processed at the same time by more than one instance, as this would produce race condition.
To synchronize application instances and avoid race conditions, we've set up a Redis instance, and we use Redisson's locking mechanism to achieve exclusive execution. In general, the workflow for an instance looks like this:
(take a lock A) -> (process data) -> (release lock A)
Then, obviously, the other instances, that want to process the conflicting data item, need to wait for lock A to be released. Processing an item can take anywhere between several seconds and several days. so a lock might be held for a long time (and we use this auto-renewal feature for locks to have the lock prolonged as needed behind the scenes by Redisson).
My question is - what happens if an instance, that is currently holding the lock, loses connectivity to Redis (and therefore the lock times out and is then taken by another instance), and then after some time it regains the connectivity? Will it finish processing the data without holding the lock, and then fail on releasing the lock? Or maybe something else would happen?
I'd really appreciate your feedback on this.
Best Regards,
Paweł


3188
Rmap.addAndGet method throws NumberFormat exception

Expected behavior
This should not throw an error. It should convert the number to long but it is converting to int
Actual behavior
RedisExeption is thrown
Stack trace:


3189
Authentication broken for Sentinel configuration

HI there,
it seems like the Redisson authentication is broken for the current release 3.13.6 in combination with a Redis 6.0.9 and a Sentinel setup. I provide the password with the config object:
I suspect the implementation of the checkAuth() and createRedisConfig(...) methods in SentinelConnectionManager.
Since the default of usePassword is false, this results in the provided password being set to null in createRedisConfig(..), which subsequently causes checkAuth() to fail prematurely on line 213 client.connect() with a RedisConnectionException caused by an RedisAuthRequiredException. Therefore, usePassword is never set to true and the Redission Sentinel config is broken for secured Sentinel instances.


3190
Local Cache performance : Cache Key extra operations

Hello Everyone,
The Local cache map data types for key is CacheKey and for value is CacheValue. The CacheKey contains the hashed value of encoded original key object. Due to this, when ever redisson tries to retrieve from the local cache, it has to encode the key and convert to hash value and get value from the local cache.
Is there any specific reason behind this approach? What if the CacheKey stores the original key directly? Will that improves the local cache performance?
Best Regards
Sai


3191
wiki file singleServerConfig need to update

Expected behavior
run success
Actual behavior
with exception  Can't parse config
Steps to reproduce or test case


3194
none




3196
Always get a deprecation error log about JSON even though not using

Expected behavior
I point RedissonSessionManager at a YAML config file. I don't get a deprecation warning about using JSON config files.
Actual behavior
I point RedissonSessionManager at a YAML config file. I do get a deprecation warning about using JSON config files.
Steps to reproduce or test case
Point RedissonSessionManager at a YAML config file. Get a deprecation warning about using JSON config files.


3197
RateLimiter Bug on 3.13.6 : bad argument #2 to 'unpack' (string expected, got nil)

Expected behavior
working normally
Actual behavior


3203
org.redisson.client.RedisTimeoutException: Command still hasn't been written into connection! Increase nettyThreads

Getting below exception intermittently during execution of a multi-threaded batch process.


3204
none




3205
RMap is holding huge memory compared to normal object in Redis

While working on memory improvements for Redis, I came across with an issue where I have observed that Redis is using huge memory for RMap compared to normal object.
I have execute below code and I observed below things:
I could see memory occupied in Redis for key abcd-abcd:map is 10728729 bytes(10.72 MB), I have used command MEMORY USAGE abcd-abcd:map.
I could see memory occupied in Redis for key abcd-abcd is 1170360 bytes(1.17 MB), I used command MEMORY USAGE abcd-abcd
My question is if I am saving one object(hashmap) as an RMap and saving the same object(hashmap) as a value in another Map then why the object saved in RMap is occupying huge amount of memory compared to other case?
Please note currently I kept SIZE as 100000, but in my case I need to save 1-2 million(or more than that) objects in RMap and in that case I can see huge memory utilization in Redis.
Can someone please review this and share their thoughts?


3206
Fill variables in redisson.yml with Spring Boot values.

Is your feature request related to a problem? Please describe.
We are using redisson-spring-boot-starter. We were hoping that we could configure Redisson with a redisson.yml, but also configure more dynamic properties from our application.yml.
When we run in a different environment we can overwrite the Redis hostname by setting an environment variable. With Spring Boot profiles (for example "local"), we could have an application-local.yml that contains the following:
That way we would be able to have different configurations for our local run configuration compared to what we use in our production systems. Detailed properties for Redisson (described in redisson.yml) are the same for all environment, while things like the host, port or ssl properties can change depending on the environment where the application is running.
Describe the solution you'd like
If the merging of application.yml(or application-local.yml) with redisson.yml is not possible, can we then maybe have some feature where we fill variables with Spring Boot values. That way the redisson.yml would be able to look like:
In such a way, we would be able to create an application-local.yml that looks like this:
With Spring Boot values I mean the values described by externalized configuration here. That way there are many ways to inject variables into the configuration of Redisson.
Describe alternatives you've considered
We currently are using the following as an application.yml:
This works for us but puts a lot of detail for a specific dependency in the application.yml. These fields are never changed. The values are prone to mistakes.


3207
bug(redisson-hibernate-53): hibernate config CACHE_REGION_PREFIX is ignored

Environment:
Setting CACHE_REGION_PREFIX for hibernate should be used by redisson hibernate and the entities should be stored under the entity key with the defined prefix.
Actual behavior
The prefix is not used and the entities are stored under the default keyspace.
Steps to reproduce or test case


3208
redisson-spring-boot-starter maven test

Expected behavior
When a fresh copy of the repository is cloned, the tests of should all pass.
Actual behavior
When running mvn clean install in the redisson-spring-boot-starter module the build failed on failing tests. I got the following error:
When I run the tests with an IntelliJ run configuration the test does pass.
Steps to reproduce or test case
mvn clean install
Redis version
I think this is not relevant, but it Redis 6.0.6 running on Docker.
None
What is the actual problem?
I think you'll see in the above exception log that there are some (probably) unexpected character in the redisson.yaml that is used by the tests for redisson-spring-boot-starter. I looked at the encoding of the redisson.yaml by using Notepad++. The result is that the encoding for the redisson.yaml file is: "UTF-8-BOM".
How to solve this issue?
Setting the encoding of this file to "UTF-8" results in the maven tests passing. After doing this, and looking into the git diff shows the following:
I am not sure what are the "".
Can I create a PR for this?


3210
default codec MarshallingCodec result in exception "ERR hash value is not a float" when using map.addAndGet

Expected behavior
no exception when use default config
Actual behavior
have exception, but if i set codec to JsonJacksonCodec, everything works
Steps to reproduce or test case
use defatult config with default MarshallingCodec


3211
deleteByPatternAsync lua script error

I am currently using AWS Redis Elasticache cluster with a simple setup
Redis Version 5.X
1 shard, 2 replica
I sometimes get an error like below where keyPattern is "test-key*" which is confusing considering that I only have 1 shard.
Any idea what could be going here?


3212
Can we share sharing the same Redisson client for both Hibernate L2 cache and Spring Cache Abstraction

Can we share sharing the same Redisson client for both Hibernate L2 cache and Spring Cache Abstraction?
I am configuring redisson as my l2 cache in application.propeties
Currently, I am creating a Cache manager bean using the below code, which creates a new connection to redis.
I want to create a Cache Manager bean use the same connection configured in application properties. Is it possible to do that?


3213
none




3214
RMap keySet throw java.lang.String cannot be cast to java.lang.Integer

Expected behavior
Actual behavior
Steps to reproduce or test case


3216
none




3217
Redisson 3.13.6 + Kryo 5.0.0: Class is not registered

Expected behavior
I should be able to serialize any Pojo.
Actual behavior
Steps to reproduce or test case
With those versions of Redisson and Kryo. Just set up a simple client. The boolean "RegistrationRequired" is true by default now on Kryo and any new serialization will fail.


3218
Add tryAdd() method to RSet and RSetCache objects

No description provided.


3220
compatibility with spring-session 2020.0.1

i have seen on the wiki that currently redisson officially supports spring-boot up to version 2.3, the same for spring-session and spring-data. which version of reddisson library should I use when running with spring-boot 2.4.0 and spring-session 2020.0.1?


3221
Option to store null values into the local cache

Is your feature request related to a problem? Please describe.
I have an application that is using Hazelcast "near cache" extensively and I'm evaluating a migration to Redis using Redisson "local cache" because I would like to use the AWS ElastiCache Redis service. This application does thousands of cache reads for every user request, so the "local cache" is really needed.
For testing purposes, I launched the same request twice to this application using Hazelcast and twice using Redis, and I saw that the second execution time for the Redis application was higher than the second execution time for the Hazelcast application. It was very surprising considering that the second request should read the data from the "local cache" (redisson).
I debugged the application code and I found that it does hundreds of cache misses. On the othe hand, I found that Redisson only updates the local cache when reading the map value from redis gives a not null value. This redisson code is in RedissonLocalCachedMap.getAsync():
So, considering that our application does hundreds of cache misses and that Redisson local cache always tries to read the value from redis (even when it tried to read the same key before), it is reasonable that our application performs worse than expected.
Describe the solution you'd like
In order to improve our application performance when using Redis I think that it would be helpful to be able to add null values to the Redisson local cache, maybe adding an extra option in LocalCachedMapOptions; something like cacheNullValues, with a false value by default. I think that something related was fixed in #928 and #853
Describe alternatives you've considered
I have not considered an alternative


3222
none




3223
Redisson Semaphore Expiry Not Getting Honoured

I am trying to synchronise my APIs using Redisson semaphores. Here is the code:
I have observed certain cases where the LockOn object in Redis is has its TTL set to -1. What this means that there is no TTL. But I am clearly setting it to 60s on a successful acquisition.
Steps To Reproduce: This happens only for a bunch of requests and is intermittent.
Redisson version: 3.13.4


3224
Semaphore TTL -1 In Redis Despite Explicitly Setting It

I am trying to synchronise my APIs using Redisson semaphores. Here is the code:
I have observed certain cases where the LockOn object in Redis is has its TTL set to -1. What this means that there is no TTL. But I am clearly setting it to 60s on a successful acquisition.
Steps To Reproduce: This happens only intermittently. I have been unable to reproduce it myself.
Redisson version: 3.13.4


3225
Adding permit later doesn’t unblock thread

Thread A:
Get semaphore.
Thread B:
Get semaphore.
Acquire permit = 1. (may block for step A.2)
Do stuff.
Release permit = 1.
Add permit = 1.
I expected step B.5 to unblock thread A, but that doesn’t happen.


3226
Spring Data Redis 2.4 support

No description provided.


3227
Rlock not able to handle 200 concurrent requests

Hi,
I was trying to use distributed lock to do some operations and here I am facing an issue - it wasn't able to handle more than 200 concurrent requests
I am using redis as single server instance for this testing and here is my code
Please advise on what to look for to handle higher concurrency and handle the required requests per second. Our target was to handle around 1k concurrent requests


3228
register expired event topic in cluster didn't work

HI, I want use subscription features, but redisson always register it at only one node, I can't got other node's expired event.
I tried more times, the results are same,
and I lock WIKI 10.6 Low level Redis client:
but I can't found the method in my use version


3229
redisson-spring-boot-starter, version 3.13.6

When I use the following command, an exception is thrown,I tried a lot of high version, the error message is the same.
I use the  version: 3.5.5, It is work. so why the high version doesn't work ?


3230
How to configure checksentinelslist in springboot file

How to configure checksentinelslist in springboot file


3231
ElementsSubscribeService

hi, I'm using redisson's ElementsSubscribeService along with redis BRPOPLPUSH command to subscribe to a redis list, so that I can retrieve an element from the tail of the list (and move that element to the head of the same list) when another client pushes an element to this list.
But when I push an element to the list and consume that element from the same application (spring context), the consumer's redisson operation got blocked during handling.
consumer pseudo code:
here is the log right before the consumer got stuck:
log after:
can you help me with this? many thanks!


3232
 redisRepository.opsForZSet().rangeByLex( NullPointerException




3233
none




3236
Please follow semantic versioning specification when you make big changes

This is not the first time you make a breaking change in a minor version bump!
Expected behavior
We expected the minor version bump would be backwards compatible.
Please refer to here:
Minor version Y (x.Y.z | x > 0) MUST be incremented if new, backwards compatible functionality is introduced to the public API.
Actual behavior
In your redisson-3.13.6, you made a type change:
which breaks our build when we tried to bump the version.


3237
Regression: using #del() in pipeline on clustered connection

Expected behavior
Using del() in a pipeline on a clustered connection should always execute after the earlier commands (e.g. get) in the pipeline. We're using Redisson as the connection factory for a spring-security-oauth2 token store, which uses this behavior.
See previously #2680.
Actual behavior
We’re getting NullPointerExceptions, because the one of the gets returns null. It looks like #3153 re-introduced this error, because it always executes del async, regardless of whether the connection is pipelined.
Steps to reproduce or test case


3238
Redis elasticache (ReplicatedServersConfig) RW/RO endpoint or all nodes?

Hi,
I am trying to use redisson to connect to an AWS Elasticache (not cluster) redis,
I can't find a clear answer on what 'nodes' should I list in redisson config.
Should I put : (using AWS front endpoints)
(in the past I used the master.myredis... directly in a node application, didn't dig more into it then).
Thanks.


3239
How to programmatically initialize redisson hibernate second level cache

My application uses:
I am using spring boot along with redisson for http session management and spring data. The configuration is programmatically initialized and works well.
I am trying to add hibernate 2nd level cache back by redis. I cannot find documentation on how this can be done programmatically. I have the following beans: RedissonClient, RedissonConnectionFactory and RedisTemplate


3240
Enums in ReadMode.java seems to have non inclusive language

Is your feature request related to a problem? Please describe.
The enum variables defined in ReadMode.java has wording that is being considered non inclusive in tech industry.
Describe the solution you'd like
Use one of the preferred alternatives like Replica, Primary, Secondary, Follower, Responder.


3241
RedissonLocalCachedMap: putAllOperationAsync wrong Lua script for Reconnection Load strategy

In RedissonLocalCachedMap : putAllOperationAsync method, the below LUAscript is executed.
As highlighted, if the reconnection strategy is LOAD, then we are calling hmset, ideally it should be ZADD, as this is used  store the score and ids in sorted set.
Expected behavior
To store into sorted set.
Actual behavior
Trying to store into Hashmap and failing with error saying that, invalid arguments for hmset.
Steps to reproduce or test case
Create a RedissonLocalCachedMap with ReconnectionStrategy as LOAD. And call putAll operation on localCachedMap.


3242
isHeldByCurrentThread() goes wrong




3243
Is there any method can tell multiLock is held by current thread?

In RedissonMultiLock method isHeldByCurrentThread direct throw unsupportedOperationException.


3244
redisson Chinese document configuration error

redisson Chinese document configuration error!
Chinese document configuration by  yml
This configuration is wrong:
The correct configuration is:
clusterServersConfig:


3246
config sentinelAddresses with k8s service address(ClusterIP) error

may i ask if i can only config the sentinelAddresses with fixed ip address?
in my k8s env,there are three redis sentinel pods(ip may change when restart),these pods match k8s service(clusterIp):
i use this service address to config sentinelAddresses,found constantly error log.
Expected behavior
connect redis correct.
Actual behavior
constantly log error like


3247
Client unable to discover cache node because of primary node failure

Our cache cluster has 3 shards with single master in each shard and 0 slaves.
Expected behavior
When the Redis cluster node fails aws(elastic cache for redis) will create a new node and replace the failed node. After the replacement is successful client should be able to discover the new node again.
Actual behavior
Redisson client is unable to discover the new node. And all the calls are failing until we force the re creation of the client from the start.
Steps to reproduce or test case
We are working on AWS ElastiCache for Redis
Our cache cluster has 3 shards. Each shard has 1 master and 0 replication nodes.
When one of the shard’s primary node fails(happens in case maintenance) all the calls which get directed to that particular shard fail after that.
This behaviour is observed only when there is some traffic at the time of node failure. If there is no traffic at the time of node failure the client seems to work perfectly fine and serve requests at later time.
I have observed the following log statements:
Not really sure why a slave with same address is getting added and removed.
My guess is it is removing the wrong node.


3249
Connection leak while using Redis-Redisson 3.13.6?

I use Redisson 3.13.6, and connect to redis 5.0
when started, the connection number is constantly increasing, all connections are established, like the following:
the connection number is increasing from dozens to thousands, #2771 tell us fixed,but  I suspect connection leasing is still exist
this is my redissonconfig


3250
Shared session between Tomcat Session Manager and Spring Boot Redis Session

Hi.
In our organization, we are building a new version of our website on Spring Boot and we are using Redis for session storage via spring session data redis. In our old application, session is stored in tomcat memory. As for now, we are trying make to the application share session data, by updating our old website with Tomcat Session Manager, but we are having an issue with synchronizing data and session expiration strategies and session data.
Spring Session
Tomcat Session Manager
Is there any way to synchronize the way, how these modules work with sessions other than writing implementation or put spring boot application in nonembedded mode?


3251
Use lua script to run directly on the linux server, you can check the data, use redisson, you can't get the data

this is my lua file
return resultsWithParent
but search data from redisson ,it can not get datas;


3252
Problem to deserialize object with jackson

Hey guys could you tell me what i am doing wrong here
I have an interface and it has many different implementations, so for example there is a call create account it should return CreateAccountResponse or any other interface realisation
Could not execute the callcom.fasterxml.jackson.databind.exc.InvalidTypeIdException: Missing type id when trying to resolve subtype of [simple type, class com.opngo.nowos.nowos.api.response.DataResponse]: missing type id property 'operation' (for POJO property 'response')
Here is my Interface
Here is one of the response objects that implements the interface mentioned above
Here is main Response that have that interface that should bring correct response object
And finally just wanted to mention that the goal of such approach and receiving different responses for each call is to test their properties, so i am casting interface to the correct class depending on the call


3253
none




3254
RedissonFairLock.tryLock returns with false after timeout even when lock has been released

We use RedissonFairLock in our application to synchronize across multiple threads. Whenever there are several simultaneous lock attempts on the same lock, one or more of the waiting threads always errors out with tryLock returning false after the waitTime configured, which is almost 5 mins, even though I can clearly see that the other threads that were holding the lock have long since released it.
Is there a known issues with RedissonFairLock? Also, would switching to a non-fair lock help (we don't really need fairness guarantees)?
Code used to obtain lock -
Redisson version being used is v3.13.6


3255
Redisson Multiget - Getting multiple key values in single call form Redisson

I have a redis cache where each key is of type list and from redisson i want to make a map of each list key and their size...
Below code is working fine but I want to make single call to redis cache.
I don't want to make a call to cache multiple time. Below code should be changed to single call
Thanks in advance


3256
RetryAttempt setting isn't applied to connection during startup

No description provided.


3257
org.redisson.client.RedisException: ERR Protocol error: invalid bulk length

Using redisson 3.13.6, redis 5.0.7
Putting an HashMap we are getting this exception:
Current redis configuration is proto-max-bulk-len 1024mb
The hashmap size is not exceeding this limit


3258
RPatternTopicReactive.removeListener() not working

Expected behavior
After calling removeListener with reactive client, we shouldn't trigger the listener anymore
Actual behavior
Listener is triggered after calling removeListener with reactive client
Steps to reproduce or test case


3259
ClassCastException when trying to get count of elements within a range in sorted set for rxjava2

I am getting a ClassCastException when trying to get the count of elements within the score range in a sorted set using the rxjava2 client.
code snippet:


3260
"RateLimiter is not initialized" exception when expire the key

Expected behavior
normal
Actual behavior
Steps to reproduce or test case
My Code


3261
ClassCastException when adding elements to sorted set using rxjava2 client

I am getting a ClassCastException when trying to add multiple elements to a sorted set using the rxjava2 client.
code snippet:
redisson version - 3.13.6


3262
Command still hasn't been written into connection! Increase nettyThreads and/or retryInterval settings

Redisson version: 3.13.4
This will be the case when you visit redisson every time the project is started,nettyThreads is the default number


3263
Exception "Unable to write command into connection" throwed after two weeks time running with redisson

The exception stack info is below:
We can't find the channel port 55134 in the client vm, but other channel worked normally, the redisson version is 3.11.3
I want to known how to lead the ConnectionWatchDog to check the channel in time.


3264
Would be nice to have a way to extend the TTL on an RLock

Is your feature request related to a problem? Please describe.
I have some situations where I'd like to keep the lock acquired for potentially a long time, but I don't find out until I've held it for a while.  I don't want to set a long TTL because I might finish soon; I basically need to extend the acquisition of the lock in increments.
Describe the solution you'd like
A simple RLock.setNewTTL() method, or similar.
Describe alternatives you've considered
https describes how this can be accomplished by sending a Lua script:
If the work performed by clients is composed of small steps, it is possible to use smaller lock validity times by default, and extend the algorithm implementing a lock extension mechanism. Basically the client, if in the middle of the computation while the lock validity is approaching a low value, may extend the lock by sending a Lua script to all the instances that extends the TTL of the key if the key exists and its value is still the random value the client assigned when the lock was acquired.
It would be nice if Redisson's RLock API could take care of this for you.  Apologies if there's already a way to do this that I missed.


3265
Add LFU eviction support for RMapCache object

No description provided.


3266
the lock expiration  failed when the network breaked.

I have a problem ,this is code:
at imeUnit.MINUTES.sleep(5), break the network,the program throw a network exception,restore the network,find the lock expiration  failed,other thread can lock the key ,is a problem?


3267
Redisson used disconnected channel to write data

My redisson version is 3.13.3, and the configuration is :
The slaveConnectionMinimumIdleSize use default value.
After a two weeks time running, an exception "Unable to write command into connection" thrown
The stack info is:
We can't find the port 55134 in the client channel,  why Redisson used the disconnected channel to send data?


3268
Print the SearchDomainUnknownHostException repeatedly when connected to redis sentinel cluster on the Kubernetes

When I use redission 3.13.6 to connect to the redis sentinel cluster on the kubernetes,it will print following logs every few seconds.The address of cluster is redis-cluster:26379 which is the servername on kubernetes. But when I change the address to its IP address which is 172.30.49.77:26379,the error is missing.How to resovle this problem when use servicename address.


3270
none




3272
Tomcat session manager registers UsageValve with Engine pipeline

Expected behavior
Since the Manager can only be registered with a Context, the UsageValve should not be added to the Engine pipeline, but to the Context pipeline. Or the UsageValve should take into account that not all Sessions are RedissonSessions.
Actual behavior
If the session manager cannot find a UsageValve, it adds a UsageValve to the Engine pipeline. The UsageValve assumes all Sessions are RedissonSessions.
Steps to reproduce or test case
Have two webapps, one with the default Session Manager, one with RedissonSessionManager
Access the one with the RedissonSessionManager first
Then access the one with the default Session Manager
An internal server error is returned and the following error is logged


3273
Unable to send PING command over channel:




3274
Support TTL for RBuckets.set

Currently RBucket supports set with TTL
This is a request for similar support in RBuckets for setting multiple key values with specified TTL.
thank you.


3275
Can I get and update an object in an RBatch operation?

Apologies if this has been asked before, or if this is the wrong forum for this kind of question.
I'd like to update the timestamp field of a java object in an RBucket, keeping the object's other fields as-is.
Can I do this in the context of an RBatch?  It's not super clear from the documentation I've found - I can't tell whether batching only supports pipelining a bunch of writes, or if it can do reads and then writes based on the results of those reads in a single batch operation.
pseudocode for what I'm trying to do:
I'm not sure if the batch will wait for the result of the read before updating it and performing the write.
If this isn't the right way to do it, should I just perform a synchronous get followed by an async update?  Thank you.


3276
redis-clusters mode with one master node crashed , why redisson client still connect the crashed node?

hi ,
i want to use redis-cluster and client is redisson, i ran test case as follow:
step 1: run the test code;
step 2: during the loop , i killed one master node (192.168.199.142:8001) .
on console log : there still has command set request to  192.168.199.142:8001 node and continuous attempt try output ,  is that right or reasonable? thks.
or how can i do to avoid the request to 8001 node?


3277
Does RLocalCachedMap get invalidated with the changes in Redis-Server?

Hi,
My use case:
I have a single node application(MyApplication) which uses RLocalCachedMap (say testMap)to communicate with redis-server and also cache data locally in aplication.
On the other hand there is another Non java application say anotherApplication(which we have no control of) will update the data in redis-server on same map testMap.
In which case, does RLocalCachedMap in  MyApplication will invalidate the local cache entries when there is change in redis server ?
If not, how would you suggest to implement Redis Server assisted client side caching?
Is there a way that i can use listen to redis-server invalidation events and keep the local cache in sync with redis-server data (with or without RLocalCachedMap as Its not mandate for use to use RLocalCahedMap). ?
Please suggest.


3278
Does a redisson retry attempt invoke the load balancer again?

Given one master node and multiple replica nodes with Sentinels enabled, Redisson configured to read from replica nodes only, and round robin load balancer and retries enabled. In case of a Redisson retry attempt, does it invoke the load balancer again to determine a new replica node or does it talk to the same replica that it had unsuccessfully communicated with before?
Our use case is such that we see are witnessing a 50% drop in commands processed per second when a single replica node restarts. We have retries enabled in Redisson but they don't seem to be helping so we are wondering if the retries also go to the same failing node.
Redisson version: 3.13.6 Redis version: 5.0.6
The contributing guidelines dont really say anything about where to ask questions so I also created a SO question:


3279
How to execute redis 'client tracking on' command ?

Hi,
I would like to subscribe to the invalidation messages from redis-server using redisson.
I looked through commands mapping:
But not found any method associated there.
Also checked the low-level client but RedisCommands.java also does not have CLIENT TRACKING ON.
Could you suggest how to achieve it ?


3280
After immediate put call get method returned null

We are using Rmap/RadissonMap , and use fastPut method to put key in cache and immediately after this method call ,Call get method and that return some time null and some time working fine please suggest solution for this issue.
My redis is in master-slave architecture with sentinel.
Redisson client configure as sentinel configurations so my understanding all the put should used master node of redis and all get should use slaves.


3281
none




3282
redission remote service does not support java8 class Optional serialization

redission remote service does not support java8 class Optional serialization


3283
none




3284
Using external EventLoopGroup with the Blocking API

I'm using Redisson RBLoomFilter  over Vert.x and I need to call the contains method, which is blocking (i didn't find any async option)
Is it possible to use Vert.x Netty EventLoopGroup instead of Redisson Netty threads without blocking the eventloop?
The blocking nature of the contains method blocks netty threads? or is it using a different thread pool for blocking operations?


3285
RBloomFilter contains async Implementation

I'm using RBloomFilter and I saw there isn't a async variation of the contains method.
Why is that? is there any particular reason it's the only method missing an async variation?
Is it possible to implement it by my self with another redis client?


3286
Documentation out of date with 3.14.0 for spring sessions

Could you please update the docs for enabling spring sessions with redisson.


3287
Why does it take RLock nearly 1 second to get the lock?

There are only 10 redission client connected to the redis server, no more than 4 threads competing for the lock.
It is weird that my redis server cpu and memory usage is no more than 10%.
My redisson version is 3.12.5.
Is there any one knows the reason?


3288
how to manual change read mode at redis cluster

I have some high loading action, I hope it can run at SLAVE nodes, and other action at MATER nodes.
ex:
scan key by pattern and mget value by keys at SLAVE nodes.
normal get and set at MASTER nodes
how to assign nodes when I use some high loading action?


3289
BiHashMap  not perform in bijection manner

Hello,Author or team member of Redission. I find a convenient util class named BiHashMap when I read source code of redisson. In my opinion, it will perform in bijection manner. I try to use it but find some problem. here are some descriptions
Expected behavior
return a value equal to  parameter which is already put into the map  when use map.reverseGet(map.get(param))
Actual behavior
return a value not equal to parameter which is already put into the map  when use map.reverseGet(map.get(param))
Steps to reproduce or test case
We can't guarantee all the inputs is bijective.if it should perform in  bijection manner , does it better to  use some mechanism when conflict occurs(delete illegal old data or forbid it when put operation will result in a conflict data ... )


3290
RedissonMap.keySet(pattern, batchSizeHint).isEmpty() is inefficient

RedissionMap.isEmpty adopts the default AbstractMap.isEmpty, which checks size()==0. RedissionMap.size() iterates all keys (even with pattern), which is inefficient with large HASH.
Suggest to override RedissonMap.isEmpty() which checks iterator().hasNext() instead.
Not sure whether this optimization applies to other RMap implementation.


3291
Redisson creating new connections when using pollFromAny

I have the following code.
redisson.getScoredSortedSet(keys.stream().findFirst().get()).pollFirstFromAny(1, TimeUnit.MINUTES, keys.toArray(new String[0]))
The above code results to connections getting acquired and released every second as follows. What can I do so that it reuses connections from the pool rather than creating new ones.
I am connecting to Elasticcache which is running redis with 2 nodes and cluster mode enabled


3294
none




3296
none




3297
Rename Empty BloomFilter Throws RedisException:no such key

possible reason:
Bloom Filter is empty now and key {foo} doesn't exist ,so rename failed


3298
RedissonMap.keySet(pattern, batchSizeHint).isEmpty() is inefficient




3300
RSet broken for serializable custom pojos

Expected behavior
When working with multiple service instances and using RSet as a distributed cache, add() will create a duplicate for a custom serializable pojo even though equals() and hashCode() are implemented correctly. Also the contains() method will return false when checking the same pojo from different instances OR from the same instance with a refetched RSet like
Actual behavior
RSet's contains() method returns false. RSet's add() method will add the same object multiple times.
Steps to reproduce or test case
Take any simple serializable pojo, add it to an RSet. Get the RSet again from the redission client and call its contains() or add() method with the same object. contains() will return false, and the same object will be added again.
The size of the RSet will increase with each add(). Using the RSet as a constructor parameter for a native HashSet(), its size will  always be constant, since the duplicates are not added as expected.


3301
First call to RMapCache get() 10 times slower than subsequent calls why?

Trying to understand the slow performance of get(). I run a test program:
What is happening on the first call that isn't happening afterwards?
Many thanks for your help.
WHat is happening


3302
RBlockingQueue entries are sometimes lost.

RBlockingQueue entries are sometimes lost.
Expected behavior
All entries added to the queue with put are returned with poll.
Actual behavior
Sometimes a queue entry will be lost when poll returns.
Steps to reproduce or test case
Minimal code sample used to reproduce:
The bug reproduces within 100 iterations in included sample. The poll timeout is set to 1 ms to increase likelihood of the error happening. In a live system I have this set to 5 seconds and I get this error several times a day.


3303
Why does using a redisson container slow down io.netty?

An Attempted Optimization:
I was benchmarking an application and realized that the majority of time was being spent waiting on a jedis socket.
The slowness appeared to be from the accumulated network round trip of a particular jedis call.
Seems like a good use-case for a cached redisson container, so I opted for SetMultimapCache.
And sure enough, it reduced the overall time spent in my function from 24% to .1%
A new problem:
However this seems to have caused even more time to be spent in io.netty.  So much so that the overall duration (from the client's perspective), is significantly slower.
Do you know why this is happening?  My understanding so far is that both grpc and redisson are using netty, and maybe they aren't playing well together?  Or I have some kind of bottleneck which is now being stressed further by optimizing the main worker thread.  Or I don't understand netty or redisson enough to see what's happening.
Attempts to fix:
I've tried to setup the resisson client in many different ways.
I've tried a different number of nettythreads.  I've tried different eventloop groups with different thread counts.  I've tried changing the IO ratio to something lower/higher than 50.  If it helps, I'll show you the diff of how I integrated the container.  It basically just shows how I moved away from jedis calls in place of the redisson container:
The diff shouldn't be that important, but I didn't want to leave anything out.  These are the changes I've made with the configured redisson client that result in speedup where I was trying to optimize, but signifcant slow down on the client side and increased time spent in io.netty?
Do you know why this is happening?  What else can I try?


3304
Why does the first IP of the cluster automatically change to the intranet IP?

This is my configration file
This is my log. note that the ip of port 7000 has changed,
When I test the code on my computer, I always get an error: Can't connect to master: redis


3305
Make RxJava/Reactive libraries optional/move them to separate modules

Curently, redisson library itself is more than 2MB. When added Netty, another 2.5MB, along with RxJava, +2MB, & Project Reactor, 1.5MB, its nearly 10MB in total dependency size, even without Spring etc. I realized that both RxJava &  Project Reactor classes are not necessary for all operations, mostly has their own packages for operations/data structures etc. I believe it'd be extremely useful to move them to their own separate modules so anyone who wishes to use them, either one or both, can add specifically, but the core will be free from those dependencies & be more compact.


3306
Error starting project:Unable to connect to Redis server.

There is a probability that it will happen, not every time it will go wrong.


3307
RPriorityQueue/RPriorityBlockingDeque peek instance object, update value won't save to redis

Being confused.
If won't save update changes to redis automatically,  "RPriorityQueue/RPriorityBlockingDeque"  feature is almost no help  personally.
The memory address keep change:
step 3: The head of RPriorityQueue, "using" property still be "false",no matter get from redis later again .


3308
An exception was thrown by org.redisson.misc.R in edissonPromise$$Lambda$160/1930319715.operationComplete() post redisson 3.11.5 too

With redisson sentinel mode getting null pointer exception
Expected behavior
Sentinel configuration should work as per expectation in redisson version 3.11.6 and 3.14.0
Actual behavior
Getting below error :
Steps to reproduce or test case
On trying to connect to redis labs with below sentinel configuration we are getting above issue.Connection to redis is successful.But I continuously see above error its like every milliseconds.
where  'redis://127.0.0.1:8001' is address of service discovery in redis lab.
Similar error was fixed earlier in redisson version 3.11.5 .reference link : #2355


3309
Unable to send PING command over channel ClosedChannelException




3310
How to optimize slow queries by Redisson RSet.readAll() ?

Hi,
Recently, I used Redission RSet to save Object Collections (size from 10,000 to 40,000). When I used readAll() action to fetch all of objects in the set, it caused a lot of slow queries(cost over 100,000 microseconds).
I know that storing too many objects, and that too long a key can be a performance drop, so I'd love to know how I can store so many objects and read them all efficiently with Redisson.
Thanks~
Object Example:


3311
AccessorInterceptor#removeIndex: incorrect behavior of removeIndex(RMap<String, Object>, Object, Field) method

Expected behavior
Correct removed index if exists in cluster mode or not removed if value index does not exists.
Actual behavior
Current call of AccessorInterceptor#removeIndex(RMap<String, Object>, Object, Field) raises an NPE if index value does not exists.
Steps to reproduce or test case
Persist and delete entity
See throwed exception:


3312
AccessorInterceptor#removeAsync: incorrect behavior of removeAsync(CommandBatchService, String, String, Codec, Object, String) method

Expected behavior
Correct removed index.
Actual behavior
Current call of AccessorInterceptor#removeAsync(CommandBatchService, String, String, Codec, Object, String) raises an script exception ERR Error running script (call to f_7f573e8a56b15c812f93887e04b9fdb40d72f0e6): @user_script:1: WRONGTYPE Operation against a key holding the wrong kind of value.
Steps to reproduce or test case
Persist and delete entity
See throwed exception:


3313
Allow to store cache misses for JCache local cache.

No description provided.


3314
netty4.0.23.Final, a post request, got exception: java.lang.UnsupportedOperationException




3315
StringIndexOutOfBoundsException

Input code:
Exception Message:


3316
RedisTimeoutException: Unable to acquire connection after Redis cluster back to normal

my redisson version:3.12.3
redisson client:
I use redissonMap to caching data and use RScheduledExecutorService to schedule tasks. Why there's no connection to use  ? Looks for your help, thanks.
My application error:


3317
need to trigger RLock.unlock() twice to remove lock

Hi
i have strange behavior in my program. I am trying to implement something like "getAndLock then PutAndRelease".
Here is my getAndLock function:
Here is my PutAndRelease function:
i can see that after 1-st rLock.unlock(); lock is still alive (presented in reddis and rLock.isLocked() == true) and after 2-d rLock.unlock() it is released (removed from reddis and rLock.isLocked() == false)
Why is it so? why do i need to trigger rLock.unlock(); multiple times until it finally removes lock?


3318
Issue with redisson - Exception Command still hasn't been written into connection!

Hi,
We are using AWS elasticache Redis with cluster mode enabled. We are seeing below issue intermittently from Redisson, please guide how to resolve this issue.
Below is the cluster configuration:
I have tried increasing netty threads, connection pool size and retry attempts.
Average load on our system is around 500 requests/sec.


3319
Add StoreMode setting for JCache local cache

No description provided.


3320
ERROR [io.netty.util.ResourceLeakDetector] - LEAK:

When I run redisson,there are some error logs:
LEAK: ByteBuf.release() was not called before it's garbage-collected. See https for more information.
Recent access records:


3321
Support transaction in live-object interceptors

I want to use  transactional isolation functionality in live object interceptors, or do I have to embed in the library code to implement the feature?
Do you plan to implement it?


3322
Add Tomcat 10 support

No description provided.


3323
RedissonMultiLock#tryLock  The difference between leasetime and newLeasetime

In this method, both waittime and leasetime are specified. That is to say, the leasetime and waittime of the input parameter are not equal to - 1. When locking, newleasetime is used, which is twice as much as waittime. Why not use the leasetime in the input parameter


3324
Interrupted Exceptions are hidden under Unexpected exception

If an InterruptedException is thrown while waiting for RedissonBuckets.get, redisson throws a  RedisException with the message Unexpected exception while processing command.
Expected behavior
If an interrupted exception is throw while waiting for RedissonBuckets.get, a RedisException wrapping the InterruptedException should be throw so the clients can implement proper error-handling.
Actual behavior
Exception that is not clear to pin-point the actual reason:
Reproduced on 3.13.6 and 3.14.1


3325
none




3326
What's the best way to iterate through a Mapcache

Looking at this example, there are different ways to iterate though a map
In addition, I can also use Java native API
Suppose the map has millions of entries, what's the best way to iterate through the map to get all key/value pairs, without blocking Redis?
My understanding is that KEYS command may block other clients, so HSCAN may be better. Does Redisson support the map iteration based on HSCAN?


3327
Avro utf8 string cannot be deserialized properly using JsonJacksonCodec

Avro Utf8 string cannot be deserialized properly by jsonjacksoncodec
Avro utf8 string is serialized as binary object but being deserialized as string hence causes transformation exception


3328
Get value failed in cluster mode

Both redis in 172.21.22.22 are slave , when there is  one key in 9000'redis and  one key in 9001`redis,   failed to get key in 9000'redis by RedisTemplate.


3329
Add support MEMORY STATS command

No description provided.


3330
Where is RXAResource class?

In Chinese wiki page you mentioned RXAResource class but I couldn't find in source code. Where can I find it?


3331
Problem with serialisation/deserialisation query cache for Hibernate Cache

I am using:
codec: SnappyCodec
When I try to put query data to Redis I receive an error
Then I try to change the codec to Kryo5Codec
What am I doing wrong?


3335
none




3336
Add setAndKeepTTL() method to RBucket, RBucketRx, RBucketReactive interfaces.

No description provided.


3340
Redis Cluster slave "down" on slave connect timeout when startup.

Expected behavior
Redis Cluster slave  reconnect or report error on startup after connect timeout
Actual behavior
Redis Cluster slave report "down"
Steps to reproduce or test case
Cluster slave connect timeout on startup


3341
Add min idle time parameter to listPending() and pendingRange() methods of RStream object

No description provided.


3342
Add autoClaim method to RStream object.

No description provided.


3343
Add addIfExists() method to RScoredSortedSet object.

No description provided.


3344
Add addIfGreater() and addIfLess() methods to RScoredSortedSet object

No description provided.


3345
about slave node down status.

flags field that "sentinel slaves xxx" command result contains "s_down" or "disconnected", manager will freezed the node,
but master-link-status than "sentinel slaves xxx" command result is "err", slave node is in "LOADING Redis is loading the dataset in memory" status, why not add this condition in slave node state check? just like


3346
none




3347
The timeout configuration of MapReduce does not work

There are two data processing services here. When I use MapReduce to process data, the timeout (30 s) is set. However, when one of the services in the process of reducing data goes down unexpectedly, there is still no response from the map after the timeout, Does the data processed by the down service need to be reallocated to other machines? What is the specific meaning of this timeout? Is there something wrong with my use?
The following pictures are related information:
This is the normal data processing service:
This is a service that has been down unexpectedly:
This is the configuration code information:
This is the now time:
@mrniko thanks


3348
Redisson mapwriter

I am using RMapCache<String,Object> with map option with write mode as WRITE_BEHIND
now when i put something in cache after particular delay it is getting executed after dealy provided,
but what i need is map writer should pick entry from map unless it is cache but it is not doing so it is only getting executed once.
Can anyone help what can i do in this case or there is any alternative?


3349
Spin lock with exponential backoff

RedissonLock uses pubsub mechanism to get notified about changes to lock. According to the cluster spec (https), currently messages are simply broadcasted to all nodes in the cluster. It makes this lock inefficient in clusters with more than 5 nodes.
It would be great to have a spin lock with exponential backoff, because it works well with Redis's horizontal scaling.
If the idea seems fine to you, I can prepare a PR in a few days, just let me know. If not - sorry for taking your time, feel free to close the feature request.
Best regards,
Danila Varatyntsev


3350
Add readUnion() method to RScoredSortedSet object

No description provided.


3351
can i use redisson with spring cloud getway and webflux

when i use redisson in spring cloud getway filter,
but when i unlock this rLock report error log not locked by current thread , this rLock is not the same thread when i locked, how can i fix this problem


3352
add readIntersection() method to RScoredSortedSet object

No description provided.


3353
BaseRedisBatchExecutor NullPointerException with Redis Cluster

Redisson 3.14 - Redis Cluster with cluster-require-full-coverage=no throwing NPE
I believe the NullPointerException happens because the slot is not allocated.  "MasterSlaveEntry msEntry = getEntry(source);"
returns null, and then get() is called with a null parameter, which is not allowed by the ConcurrentHashMap
Could this be updated to return a Redisson exception?


3354
RScript eval error

Steps to reproduce or test case


3356
add readDiff() method to RScoredSortedSet object

No description provided.


3357
Redis Cluster master down and restart,redisson can't update cluster state

Expected behavior
redis cluster master down one by one.After a period of time, restart master node, redisson client can't update cluster state
Actual behavior
redisson can't write command to master, and report error.
Steps to reproduce or test case
It doesn't have to happen
1.test case
3 master and 3 slave
restart all master and There's a certain probability
2.redisson can't update cluster state exception


3358
add diff() method to RScoredSortedSet object

No description provided.


3359
org.redisson.client.RedisTimeoutException: Command still hasn’t been written into connection!  Increase nettyThreads and/or retryInterval settings.

Got this exception continuously for a minute and then became fine. Would like to know what is the root cause of this.
Using Redisson: 3.13.2
org.redisson.client.RedisTimeoutException: Command still hasn’t been written into connection!
Increase nettyThreads and/or retryInterval settings.
command: null, params: null after 3 retry attempts


3360
FstCodec error

redisson-all-3.12.1


3361
add rangeTo() method to RScoredSortedSet object

No description provided.


3362
add revRangeTo() method to RScoredSortedSet object

No description provided.


3363
none




3365
How to implement the contains of RDelayQueue To specify fields for the same of value.

I want to implement query the message that exists in the RDelayQueue, and remove if it exists function.
The message DelayEvent is
The value is ture about this TestCase:
The value is false about TestCase in the below:


3366
Have a Bypass Mode? when redis down.

Hi, I used redisson-tomcat-7 in my project.
Everything is ok.
and I tested how to works when redis down. Tomcat returned 500 Error.
My question is
Have a Bypass Mode? when redis down.(Use Local stored sessions)
If exist, Let me know how to use Bypass Mode.
Thanks.


3367
Use System.nanoTime() in IdleConnectionWatcher to avoid clock drifting

No description provided.


3368
RLocalCachedMap with Broadcast Mode tracking.

Can RLocalCachedMap be used with Broadcast mode tracking?
In Redis CLI we would enable this as "CLIENT TRACKING on REDIRECT 10 BCAST PREFIX"


3369
Repeat consumption(multiple listeners)

redisson version


3370
[Redis Cluster] RedisTimeoutException: Unable to acquire connection! Increase connection pool size

Expected behavior
Redisson should not exhaust the connection pool. In other words, it should release connections after every successful command.
And even if the pool is exhausted that should not make Redisson freeze completely until restarted I guess.
Actual behavior
We have experienced this error in production and now I have managed to reproduce the error with a clean Spring Boot project and one endpoint that executes a lua script on a redis cluster. I am using Locust (locust.io) for load testing.
More on how to reproduce the error later.
The screenshot shows an example Locust load test result: the first couple minutes are fine, I get around 1000 req per second and no errors.
But then requests start to fail and response times go up to ~6 seconds. Sometimes it takes around 5 minutes as the test is a bit random.
This is the log for one of those failed requests:
Once this happens, even if you stop the test, Redisson no longer recovers. All requests fail after 6 seconds and you have to restart the server for it to work again.
By the way, those 6 seconds seem to be related to retryAttempts and retryInterval settings, but even if I set retryAttempts to zero, it still takes 1.5 seconds for each request to fail. Why?
Anyways, the main problem is that it fails.
Steps to reproduce or test case
I have created a clean spring boot project with one endpoint that executes a lua script. The script is basically rate limiting:
The endpoint just takes the IP of the request (from a "True-client-ip" header) and executes the script with it, returning the IP and the number of requests made so far this minute so you can see if it is working or not.
And the test makes a bunch of requests to this endpoint, faking the True-client-ip header with 50 different IPs in an attempt to simulate a realistic environment.
So, how to test:
Download and extract the demo project
Change RedissonConfiguration to connect to a redis cluster. Ours has 3 master and 3 slaves.
Start the server and see if localhost:8080/redisson works on your browser.
Start Locust with locust -f demo.py from the root project directory (you will need to install locust with pip3 install locust)
Open Locust UI on your browser (localhost:8089) and enter the following parameters:
20 users, 5 spawn rate,
Wait a couple minutes for the server to explode (hopefully)
And those numbers probably are not even important, but now that I have managed to reproduce the error I don't want to change them.
Check RedissonConfiguration for the details.


3371
The following method did not exist: org.redisson.api.RTopic.removeListener(I)V




3372
Clarification on RLocalCachedMap and CODEC Types

Hi,
I am working on a API which is a high TPS one (around 10000 TPS) for both read and write.My API makes use of Redisson Open Source to connect to AWS Redis and I am making use of RLocalCachedMap so that frequently used objects will be fetched directly from LocalCache. I have the following questions:
What is the unit of cacheSize? Is it the number of records. If it is number of records that this local cache can hold, then I am getting many errors related to server crash and restart if I increase the count to higher values. Each object size should be around 800 bytes. I am not sure why that is happening. Do you think it might be with the RAM of the server on which it is deployed?
What happens if I dont set the cacheSize. Per documentation it is unbounded (default value is 0). So what would be the max limit this local cache size occupies and does it do the cache eviction internally if the LocalCacheMap feels the memory is nearing its capacity.
This question is with respect to the Redisson default Thread Pool size. Right now, I am using the default thread pool options. Do I need to fine tune the thread pools or the default thread pools can handle 10000 TPS
This question is with respect to CODEC Types.
I am having an object which has generic as one of its attribute. When I push the object to AWS Redis through redission using the codec types SNAPPYV2, SNAPPY it pushes the value and while retrieving from AWS Redis I could see the object having the values populated except the values of generics attribute (guess this codec type skips the generics at the time of deserialization). If I use JSON Jackson Codec, I could see the complete values being retrieved from AWS Redis. Would there be any codec that you suggest that handles generics or do i need to write custom serialization logic to handle.
What would be the best codec type if I am going to push the object as Map<String, Object> to AWS Redis. I ran performance test with different codec types and almost each of them returned in the same time (JSON Jackson COdec being little faster).
To meet the High TPS, what should be the object i need to consider while inserting it into AWS Redis, should the object be the regular POJO or can I have it as Map<String, Object>
Also, it would be helpful, if you can share any articles that helps in improving the performance using Redisson to connect to AWS Redis


3373
Will tasks submitted via redisson ExecutorService be executed after redis instance is restarted?

It's not an issue, it's a question I have not found an answer to in documentation.
Will tasks that were submitted via redisson ExecutorService be executed if redis instance is restarted?
For example, a task is submitted with a delay 10mins and right after it was submitted, redis is restarted. What will happen with that submitted task?
What if I have AWS ElastiCache with Redis Replication Group and Multi-AZ enabled - will that task be executed if it was successfully replicated to read instances and primary instance failed?


3374
time_to_live and max_idle_time doesn't work in redisson as 2 level cache in hibernate

Hello everybody,
I try to use Redisson  as second level cache in my jpa spring boot application it works fine i see that it cache entities in redis it just i need to set a time to live and time to idle on cache entries i use this configuration below but it doesn't work:
I use redisson-hibernate-53 as dependancy
Any help on this will help, thank you.


3375
Can I make Redis soft dependency?

I am trying to use this library as my cache engine in my JPA application. As of now I understand if I configure this in my app - the app won't start if the Redis isn't running. Can I make this a soft dependency like if Redis server isn't running start the app without L2 cache?


3376
add ScoredSortedSetAddListener

No description provided.


3377
org.redisson.client.WriteRedisConnectionException

Expected behavior
When redis runs for a period of time, there will be abnormal connection
Actual behavior
Steps to reproduce or test case


3378
Add createConsumer() method to RStream object

No description provided.


3379
Is redisson using write behind strategy guarantee data sync to DB"

I m exploring the use of write behind strategy, just wonder is it guarantee data sync to DB.


3380
add addIfExists() method to RGeo object

No description provided.


3381
add tryAdd() method to RGeo object

No description provided.


3382
No response after 1000ms




3386
redisson client configuration when using AWS elastic cache with single end point but with replicas

what the optimal configuration when we use redisson as session manager and as a cache service , and the Redis cache provided by AWS elastic cache with a single endpoint that had replicas in the case of AZ failure ?


3387
RPC is very slow

RPC  very slowly. It takes about 1 second to get data for 10 times. How to solve this problem


3388
Can I make redis strong consistency in active active HA environment

Hi
can I make redis strong consistency in active-active HA environment through Redisson config? We need a synchronous replication between redis nodes.


3389
RMapCacheReactive.getLock returns org.redisson.RedissonLock instead of org.redisson.api.RLockReactive

Expected behavior
RMapCacheReactive.getLock should return an instance of org.redisson.api.RLockReactive
Actual behavior
RMapCacheReactive.getLock returns an instance of org.redisson.RedissonLock and throws exception:
Steps to reproduce or test case


3390
RBatch response order with cluster env?

In cluster environment batch executed in map\reduce way. It aggregates commands for each node and sends them simultaneously, then result got from each node added to common result list.
Read above tips, I was not sure about responses order for origin commands.
Could you help me make sure about this?
1.When commands send group by slots, but I want know responses order is right with original commands?


3391
If readLock is blocked by writeLock then readLock.isLocked() should return true

Expected behavior
If readLock is blocked by writeLock then readLock.isLocked() should return true (see step 4 below)
Actual behavior
If readLock is blocked by writeLock then readLock.isLocked() returns false. (see step 4 below)
Note: readlock.tryLock() behaves as expected
Steps to reproduce or test case


3392
none




3393
Redisson 3.12.5 unlock hang forever

redisson version:3.12.5
redis version:5.0.7
redis cluster mode: 3 master 3 slave deployed in vm
question descript:
In my production environment, a thread(dubheTaskExecutor-pool-2-thread-836) hangs up forever  whe invokes RedissonLock.unlock() . And I never found any error  in my application log. I am desired to find out if is a bug in redisson 3.12.5.The thread dump file is below(core part) :


3394
none




3395
Dead connection stay in pool forever if server is not responding.

Expected behavior
Dead Connection automatically reconnect after channel inactive.
Actual behavior
In org.redisson.client.handler.CommandsQueue, we only call sendNextCommand to poll command if server responded with data or write was failed in the first place.
But if client write was successful and server is not responding, our QueueCommand is still staying at the front of queue, next time we call sendData, org.redisson.client.protocol.QueueCommandHolder#trySend will return false and nothing happens.
So eachtime we use that connection to write something, we got  RedisTimeoutException:  Command still hasn't been written into connection!


3396
Selectively store session attributes to redis using redisson tomcat based configuration.

Hi ,
I am implementing redis based tomcat session management using redisson. I want to filter out some of the session attributes which gets saved in my redis database session. Is there any way to do so through configuration? Something similar to SetAttributeFilter in MemcachedBackupSessionManager?
Here is the single instance config YAML file i have used:


3397
Allow password (or any secret) to be set at run time after yaml config read

Is your feature request related to a problem? Please describe.
Add a "setPassword" method to org.redisson.config.Config;
Motivation:
I'd like to configure everything EXCEPT the password in .yaml.
But allow a programatic setting of just the password after the .yaml config loads.
This way I can pull that "secret" out of a "vault"   ( hashicorp vault, azure key vault, amazon aws kms, etc)...and set it at run time.


3398
org.redisson.api.RAtomicLong#expireAt(long) Cause the value to be deleted

Redisson:3.15.0
redis:4.0.9
org.redisson.api.RAtomicLong#expireAt(long)
Cannot find the key of aKey after execution
Why is this ?


3399
Add expireAt(Instant) method to RExpirable objects

No description provided.


3400
Connection leak when redis cluster has "127.0.0.1" in its node list.

Expected behavior
An exception in adding a cluster member connection should not result in a connection leak
Actual behavior
Our redis cluster had two nodes which had configured themselves as "127.0.0.1:6379" in the cluster configuration.  Upon connecting two this cluster, redisson properly threw exception
Later in the logs we find, repeatedly
Each of these subsequent attempts appear to leave a new connection open to the redis node from which redisson is gathering cluster nodes information.  Over the course of ~2h, this used the remainder of that redis node's 10k connection limit.
Steps to reproduce or test case
I'm not sure how our redis server came to this state originally, but I was able to reproduce by stopping a cluster member, changing the address field in the "myself" line in the cluster config (in our case, /var/lib/redis/redis-6379.conf) from
Where $redisHost resolves by dns to A records for each node in the redis cluster.


3401
Add random() method to RScoredSortedSet object

No description provided.


3402
none




3403
Support for storing data locally

Is support for storing data locally provided so that number of calls to redis can be reduced?


3404
Can't execute SENTINEL commands on

exception log
Can't execute SENTINEL commands on /192.168.28.129:63376
There are three sentinels in total. This anomaly occurs every time you start it. A sentinel anomaly appears randomly, but it can be used normally.


3405
none




3406
Integer with Spring Boot 2.3.8 in Mac Warning:ClassNotFoundException: io.netty.resolver.dns.macos.MacOSDnsServerAddressStreamProvider

Expected behavior
no error log


3407
Redis cluster master restart cause tps down and can't recover

Expected behavior
Redis cluster master down, redisson client update cluster state, and tps come down.  After a period of time, restart master node,  tps come back to normal.
Actual behavior
restart master node,  tps  can't recover , just come back a little.  And server no error.
Steps to reproduce or test case
5 master and 5 slave
master 1 down and wait for slave become master
restart master 1,  observe tps
version
redisson version : 3.14.1
Looking forward for your response, Thank you!


3408
none




3409
Redisson api reconverts Stream's linked hash maps into hash maps

Hi guys!
thanks a lot for your brilliant product it helped us tremendously. However I believe that we are facing a bug there.
redissonClient.getCommandExecutor().read(name, RedisCommands.XRANGE, name, "-", "+")
returns LinkedHashMap
while
redissonClient.getStream(name).read(10, new StreamMessageId(0L, 0L));
return HashMap, which is imo wrong.
When using redis streams and XRANGE command, one wants to rely on ordering being exactly the same as ordering on StreamMessageId's.
Would you have some time to check this?
Thanks,


3410
FST codec on Topic (PUB\

No description provided.


3411
FST codec on Topic (PUB\SUB).

So i suggest. There is a way to do FST codec on Topic (PUB\SUB). When i tried to use it. It didnt work. Then i though that im choose a wrong way. And then i Make log of redisson to debug "logging.level.org.redisson=debug".
So what i see when i use publish method :
As we see there is using still StringCodec.  Then i tried to use FST codec not for PUB\SUB. Just for save info to redisson. And then it works. My configuration of FST is simple:
There is a way to use FSTCodec for Pub\Sub, not only for store data? Version of redisson 3.14


3412
Duplicate PING when Redis connection got reconnected

When a blockQueue executed with TIMEOUT, it will always trigger reconnecting via one connection.  PING will trigger again when connection reconnected, but previous PING will still ongoing.
ps: 3302 fix will reduce the possibility of reconnecting,  but whenever reconnecting happen, duplication ping will happen.
Expected behavior
Redis PING performed one time per interval per connection
Actual behavior
Redis PING performed mutiple times per interval per connection when this connection got reconnected


3413
Error default codec in Chinese wiki document

The Chinese wiki mentions that the default codec is JsonJacksonCodec, but in fact the default codec is FstCodec,  please correct it, thank you


3414
about addandget API

when i want to use the addandget API,i found the number convert throw a ClassCastException.
the error is on third line
Can I use new BigDecimal(entry.getValue()) instead?


3415
add randomKeys() and randomEntries() methods to RMap object

No description provided.


3418
CPU spike after Slave failover if subscriptionMode=SLAVE

No description provided.


3419
internal RedissonBaseLock.evalWriteAsync() method isn't executed again if cluster slaves amount > 0

Expected behavior
Actual behavior
Steps to reproduce or test case
Redis version
Redisson version
Redisson configuration


3420
RedissonBaseLock can't be unlocked if exception got thrown from the same thread

RedissonBaseLock.java:312
opStatus is always null:
RedissonPromise.java:183  (status of netty's Future is canceled due to Exception thrown from the same thread)
I'm experience it permanently.
At a first glance (if i'm not mistaken) this is a Blocker  level issue.
RedissonPromise.java:187:
Same behavior if Exception got thrown too early, such that f.getNow() results null


3421
Ratomicdouble increases the number of decimal places




3422
RStream.claim fails with NPE if given id does not exist

In my scenario, I invoke RStream.claim(groupName, consumerName, idleTime, idleTimeUnit, ids)
where some ids may already be removed from a stream.
I would expect this method to claim and return whatever records exist.
Instead, it fails with NPE


3423
RMapCache to add an expire "by key" functionality

Is your feature request related to a problem? Please describe.
Trying to implement a sliding-expiration..........in a performant manner.
the specific request is for RMapCache to add an expire "by key" functionality
Current "expire" (below) does not have a "by-key" parameter.
Describe the solution you'd like
Consider adding "expire by KEY" functionality to
We're doing this to get "sliding expiration" to work.
Other Project FYI's:
Lettuce and Jedis have this "expire by key" functionality.


3424
Cache entries loaded by cache loader are not expired even if TTL is specified

Expected behavior
Cache should respect configured TTL no matter how entry was put in it.
Actual behavior
For now if cache loader is configured RedissonMap puts loaded entries into cache ignoring specified TTL.
Steps to reproduce or test case
Create map cache with some TTL and cache loader, let loader to provide value for some key, wait for TTL and then try to get value from cache again - cache loader won't be used.


3425
Failed to cancel scheduled tasks and blocked threads

Expected behavior
Normal mission cancellation
Actual behavior
Failed to cancel the task and blocked the thread
Steps to reproduce or test case
When canceling a timed task, if the task is running, there is a chance that the task will not be canceled. If we use synchronous method to cancel the task, it will cause the current thread to block permanently, and the actual analysis shows that it will be in the scheduleCheck method.


3426
Will the next version of redisson plan to update netty to the latest version?

Hi mrniko,
When will redisson 3.15.1 be released? Will you update netty to the latest version?


3427
Redisson as L2 Hibernate cache in Spring-boot app in CloudFoundry

We are developing a micro-service in spring-boot, which would be deployed in cloud foundry , we want to use redisson as l2 hibernate cache, problem is RedissonRegionFactory expects Config from redisson.json/yaml file,  and
we cannot have file in class path, is it possible read credential from vcap services ? or make redisson-hibernate spring compatible so that we can inject properties to RedissonRegionFactory.
we planning to use redisson as regular cache as well hibernernate l2 cache, please let me know is redisson is suitable for my use-case.
i tried extending the class RedissonRegionFactory and overrite createRedissonClient method to inject vcap peroperties in Config object but before spring creates beans hibernate trying to instantiate RedissonRegionFactory (i could be wrong).


3428
If the object has "score" field, the "score" is discarded when it is serialized

Redisson configuration singleServerConfig <org.redisson.codec.JsonJacksonCodec>


3429
FairLock released if `lockWatchdogTimeout` is set to 100 millis

I encountered a strange behavior when lockWatchdogTimeout is set to 100 millis (I didn't test to see what exact value it starts behaving abnormally). Lock is released even if the locking thread still alive.
Any value higher than this, lock is kept as long as thread is alive.
Redisson version:3.15.0
I create lock in the standard way, nothing special.
I have a test where I acquire fairLock instance, and perform locking.
I have something like this:
If lockWatchdogTimeout=100 then this test fail constantly. But if the value is set to lockWatchdogTimeout=150 then the test passes successfully.
Even if I set Thread.sleep(5000); (5 seconds keeping the lock) the test still passes.
Why when this configuration value set to 100, Redisson releases the lock?
I'm not sure if it is a bug, but I couldn't find any documentation regarding minimum value of this config param. The default is 30 seconds and maximum is 60. But no mention of maybe it has minimum allowed in means of amount  and TimeUnit value.


3430
error in simple for loop: Command still hasn't been written into connection! Avoid to use blocking commands in Async/JavaRx/Reactive handlers.

when i use this procedure:
it will print:


3431
Chinese wiki has a wrong yml setting at 2.6.2.

Expected behavior
transportMode: "NIO"
Actual behavior
"transportMode":"NIO"
Steps to reproduce or test case
just edit Chinese wiki at  2.6.2


3432
looping message

Expected behavior
push delete by redis and i have one success
Actual behavior
i have looping push
Steps to reproduce or test case
i offer in pushQueue and when i take it i have not looping
Redisson version
3.10.
Hi, help me please
i have RDelayedQueue and RBlockingQueue, sometimes i have looping
sorry, my english is bad


3433
How to handle Avro schema change in Redisson

I am using avro schema. Which looks like below.
Using various codecs available in redisson, I am storing the above object.
Now If I make a change in the schema(adding a new field), I am getting a deserialization exception, while retrieving old object back.
I have tried using AvroJacksonCodec, SerializationCodec, MarshallingCodec.
I have read that using kryoCodec it is possible. But could not find any working demo.
JsonJacksonCodec has some issues with org.apache.avro.util.Utf8. So that is also not helping in schema evolution.


3434
Fix reliable word in the redisson.org front page

It's misspelled: relable
Not a good work do misspell


3435
confused in container use

I am using redission 3.13.4 in k8s with cluster mode in 3 master 3 slave. I meet some problem when i delete redis pod one by one manually to simulate k8s node shutdown, after the redis pods reruning on other node, still have
some errors happened and never recover until i restart the business client pod where redisson in.
one like bellow:
It seems connecting to an old server ip.
hope to get your help


3436
Deserialization issue with Kryo5Codec post schema change.

No description provided.


3437
looping useClusterServers

Expected behavior
push delete by redis and i have one success
Actual behavior
i have looping push
Steps to reproduce or test case
i offer in pushQueue and when i take it i have not looping
sometimes i have looping when pushQueue.take() - message delete
but then i have i, why i have looping
this bug i have not rarely


3439
How to add MapEntryListener to RMapCacheRX?

I thought the xxxRx and xxx datastructures were equivalent in terms of functionality. I use a RMapCacheRx in my application and want to be notified on Entry expiration of the entries in that RMapCacheRx. With a regular RMapCache there is an addListener(listener: MapEntryListener) method, however on the RMapCacheRx there is only addListener(listener: ObjectListener) which only notifies me when the RMapCacheRx itself expires.
I tried making a non-rx client and getting the RMapCache with the same name to add the listener but then I get these errrors:
I use Redisson 3.13.6 (last version with RxJava 2 support) and Redis 6.0.8
Can anyone help me?


3440
org.redisson.client.RedisTimeoutException: Command still hasn't been written into connection! and currentCommand=null

Redisson Version - 3.13.0
We are noticing following exceptions in our logs and then thread just get hung post that:
PS - masked the complete addr.
We are using RLock's following implementation to acquire the lock:
The config we are using is default config
Trying to understand what is causing this? Especially what does it mean - currentCommand=null


3441
RScheduledExecutorService's  WorkerOptions.workers() doesn't work

and i found it will consume 16 thread once instead of 5


3442
slaveConnectionPool can't reconnect in sentinel model

Expected behavior
Actual behavior
use chaosblade to inject network delay in to redis port,keep delay time more than failedSlaveCheckInterval,
when netword delay finish, slaveConnectionPool not reconnect to redis slave node, slaveConnectionPool's all ClientConnectionsEntry in to RECONNECT status and keep throw exception:
it's a bug?or i can set any config to fix it?


3443
How can i disable Reddison auto configuration ? There is a test environment where we dont want redis.

Spring boot app does not start as we dont have cache in test env.


3444
RateLimiter error during unpack on redisson 3.15.0 - bad argument #2 to 'unpack' (string expected, got nil)

Expected behavior
No error when trying to acquire a RRLimiter lock.  Error seen when multiple threads from one application try to acquire a lock from a 3 member redis cluster.
Actual behavior
Intermittent error seen,
I believe this internal script's function is the source of the problem:
I am not so sure why v would be nil.
Steps to reproduce or test case
Not easily reproducible as of yet.
3 member redis cluster with sentinel for HA, running in kubernetes 1.20.2


3445
Simplify RGeo API

Introduce new methods with ability to specify chained arguments:


3446
Add count with any for search in RGeo

No description provided.


3447
Add ability to search in box for RGeo

Usage examples:


3448
Command still hasn't been written into connection

We started receiving the following error multiple times:
We do not use the async API. We got the same error for successive commands.
Isn't this API blocking and how can we avoid such exceptions?


3449
RMap put method return null

version:3.15.0


3450
Command still hasn't been written into connection! Avoid to use blocking commands in Async/JavaRx/Reactive handlers. Try to increase nettyThreads setting.

Exception:
Caused By these codes:
Redisson Version: 3.15.0. And I don't think it occurred in previous version


3451
failedAttempts cannot be set zero

Expected behavior
if failed no Attempts
Actual behavior
create redis connect error.
when I read code I found maybe problem appear at org.redisson.connection.pool.ConnectionPool#tryAcquireConnection method.
this compare statement  entry.getFailedAttempts() < config.getFailedAttempts() is always true , so connect cannot create success.


3452
Does RSetCache support EntryExpiredListener

RMapCache has eviction feature which can expire entries and has EntryExpiredListener to handle the expired entries.
RSetCache also has eviction feature to expires entries but don't have such a listener to handle the expired entries.
Is there any plan to support it or any difficulty to implement it?


3453
3.15.1 sentinel execute auth error

update to 3.15.1, run in sentinel model,throw
i trace the code,find in MasterSlaveConnectionManager.connectToNode() will createClient(NodeType.MASTER)
but in 3.14.1, MasterSlaveConnectionManager.connectToNode() method called by SentinelConnectionManager.checkState,will pass a RedisClient by createClient(NodeType.SENTINEL)
i think it's a bug


3454
redisson config lead to The remote host forced an existing connection to close.

Expected behavior
Actual behavior
After a few minutes of redis operation, the following problems will appear:
The remote host forced an existing connection to close.
Steps to reproduce or test case
Redis version


3456
Add MINID trimming strategy and LIMIT argument to RStream.add() method

No description provided.


3457
RStream.getInfo() method doesn't decode entries

No description provided.


3458
Add MINID trimming strategy and LIMIT argument to RStream.trim() method

No description provided.


3459
How Redisson's DelayQueue offer same element as one element?

As far as I know, Redisson implements delayQueue through zset and list,zset will not add repeatedly for the same member
how can i tell redisson they are same member
Thank you for help me!


3460
Redisson does not reconnect after failed DNS Monitor change

Editing and repurposing this issue after finding the underlying cause. Originally this issue was to improve the error messaging. The underlying problem is a failure to reconnect after a failed DNS change. After this scenario plays out, there are no connections in the pool, and the error message we end up seeing is an ArrayIndexOutOfBoundsException
Expected behavior
Reconnection to redis node
Actual behavior
after DNS monitor detects a change to an ip it cant reach, subsequent dns change to a good ip does not restore connections.
Steps to reproduce or test case
connect to a single redis master node
add a host file entry for some bogus ip address,
watch redis connection failures
remove the bogus host file entry, so that DNS monitor gets the good ip address again
re connection does not happen


3461
Can we set a local cache size for RSetMultimapCache?

Is there a way to set an upper limit on the number of elements that are kept in the local cache?  I don't see a way to do this and our TTLs are very long.  I don't see a way to clear the local cache ourselves either.  Containers like RLocalCachedMap have clearLocalCache(), but RSetMultimapCache does not.
Thanks!


3462
Is there a simple way to change node address dynamically?

I try to use redisson(3.7.0) as my redis cluster client, and I need to change the connection address of redisson dynamically, in Spring environment, is there a simple way to do that? Does it need to consider the instance with old connection's recycle?
I tried to get the redisson instance directly and update the node information of its config like:
but it failed(it could work sometimes).


3463
none




3464
none




3465
CommandDecoder:181 - Unable to decode data. channel: Unsupported protocol version 0

I am trying to store a basic POJO called MobileNotificationDTO inside an RMap<Long,MobileNotificationDTO> using MarshallingCodec
Writing an integration test, it is failing to retrieve the POJO from the map
Any ideas how to fix this issue? I have tried JsonMarshallingCode and StringCodec but still the same error


3467
Fallback failing for Hibernate-5.2 - nextTimestamp() doesn't have a try-catch

Expected behavior
With an application server up and using redis, and hibernate.cache.redisson.fallback=true, I should be able to kill redis, and continue to use my application server.
Actual behavior
Hibernate+Redisson becomes unusable as soon as redis becomes unavailable - with failures coming from the nextTimestamp method in BaseRegion RedissonRegionFactory.
Steps to reproduce or test case
Configure hibernate L2 cache with redisson.
start application server with redis online
stop redis
try to use application (hibernate calls) - get errors.


3468
Can you create a linked list of live objects within a live object?

I have a live object that holds a linked list that holds items from another live object. I am able to push the parent live object to the redis live object service just fine. When I retrieve the parent object, the linked list is null. If I insert a string, it works just fine, but with my child live object it always returns null. See below:
The variables and ID's sets removed for readability.
The myObject will hold the ParentObject with the null linked list, this list is not null when sending to redis service. Also when I substitute the object type of the linkedList to String and not ChildObject, this works just fine and the list is not null. Its the nesting of the RLO within the RLO that is killing me. Any thoughts? Thanks for your time!


3469
What's the reason for using a single pub/sub topic in tomcat RedissonSessionManager?

Hi,
We are currently using Redisson 3.13.6 for session management of a java web application deployed in tomcat 7 and sessions stored in ElastiCache.
RedissonSessionManager is configured with readMode=MEMORY and updateMode=AFTER_REQUEST (due to the way the app is implemented this is the only configuration working for us).
We noticed high network outbound traffic on a single ElastiCache node, followed by CLUSTERDOWN errors because of bandwidth throttling.
I checked the implementation and found that RedissonSessionManager is implemented to use a single topic for pub/sub communication
Is there a reason for using a single topic?
Is it ok to update the implementation to create multiple topics, and use a balancer when accessing them from  RedissonSession?
I understand that the Redis slot is computed based on the topic name, so choosing the name for the topics in such a way that they will end up on different nodes is not that straightforward, but I am interested if there is another reason this approach might not work.
Thanks,
Ilie
P.S. The quick fix was to upgrade the ElastiCache node type to accommodate the traffic, but it's not ideal because of the price of the new instances and because the nodes not handling the pub/sub topic are not using these resources.


3471
Simplify read() and readGroup() methods of RStream object

Is your feature request related to a problem? Please describe.
Describe the solution you'd like
Describe alternatives you've considered


3472
upgrade spring boot version to 2.4.3 to make our projects support spring-native 0.9 beta

spring-native released a beta version, support spring boot 2.4.3, so our company plans to use it, so hope the next version of redisson boot starter upgrade to the spring boot version.


3473
none




3474
Why redisson lock implements use WAIT command

I am using redisson lock in my project, but the redis cluster i use in product env forbidden to use WAIT command, so the redisson lock alway ends up to and RedisException with message " wait command not found", I try every lock implements in redisson, all the same, so what should i do to fix this ? change anothe redis or write a lock by myselft ?


3475
what is the minimum version for "jackson-core" required for redisson 3.14.0

what is the minimum version for "jackson-core" required for redisson 3.14.0


3476
Caused by: java.lang.ClassNotFoundException: com.fasterxml.jackson.core.TSFBuilder

keep getting this error when i try this
Config.fromYAML(PropertiesUtil.getResourceAsFile(REDISSON_RESOURCE_NAME));
the exception is
when I try to look at the code can't find usage for TSFBuilder at class ConfigSupport


3477
Enable tcpNoDelay setting by default

No description provided.


3479
RedisTimeoutException : Command still hasn't been written into connection! Increase nettyThreads and/or retryInterval settings

Redisson version: 3.13.0
This problem will appear after every downgrade of redis cluster. Restarting the application can solve this problem at present.
However, how to solve the problem thoroughly?
More information :
2.Examples redisson.yaml


3480
References in RxJava objects aren't supported

No description provided.


3483
java.util.ServiceConfigurationError: org.jboss.marshalling.ProviderDescriptor: Error reading configuration file

hello, I spent my day trying to debug but I didn't succeed, do you have an idea?


3484
There may be concurrency problems in org.redisson.RedissonLock#tryLockInnerAsync

if two thread get the same lock subject and run the method at same time, one's leaseTime is -1, and another's leaseTime is bigger than 30, the "-1" thread first cam in and set internalLockLeaseTime, then another thread came in set the internalLockLeaseTime bigger than 30, then if the bigger leaseTime one get the real redis lock! It while cause watchDog invaild and the lock be expired ahead of time.


3485
Abnormal behaviour in redis mapwriter execution

We have used write behind mode in mapoption,
my code written in write method is executing fine but after some time
i have observed that i am getting "org.redisson.client.RedisOutOfMemoryException" exception after that my write method of mapwriter is not getting called,
can yo please help me out in these.
Also observed that after getting any throwable error in write method same behaviour is getting replicate.


3486
ERROR org.redisson.connection.DNSMonitor 112 - Unable to resolve redis.address

Expected behavior
Do not print such logs
Actual behavior


3491
none




3492
with service cluster,a machine have held the lock,another machine will unlock successfully?

the method 'tryAcquireAsync' of RedissonLock class,use current thread IDas redis value.
if two machine have same thread ID,a machine have held the lock,another machine will unlock successfully?
RedissonLock class can use a map to store current application have own Lock,if service reentrant or unlock,
verify that it have the lock before.


3493
Transaction in Redis Live Object Service

Hi,
Is it possible to perform transaction on Redis Live Object?
I want write a new instance of MyClass - only if new instance is newer than previous one.
I need method similar to 'merge' in RMap.
So I need to compare dates of old and new objects and then save new object only if it newer. It has be executed in one transaction. In other thread someone can update fields in this object.


3494
RetryInterval and "Client Pause" command

I thought of reporting a behavior I see during testing.
If I break connectivity to Redis, retryInterval works as expected, but if I use the CLIENT PAUSE, then
all retries are done at the same time. retryInterval  is not respected.
I don't really use CLIENT PAUSE. I was just trying to simulate latency and noticed this. I reported in case this behavior can impact other/real scenarios


3495
Add RedissonClient.reactive() and RedissonClient.rxJava() methods

No description provided.


3496
Add MOVE command support for queue

No description provided.


3497
MacOSDnsServerAddressStreamProvider

Why i have this warning?
and how this dependency help me?
i want to know why i need it??
question


3498
if there are more than 2 servers using redisson , when session invalidate method called one of server does not know that session is invalidated, because JSESSION ID is still on the cookie in user's browser.

Expected behavior
session invalidated is applied to all servers.
when readMode="REDIS" session always should get from redis directly
Actual behavior
if there are more than 2 servers using redisson , when session invalidate method called one of server does not know that session is invalidated, because JSESSION ID is still on the cookie in user's browser.
Steps to reproduce or test case
setting redis configuration below.
make jsp file and prodcess login, logout, print session value.
load balance is infront of tomcat


3499
ClassLoader issues when using Redisson Transactions with asynchronously acquired RedissonClient

Expected behavior
When using an asynchronously acquired RedissonClient (via. CompletableFuture.supplyAsync) with transactions I expect the class loader used to be correct.
Some constraints to narrow the scope of the problem:
I only encountered this when using Redisson Transactions.
If the client was acquired in a synchronous way, I did not see this behavior.
Actual behavior
Similar to #2984 I am seeing that on the first request to my WAR on a web server, the correct class loader is used.
But then on subsequent requests, it is using the URLClassPath loader what I assume to be the default for Jetty.
After this breaks, I get consistent ClassNotFound errors.
Steps to reproduce or test case
I created a minimal jetty project here in an effort to reproduce the code we are running.
In words, my steps were as follows:
Create a Jetty Server running 9.4.30.v20200611, and deploy a WAR on it. Place objects into Redis, using transactions, and try to retrieve them. After the first request succeeds, observe ClassNotFound issues when trying to retrieve other objects. The stack trace can be found in a gist.


3500
[IS A BUG?] RedissonReadLock#tryLockInnerAsync

is this a bug ? when read lock try lock but write lock is held


3501
Redisson 3.15.1 seems to try to authenticate on the Sentinel instance while no sentinelPassword is provided

Expected behavior
Redisson should not try to authenticate against a password-less Sentinel instance.
Actual behavior
Redisson seems to send an AUTH instruction to the Sentinel instance, resulting in the following stacktrace repeating endlessly. However, the client seems to be successful at performing various operations on the Redis cluster (get/set).
Steps to reproduce or test case


3502
LEAK: ByteBuf.release() was not called before it's garbage-collected.

Redisson 3.5.1
I am debugging why we are seeing ByteBuf leaks and native memory problems.
I suspect one reason could be serialization failing for some objects.
I created a simple test to run this code in a loop
The code triggers: java.lang.IllegalArgumentException: java.io.NotSerializableException: java.util.logging.Logger
and looks like MarshallingCodec. Encoder.encode doesn't clean the ByteBuf  if there is an exception - and I
don't see a way to do it myself.
I enabled -Dio.netty.leakDetectionLevel=paranoid to get this output:
Recent access records:
If I can't get the native memory issues sorted out, I need to see if this can help:


3503
ClassNotFoundException when using ServiceLoader

Hey, while writing plugins for BungeeCord proxy I ran into a problem with ClassLoader.  Plugins use the redisson library to create the network It works like this:
BungeeCord loads available plugins
One of the plugins contains the redisson library and connects to redis
Another plugin use the previously loaded plugin with the library to synchronize the objects
All plugins are loaded using the same ClassLoader, so the same ClassLoader also loads the redisson library, and knows about classes that we serialize and keep in redis. Unfortunately the plugin that is loaded in step 3 throws a error like:
So I wrote small ServiceLoader application to reproduce that issue.
Steps to reproduce or test case
redis-cli config set notify-keyspace-events KEA
or manually
mvn clean install


3504
[Wiki] The default value of masterConnectionPoolSize in cluster settings is wrong

Actually, the default value of  masterConnectionPoolSize in cluster setting is 64, but got 24.


3509
Redisson with AWS IRSA

How can I create redisson client with AWS role based authentication ?
I have used it with redis auth so far but don’t know if I can create redisson if I want to use role based auth.


3510
task level taskRetryInterval and taskTimeout

For now, taskRetryInterval config in ExecutorOptions, and taskTimeout config in WorkerOptions.
I need like this:
RScheduledExecutorService.schedule(jobRunnable, CronSchedule.of(jobConfig.getExpression()), timeout, retryInterval)


3511
Old value is not available in cache entry update event

Before I submit a bug report on this, I wanted to check if maybe I'm doing something wrong.
I'm expecting to get a non-null value from getOldValue on CacheEntryEvent, when event type is UPDATED. I have set isOldValueRequired to true in the listener configuration.
Is there anything else I need to do to get this to work?
I just upgraded to Redisson 3.15.1.


3512
none




3513
can redisson lock accross apps written by different language?

can redisson lock accross apps written by different language like golang, python?


3514
Fixed rate schedules stops after some time

Hello,
We're using executor service with fixed rate schedules, but the schedules stops after some time.
I've reproduced the issue in a small standalone project.


3515
RScheduledExecutorService.scheduleAtFixedRate() starts multiple instances of the same task if multiple workers defined

No description provided.


3516
MaxIdleTime on Redis Live Object

Hi,
Is it possible to set maxIdleTime on Live Object in Redisson?
If not, is there another option to delete unused objects?


3517
Redis 6.X : Required ACLs

Hello !
What are the minimal required ACLs tu use redisson and the org.redisson.spring.cache.RedissonCache in particular.
I haven't found any documentation about this.
Moreover, I have activated "useScriptCache" option.
Thank you


3518
Redisson 3.15.1 and 3.15.2 never release connection on redis server (replicated server configuration)

Expected behavior
we have switched from redisson 3.15.0 to 3.15.1, and we were hit by a crazy increase of connection on our redis nodes.
our application idle at 77 connection to our redis nodes (basic replicatedserverconfig with three rediss node in aws elasticache).
our fleet of container generate total number of connexion between 200 to 500 depending on autoscaling.
Actual behavior
Today behavior with 3.15.1 and 3.15.2 is a crazy number of connexion, redisson never releasing the connexions,
eating all the connexions in our container (creating mess with tomcat), and generating 20k to 60k connexions on
our redis nodes.
Steps to reproduce or test case
Switching redisson version
redisson is used for spring boot cache mostly, a very simple lua script is also used for leader election.


3519
addLastIfExistsAsync API in RedissonDeque appending absurd value to the list in redis

Expected behavior
This should append a json string value to the already existing redis list with json strings. The key was created with StringCodec.INSTANCE.
Some absurd value is being appended to the list. No error logs seen regarding command timeout or anything like that.
Steps to reproduce or test case


3520
DelayQueue not working when key exist in redis




3521
if a thread fetched a lock and throws exception, should redisson cancel the renew task?

I wrote a test case like this:
and here is the result
Thread crashed and renew task is still going on.
I think it's necessary to check thread when renewing.
any idea? :)


3522
ConnectionListener.onConnect() method isn't triggered during Redisson start

Use method Config.setConnectionListener() for listener registration.


3525
ReactiveBatch commands are not executed

Expected behavior
Batch response include result of two operations:
Batch response include result only for  batch.getBucket("bucketKey").isExists(); operation. During debugging i see that
executeAsync() method of CommandBatchService have only one command.


3526
RedissonRateLimiter tryAcquire and availablePermits throw RedisException: too many results to unpack

Expected behavior
method call should return without exception
Actual behavior
A RedisException is thrown:
Steps to reproduce or test case
Add more than 8k entries to rate limiter.
Wait for all of them to expire.


3527
Any alternative solution to create a SQL table structure in Redis using Redisson in java app.

Any alternative solution to create a SQL table structure in Redis using Redisson in java app. For example a table of say Products.
The standard flow would be to instantiate a RMapCache and add the products to that - something like this
and this in Redis would result in something like this
hscan "ProductTable" 0
1) "0"
While this solves the immediate problem, 2 or 3 questions arise
when doing the get command - prodRet = prodMap.get("Prod101"); - does Redis need to do a 2 step lookup - first to find the "ProductTable" and then to find the prod key within that ? is this not expensive?
in a Redis cluster environment the whole "ProductTable" will end up in 1 SLOT in 1 node. So whats the use of sharding across cluster ? Yes there may be other tables that may go to other nodes but no guarantees.
If someone has a better solution or better insight into this can you please share. Or am i missing something here?
appreciate your help...


3528
Exrta bytes in the value are missing when saved using local cache mode (getLocalMapedCache)

This is a very simple java program using Redisson adding products to a productTableCache
When i look from redis-cli , i see these extra bytes added to the product value in redis - what are these additional bytes ?
Now if i insert another product using Redisson getLocalMapedCache i dont see these additional bytes
But now if i refer to LocalProd102 in an EVALSHA script , it gives exception possibly because the additional bytes are not found.
Any help or prior experience in this regards ?


3529
RScheduledExecutorService

when I use it in Distribute Schedule, Runnable method  depencies on spring context(i.e @Service UserService.class and @Mapper UserMapper.class include more indirection depencies ) each other must implemnts Serializable ,This way is unfriendly,so I suggest ...


3530
Quarkus integration distributed cache

There isn't any standard way or sample to basic Redisson with Quarkus Integration!
I actually, looking to find a way to handle distributed cache with Redisson. Could you please inform me in this way?


3532
How to configure Reddisson to connect with TLS1.3?

I'm trying to configure the Reddisson client to connect over TLS1.3. Has anyone had success with this? I've been setting the ssl* configuration parameters with the correct keystore file and sslProvider but I keep getting handshake failures.


3533
pollFirst & pollLast in RSortedSet are missing

No description provided.


3534
Problem with deserialization using redisson as second level cache in hibernate

I using:
deserialization should work with org.redisson.codec.Kryo5Codec too.
Actual behavior
Loading entity causing an error:
Steps to reproduce or test case
Use Hibernate with redisson second level cache and load an entity with a READ_WRITE as strategy.
NOTE: If it is not a redisson error, where should I create an issue?


3535
`RScript.evalShaAsync` prepends additional characters to the first argument. seems to be related to the default `Codec`.

Set up:
where:
sha is the hash of a loaded script (via SCRIPT LOAD) command.
key is an alphanumeric string. e.g. "123456789"
expirationSeconds is 3600
elements is a single alphanumeric string. e.g. "foobar1234"
the loaded Lua script contains the following lines:
if not tonumber(ARGV[1]) then
end
in order to parse the expiration.
Expected behavior
the if check in LUA script should not trigger an error.
Actual behavior
script returned error and from the error message ARGV[1] is set to > 3600 with possible whitespace characters (stripped from console output)
Steps to reproduce or test case
load a script (statically or programmatically) contains the argument parse lines above
invoke the method above
observe the application output
Note on the script:
the same script (without modification) worked with lettuce-core in the same application in a production environment (with thousands of calls per minute running 24/7) and has been proven stable.
for some reason the arguments received on Redis server (from redisson) contains extra characters for the first argument.
Update
I tested a non-default Codec:
and the issue is addressed. Not sure if this is expected behavior for the default Codec


3536
Caused by: java.lang.NullPointerException

Hi Team,
while we are using Redisson 2.15.1.
Java 1.7.80
With 3 redis clusters and 3 application instances


3537
Object lost due to TTL

We are trying the below approach to get the data from Redis with TTL.
Now list.size == 0 and my application failing due to this since the object fetched in removed from memory.
Please any approach to mitigate this issue.


3538
Handling of shard being down in a Redis cluster

Hi
Does Redisson has any logic for intelligently handling a scenario where a particular shard is down in Redis. Possible 'intelligent' solutions could be to-
Avoid calling Redis cluster for keys located over that shard
Not keep retrying for keys which are continuously failing
All these solutions may enable it to keep serving the traffic for which ever keys it can from other shards.
This is possible only with some built in knowledge of key distribution across shards, I am not aware if redisson has that context ?
Thanks!


3539
Collection RLocalCachedMap thread safe question

hi,im use redisson collection ,and this is my code
t6 put kv to localCachedMap,
then concurrent requests t5, found   duplicate records


3540
Not support BITFIELD friendly

example:
can I use redisson client to execute command like this?


3541
Redisson AWS ElastiCache cluster discovery after re-sharding failing

We are using Redisson to connect to an AWS ElastiCache Redis cluster. We are seeing an elevated number of exceptions after we scale the cluster up or down and redistribute the slots.
Expected behavior
Redisson will pick up the new topology and slot distribution after the re-sharding is done.
Actual behavior
We are seeing these exceptions:
The exceptions persist for hours after the re-sharding is done. We don't see these exceptions if we restart our service.
Steps to reproduce or test case
Initialize Redisson client and connect to AWS ElastiCache cluster
Add or remove shards
Wait until cluster is in active state and slot redistribution is done
Try to read from the cluster
All other values are default


3542
java.lang.ClassCastException: java.lang.String cannot be cast to LiveObject

Expected behavior
not error
Actual behavior
Steps to reproduce or test case


3543
Redisson keeps doing connections initialized

We have a 3 node redis cluster and redis clients running as java servers.
on some redis clients we see Redisson continuously keeps doing connections initialized - sometimes for more than 2 min or so.
Same program is runing on other servers connected to the same redis cluster but there we dont see this issue.
What could be triggering this reconnections? Anything we need to change in the config ?
Below is the config passed to redisson
appreciate any help.


3544
Why ExpirationEntry use LinkedHashMap to save threadId

Reddison watchDog strategy use timerTask to increase key expiration time while set the lock success
First use entryName to get ExpirationEntry object. For the same entryName, other threads can't get the key because locked(ps: same thread can get and counter++),so why use LinkedHashMap to save thread if there only have one thread?


3545
org.redisson.client.WriteRedisConnectionException

Some time getting following exception in unit tests but not always
Caused by: io.netty.channel.StacklessClosedChannelException


3546
Object not added in RSet

In the below code, we are facing intermittent issues where System.out.println("Your Ids: "+ids1) is not printed when we add something and RedissionSet reference doesn't contain anything even after adding objects to it.
Are we doing anything wrong? Any help will be appreciated.


3547
org.redisson.client.RedisResponseTimeoutException

our server sometimes throw a exception ,the flow ,then the sytem is unavailable,how to solve this problem,thinks


3548
some time we see exception on DNSMonitor

hi,
we see some time following exception at the log , we don't know the reason for it


3549
Sync methods can't be invoked from async/rx/reactive listeners

I use both sync and reactive redisson clients in one project. Reactive one for business logic and sync one for third party library.
Calling sync client methods in reactive client map/subscription lambda/callback will throw the exception:
The exception is thrown by a method checks name of current thread starts with "redisson-netty"(introduced in version 3.15.1?). However, all reactive operator will run in the thread that named "redisson-netty-x" in downstream of reactive redisson client operation.
Steps to reproduce or test case


3551
An exception was thrown by org.

Expected behavior
Actual behavior
Steps to reproduce or test case


3552
exception in redisson decode

hi,
is following exception is also related to netty version or there is other problem , by the way wasn't happen to us before production :)


3553
Redisson and Azure Redis for Cache. Connection starvation

Hello
We're using Azure Redis for Cache which has Redis 4.0.14 under the hood with cluster configuration (number of master nodes is configurable, can be less than 3):
There is scheduled maintenance on Azure which doing the following:
Terminate all slave nodes
Pause 10 min
Terminate all master nodes and load balancer
We have multiple components connected to redis (9 instances) and all of them are not able to execute commands after redis outage.
While redis is out of service we see following exceptions (which is okay):
There is a timer (not redis-based) which every 10 secords extracts value for particular redis key.  When there are no more exceptions which looks like above, we have a lot following exceptions (as a result of GET command sent by the timer):
And in a few minutes after previous exceptions operation to extract value in timer fails all the time with a little bit another exception:
In the beginning we also observed following WARN which also may cause issues:
Expected behavior
Connections to redis successfully restored after outage
Actual behavior
Some redis connections have closed channel and associated to particular slots. Unable to execute redis commands
Steps to reproduce or test case
Terminate slaves/masters in redis cluster configuration multiple times. Check that in connection pool all channels are not closed when redis instances will be restored
Thank you for help


3555
Eviction for Entities Annotated with a Region that contains ":" caracter

My entities are annotated with Regions following Redis hierarchy, using colons:
How could I set the eviction times for these Entities, on our application.properties?
We try:
But none of them worked.
Replacing the region to string that is not colon delimiter, works as a charm.
Any advice?
Thanks!!


3556
Setting TTL on existing value

We have a use case whereby when we first create objects in our Redis Hashmap, we set a long TTL (e.g. 1 month) to ensure that the data will be cleared out at some point in the future.
However, in general this data is only required for a few days, and for optimization we would like to clear this data out sooner when possible. When our application is made aware that it is safe to clean up this data earlier, we would like to set a new TTL on the entries (e.g. 1 day).
Unfortunately, I can't see any way to alter the TTL on an existing entry (other than doing a read, followed by a write with the new TTL).
What I was looking for in the API was something similar to:
or even better, a method which accepts a batch of keys
Does anything like this already exist already in Redisson? (or is there some other workaround I can use?)


3557
How to work with shard?

in redis in action
They have API such as
does Redisson has similar API to help Shard automatically?
of course I can handle shard myself as


3558
Add RMapCache.getWithTTLOnly() method

No description provided.


3559
Why doesn't RTransaction support passing MapOptions when creating a new RMapCache?

When creating a MapCache object within a transaction, I noticed that the create methods don't support the passing of MapOptions to configure the instance.
When creating from the client itself, the option is there to pass options to the method.
Are the fields in the MapOptions object that are not needed in a transactional context? It looks like at least for RMapCache objects, the options field is null when it calls the superclass.


3560
Redisson indefinitely try to reconnect on old sentinel instance

We using redisson for our tomcat session cache in Kubernetes cluster. We have setup a sentinel cluster with 3 redis instance.
We have some issue when one of our redis pod changes. This can happen when maintaining a node. In this case the redis pod is recreated on another node but with a new IP.
For connect to sentinel we use a statefulset headless service.
Expected behavior
Redisson reconnect to the new redis node and stop communicating with the old pod
Actual behavior
Redisson reconnect to the new redis node BUT continue to try reconnect on old node indefinitely.
Steps to reproduce or test case
Setup redis sentinel cluster in Kubernetes (with statefulset). Our pod have 2 container, one for redis (port 6379), and one for is sentinel (port 26379).
Start tomcat pod with redisson config for session.


3561
ByteBuf LEAK in JCacheEventCodec

In #3511 I introduced a ByteBuf leak because the buffer copy is never released:
I can create a PR to fix this shortly.
"LEAK: ByteBuf.release() was not called before it's garbage-collected. See for more information.
Recent access records:


3563
Null pointer exception is thrown when performing action and redis server is down

Expected behavior:  Redisson Client should throw checked exception or return bool value when operation on RBucket can not be performed because server is down
Actual behavior When single server will be shut down during application work and some operation on RBucket will be performed, then NullPointer exception exception is thrown. Also redisson treats RBucket object as not null one.
An exception was thrown by org.redisson.misc.RedissonPromise$$Lambda$731/0x0000000840e3b040.operationComplete()
Steps to reproduce or test case
Turn on redis and redisson with single server mode
Save some value by using RBucket
Shut down redis server
Try to save / remove another value by using RedissonClient (by using RBucket)


3564
The expire method of RedissonReactiveKeyCommands could not work on  Sentinel mode.

Redis version 4.0.7
Redisson version redisson-spring-data-22:3.12.5
In ReactiveKeyCommands the method expire was defined as a write operation, but in the RedissonReactiveKeyCommands
the method expire was implement as a read operation.
When using the reactive redisson to work on Sentinel mode and executing expire command will cause the exception which tips that should not execute write command in a slave instance, because the RedisExecutor was set as readOnlyMode.
When RedisExecutor was set as readOnlyMode, the connectionManager will return a slave connection.


3565
How to print current open connections in redisson client?

I am trying to tune redisson client connection pool configuration and I am using cluster mode to connect to ElastiCache. I am trying to analyse what is current connections utilised and other connection pool details.
Can anyone please help me how to print the information?


3567
RMap compute implementation breaks Map contract.

Expected behavior
Remapping function result is written to redis and returned.
Actual behavior
Remapping function result is only returned, but not saved if object instance remains the same.
Steps to reproduce or test case
This snippet prints


3568
Broken connection detection

Using 3.15.4 and sentinel connections, when I set the config connection listener, i don't get a connect or disconnect when (all) nodes have failed (e.g. dropping the Redis traffic from firewall to simulate network issues).
When this happens, a .getBucket command is blocking and remains blocked no matter if the connection is restored or not
The config i'm using:
The question i have is how to figure out when the connection is broken ? What am i missing ?
Thanks


3569
Simple key value read and write example

Hi Team,
Can you share a sample on how to read/write a simple key value  using RedissonReactiveClient
key: String
value:  java object
Reactive way of writing and reading will be great help.


3570
none

[]


3571
infinty add slaves if cluster nodes are all same ip&port




3572
The best way to create Redisson client

Hey guys! We're using Redisson in our app and instantiating it as a Singleton. But faced some weird behavior when the Redis cluster was rebooted. We're calling the method RMap.getAll(Set<K> keys) and this time got incorrect data from Redis. Seems like some of the Redisson workers returned the requested data and other ones not.
Now we're trying to create the Redisson client for each request to avoid the mentioned issue. Is it a good idea or will be better to create it one time along with the application?


3573
Thread lock starvation with RSemaphore on high concurrency with hundreds of locks

We (@cstamas and me) are currently trying to integrate Redisson into Apache Maven Resolver. The purpose is to synchronize access to the Maven local repository across multiple processes. In our tests we experience a constant thread stravation where a write lock cannot be obtained in time, but tens of other threads are given access with RSemaphore. I assumed that we are having the same problem as in #1763, but the fiddling with config options did not work out. The lock is a hot path in dependency resolution.
The amount of locks is around 500 accessed by around 100 Maven modules from 48 threads (T4C on a 12-core Xeon processor).
Here is a sample condensed overview of semaphore permit acquisition and release:
I can provide full debug output, actual source code (see PR), pre-compiled Maven distro and the sample project which almost always fails for me. Help would be very appreciated because I am at my wit's end.
Note: The following lock types work flawlessly with the same project: rwlock-redisson (RReadWriteLock), semaphore-local (Semaphore) and rwlock-local (ReentrantReadWriteLock).


3574
Redisson Java Client-RedisCluster-YAML config-RedisNodeNotFoundException

Good morning:
I have been working in the implementation of a Redisson client to connect a Java application to Redis cluster defined by a YAML config file (loaded from the Config class) and by using RBucket as a class to put and get key-value pairs.
The connection is primary established by calling Redisson.create(config) method. Sometimes, even if a master is up after an outage, a RedisNodeNotFoundException exception happen saying that we need to increase the value of retryAttempts and/or retryInterval settings.
I really appreciate if you can give me some advices, recommendations about some configuration fields I could have missed, or something about the uses of RBucket or Redisson.create method in order to make it more resilient and to solve that issue.
Thank you so much in advance.


3575
none




3576
RBatch - remove async from map not working.

Hi,
I am trying to execute few commands on several maps as part of an rbatch.
There are both putAllAsync commands and removeAsync commands.
All the put commands works fine but it seems that nothing is getting deleted.
The key type for each of the following maps is Long
These maps are of type RMapAsync ( and are part of the batch).
At the end of the batch I execute it using redisBatch.executeAsync()
Is there an issue with removing from a map and adding values to map in the same batch? Is there any other issue? How can I solve this?
Thanks.
It doesn't happen only in batch operations but also in calling fastRemoveAsync for RedissonLocalCachedMap


3577
none




3579
why can't i set expiration on RAtomicLong?

I'm using Redisson 3.15.3
In my attached example you see that i try to create (or get an existing) RAtomicLong with a given name and expiration. Everything works apart from the yellow marked line where i try to set the expiration. In this concrete case expiration is 15 and unit is TimeUnit.MINUTES. But the expire() call always returns false.
I'm wondering if i do something wrong or what might be common causes for expire to return false (so i could investigate those further)?


3580
Async lock thread affinity

Hi,
I'm working on a kotlin micronaut web app which is attempting to be fully async and we're using redisson for distributed locks.
I'm somewhat unclear on how to exactly use it correctly.
The official documentation says RLock object behaves according to the Java Lock specification. It means only lock owner thread can unlock it otherwise IllegalMonitorStateException would be thrown. Otherwise consider to use RSemaphore object. which sounds weird as in an async context, executing on a specific threads is never guaranteed.
The code I'm using for now, in a kotlin suspendable func, is like this:
The unlock line is not guaranteed to execute on the same thread as the lockAsync line.
Thanks!


3581
Memory leak in IdleConnectionWatcher

Hey,
I have a production environment which uses a load balancer over several master Redis instances, so the actual IPs of the Redis instances switch with every request.
I update Redisson from some 3.3.* version to 3.15.3 and started to notice odd memory consumption: something keeps piling up in the Old Generation and never gets garbage-collected. Normally, it would take about a day to reach Old Gen mem cap and in a few days, so when other objects make it to Old Gen, the app just dies with OOM.
I dumped the memory, it looks like when IPs change, new ClientConnectionsEntry items are allocated and attached the linked queue in the IdleConnectionWatcher which is never pruned, unless the client is shut down. I can't tell how many nodes are in those queues, probably too many, because IdleConnectionWatcher is about 30Mb big.
Unfortunately, I cannot change the infrastructure I use. Any chance there's any config that could just mitigate it for now?
Expected behavior
Application does not run out of memory if connection entries are re-created frequently and dangling objects are cleaned up.
Actual behavior
Strong references to previously created objects are retained and keep piling up until the app gets OOM-killed.
Steps to reproduce or test case
Tricky: Redis instances should be behind a load balancer, which should have a resolvable hostname. The idea is to make Redisson try to rebuild the connection pool every time it makes a request.
Redis version
Idk, because I don't have access to the infrastructure.


3582
none




3583
Netty ByteBuf leak, JsonJacksonCodec, batched write

We are seeing leaked Netty buffers like this quite frequently in production. In some deployments it causes out of memory errors on our container instances.
Seen both in Redisson 3.15.2 and 3.13.1. The codec is JsonJacksonCodec as you can see from the allocation call stack. So far I have only seen it with pipelined write operations (RBatch, in memory atomic). No other exceptions or errors during the write operation was seen.
My question is, is there something we should be doing differently to avoid such leaks, or is this a possible bug? Any hints on where to look would be helpful. I have not been able to create a local minimal repro to share unfortunately.
Recent access records:


3584
RedissonConnection#scan query results error in redis cluster

Hi, In our test case, we store three keys that start with  test  in redis cluster, two of which are in the same node, one in the other node, and then using  RedissonConnection#scan  method to query   test*. we can only query keys on a node, not all nodes.
Expected behavior
In Redis cluster mode,when we use RedissonConnection#scan to  get the keys with a pattern mode like (test*), we want to get the keys that can be matched by the pattern on all redis cluster nodes
Actual behavior
In Redis cluster mode,when we use RedissonConnection#scan to get the keys with a pattern mode like (test*) in redis instance,we can only get the keys matched by the pattern on a certain redis node
Steps to reproduce or test case


3585
ConnectionListener configuration

Good morning:
I hope you are doing well.
I would like to know which is the process or thread that is used by the ConnectionListener so that the RedissonClient reconnects to the Redis Server.
I mean we can get onConnect and onDisconnect events, but I would like to know how Redisson implements reconnection mechanisms so that the listener can trigger the onConnect event.
Could that mechanisms (process/thread) be configured by using the YAML config? Or have a behavioral properties set by default for all the implementations that use it?
I appreciate your attention and collaboration with the related details about this topic.


3586
Redisson scheduleWithFixedDelay job not running on the configured time

Background:
Redisson version: 3.15.0
Framework: Spring Boot
Redis instance type: Cluster mode ( Azure Cache Premium with 2 nodes )
I am using scheduleWithFixedDelay API of redisson to schedule two kinds of delayed jobs:
repeat every 2 mins with a initial delay of 5 mins and max execution count of 5 times
repeat every 2 mins with a initial delay of 15 mins and max execution count of 10 times
I have implemented the logic for the max execution count using RAtomicLong data type.
Issue
When I schedule using the executor.scheduleWithFixedDelay API, the job is not executed at the expected initial delay configured. To add some more context, I spawned multiple instances of both the delayed job types and NONE of them ran at the expected delay ( 5 mins or 15 mins). In fact, all of them ran the next day around the same time with a delay of ~8 hours from their initial creation time.
On the other hand, jobs that I schedule with executor.execute API are running fine without any issues immediately. The problem is happening only with scheduleWithFixedDelay API.
Below is some sample source code of roughly how the delayed jobs look like along with the redissonClient / redisson node creation code.
Highly appreciate any help with this :)
We felt these errors were causing the scheduleWithFixedDelay to not to work properly, so to fix these connection timeouts, we set the following params to the redisson client:
pingConnectionInterval: 10000
keepAlive: true
Post doing these configuration changes, we did not notice these timeouts for 2 days and the scheduleWithFixedDelay API did work as expected. However, we started receiving these timeouts after 2 days.
I wanted to know what is a right way to deal with this situation. Also, as mentioned before, this is ONLY happening for scheduleWithFixedDelay usecase and not the execute API. Why is this happening ONLY for the schedule API and not the execute API ?


3587
Redisson cluster cannot recover from "missing slot"

A test program is pushing a bunch of requests (evalSha for lock-free evaluation) repeatedly. Then bounced Redis Cluster in the middle of it. The connections were lost, then discovered within seconds, as expected. However, Redisson is stuck unable to recover from this condition:
Redis cluster state is fine:
Expected behavior
Eventually discover the hash slot is available.
Actual behavior
Retrying the same sequence of operations does not recover even after 5 minutes.
Steps to reproduce or test case
Start Redis cluster
Loop evalSha across all cluster nodes.
Bounce Redis cluster in the middle of the loop
Observe the failures
Observe that restarting the Redisson (bounce microservice in this case) recovers - so the issue is not in Redis cluster.


3589
While putting value into Rmap It throws io.netty.util.IllegalReferenceCountException: refCnt: 0

My application is a spring-boot application. Tried Running on both Tomcat and Undertow embedded server but the result is the same.
My SpringBoot version is 2.4.3 but have tried updating it to 2.4.2 and similarly 3.15.3 but the result is the same.
Exception Trace=


3590
Exception in EVALSHA when referring to hash saved using LocalCachedMap

If I use Redisson LocalCachedMap to save into Redis and then refer it using the LocalCachedMap it all works OK.
But If i refer to that same object saved using LocalCachedMap in a EVALSHA Lua script i get this exception given below.
If i just use RMapCache to save the object and refer it in the same EVALSHA Lua script it works OK - so this means the script has no issue.
The issue seems to be when the script has to unpack an object saved using LocalCachedMap.
What is the workaround / solution for this ?


3591
Tomcat 9 Redisson keeps hit Redis memory limit

Description
Hi team,
We're encountering an issue in production env that Redisson client keeps hit the maxmemory limit of Redis, we're using AWS Elasticache Redis with cluster mode disabled, have upgraded the node type from t2.small to cache.t3.medium, but it still too small.
We're wondering if it's an issue that others may also experience, are there any potential solutions for us to try?


3592
Duplicated section 6.12 in English documentation (wiki pages)

Expected behavior
There is only one section 6.12 RateLimiter in the English version of the documentation.
Actual behavior
Section 6.12 RateLimiter is duplicated in the English version of the documentation.
Steps to reproduce or test case


3593
When using distributed locks, why not use the JVM locks first to reduce the pressure of redis?

When using distributed locks, why not use the JVM locks first to reduce the pressure of redis?


3594
Setter detection in Jackson codec ·94 ·

We are using Jackson-based (de)serialization. Our DTOs are immutable and use Lombok's @Jacksonized @Builder (so no setters in those classes).
To our surprise, this does not work in all cases. When deserializing with a "pure" Jackson, everything works fine. But when using Redisson, Lombok's @Builder.Default breaks deserialization. In this case, the generated builder class does not have a matching field for the JSON property. For instance, a field String example in the DTO will result in two fields in the builder: String example$value and boolean example$set. None of them matches the JSON property example (serialized from the DTO). However, there is a matching setter method example(String), which is used by Jackson in that case.
After a bit of debugging, we found the reason why it works with Jackson directly, but not in Redisson: JsonJacksonCodec explicitly switches off the detection of setters, but only relies on fields (which is obviously not sufficient in this case). The solution is easy: We simply use our own codec that extends JsonJacksonCodec, switch on the setter detection and everything seems to work again.
However, the question remains: Why does Redisson explicitly deactivate the detection of setters (and getters, too)? Is there any drawback in allowing it, like we did?


3595
Connection pooling mechanism in redisson

HI Team,
I had a doubt regarding redisson connection pooling management.
I have an application with a high volume of traffic and hence get a lot of concurrent requests.
Have optimised my connection pool accordingly.But i have the following query
What if a new request arrives and all the connections are busy in case of unprecedented volume.
How does redisson handle such scenarios.Is there a connection request time out , post which it tries to create a new connection if pool is exhausted OR the request is rejected in absence of a connection in the pool .
regards,
AC


3596
Add broadcastSessionUpdates setting added to Tomcat Session Manager.

No description provided.


3597
none




3598
No usable error message when failure parsing redisson-jcache.yaml

@edburns was trying to get Open Liberty to persist http session cache data with Redis using redisson-jcache. Something that I (and the Open Liberty team) have not done before. He got the Open Liberty configuration setup correctly, but was getting an exception (see Actual Behaviour section). After much debugging we discovered it was because there was a typo in the yaml meaning there was an exception while parsing it. However the JCachingProvider.loadConfig method is just swallowing all exceptions that occur which means there was no error message anyone could use to determine what went wrong. I managed to track down the problem by inserting a printStackTrace into the IOException catch blocks, but I don't think that would be a PR that the Redisson team would wish to take.
Expected behavior
Useful error message like this:


3599
DelayedQueue Durability

Suppose the following scenario:
Application Start
BlockingQueue being read.
Item added to DelayedQueue to be executed after 30 seconds
Application Restarted, before these 30 seconds
I noticed that, without application restart, the items on the DelayedQueue will be executed correctly. But, if I restart the application after item added to DelayedQueue, but before its scheduled execution, it is not executed.
Is this the correct behavior? No durability to itens that are on DelayedQueue?


3600
How to delete element from org.redisson.connection.IdleConnectionWatcher#entries

It seems that 'entries' will always grow when DNSMonitor find dns was changed.
how to delete element?
since redis proxy was used in my app,the 'entries'  will grow infinitely along with dns changed.


3601
RTopic -ERR only (P)SUBSCRIBE / (P)UNSUBSCRIBE / QUIT allowed in this context

Did I use Rtopic incorrectly?
Code:


3602
The XGROUP_BOOLEAN attribute parameter of the xGroupDelConsumer method is set incorrectly

Redission 3.13.2
Redission-spring-data-22
The XGROUP_BOOLEAN parameter is wrong when the xGroupDelConsumer method of RedissonStreamCommands calls write.
I tried to modify the "XADD" of the XGROUP_BOOLEAN property to "XGROUP", and the test result was deleted successfully.
The following is the error log information before modification:


3603
String index out of range: -3

is my problem,iForgot to add port,
in RedisURI line 45,When rediss:// is configured, shouldn't it be https


3604
org.redisson.client.RedisTimeoutException: Unable to send command

In a production environment, we use the redis is cloud services, in the event of network jitter occurs after org. Redisson. Client. RedisTimeoutException, specific exception is as follows:
Once this exception occurs, even if the network is back to normal, this exception will not disappear, can only restart the service.Has anyone ever had this problem?What configuration can be used to solve this problem?


3605
@RObjectField annotation with codec option has no effect

Expected behavior
According to the brief documentation on the @RObjectField annotation I should be able to use this annotation on a field within a class annotated with @REntity to override the namespace and codec. For instance, in the below demo I'm using @RObjectField to override the serialization mechanism used to encode otherObject.
When I apply the @RObjectField annotation I expect the otherObject to be serialized using the JsonJacksonCodec. For instance, after I execute the following code:
I should see a Redis command in my MONITOR log that looks like this (note the JSON format):
Actual behavior
When I check out the logs of my Redis instance using MONITOR I see the following HSET command
With or without the @RObjectField annotation, the result is always the above. I've also tried different codecs to see if there's a problem with the codec, but I think the annotation is simply being ignored all together. If I move the codec specification to the @REntity annotation, I do see the correct result, but then the entire entity will be serialized using Jackson, which is not what I want.


3606
How to isolate MapListener to a single database

I have some code which adds a listener
which works great, apart from the fact that I'm getting notifications on events in databases i'm not using.  I.e., i'm using database 0, but I get events from database 1.
How can I isolate events to the database that i'm using.
thanks, Mitchell


3607
ExecutorService use getBucket(*).get()  time consuming

I had a problem in my production . When the request qps increase,it taked a long time for the function that getBucket(key).get() .
I used the function in JAVA ExecutorService.When redis key is not exists , it has time consuming.But when redis key is exists, it is ok.
Expected behavior
Taked a little time for getBucket(key).get()
Actual behavior
Once in a while, it taked a long time for getBucket(key).get() .
Steps to reproduce or test case


3608
use bitfield get StackOverFlowException

Expected behavior
return 13
Actual behavior


3609
RLocalCachedMap.containsKey doesn't fire loader

Expected behavior
containsKey looks for a key in local cache, then in redis, and, at last, invokes loader. If loader returns entry, put it in cache and report true.
Actual behavior
containsKey doesn't invoke loader at all and returns false for cold local cache/redis.
Steps to reproduce or test case
I have a map with loader, however for cold local cache and cold redis, this snipped produces different output
The first one is false if cache + redis is empty, loader is not invoked. The second call invokes loader and populates cache. Subsequent containsKey calls start to work after that.
Probably, other Map implementations contains this issue.
Single server, LocalCachedMapOptions.defaults() with loader.


3610
RDeque needs popRange()

RList already got its subList() method, but RDeque still could not pop multiple elements at one time.
This limits a lot RDeque's usage, and I have to use RList instead.
Redis realization[python]:


3611
spring boot application bootstrap:  java.util.ServiceConfigurationError: javax.cache.spi.CachingProvider: org.redisson.jcache.JCachingProvider Unable to get public no-arg constructor

Expected behavior
The program starts normally
Actual behavior
Steps to reproduce or test case


3612
Allow pipelining for native RedisClient

a native RedisClient "should" allow pipelining of a list of commands.
Currently that seems impossible to achieve (or is at least undocumented as far as i know)!


3613
can dependency on javax.cache be optional?

the pom.xml from org.redisson:redisson pulls in the caching API from javax. as we do not use this in our projects at all, can this one be made optional? or if not is an exclusion on our side safe?


3614
RLockReactive fail to unlock when subscribe to tryLock(Thread ID)

RLockReactive fail to unlock with RedissonShutdownException when un lock it at the end of the reactive sequence with doFinally() or with then() operators. When testing it with StepVerifier the unlock is complete sucessfully but fail with subscribe().
Example:


3615
AWS ElasticCache Redis(Cluster Mode Disabled) Cannot Find Redis Node After Failover

We are using Redission to connect AWS ElasticCache Redis(Cluster Mode Disabled), but we found exception below, even we upgraded to the version 3.15.1. And we don't see these exception unit we restart our service.
Exception:
Do I need to change the config to useReplicatedServer() or useSingleServer() also can support AWS ElasticCache Redis(Cluster Mode Disabled)
Thanks a lot!


3616
Clean up dependencies report

Using bb7b1b6 from master mvn dependency:tree reports multiple bad dependency management on redisson module:


3617
Make storeMode = LOCAL to fire loader

My application has caffeine local cache and I'd like to use redisson for this, just like normal distributed map. I've configured store mode and provided loader, however loader doesn't start.
I've looked into code and it looks like this option was never considered, so, probably not a bug, however I think, loader and store mode should be compatible with each other.
Describe the solution you'd like
Run loader and store result in local cache.
Describe alternatives you've considered
Dedicated caffeine instance


3618
RedissonClient.loadBucketValues() api is not find,How to use mget  ,version:3.12.5

No description provided.


3620
the wiki "11. Redis commands mapping", "CONFIG GET/SET" method is wrong




3621
RedissonNode starts with ClassNotFoundException

No description provided.


3622
redisson can not connection Redis Server

Expected behavior
redisson connection redis success
Actual behavior
redisson connection fail, but other redis client, connection success.
Steps to reproduce or test case
spring boot start
this is redis config log out , ip、port、password
this is spring boot run ,fail log
this is other redis client connection success.
redis server and springboot on one server ,
seek help.


3623
spring boot 2.5.0  with  redisson 3.15.5 Not compatible  :  zadd command will throw stackoverFlow error

use spring data redis's factory for redisTemplate  was ok
use redisson's factory for redisTemplate  was error
my test code is


3624
Need help with configurations while enabling SSL

I am using redisson-3.15.3.jar in my application and need to enable SSL. I have enabled SSL at redis with the help of this URL
It helped me generate two files: a .crt file and a .key file.
Now I need the configuration to send SSL encrypted calls to redis. I have tried the following but it didn't work:
CC: @mrniko


3625
Something odd in k8s

I am using redisson:3.13.2 as the redis client of springboot(2.2.9) project.
I build project as image and then run it locally. It works. But fail in k8s with the exception:
I wonder what is wrong?


3626
Will RLOS indexed based querying work in cluster enabled Redis?

When we use cluster enabled Redis like AWS EC, it's possible that objects gets stored on different shards. Will the indexed based querying still work here?


3627
org.redisson.RedissonSemaphore#drainPermits throws java.lang.ClassCastException

Due to bug in RedissonSemaphore#drainPermits implementation, the invocation of this methos throws ClassCastException.
The return type parameter of the method is Integer but the argument evalCommandType passed to the commandExecutor is RedisCommands.EVAL_LONG


3628
java.lang.NoSuchMethodError




3629
Trylock causes a deadlock,System restart can be unlocked

Expected behavior
Actual behavior
Steps to reproduce or test case


3630
Missed implementation of few methods in Spring Data's RedissonConnection

List of missed methods:


3631
RExecutorService does not work,block at future.get()

redis_version:6.0.2
code


3632
Exception in redisson decode

Hi,
is following exception is also related to netty version or there is other problem , by the way this is only happening  when I use it in RTopic pubsub MessageListener.OnMessage() :)


3633
redisson-spring-boot-starter doc error

spring.redisson.config should be spring.redis.redisson.config


3634
org.redisson.client.RedisException: Unexpected exception while processing command

Hi, We found RedisException errors during stress testing.
CommandDecoder#handleResult running context:
Stack trace:


3635
Redisson error to map slot-partitions after re-sharding slots  between nodes:org.redisson.client.RedisNodeNotFoundException

Expected behavior
Redisson will   map slot-partitions  by the topology after re-sharding slots between nodes
Actual behavior
Steps to reproduce or test case
Initialize Redisson client and connect to redis cluster,and topology at the moment:
Reshard the slots  between origin nodes
Wait utils the re-sharding slots finish, and the topology at the moment:
Reddsion update cluster topology, and the topology at the moment
Try to access redis cluster
Exception happen
Cause analysis: org.redisson.cluster.ClusterConnectionManager#checkSlotsMigration has a bug.


3636
Redis Lock - question about edge case

I am looking to use Redis for exclusive locks of resources.
If they fail and two workers will think they are holding the lock, that can end up in, let's say, really bad data corruption.
I know that a lot of edge cases in Redisson have been covered, however how about this one:
Worker1 acquires lock with time of "infinity" (until manual release)
Worker1 loses connection to Redis instance, while access to everything else still works and it continues operation on data, databases etc....
Lock gets removed from the database, because it expired in 30s (lock watchdog timeout), because of no bump by watchdog
Worker2 has good connection to Redis and is able to acquire the lock and start it's operation on data (leading to corruption)
Worker1 gets Redis connection back, it's watchdog tries to recreate the lock in background ASAP, however it lost the race because the lock was already acquired by Worker2
Both Worker1 and Worker2 now think they are holding the lock :(
Looking by the code comments, this seems to be expected behavior/known edge case - one of very few in regards to locks.
If I am correct with this scenario, what would you recommend? Going with non-redis solution like etcd or zookeeper, for example?
or maybe set the watchdog timeout to a value that will always be more than the execution time of task under that lock and have some custom code for removing failed locks on boot?
(so if Worker1 is down I either wait for it come back and automatically clean it's locks that are no longer valid or manually remove the locks owned by Worker1 assuming I want to safely get rid of it)
And is there a mechanism to check periodically whether watchdog has lost the race to reacquire the lock and allow application to act on it?


3637
Nested Conditions on RLOS don't work as expected when we use Conditions.in as one of the condition

The below code doesn't work:
If I write the Conditions.in logic explicitly by looping the Conditions.eq, it starts working. Following code works:


3638
this.redisTemplate.opsForGeo().position(key, members)

Expected behavior
return null or an result
Actual behavior
Steps to reproduce or test case
When getting a point without member


3639
Redisson Rate Limiter -> Hard Limit

The problem I'm seeing is that I'm setting a Rate Limit of lets say 20/second. If there is a period where 20/s is not reached, it will compensate for that and allow a temporary burst of permits over that threshold.
I was hoping for a configuration change to set a hard limit for a rate limit -- so that irregardless of the average rate, the rate must never exceed this value.
This may be how the rate limiter is already set to function, and i've uncovered a bug, let me know if this is the case and I can attempt to simulate this issue in a test (or at least try).
This is how i'm creating my rate limiter:
RRateLimiter rl = sharedRedissonClient.getRateLimiter(this::class.simpleName);
rl.setRate(RateType.OVERALL, 18L, 1L,  RateIntervalUnit.SECONDS);


3640
Unable to evaluate the expression Method threw 'org.redisson.client.RedisException' exception.

I'm trying to get values for a stored key from Redis and I am facing above error. I am trying to get the keys using this.redisson.getSet("TestClass"); and for saving the values to redis I am doing repo.save(TestClassObject);
I am not able to retrieve the objects when I try to this.repo.findAll() in that case I get values as a list but all elements inside the list are null. I also tried using getSet as stated above in that case I get the values but as string only hence not able to call getters as they are not of TestClass object type.
Can anyone please help with this?


3641
Getting connection refused error while trying to use reddison-hibernate as hibernate second level cache

Hi All,
Getting connection refused error while trying to use reddison-hibernate as hibernate second level cache
Please note that redis server is up and accepting redis-cli commands.
reddison hibernate version used : redisson-hibernate-53 as I am using spring data jpa that gives hibernate 5.X latest.
Also reddison.yaml is configured.
Getting the following error/


3642
Does Redisson support spring-data-mongodb

So I've adding redisson to my application. The config looks like what is defined here:
singleServerConfig: address:
When I try adding Cacheable to the method that call external services using RestTemplate I'm able to see the result cache in redis-cli. Though when I try adding Cacheable to service methods that call underlying Mongo repositoy I'm getting IllegalArgumentException
Could someone explain if its because its not supported? I don;t remember exactly but saw that this is supported in only pro version. And if there are any alternatives I could look at without much code change.


3643
RedisSentinel.getMaster() method throws NPE

No description provided.


3644
Why is `isEvalCacheActive` hardcoded to false inside `CommandBatchService`?

Why is isEvalCacheActive hardcoded to false inside CommandBatchService?
Due to CommandBatchService being used by RedisBaseLock this means regardless of whether you have useScriptCache set to true in the Redisson config all Redisson locks will be sending the whole script across the network for every lock call.
I assume there's a reason for this but is there any way I can use evalsha for locks instead?


3645
Storing large object exceeds Redis' max inline read request size.

Expected behavior
Store an object of size greater than 64kb as allowable in docs.
Actual behavior
Client throws exception org.redisson.client.RedisException: ERR Protocol error: too big inline request
Steps to reproduce or test case
Single server configuration w/ sslEnableEndpointIdentification = false. I've tried with both StringCodec and FstCodec with no success.
Let me know if there's a configuration to avoid inlining the request, I couldn't find one via the docs.


3646
Redisson client opens thousands of connections, still disconnected from cluster

Expected behavior
Redisson client should be stable.
Actual behavior
Over the weekend we noticed that roughly 50,000 connections were made from Redisson clients or our AWS Elasticache Redis cluster. Typically our Redis cluster has a little over 1000 client connections. This introduced a lot of load on the Redis cluster until requests started timing out. Rebooting applications that use Redis seemed to remediate the issue. There are still some Redisson clients in a broken state.
One service is repeatedly logging the following a day later and is in a broken state.
I worked with our SRE team and with the use of netstat we discovered that this application was holding 2400 open connections to the Redis cluster! Typically each application will hold around 28 connections.
Rebooting the application resolves the issue, which seems to indicate it is a client side issue.
I looked back to when the issue started to occur and see no logs about creating new client connections. All I see are Redis operations beginning to timeout.
Steps to reproduce or test case
Unclear. We have been running this version of Redisson for months without issue. Typically our services are running for a maximum of 7 days.


3647
RMapReduce ,use the Document case,but  blocking, unable to execute

i read RMapReduce document 9.5
Copy code in local ,but it does not work
block here
What happened here? Thank you


3648
reactive client getKeysByPattern getting incorrect result

Expected behavior
I have 100 keys in redis
reactiveClient.keys.getKeysByPattern(null) size should be 100
Actual behavior
reactiveClient.keys.getKeysByPattern(null) size is 47 (always getting the magical result with size of 47...)
Steps to reproduce or test case
insert any number e.g. 100 of keys in local Redis console


3649
Helidon CDI integration

No description provided.


3650
GraalVM native-image support

No description provided.


3651
Because of prior network problem, rbucket can't get data and throw InvalidDataAccessApiUsageException

Expected behavior
Redisson client could reconnect to redis server after network problem had been fixed
Actual behavior
Redisson client can't get data and threw InvalidDataAccessApiUsageException like below.
After we redeploy the project, redisson client can get data finally.
Steps to reproduce or test case


3652
schedule service  timeout will cause old running task to cancel the whole job when finish error

my redission version is 3.15.1. using spring boot 2.4.1.
i run a task once per second, and will finish in 3 seconds,  but the timeout is 2 second,  this will trigger a new task to run, when the old task finish,  it will encounter and error, which cause the whole schedule task will no run anymore.
here is my example to reproduce the case:
this is the output log


3653
Redisson shutdown takes much time after RBatch execution

Redisson shutdown takes much time if RBatch executed in REDIS_WRITE_ATOMIC or REDIS_READ_ATOMIC mode.


3654
Is order of Operations in a RBatch guaranteed?

Sorry if this is obvious, but i did not find any documentstion about this:
If i am using RBatch and create let's say a Bucket from it, and call setAsync on the bucket 100 times before executing the batch, is the order of the operations in the batch guaranteed to be the order in which
setAsync(Object)
has been called?
In other words, is there any way i could end up with anything but the last value i set to the bucket after the RBatch is executed? For instance if the Marshalling of the 99th value took some time?
Bucket is just an example here, i am also using RMaps the same way.


3655
Redisson running under Quarkus throws ClassNotFoundException

I am trying to use a Redisson pubsub solution between several nodes running jobs.
Redisson crashes when trying to deserialize a message published by another node.
Quarkus version: 1.13.4.Final
Expected behavior
The message subscriber should receive the message without error
Actual behavior
Publishing works just fine. When the subscriber receives a message, a ClassNotFoundException is thrown during deserialization
Steps to reproduce or test case
Subscribe to any message while running Redisson under Quarkus


3656
`useScriptCache=true` sends whole script to Redis for each lock call when using `RedisBaseLock`

Expected behavior
When useScriptCache = true is in config evalsha should be used for all script executions rather than eval to reduce network load as specified in the docs.
Actual behavior
When useScriptCache = true in config eval rather than evalsha gets used for each lock call resulting in significant network load.
Steps to reproduce or test case
Open Redis CLI
Execute MONITOR command to see commands executed on Redis
Run redisson.getFairLock('lock-test').tryLock(10, TimeUnit.SECONDS); using the configuration below.
Note the EVAL from the MONITOR:
The reason for this is that CommandBatchService is hardcoded to ignore the config setting:
CommandBatchService is used by RedisBaseLock when executing its scripts.


3657
Micronaut integration

No description provided.


3658
Adding ttl

How do I add the lowest possible TTL to Redisson? Some caches expire after long time. Or would it be better to write clear() on Spring application ready event?
This is what the Config looks like:


3659
ClassCastException occurs

I'm seeing these errors in logs, this for Instant and others for Enums as well
My value serializer is StringSerializer and the codec is not defined explicitly so it would be picking by default.
What would be the issue? Do I need to change to JDK serializer or Jackson one?


3660
expire(Instant) is not equivalent to expireAt(Date)

In #3399, RExpirable#expireAt(Date) is deprecated, and the javadoc said Use expireAt(Instant) instead (in latest release it is called expire(Instant)).
But I notice that the implementaions of this two method is not equivalent actually.
This breaks some object expiration, such as RedissonBloomFilter.
Expected behavior
calling expire(Instant) should expire bloomfilter name and configName both
Actual behavior
only bloomfilter name is expired
Steps to reproduce or test case
expireAt(Date) calls expireAtAsync which is overridden in RedissonBloomFilter which expire name and configName both


3661
Spring Data Redis 2.5 support

No description provided.


3662
Is RLOS merge/persist a transactional operation?

Hello,
We understand that whenever we merge/persist a RLOS object, it will also created indices inside Redis for fields annotated with RIndex. Basically, this merge/persist operation includes multiple writes being carried out on the cache.
Is it fair to assume that this entire operation is a transaction, i.e. if any of the writes fail due to any reason, it will do a rollback and throw an error to the caller?


3666
Reactive Support for Redisson Live Object Service

Hello,
Are there any plans to introduce reactive support for RLOS? If yes, by when do you think it will be available?
Thanks!


3667
RedissonReactiveSubscription remove listener after first 32 messages

Expected behavior
RedissonReactiveSubscription keep the listener to process messages continuously
Actual behavior
RedissonReactiveSubscription remove listener after first 32 messages
Steps to reproduce or test case
using spring data redis backed by redisson to subscribe message from redis


3668
Invalidate cache (2LD Cache Hibernate) if add or remove column in entity.

Expected behavior
It should not throw an error and only use the columns that are present in the entity, unfortunately I don't know exactly how redisson stores that.
Actual behavior
If you have an entity and add or remove a column and try to load it, you get an error.
Steps to reproduce or test case
Run 2 Java applications use hibernate-core (5.5.2.Final) and redisson-hibernate-53 (3.13.4) and setup redisson 2LD cache.
First Application has the "old" entity like:
Then try to load it on the first application it will work. But then try to load it on the second application and you will get this exception:
if you clear the cache and load it on the second application first and try to load in on the first application you will get this error:


3669
Can't set expiration time for bloomFilter key?

Can't set expiration time for bloomFilter key?


3670
Reactive Client - Key does not expire

Why does expire method not work for reactive client?
I can still see the keys and values after 10 seconds. Looks like the client should not be shutdown to expire the keys? Can we not set the expire key as part of the expire method invocation itself?


3671
getLocalCachedMap for reactive client

Why do we not have getLocalCachedMap for a reactive client when the blocking client has it.?


3672
MapLoader / MapWriter Reactive Interface

Can we have corresponding reactive interfaces for below interfaces?


3673
RBlockingDequeReactive does not consume all elements

Steps:
Verify in redis that we have 100 elements in the List.
Now consume elements from the queue. (add delayElements to replicate this issue) It consumes only 32 elements. we lose all other items.


3674
Transaction does not execute

This transaction works just great 1 time. I tried to execute in a loop just for 10 times!! I get the exception for the remaining 9 times.


3675
'Not all slots covered!' on startup in AWS Elasticache

We run a Redis cluster in AWS ElastiCache. On a service startup we sometimes get the following exception (used dots instead of potential NDA data):
Application run failed
As far as I understood, redisson sends a ping on AbstractNIOChannel.finishConnect if pingConnectionInterval > 0, and this ping fails.
Is it possible to fix this issue without disabling slot coverage check? If not, is it safe enough to disable that check?
Thanks.


3677
class not found exception with redisson tomcat code

we got following exception with Redisson tomcat decode
version 3.14.0


3678
RScheduledExecutorService tasks not run(or run only a part)

my problem is: use RScheduledExecutorService execute task, but no task key into redis(sometimes can into, sometimes can't, so what reason can cause this?).
my redisson version is 3.12.3.
Has anyone encountered the same problem,  eager for your solution.


3679
none




3680
I want to listen to the redis link disconnection event

I want to listen to the redis link disconnection event
What should I do?
Can Redisson do such a thing?


3681
Configure Sentinel on Kubernetes using bitnami/redis

I have a setup of Redis Sentinel on Kubernetes that is using https (single master setup). My configuration looks like follows (Spring Boot):
The sentinel instances are running behind one single service redis-cache:26379 in Kubernetes and only that single service must be used to access the sentinel instances.
Now I'm constantly seeing the following warnings in the log:
Looking at the code in org.redisson.connection.SentinelConnectionManager.SentinelConnectionManager(SentinelServersConfig, Config, UUID) it seems that SENTINEL SENTINELS is executed to get the list of sentinel instances. That won't be correct for the mentioned setup as this returns multiple cluster-internal IPs instead of the single service mentioned above.
Is there a possible solution for this (e.g. to disable automatic sentinel discovery)? I saw the configuration option org.redisson.config.SentinelServersConfig.isCheckSentinelsList() but that only disables the check, but not the discovery mechanism.
I'm using Redisson 3.15.5.
Any ideas how to solve this? Thanks!
Also see #2788


3682
Redisson LOS retry configuration

Hello, I noticed that there's an inbuilt retry mechanism inside Redisson Live Object Service which retries 3 times before throwing the WriteRedisConnectionException exception.
Is there anyway, we can further configure this retry logic? Or switch it off in case we want to implement our own?


3683
none




3684
Connecting to AWS Elasticache cluster using cluster endpoint

Hello,
AWS EC exposes 2 ways of connecting to multi-node cluster.
It gives us a cluster-endpoint AND it also gives us endpoints for each node.
Now, in redisson I see that there's a cluster connection config which requires each of the node endpoint address alongwith replicase i think.
And then there's singleServerConfig.
I was wondering what's the best way to handle this? If I use single server config with cluster endpoint, will it be okay?
Or I always need to use cluster connection config with all node endpoints registered.


3685
MOVED redirection loop detected on AWS Elasticache

Expected behavior
works fine.
Actual behavior
Steps to reproduce or test case
It works fine when use cluster config. but the cluster mode has bug when redis failover, like #3635 ,  I want to try replicated mode. and found the issue.


3686
How should users debug subscription timeouts?

I often see this error message when my one of my replicated services is trying to acquire a distributed lock from our AWS Elasticache Cluster.
Subscribe timeout: (7500ms). Increase 'subscriptionsPerConnection' and/or 'subscriptionConnectionPoolSize' parameters.
I followed the suggestion of the message and increased my subscriptionsPerConnection from the default to 500. I still see the error message. I looked at the CPU/Memory usage of the AWS Elasticache cluster and it is below 5%.
I have looked into other issues about this topic and I have not found a good way to root cause what is actually going on.
Is there a way that we can validate that we are indeed exceeding the subscriptions per connection or are running out of subscription connections?
If we are indeed running out of connections is there a way we can dump what subscriptions our connections are using?
I have enabled DEBUG level logging and I see the following messages.
What is the difference between the freeSubscribeConnectionsAmount and freeSubscribeConnectionsCounter ?


3687
AUTH does not seem to work as expected.

Steps:
Run this command in redis
acl setuser dummy on allkeys +get +set nopass
Try to do this in redis. This will fail as the user has no permission to do this operation.
AUTH dummy password
Run this. This should ideally fail. but it passes!


3689
redisson crashing




3690
Is there any instruction to build the project, thanks

#3652
The fix hasn't been released yet, but we want to use it because we in the production environment.
I downloaded the source code today, switched to the corresponding tag(3.15.1) and tried to build it with the this fixed change, but the Maven dependency couldn't be found.
Is there any instruction to build the project, thanks


3691
Error message from Redis: ERR invalid command channel:·

i user redisson version is 3.13.2
Error message from Redis: ERR invalid command channel:
What does this mean, please?


3692
Redisson complains about multiple masters when two replicated address nodes resolve to the same IP

We are working through issues with using Redisson with AWS Elasticache during upgrade/failover/etc.
We currently have a replicated cluster of size 2: 1 master and 1 replicated node.
AWS Elasticache provides us with two DNS endpoints to use:
During normal operation both of these DNS entries will resolves to different IP addresses, however during upgrade/failover it is possible that only one cluster node is available and the DNS entries will resolve to the same IP addresses.
Even when operating the cluster with 1 node I think this should be allowed. This allows infrastructure teams to easily to scale up/down underlying cluster nodes load balanced by DNS without having to modify the application config to include/exclude certain hostnames.
Expected behavior
Redisson should tolerate when more than one node address resolves to the same IP address, that happens to be a master in the cluster.
Actual behavior


3693
Redisson Spring Boot Starter is missing CacheManager

Hi,
redisson-spring-boot-starter should also expose CacheManager. Currently it does not!!


3694
Redisson Pro

I like redisson so far. Does Redisson open source version support the following?
master-slave
cluster
sentinel
if yes, whats the need for pro version?


3695
The ClusterPartition#slotRanges not update in ClusterConnectionManager#checkSlotsMigration

Expected behavior
The  method ClusterConnectionManager#checkSlotsMigration only update the slots, not update the slotRange


3697
Getting UndeclaredThrowableException when cache down while doing rlos.get()

rlos.get() causing this. As per above writeups method.invoke calls needs to be handled explicitly.


3698
Redisson - remove web dependency. conflicts with WebFlux

Issue:
I use Spring WebFlux - reactive web stack. When I added Redisson Spring boot starter - I started seeing weird issues in the application. Then I found that it brings this below unnecessary dependency. I can do maven exclude. But ideally , in redisson, this should be a test scope dependency.
spring-boot-starter-web.
WebFlux and Web can not be in the same project and it would lead to weird issues.


3699
Stream - do not emit empty map

@mrniko
Issue:
Below code returns an empty map when there are no messages. Ideally Mono should be emitting an empty signal. Not an empty map.


3700
Stream API enhancement

Currently redisson stream read does not seem to be really reactive. It just emits via Mono.
Can we change the Map<StreamMessageId, Map<>> to a proper data structure?
Also stream is never ending data stream.
The upstream should listen to downstream demand and emit messages as and when it arrives.


3701
Transaction support for other DS

Currently in transaction mode, we have options for updating only limited data structure.
For ex: List is not supported.
Is there any reason for this?


3702
Provide Redisson commandExecutor instrumentation

We want to trace command execution with RedissonClient.
To approach this with spring I create proxy with cglib and inject it by java reflection API:
It would be nice if Redisson will provide some way to set interceptor (or multiple) for command execution (pre- and post-execution). It can be used for several observability purposes like metrics collection or distributed tracing.


3703
cannot get redis connection after redis master switch over and found there're memory leak.

In my product environment, after some times of redis master switchover (2 redis services + 3 sentinels),  the redisson happens
Expected behavior
Expect the redisson work fine the get connection
Actual behavior
redisson happens error and cannot ger error.
found memory leak in the heapdump.


3704
Redisson vs Lettuce - Performance Comparison

I was just trying to do a simple performance test to compare Redisson and Lettuce.
I really like Redisson. But Redisson seems to be consistently slower than Lettuce. Is this expected?


3705
Azure Redis For Cache. Scheduler stops fire timeouts after redis restart

We're scheduling multiple tasks and using Redisson as a library for distributed scheduling backed by Azure Redis For Cache (cluster mode)
Everything works fine during few weeks but at some moment it stops call tasks handlers after timeout. We found that it happens in failover cases (when master is terminated and slave promoted to master or when redis fully rebooted) but not each time. It can be reproduced manually when we randomly restart master/slave redis instances or both of them through Azure Portal. After a few restarts (it happens not each time) our application stops execute tasks handlers when it's time to call it. Newly created tasks for the same instance of RScheduledExecutorService are also not working.
If we restart our application when detect this issue, then it handles all scheduled tasks that were not handled after failover and starts working normally.
I tried to debug this issue and see that HashedWheelTimer still executing and pushes request Ids through lua script into list (request queue):
But entries are never extracted from this list after restart (previously it was done by BLPOP command, but after restart I don't see any BLPOP commands related to this queue and from response queue also: {remote_response}:). Most probably it just doesn't resend BLPOP command after reconnect to Redis and because of this it doesn't call associated handler. Size of queue just increasing when new tasks scheduled:
And after restart of an application it immediately handle all of them:
Here is a log file that I've captured (with enabled Redisson debug logs) and there you can see that there are no BLPOP commands anymore after restart. I can reproduce the issue but not sure what exactly I should check.
Since request queue is a local variable passed to "subscribe" method of RedsissonRemoteService, I cannot check the state of this queue (may be there is a way to do that but didn't found where it can be stored)
While debugging after failover, I've tried to call "getBlockingQueue" manually, it returns new instance of blocking queue. Poll/take methods from this newly created queue working fine for this queue after failover. It's possible that re-subcribe didn't happen in some rare situation.
Expected behavior
After failover redisson continues fire timouts (calls handlers)
Actual behavior
Redisson stops call scheduler tasks handlers. Even newly scheduled tasks are not working
Redis version
Azure Redis for Cache (Redis 4.0.14)


3706
Quarkus native remote service invocation fails

I tried to call a simple remote redisson service, compiled to quarkus native, but the invocations fails, because of a ClassNotFoundException org.redisson.remote.RemoteServiceRequest
This class seems not to be registered for reflection and serialization. If trying to add it manually with graal-options, other CNFExceptions occure, because other redisson classes are missing. Not native-compiled invocations of such a service work well.
Quarkus version: 2.0.0.Final
Expected behavior
The invocation of a remote service works
Actual behavior
The invocation fails with a ClassNotFoundException


3707
Allow to set task id for RScheduledExecutorService

Is your feature request related to a problem? Please describe.
Currently, there is no "native" way to determine if task is already submitted to Executor in distributed environment, across several Application instances.
It's true when some of the instances restarts and the instance doesn't have any correlation between generated task id (random in current implementation) and actual task.
The new feature will allow to avoid submitting duplicate tasks.
Describe the solution you'd like
Describe alternatives you've considered
I used some sort of workaround and maintain separated HSET to hold actual submitted task, such that application instance calculates the ID from actual task on startup and verify that task already exists in HSET.
This approach is a kind of shame in our codebase, since it requires instances to have distributed lock for task verifying and registration process. It is something like leader election based on lock.
P.s. my thought that this is a crucial part in the library, since it will allow to seamlessly implement "distributed task queue" and get off unmaintained quartz solutions without extra hassles that i had to implement.


3708
none·




3709
Add value to RSet with KEEPTTL option

Since Redis 6.0, the KEEPTTL option has added to SET command. So I'm wondering how can I use this option in RSet API, or do we have any implementation for the usage of this option?


3710
Live object batch persist error




3711
org.redisson.client.RedisException: Unexpected exception while processing command

I am using Radisson as a distributed cache and it is updating by two aws ECS instances. Eventually, I am getting this exception. when clear the cache it is working fine properly and again it is happening after some time. I could not narrow down the problem. looking for help from here.
Cache objects are updating frequently by java services and frequently retrieving.
Issue happens eventually, which means that some objects are caching and retrieving properly and sometimes retrieving getting this error.
Note: by searching on the web, I have found that there was a marshalling issue and redisson has fixed it on 3.15.x versions. Even after I update the library, this issue existing.


3712
Redisson renewExpiration not working after redis lock expires

Expected behavior
After a lock is expired or removed on Redis-Server a new lock should be created with renewalExpiration renewing TTL of a lock.
Actual behavior
A new lock is created , but for some reason this new lock do not call renewExpiration but add this ThreadId to a map and  I dom't figure it out how it uses this map to renewal.
On this specific case I was trying to use the same thread to reaquire this log,  I tried with a new thread but the result was the same.
If I restart the applications, as this map is empty  the ttl renewal works as spected.
Steps to reproduce or test case
Set a HIgh watchdog (30s) aquire a lock expire it manually on server. Aquire it on the same application


3713
Unsupported protocol version 50

Retrieve data error,Beg big guy to help see


3714
Redis renewExpiration  ttl problem

Expected behavior
Allways renew the ttl key .
Actual behavior
after looses a lock and try to aquire it again, sometimes the renewal feature doesn't work as it supposed
Steps to reproduce or test case
To reproduce it I had to use debug stop the execution before this call
with redis client remove the key.
Then release the flow.
if the key does'nt exists the renewal doesn't fire for this specific key, and it's everything ok
So my code aquire this lock again since it's not the owner, and everything seems to work except that it doesn't renew the ttl key lock because of this
In my point of view if you add
cancelExpirationRenewal(threadId)
when the renewal fails , it solves the problem


3717
Kotlin objects with JsonJacksonCodec

Hi!!
I'm using Redis as a cache provider with the help of Redisson in a kotlin service.
At first I tried to set in redis non Serializable objects and I had to change to a JsonJacksonCodec in order to encode non Serializable objects. However some code at initTypeInclusion from JsonJacksonCode.java is avoiding our jackson to write @Class property for kotlin classes (they are closed by default).
I have created a custom Codec in kotlin extending JsonJacksonCodec:
And everything works! Now I can serialize and deserialize kotlin classes into Json and keep them in redis.
However I'm wondering, as we are passing class type to getBucket:
redisProvider.getClient()?.getBucket<V>(cacheKeyToString(namespace, key))?.get()?.awaitSingleOrNull()
Can't we just use that information to indicate Jackson which class should be used to deserialize???
Also, did you find OK my JsonJacksonKotlinCodec?


3718
org.redisson.client.WriteRedisConnectionException: Unable to write command into connection! Node source: NodeSource

1、my redisson version is: 3.12.3
2、my code like this:
RBlockingQueue queue = redissonClient.getBlockingQueue("queue_name");
XXVo = queue.take();
3、my problem is:


3719
org.redisson.client.WriteRedisConnectionException: Unable to write command into connection! Node source: NodeSource

1、my redisson version is: 3.12.3
2、my code like this:
RBlockingQueue queue = redissonClient.getBlockingQueue("queue_name");
XXVo = queue.take();
3、my problem is:
4、additional:
the queue may have 100 element, 99 take success, but 1 take occurred error above.


3720
RDelayedQueue doesn't return element when there is only one element in queue

Add one element to RDelayedQueue:
Wait for specified time
insert second element in queue.


3721
Pub-sub is not working if custom name mapper is defined

Expected behavior
If a custom name mapper is defined, the pub-sub mechanism should work as previously.
Actual behavior
If a custom name mapper is defined, listeners are not invoked.
And if this mapper is removed from configuration or NameMapper.direct() is used then listeners are invoked.
Steps to reproduce or test case


3722
Redisson - JDK 16

Hello, while doing communication using redisson I encountered a problem because on JDK 16 when deserializing a packet redisson cannot find the class (ClassNotFoundException). (The same code works fine on version 8 and on version 11 (with the same version of redisson)). That is why I'm wondering if I'm doing something wrong or redisson doesn´t support JDK version 16.
Stacktrace
Of course this class exists, there is a screenshot of that.


3723
ByteBuf leak when RedissonScoredSortedSet addAll

Expected behavior
No memory leak
Actual behavior
Apparently there is a direct memory leak problem when using Redisson and RedissonScoredSortedSet
We noticed more and more memory being used by our container when started using our service in particular way, storing larger amount of objects than usual, but we couldn't see it in the heap dump.
After enabling paranoid leak detection in netty we got the exceptions:
	org.redisson.RedissonScoredSortedSet.addAll(RedissonScoredSortedSet.java:364)
	our.service.RedisClient.set(RedisClient.java:34)

We are pushing larger set to the cache, about 3000-4000 objects few KB each.
It keeps increasing everytime the data expires (our case 5 minutes) so most certainly set.addAll is causing that. After a couple hours the container hits the limit, but heap stays the same.
Steps to reproduce or test case
Our code is rather simple:


3724
Ask a lock reentry problem, sub method using thread pool call

If the thread ID is used as the key value for reentry, is there any problem if the thread pool is used for calling the sub method? Can the key value be specified externally? And if the thread number will be repeated


3725
none




3726
none




3727
RMapCache

hi,
We use RMapCache object to save our data, but we can see that the redisson client gets all the map when we need data and not a specific key on the map.
is there a better way or map to prevent this behaviour and get the key we want instead of all the map and continue having TTL leave map ?


3728
Thread lock starvation with RSemaphore on high concurrency with hundreds of locks (2)

This is a followup to #3573. We have now received the first user feedback from @jebeaudet which exhibits the same behavior as in the previous issue.
We have tried with Maven 3.8.x from the maven-3.8.x and Resolver 1.7.1 with Redisson's RSemaphore. Several runs observe the same behavior. One thread tries to acquire a lock which is not held by anyone else and after the time is up (30 s) no lock is obtained. @jebeaudet privately provided me log files of those builds and I have distilled the lock workflows from it. Here is a sample:
The write lock artifact:ch.qos.logback:logback-classic:1.2.3 is not held by someone, yet it fails. I can provide several SQLite databases which contain raw imported data, prepared data as well as joined by lock workflows/transitions. The thread dump of a hanging build looks always the same:
Nothing, but localhost....
PS: There is a similar issue with RReadWriteLock, but I will report this seperately.


3729
ReactiveRedissonTransactionManager`s transactionOption change, but not work

Expected behavior
transactionOptions timeout option disable
Actual behavior
transactionOptions timeout option not disable
Steps to reproduce or test case
Hello
I use redisson with spring framework
create ReactiveRedissonTransactionManager bean
I set the timeout to -1 but it didn't set as desired. I think tunoff
so, I find ReactiveRedissonTransactionManagers doBegin` method
inherit this class, and customize doBegin method set timeout -1
but didn`t not work well ( I set it up, but it was actually 30 seconds. )
how can I turn off timeout setting ?
ps. let me know if i can help you


3730
FairLock deadlock again

Expected behavior
redisson_lock_queue and redisson_lock_timeout keys disappear once the lock that was taken by the first thread is timed out automatically after lock lease time, and then the second thread successfully takes the lock.
Actual behavior
Sometimes, even though the lock from the first thread is timed out and released automatically, the redisson_lock_queue and redisson_lock_timeout keys are stuck and the second thread can't acquire the lock, even though nobody is holding it. The second thread is stuck for full acquisition timeout. Then, it fails to get the lock eventually, and keys redisson_lock_queue and redisson_lock_timeout disappear, making the lock available again. Feels like lock expiry notification gets lost and Redisson waits for nothing. P.S. In this regard, would be great to have FairSpinLock not to rely on pubsub.
Related? #2883
Steps to reproduce or test case
1 redis, 1 sentinel


3731
Dynamic cache name when using with spring boot

I'm using Spring Cache as the abstract level for caching and Redisson as the client. Everything works fine, but recently I had a an issue with high cpu and memory when handle a lot of requests. Now i'm searching how to optimize or solve it. I read https and see that Redis hash data type works well only when there is small number of entries in a hash.
This is how I'm using Redisson with Spring Cache.
And I use spring Cacheable annotation in my method with the value as "CacheA" or "CacheB".
I checked the source code of RedissonSpringCacheManager, Redisson create a RMapCache instance for every cache names which are mapped to corresponding hash key in Redis. In my example there is two RMapCache instances, one for "CacheA", and one for "CacheB".
Now come to my issue, because my cache object (ex: CacheA) has thousands of entries. My idea is to split it into smaller hashes by altering the cache name dynamically. Example: CacheA-1, CacheA-2,....
But how can I do that in Redisson? Bellow is the code of createMapCache method in RedissonSpringCacheManager.java
Thanks,


3732
Can't parse json config /tomcat/redisson.conf

I experienced "The session manager failed to start due to previous errors". It looks "Can't parse json config /tomcat/redisson.conf".
I attached the redisson.conf here. If someone can review the conf file and provide suggestion solving the errors, it would be really appreciated.


3733
Redisson connections release while command execution attempt failed

We faced an issue in following Azure Redis Cluster configuration:
And we have a question:
When RedisExecutor executes its command and retryTimeout happened then:
1.1. Error message is assigning to exception variable
1.2. Then attemptPromise is cancelling
1.3. Then attemptPromise.onComplete happens which calls releaseConnection
1.4. There is a code
which do not release connection if connectionFuture.isSuccess() == false (and this condition always met in case of timeout or I am wrong?).
And looks like that its never releases this connection and free connection counter semaphore is not releasing at all here.
Is it expected behavior? Should we always have connectTimeout less than retryInterval?
And in case when 2nd attempt fails too, we still see in the logs "after 0 retry attempts" because we already have "exception" variable set on previous step.


3734
Predicate filter on RListReactive list returns non-deterministic result

Expected behavior
Actual behavior
Returned array is non-deterministic way. Values that it can take:
Steps to reproduce or test case
I use Redisson RedissonReactiveClient with Spring Boot 2.5.2. I wrote the following example code. When I hit refresh in the browser, I receive different array sizes in a non-deterministic way. The array is always deleted before the execution, so array should always contain the following 4 elements and filtering by "B" should return the two elements of the array, where the result  of the applied predicate is true.
Redis runs dockerized on localhost.


3735
ClassNotFoundException Exception RemoteServiceResponse

Hi,
We are intermediately getting ClassNotFoundException exception while using redisson-spring-data-23:3.16.0. Could someone guide on the issue and its resolution please.
Using bare minimum config as below.


3736
Issue with AWS Elasticache using ReplicatedConfig when failover

Hello,
We are working through issues using Redisson with AWS Elasticache during switch between master/slave.
We currently have a replicated cluster of size 2: 1 master and 1 replicated node. AWS Elasticache provides two DNS endpoint: the primary one, and the reader.
Sometime on a failover, there is a switch between the master and the slave behind the DNS and redisson update his connexion. But it seem that the Redisson switch is incorrect and our service can't proceed command when this occurs.
Here is some log to help:
Jul 18, 2021 @ 08:57:42.757 ERROR redisson-netty-2-1 Can't process the remote service request.


3737
none




3738
Batch check the existence of keys in RedissonMap

Is your feature request related to a problem? Please describe.
I am using RedissonMap to store ... a map! Sometimes I wish to check if a key is present in the map without having to actually get the value. Redis provides a command HEXISTS to do this, and I can see that in RedissonMap we leverage this command to implement containsKey efficiently.
However, sometimes I would like to check the presence of multiple keys in the map, sometimes many thousands. The naive solution to simple call containsKey ends up round-tripping to redis many times.
Describe the solution you'd like
I would like a batch method (maybe something like containsKeys) which indicates the presence or absence of many keys at once, without round-tripping to redis many times.
Describe alternatives you've considered
I can call getAll() and just look at which keys got returned, however this returns all the values as well, which I don't care about in my case and which consume additional network + memory resources.
I could bypass RedissonMap and simply issue a pipelined request for many HEXISTS, but this is extra complexity I have to handle myself and it bypasses the RMap abstraction.


3739
Question about Redisson pub/sub listeners not re-subscribing after Redis maintenance

Hi,
I'm fairly new to Redis/Redisson and have a question about an issue that I have encountered during Redis maintenance (planned switchover I think).
My application is running on Azure against Azure Cache for Redis
The application is using Redisson pub/sub listeners but after Redis maintenance only 1 of many listeners re-subscribed and other listeners fail to deliver new messages that are being published.
I'm not sure if I should increase some retries-related configuration to avoid this problem or is more in-depth investigation (including redisson logs) required.
Example of successful re-subscription:
I would appreciate any help with this issue.


3740
mget

i can't find "RedissonClient.loadBucketValues()"  in version 3.16.0


3741
RedissonClient.getList() performance

Hi,
RedissonClient.getList() currently is doing a count on the list and retrieving every item one by one. We have a dynamic list that increases with time so the response time of the app also increases linearly with as the time to fetch more of the list items get longer.
From AWS xray tracing:
We have 267 items in the list and the above repeats for all items in the list:
If there a way to get all list items in redisson with LRANGE instead?


3743
Class cast exceptions on CommandsData

We're using redisson pro and getting class cast exceptions. Our dependencies in maven look like:
The exceptions we're getting:
Does someone have an idea how to resolve this?


3745
Command still hasn't been written into connection!

We are experiencing what at first glance seems like network related errors using the latest version of redisson pro. However we noticed that this error only occurs on LPOP commands.
Increasing netty threads has no effect on this, also increasing timeout config did not improve the errors.
Also when deploying our code (on a test environment without load) we see a heavy increase in cpu usage on redis master nodes. The load increases by 50% and drops very slowly in about 1 hour to <5%
We are using the RedissonClusteredSpringLocalCachedCacheManager (but the same occurs when using RedissonClusteredSpringCacheManager)


3746
not consistent response

We have 2 application servers (Tomcats) and our application is not sticky which mean that every request can reach different application server.
In our flow we upload data from one server to Redis and then read data from the second server but don't get the uploaded data.
Can the reason for this behavior can be related to local cache implementation in Redisson? Can we disable it per put request or only disable it for all Redisson client requests?
we use to get the data


3747
Regression - quarkus native builds fail after updating netty in 3.16.1

After upgrading to redisson 3.16.1 there are build failures of native quarkus, the stracktrace points to netty. as far as i can see there was a minor version upgrade of netty in the last release, so maybe this is the reason, in 3.16.0 everything works fine.
Quarkus Version: 2.0.3 Final


3748
sslProtocols parse issue

Hi.
After adding sslProtocols option to redisson.yaml file I get error below:
redisson version: 3.16.1 for tomcat 8
After removing sslProtocols line no errors reported in tomcat console


3749
RedisTimeoutException following RedisLoadingException

In our setup, we have sharded mode cluster consisting of 6 shares, 2 nodes per shard.
Our redisson client interacts with only the MASTER node in each shard.
Recently we experienced the following exception: "org.redisson.client.RedisLoadingException: LOADING Redis is loading the dataset in memory". Following that exception, we had been getting RedisTimeoutException on majority of the calls until we finally restarted our application services and the problems went away.
Any clue as to what might be the cause of this? I am suspecting this is a problem with the redisson client itself.


3750
redis lock not working as expected

I have the following test scenario:
My expectation is the following: if the lock couldn't be acquired in 1s  then it should show Failed to acquire lock. If the lock is acquired then, in 30s, it should be automatically released by Redis (this 30s are very important as I only need to allow another run after this time). Only one should should be acquired in 30s. The problem is that most of the times I get multiple Lock acquired between 30s intervals.
The code launches 1000 parallel execution tasks. Since Redis is (mostly) single threaded then I wasn't expecting any concurrency problems (and I'm pretty sure they aren't on the Redis side). I am also using a single node Redis.
I have also tried another solution using Zookeeper Leader Election and that one works as expected using the same caller function. It acquired a single lock at a time.
Am I doing something wrong here are we having a Redisson issue?


3751
RDeque Or RPriorityDeque Lost data

version: redisson-3.13.2
add code:
consumer code
add success, but Occasionally, data is not consumed.
There is no recurrence problem in the local stress test, but it occurs occasionally in the production environment


3752
Different effects when Mix using of multiLock and Lock

version:
redisson-3.14.1
When try to using both multiLock and Lock with same key
There are different effects according to the lock order
When lock lock1 first ,then lock multiLock1
multiLock1 stun for a few seconds and then, lock success(lock1 are not released)
When lock multiLock1 first ,then lock lock1
lock1 are stoped and waitting for the multiLock to release
it's confused


3754
Is there any guideline for upgrading the middle value of a version

Will it be an incompatible version when I upgrade from 3.11.x to 3.15.x?
Is there any reason or guideline for the version value?


3755
Redisson throwing java.io.NotSerializableException when trying to publish something in a topic

I'm really confused as to why I got this error, and I might have misunderstood how topics work with objects in Java.
So basically when doing RedissonClient#getTopic(nameOfTheTopic).publish(objectToPublish), I'm getting this NotSerializableException.
The object I'm trying to send is this class:
Can't you send classes other than the ones from the JRE or am I missing something that I need to do in order to be able to do so?


3756
the method  RRateLimiter.expire() is incorrect working

this is my code :
then I fund a bug :
5 seconds have passed, the  redis key "redisson_rate_limit:trade:rootMchId0001" has removed,but the redis key
Who knows you can help me?please...


3757
java.lang.NullPointerException

CommandEncoder throw NullPointerException all config is default
Redis version 5.x
Redisson version 3.16.1


3758
java.lang.ExceptionInInitializerError: null

Hello, first time using redisson. I have a very basic setup with redisson 3.16.1 running on jdk 16.
Trying to use redis for a simple cache: RMap<UUID, String> uuidCache;
The setup is just like the basic examplte from the README.
But when launching the app, this exception is printed and redis doesn't seem to work.
Is this a knows issue?
Thanks for help.


3759
Redis Stream Support For Spring Applications

@mrniko
This is a feature request.
Currently Spring supports only Kafka and RabbitMQ for cloud stream applications. There is no support for Redis Stream.
I think Redisson could implement this interface and provide redis binder via redisson.


3761
RedissonMapCache#addListener with Redis Sentinel may cause NOPERM exception

RedissonMapCache#addListener is trying to detect OS type by executing INFO command, which is considered dangerous by Redis (part of its dangerous ACL list).
This causes exception:
NOPERM this user has no permissions to run the 'info' command or its subcommand
As a workaround, user can be granted an access to this command.
But, there should be a way to avoid INFO command at all (for example, by allowing to specify RedissonMapCache#osType explicitly along with adding something like BaseEventCodec.OSType#NONE).


3762
Issue when testing failover on AWS Elaticache

Hi, I'm facing an issue when testing failover on AWS Elaticache
I'm using Redis Cluster with 2 slots, each slot contains 1 master and 1 slave.
It takes about 8 minutes after I trigger a failover event and the Redis works well but my services seem cannot recover by themselves.
I dump a thread capture and may get some useful information:
I'm using jetty as our web container and the operation I'm using with Redisson is quite simple - this.redissonClient.getBucket()
The reason why the service cannot recover is that threads are blocked in JVM, I can see 900 qtp* in JVM and their states look like this:
From my understanding, when the web requests try to get data from Redis Cluster, one of the nodes takes the task asynchronously then callback to the service by Netty epoll. So when the master failover, the tasks on this node cannot answer anymore, which makes those qtp* threads cannot finish.
I'm wondering if my guess is correct and how I can solve this issue, like giving a timeout for web requests or returning exceptions from Redisson side?
Although failover is not a common case, it still hurts a lot when my service cannot recover automatically.
Expecting for your response, thanks a lot.


3763
Redisson No Session in spring app on tomcat

I have integrated redisson in tomcat as specified in doc. My application is built in spring framework and running on tomcat server 8.5. I am currently running 3 replicas of application in my kubernetes cluster where redis is also installed.
My tomcat context.xml is as follows:
My Redisson.yaml is as follows:
masterSlaveServersConfig:
But when my application starts and try to login i see following exception in my serer:
In redis ii see session keys in redisson/tomcat_sessions and they keep on growing when i refresh the page so it seems like its creating new session ion each refresh and not validating existing one
Can you tell me what's need to be changed here ?
Also there are no log statements printed by redisson can you also tell me how to enable debug logs for it ?


3764
redisson-spring-boot-starter support "spring.redis.url"

Hope that the redisson-spring-boot-starter can support the above spring boot setting. Thanks!


3765
Does near cache options also apply to the backing RMap?

I can set max size, eviction algorithm etc. using LocalCachedMapOptions, but it's unclear from the documentation if those options also apply to the backing RMap. Given that RLocalCachedMap does not subclass RMapCache, I'm guessing no, but would like to hear from a maintainer.
You can use this ticket for improving the documentation in this respect.


3766
Redis operations metrics

Is your feature request related to a problem? Please describe.
I'd like to see metrics for low level Redis operations, like GET, SET etc.
Describe the solution you'd like
Expose metrics around these operations. The only available metrics is for RedissonCache, and there is no visibility into any of the other data structures.
As a less desirable solution, you may consider providing interceptors for a client to implement and export their own metrics.
Describe alternatives you've considered
None


3767
RedissonReactiveClient limitations

Is your feature request related to a problem? Please describe.
RedissonReactiveClient is missing many of the features compared to  RedissonClient.
Returned RMapReactive has no methods to set max size or eviction algorithm.
No method to create a LocalCachedMap (or perhaps) LocalCachedMapReactive. There's an open issue #3671 for this point only.
Describe the solution you'd like
Bring feature parity between blocking and reactive API.
Describe alternatives you've considered
Using blocking API.


3768
Flushing write-behind tasks

So i have set up redis as read-through/write-behind cache for a mongoDB. Now there is data i want to persist when the application stops.
Writing into the cache isnt enough as the MapWriter that writes from redis into mongodb is run by the same application.
If i stop the application and write my data into the cache then my MapWriter wants to wait some seconds to batch write the data from cache into db.
But at this time the application is already stopped and nothing will be persisted.
Is there some way to flush the write-behind tasks in a blocking fashion?


3769
Is there a way to pass redis commands in redisson, without using the functions?

No description provided.


3771
Exceptions when changing node type in AWS Elasticache on the fly

We tried to update underlying node type in our Elasticache Redis cluster. When AWS starts switching to newly created nodes, we see a lot of exception:
Is it possible to scale Redis cluster vertically on the fly using Redisson?


3772
fixing spelling in wiki

minor
since there is no way to pull request the wiki:
in the configuration section
"All property names matches" should be "All property names match" (not plural)


3773
Add batched merge() method to RLiveObjectService interface

No description provided.


3774
quarkus-redisson: a static analysis issue mentioning bytebuddy

Expected behavior
Quarkus Redisson should work in native mode with this reproducer.
Actual behavior
The static analysis fails with a message like:
Error: Unsupported features in 3 methods
Detailed message:
Steps to reproduce or test case
The README of this reproducer should explain what's needed.
Logically, running mvn clean integration-test -P native should be enough.
mvn, java, graalvm native-image and a valid testcontainer setup might be needed.
Redis version
There is a test container resource embedding redis 6.0.9 in RedisTestResource.java.
Redisson version
3.16.1
Redisson configuration
Basic single server here.


3775
nginx PROXY redis




3776
RPriorityBlockedQueue takes element even after the calling thread has been interrupted

Expected behavior
RPriorityBlockedQueue element available to be taken by the second thread after the first one has been interrupted before the element appeared in the queue
Actual behavior
The element has been read by someone else
Steps to reproduce or test case
Testcase is almost the same as RedissonBlockingQueueTest.testTakeInterrupted() with exceptions:
getPriorityBlockingQueue() is used instead of getBlockingQueue()
Had to use @RepeatedTest(30) since it's not 100% reproducible. I have about 6 succeeds out of 30 runs.


3777
Topic listener removal · 77 ·

Is it necessary to explicitly remove a Topic listener before shutdown, or does shutdown remove it anyway?


3778
Listeners unregistered · 78 ·

Hey
Not sure if this is an issue. I'm using a topic to transit data between two instances. Sometimes, listeners are unregistered randomly, and I don't know why, server is just publishing data, it works 1-5 times and then it breaks :/
Config:
Monitor (first wave it works, second doesn't) :
Thanks for your help, if you need more details, tell me!


3779
TransportMode

TransportMode Indicates the differences between different configurations
Why is NIO selected by default


3780
The return value of this method about setIfAbsent is null.

The return value of this method about setIfAbsent is null when a key is exist. I think the return value should be false or zero.


3781
`RedisNodeNotFoundException` still exists when redis cluster fail over

Expected behavior
Redisson can detect the cluster nodes change  correctly.
Actual behavior
Steps to reproduce or test case
When redis cluster fail over.
And can not recover by itself.


3783
RedissonKeys.Delete() method pass empty array will block the thread in redis cluster

Expected behavior
Exception throws like single redis server
Actual behavior
In cluster mode, this method will block the thread and no exception throws
Steps to reproduce or test case


3784
none

none


3785
org.redisson.client.RedisException: ERR invalid cursor. channel

Expected behavior
Normal traversal
Actual behavior


3786
Micronaut 3.0.0 integration

No description provided.


3787
spring cache and jackson InvalidDefinitionException

I think the problem is jackson turn this value to List.
But I don't know how to solve it exactly.


3788
Post slave-recovery , GetType commands continue to being sent to master node instead of slave nodes

Expected behavior
Master redis node should never get GetType commands.
Actual behavior
After unexpected traffic-load (spike) on redis, redisson starts sending gettype commands to master nodes instead of slave nodes.
Steps to reproduce or test case
On sudden spikes , this issue has been observed , its random in nature. Issue goes away after service restart.
(Also , happens very frequently.)
Both client service accessing the redis cluster and the redis cluster are in the same VPC
Redis cluster : AWS Elastic Cache is used. Cluster is 3 shards with 6 nodes  with each shard containing one master and one replica node. Instance type of each node is r6g.2xlarge
Commands used :zadd and zrevRangeByScore only.
Behaviour of nodes during the problem :
Since then we are seeing get cmds being run on 0002-001 & 0003-001 , which are master nodes.
Once the slaves are recovered, instead of using slaves for zrevRangeByScore , we see calls at master for zrevRangeByScore commands.


3789
MacOSDnsServerAddressStreamProvider

I try netty-resolver-dns-native-macos 4.1.67.Final and 4.1.65.Final and 4.1.63.Final but didn't work.
I found netty maybe not support m1 how can I solve this problem.
redisson
Shiro.ini has default web session manager set
We made all kinds of changes and combinations, but still cannot make redisson persist our session. Help!


3791
none




3792
Deserialization difference between RedissonMap and RedissonLocalCachedMap

Expected behavior
I was writing some unit tests and I discovered that I could not perform any operations on a second instance of RedissonLocalCachedMap when I was storing non primitive key/values in the map.
My expectation is that a second instance of RedissonLocalCachedMap would be able to read values from a map as long as RedissonMap could. This is preventing me from using RedissonLocalCachedMap in my code.
Actual behavior


3793
exception class loader

hi,
we have the following exception even we change the configuration to :


3795
Why does redisson always reconnect the old redis pod ip?

Our redis cluster is composed of three nodes, and each node is loaded with two redis pods. Two redis pods die when a single node goes down. But redisson always tries to connect these dead redis pods.
When a single node goes down:
When the redis cluster returns to normal


3797
redisson currently does not fully support the redis lpush command

Currently, the "lpush" command of redis >= 2.4 supports multiple elements at a time, while the corresponding "RDeque.addFirst()" in redisson only supports one element.
Similar commands that are not fully supported include "rpush", "sadd", "srem".
Hope these features are supported, thanks


3798
class loader exception

hi,
regard #3793  wasn't able to reopen
we tried to remove jar from app, but it wasn't able to recognize the app classes that we saved in the cache ?


3799
RedissonSemaphore#trySetPermitsAsync lua script is wrong ?




3800
RMap.loadAll() probably should clear unexistent entries.

Hello,
I've got rather confusing experience with loadAll() method. I used it on startup to 'sync' redisson map with database, however, it doesn't clean values not existed in database.
I can use
but it is not atomic and I've found no functions to lock entire map access while I do this.
As loadAll() calls loadAllKeys(), maybe it better to clean nonexistent keys at the end of loading if loadAllKeys = true?
Reproduction snipped to illustrate:


3801
Access Denied on Javadoc Search

In the search box on the right, type redisson.
In the  search suggestions, scroll down to the Types section (second from the top), and click on org.redisson.Redisson.
Stare at the error below and wonder why.


3802
RMapCache HMGET notworking

Expected behavior
redis call trace  once
redis command hmget
Actual behavior
Steps to reproduce or test case


3803
Redis Stream XTRIM with MINID strategy is not fully supported: incompatible parameter type

Is your feature request related to a problem? Please describe.
The API to trim a redis stream (see the correspoding XTRIM command) supports different strategies via the org.redisson.api.stream.TrimStrategy type.
Yet the additional command parameters in the overloaded methods (e.g. trim, trimAsync, trimNonStrictAsync) will allow only ints.
Specifically you can now only pass a
int threshold (to say how many messages you want to keep)
int limit (to remove up to a given number of messages)
Those are inconsistent with the TrimStrategy.MINID which expects a message Id as input.
Since the message Ids are composed of a timestamp in millis from epoch and a number, the current int param won't be able to technically be used for such a job, even ignoring the semantics of the param.
An int is not enough to encode a valid millis timestamp which is part of the message Id.
Describe the solution you'd like
It would be nice to provide overloaded methods taking an instance of org.redisson.api.StreamMessageId, and - most importantly- a simple String, to allow partial matches.
Describe alternatives you've considered
I will probably use a work-around by calling the low-level redis client, but the issue is mostly about the current API which is a bit misleading in what it provides.


3804
RRateLimiter drift

Rate limit decreases over the time in highly concurrent environment.
Demo of such drift is on screenshot. Rate there has been limited by only RRateLimiter.
Expected behavior
Limit should not change without explicit call of setRate() with new value.
Actual behavior
Limit changes over hours. As a workaround I explicitly call setRate() with the same values time to time.
Steps to reproduce or test case
Just regular usage, nothing special:


3805
Redis hostnames support for Sentinel mode




3807
port out of range:-1 if host is starting with slash

Description
If hostname is given to Config with leading slash it causes exception 'port out of range:-1'
Expected behavior
Either of two variants:
exception about incorrect host should be thrown
slash should be trimmed silently from host string and proceed.
Actual behavior
This behaviour is very misleading and cause to search a ghost mistake with port configuration instead of host typo.
Steps to reproduce or test case


3808
CommandDecoder: Unable to decode data. channel command: (EXISTS) java.lang.ClassCastException: java.lang.String cannot be cast to java.lang.Long




3809
Failed to submit a listener notification task. Event loop shut down?

when I choose redisson (version 3.16.1)  ,this problem  occurred, but go well for other version


3810
mset command (getBuckets().set(Map<String, ?>)) in redis cluster throw CROSSSLOT

Redisson: 3.6.1
redis: 6.2.5 in cluster mode
use redisson.getBucket().get(keys...) success,
but when i use redisson.getBucket().set(Map<String,?>) and keys hashed in different slot,throw a CROSSSLOT
it's a bug? or because of other considerations
and i can pr to fix it?


3811
Why does RCountDownLatch not implement the RExpirable interface?

The reason I want to set the expiration time:
The 'countDownLatch.countDown()' method may not be called
The server went down when the 'countDownLatch.await(10L, TimeUnit.SECONDS);' method was called


3812
RExecutorService execute same task twice at the same time ·

I submit 200 tasks into RExecutorService and get 202 tasks executed.
The log shows the task :  00e3b0a299b6e8e71dc887aa9e728f4ac8 push into
I guess it may cause by retry mechanism, because the client connect to REDIS via VPN and the network is slow and unstable.
the result : task 00e3b0a299b6e8e71dc887aa9e728f4ac8 executed twice.
attachment is the log store in json format.


3813
why send may command when use mget command and all keys in same slot?

when i use getBuckets().get("{test}abcd", "{test}bcdf", "{test}efgc");
i trace the code and find the 3 key use hash tags, so their have the same hash code(by connectionManager.calcSlot)
but in executeBatchedAsync, cretae 3 command (mget {test}abcd, mget {test}bcdf, mget {test}efgc ) and run in CommandBatchService
why? and i think send a command (mget {test}abcd, {test}bcdf, {test}efgc) is better than now?


3814
RExecutorService sometime will stuck and does not resume task anymore

I am tring to use RExecutorService in my project.
The test env connect to redis via VPN and the network is slow and unstable.
In my test. sometimes the RExecutorService will stuck and does NOT resume task anymore.
The RExecutorService is named : "redisson-web-online-test-DistSvc"
The RExecutorService will store request in : {redisson-web-online-test-DistSvc:org.redisson.executor.RemoteExecutorService}
and store task into {redisson-web-online-test-DistSvc:org.redisson.executor.RemoteExecutorService}:tasks
I found the {redisson-web-online-test-DistSvc:org.redisson.executor.RemoteExecutorService} is empty but the task in {redisson-web-online-test-DistSvc:org.redisson.executor.RemoteExecutorService}:tasks does not processed and remain in {redisson-web-online-test-DistSvc:org.redisson.executor.RemoteExecutorService}:tasks
relative data store in redis:
Expected behavior
Task submit into RExecutorService being executed.
Actual behavior
The RExecutorService being stick and task remain in {redisson-web-online-test-DistSvc:org.redisson.executor.RemoteExecutorService}:tasks .
Steps to reproduce or test case
Start my application
after started , waiting for 5 minutes.
submit task into RExecutorService
the task does NOT executed and remain in {redisson-web-online-test-DistSvc:org.redisson.executor.RemoteExecutorService}:tasks
{redisson-web-online-test-DistSvc:org.redisson.executor.RemoteExecutorService} is empty
value store in {redisson-web-online-test-DistSvc:org.redisson.executor.RemoteExecutorService}:counter is 1


3815
Curious to ask, why deprecate the json configuration ?

When I used org.redisson.config.Config#fromJSON(java.lang.String) to generate Config, I found that this method has been deprecated.
When using redisson-spring-boot-starter, the value of spring.redis.redisson.config is String. I think json String is less prone to format errors than yaml String.


3816
none




3817
HINCRBYFLOAT  java.lang.NumberFormatException: For input string: "PONG"

Expected behavior
Not Execption
Actual behavior


3819
Hostname ends up comparing against IP address

Expected behavior
When using redis and sentinel in hostname mode, when redis and sentinel instances are restarted, the redisson client should allow its known slaves to reconnect to the same master.
Actual behavior
Redisson is comparing the hostname to a saved IP address and not realized it is the same.
Steps to reproduce or test case
Redis deployed into K8s using the following settings:
Setup:
3 redis + 3 sentinel (running in a Kubernetes cluster), kill off 2 pairs of redis/sentinels pods (redis master and a replica)
the pods come back with different IP address sometimes (but not always) and they a
Redis returns to a healthy state, but running into issues where the client can't recover.
One issue is that replicas coming back are not being considered having the same master
We can see here that the SentinelConnectionManager thinks current master is 100.64.110.145 while the replica is reporting its master as redis-node-1's hostname
they both point to the same instance, but the comparison is not working correctly.
I'm not sure yet if its caused by the same comparison issue, when killing and recreating the pod which was running the master redis node, we are running into a state where the ClientConnectionsEntry for MASTER is marked as frozen, even after it should have been working. I think it may be a timing issue with the unfreeze call during re-connection, but still working on isolating it. (if i manually unfreeze the master entry via remote debugging, it starts to work again)


3820
Lambda task not work as expect in RExecutorService

I submit Lambda task into RExecutorService but get strange executing result.
below is my code:


3821
RedissonLock Perhaps leak

The tryLock(long waitTime, long leaseTime, TimeUnit unit) method, if the subscribe timeout, and then subscribeFuture.cancel success,when to call unsubscribe , the subscribeFuture.onComplete should move out ,before the if block.


3822
bitfield xx get i8 :READONLY You can't write against a read only slave

use client.getBitSet("bitsettest").getByte(1)
it will send "bitfield bitsettest get i8 1" to slave node
but redis return a error -READONLY You can't write against a read only slave.
so bitfield xx get ...  command only work on master node?so we need use "commandExecutor.writeAsync" to execute command?


3824
[question] 3 node SENTINEL init fails with "SENTINEL SENTINELS command returns less than 2 nodes"

SENTINEL SENTINELS command returns less than 2 nodes! At least two sentinels should be defined in Redis configuration. Set checkSentinelsList = false to avoid this check.
Any idea why this could happen
note:redisson version 3.15.0


3825
Question about use of Redisson againt Azure Cache for Redis

We use Azure Cache for Redis.
We configure Redisson as follows:
clusterServersConfig:
nodeAddresses:
In our application log we see Redisson querying cluster nodes details and obtaining info about two specific instances (Master and Replica; ports 15000 and 15001)
We're observing issues when there's a scheduled maintenance on Redis instances (github issue 3739).
Microsoft support came back to us with following feedback: your application is directly connecting to the port 15001 which means it is connecting to specific instance. Please note that it is not a good practice to connect to the specific instance as during patching, if it goes down for an update, you start seeing errors. I would suggest you to connect to Redis over port 6380.
Is it possible to make Redisson follow this recommendation i.e. always connect to port 6380 and not to specific instances?


3827
Question about ConnectionListener with AWS ElastiCache for Redis

Hello,
We have multiple instances of an application running in AWS ECS.
We periodically encounter a scenario where one (not all) container's RedissonClient with ConnectionListener receives onDisconnect calls from previously connected Redis hosts that never connects again. Other containers remain connected to the same hosts and are able to operate as expected.
Hoping for assistance to understand a way to avoid this scenario.
When we run against a docker cluster on our local computers, we are able to restart Redis instances at will and see disconnects and reconnects as we expect. Only in AWS do we find permanent disconnects. Eventually, our RedissonClient is disconnected from Redis completely and cannot make any progress on its work.
Thank you for any help.
Our RedissonClient is created more or less like so:


3828
RedissonV3.16.2 write null command to slave node when use epoll transportMode

You can't try to checkFuture by write command to redis, the slave node in redis cluster shouldn't be allowed to do this.


3829
RedissonFairLock does not automatically clear non-running LockName and non-reference lock methods after a restart and cannot be automatically renewed

Expected behavior
Actual behavior
Production environment with a large number of requests queued
At around 19:23 on the night of September 9, due to the existence of a large Key in the store, after submitting a work order to delete the large Key, there was still an imbalance of data in the cluster slice, and the DBA tried to perform a memory analysis of the cluster, resulting in a Redis slice switch and the loss of some of the Keys.
Redisson's unlock mechanism will go to determine the LockKey Delete state, if Delete succeeds then publish a message to notify other clients subscribed to this lock to compete for the lock, if Delete fails then there is no message notification (Delete is a failure state when Key does not exist), thus causing the clients subscribed to the lock to wait until the thread wait timeout time (default is 5 minutes) to compete for the lock again.
Steps to reproduce or test case
Creating a large number of concurrent requests for locks
The business processing request time to obtain the lock is set longer than 30s
If thread A acquires the lock and manually deletes the key of the lock, i.e. RawName
Observing other threads acquiring locks, you will find that you need to wait a long time to get the lock, and after restarting the main method of Test, you cannot empty the last waiting queue, but can only wait for the default 5 minutes to clear the non-running state LockName(id:ThreadId)
1. RedissonFairLock.lock will not automatically renew


3830
Unable to send PING during load test

While running a load test, I'm occasionally seeing these "Unable to send PING command" errors. Wondering if there's a particular timeout setting I can use to try to overcome these. Separately, trying to understand if this could be related to spurious disconnects seen by a configured ConnectionListener. In a previous question, I asked about any experience/advice regarding how to manage cases where a RedissonClient loses connections that are never re-established. If a RedissonClient has disconnected from a cluster, what is the best way to heal it and re-establish connections to the cluster?


3831
none




3832
Multiple connection pools created to failover slave while redis server rebooted

Expected behavior
When a master/slave fails over, the appropriate connection pool should only reconnect once and no. of connections on redis server should be 2X at max.
Actual behavior
Seeing multiple connection pools being initialised and repeatedly a pub sub connection being initialised, making failover redis node unresponsive due to connection exhaustion.
Logs from a single application server, initialising slave pool 20 times, in less than 4 seconds
Steps to reproduce or test case
Not sure, as it was an unexpected outage of redis server. But you can try failing multiple redis nodes at once.


3833
Pub Sub connections being initialised repeatedly after redis server VM became unresponsive

Expected behavior
If a redis server goes down, maximum of 2x connections should be seen on the failover node, with no change needed in pub sub connections.
Actual behavior
We are seeing much more connections than 2x (Reaching 50k connected clients in this case) and pub sub connections being initialised repeatedly to the nodes on the unreachable server.
Does redisson require pub sub pool for any internal functions or can the pool size be set to 0, effectively disabling it?
Steps to reproduce or test case
1 VM was running 3/18 cluster nodes in the redis cluster.  It became unresponsive and we saw a surge in connections to that VM after that.


3834
Inconsistent Performance Retrieving Data From Redis with Redisson

We have Redis setup in as a Master with 2 Slaves.  Generally it works well.  Occasionally when we pull a large cached object from Redis, the time to pull the data from the cache is 50-60 seconds.  The good times we have seen are 3-6 seconds to pull the same data.  Is their anything we can do to make it more consistent (obviously we want it to be in the 3-6 seconds range).  The data is stored in an RList.  This particular case the data is very large, 16-17MB.  This is an unusual case, but we need to be faster nonetheless.
I have run the latency checks on the server, no issues there.
I will add that we are constantly adding new items to the cache.  These items expire after 60 minutes (ttl).  The cache typically has about 1600 items in it at any given time (during peak usage hours).  Redis is running inside a Kubernetes environment, as is the client application (same K8S environment).  Memory usage for the 3 Redis instances is hovering around 70-80MB we have allocated 2G for each (max).
Is there anything you can think of that would cause a request for cached item to suddenly take 50-60 seconds?


3835
I expect to receive a delayed message without pushing a new or null data to the delay queue

Expected behavior
1 Write the data to the redisson delay queue and set delay time is 30s
2 Shutdown the consumer application within 30s and starts again
3 Start consumer application before or after 30s
4 I expect to receive a delayed message
Actual behavior
1 The consumer application is no longer received until the delay queue's data is delay
2 Write a new data to the redisson delay queue , the consumer side can receive historically unspent and newly written data
Steps to reproduce or test case
STEP 1 Offer data to the delay queue, set delay 30s
delayQueueService.addDelayQueue("HELLO", 30, TimeUnit.SECONDS, "TEST");
STEP 2 Shutdown consumer application
STEP 3 Start consumer application
the delay data can not be recevied, Expected recevied the delay data
STEP 4 Offer data to delay queue again,but do not shutdown consumer application
delayQueueService.addDelayQueue("HELLO AGAIN", 30, TimeUnit.SECONDS, "TEST");
STEP 5 The consumer application received the message "HELLO" immediately, and 30s later , the message "HELLO AGAIN" can be received
I expect to receive a delayed message without pushing a new or null data to the delay queue
Redis version
6.2.4


3836
spring boot 2.4.10 with redisson 3.16.2 : zadd command will throw stackoverFlow error

Spring Boot 2.4.10
This is simple demo.
string is ok.
Spring Boot 2.5.4
This is ok


3837
can i disable AddressResolverGroupFactory

Due to security issues, I want him to use the default dns instead of netty to read /etc/hosts.


3838
How does spring boot1.5x upgrade the redisson version from 3.8.x to 3.11.x?

From the dependency of redisson 3.11.3 version, we can see that the spring boot used is 2x, and now our project uses spring boot 1.5.9, how should I upgrade to redisson 3.11.3 version? The following is a screenshot of the error report
The reason for the upgrade is to fix the bugs of versions before 3.9.1
#1811


3839
Stream - DS

Let's imagine a stream created like this.
I thought I should be able to add a list of payment events into the stream. But looks like I need to always convert it into a map to add it to the stream.
My point is - each stream entry is for 1 event. Not for collection of events.
I have to add it like this.
If we see, the key is basically unnecessary here.
Can you please explain the reason behind the such data structure? Is it because redis's limitation? Or do we have any other better use case?


3840
Connection leak (regression since 3.16.1)

No description provided.


3841
RMapCache.fastRemove throws RedisException: too many results to unpack

Redisson Version : 3.16.1
Redis : 6.0.5
Getting the below error when trying to remove cache entries in bulk(more than 10000) in Redis.


3842
How can I execute BGREWRITEAOF command from RedissonClient?

Does Redisson expose an interface to execute any Redis command? Thanks.


3843
Unexpected exception while processing command

Use ExecutorService to obtain the redis value. After obtaining the redis value, cancel the task, and redisson throws an exception.


3844
 keys.getKeysByPattern cost too much time

why this code cost 42047ms,but only 6000+ keys in my redis,redisson ver 3.16.1


3845
EntryXXXListener is not working on Turkish language Windows 10

Expected behavior
EntryXXXListener is working
Actual behavior
EntryXXXListener is not working on Turkish language Windows 10
You can read at for more information.
Easiest fix will be changing toLowerCase() calls to toLowerCase(Locale.ENGLISH)
I guess problem comes from usage at CommandPubSubDecoder.java
Steps to reproduce or test case
You can force Turkish language by giving JVM argument -Duser.language=tr and try to use listeners on any map with name which includes character 'i'


3846
Reddison Fuzzy matching iteration is too time-consuming

Expected behavior
Actual behavior
When I use the keys method for fuzzy matching, there are only 15 keys, which takes 7-800 milliseconds after iterative processing
Steps to reproduce or test case


3849
Master slave mode vs Replicated mode

@mrniko
How is master slave mode different from replicated mode, after keep aside AWS EC support ?
Is it possible to do sharding using redisson across multiple standalone servers (non clustered) ?


3850
Redisson should not retry on non idempotent operations

Expected behavior
Redisson should fail fast  when dealing with no idempotent operations instead of retrying.
Actual behavior
Redisson is retrying on no idempotent operations like  RDeque.pollFirst() / RPOP:
In the above scenario, the queue was popped twice, causing data loss.
Steps to reproduce or test case


3851
redisson-hibernate fails to load config when running in Quarkus dev mode

I had to do a bit of a workaround to pick the Redisson Hibernate 2LC instead of the official Quarkus 2LC:
Notice how I've also had to override createRedissonClient(). This was due to the config file not being found when running in Quarkus Dev Mode.
See Quarkus#2531. They suggest using currentThread() to get the correct classloader


3852
RLockReactive tryLock waits longer than waitTime

Expected behavior
long id = Thread.currentThread().getId();
... lock.tryLock(0, 10, TimeUnit.SECONDS, id) ...
Expect this to exit immediately - reporting "true" if it can get the lock now ; and reporting "false" if it can not.
Actual behavior
It seems to block and wait until the lock becomes available.
The waitTime (set as 0 above) does not seem to influence the behaviour.
Steps to reproduce or test case
Invoke "lock.tryLock(0, 10, TimeUnit.SECONDS, id)", when the lock is already taken.
Expect it to instantly return with "false". It does not.
((Note: I am working inside Quarkus, and using "reactor.core.publisher.Mono" to convert the Redisson Reactive Core (Mono) into Mutiny (Uni) - this does not seem related ; but it makes it harder for me to frame a pure-Redission test case))


3853
How to extend the valid time of tomcat session?

By official tutorials, the maximum sessions valid time would be 30 minutes, and my application’s maximum valid time is expected to set to 24hours, how to configure the redisson?


3854
How to get notified of an expired lock lease?

Hello. Wondering how to be notified of a lock's expired lease?
I've tried adding an ExpiredObjectListener and a DeletedObjectListener to my lock, but neither of those received an event when my lock's lease expired.
I do see that I can call lock.remainTimeToLive, but wonder if there's a way to configure a listener for that.
Thanks for any suggestions.


3855
How to add custom tags to Redisson metrics

Hi,
We usually add custom tags, like "environment", to our Spring Boot apps the way recommended by Spring Boot docs:
So that all metrics exported to our InfluxDB contains this tag.
We moved to Redisson recently, with a PRO license, and configured the metrics export with Influx as pointed in docs this way:
We can correctly see metrics in our InfluxDB but the environment custom tag is missing.
Also tried this with no luck:
How can we do this?
Thanks


3856
Redisson Crashes Tomcat server

No description provided.


3857
Tomcat Servers Crashes due to SIGSEV with Redisson 3.10.0

Redisson Jar causes all servers in the cluster to crash due to SIGSEGV issues related to Date Format
Below is the Thread details.
Register to memory mapping:
Not able to reproduce as I am not able to find the actual data. It looks it has something to do with  java.text.SimpleDateFormat.compile. However pushing this to all servers in the cluster and crashing is not expected.


3858
when use CompletableFuture.runAsync to create thread we got no class definition found from redisson

when start new thread using CompletableFuture.runAsync we have no class definition found
we have useThreadClassLoader: true


3859
Redisson getLock operation does not respect timeout

Expected behavior
Redisson getLock timeouts after timeout
Actual behavior
Redisson getLock timeouts after timeout + 1 second


3860
How does PING influences the BATCH command?

I'm doing a batch command in the following way:
From time to time we get the following Timeout exception:
org.redisson.client.RedisResponseTimeoutException: Redis server response timeout (20 ms) occured after 0 retry attempts. Increase nettyThreads and/or timeout settings. Try to define pingConnectionInterval setting. Command: null, params: null
I'm wondering about the Try to define pingConnectionInterval setting. in the WARN message. We use the default setting for PING (the 30s interval). What is the meaning of that sentence in the message? Is the PING necessary? Could we disable the PING?  How does the PING influences the batch command? Any suggestions how this WARN can be avoided?


3861
Quarkus extension seems to only use config from build time

Weve had to revert to using reddison and creating the client ourselves as it seems only config used at build time is injected into the client, which is then causing issues for the native build. Looking here it seems this may be the case. Is this to be expected, or am i missing something here. we need this to read from an external yaml file thats managed in kubernetes.


3862
RTransaction::getBucket returns different instances on subsequent calls to the same transaction

Hi
We create datastructures from RTransaction so that we can see uncomitted changes.
While this works on the same instance of the datastructure, it does not when the same thread retrieves it again from the same instance of the RTransaction.
As the RTransaction is the isolating bit, we were wondering, if the same RTransaction should return the same instance of the datastructure on subsequent calls.
This seems to be true with all datastructures (Bucket, Map, ...)
quick test:


3863
redisson-spring-boot-starter has compile time dependency on test artifacts (junit and assertj)

Expected behavior
adding redisson-spring-boot-starter as a dependency should not pull in junit and assertj as compile-time dependencies. these artefacts should not be deployed to a productive environment
Steps to reproduce or test case
create a spring-boot project
add redisson-spring-boot-starter as a dependency
build war file
war file includes junit and assertj


3864
How to add value synchronous on RedissonPriorityQueue?

Hi,
I would like to add a value synchronous on a RedissonPriorityQueue. The add méthod use method evalWriteAsync to add the value :
Why this method is async? How can i add a value synchronous?
For information, i use redisson version 3.15.2. I check the master : the method is the same.
Thanks in advance


3865
Unable to register multiple Reference codecs in RedissonClient

In Redisson 3.15.2, getReferenceCodecProvider() was removed from RedissonObjectBuilder.java.
This breaks code that adds a reference codec with the RedissonObjectBuilder, for example:
RedissonObjectBuilder now only allows registration of the single codec set on the Redisson Config object.
Is there an alternative way to add another reference codec?  We need to use JsonJacksonCodec by default for references, but have a sub class that needs to use TypedJsonJacksonCodec.


3866
JCache does not call onExpired event at expired cache event.

Expected behavior
when cache entry is expired, JCache call registered CacheEntryExpiredListener#onExpired method
Actual behavior
Did not call onExpired.
Other event types (CREATED, UPDATED, REMOVED) did call onCreted, onUpdated, onRemoved except onExpired
Steps to reproduce or test case
Build jcache with redisson
register CacheEntryEventListener to configuration


3867
Version 3.16.3: RedisTimeoutException: Command execution timeout for command: (PING)

After switching to version 3.16.3, I see tons of next exceptions:
And I don't see the same in v3.16.2.


3868
Exception on heavy load in springboot

we are using springboot-starter redisson client on cloud foundry and using AWS Redis cluster, 99% operations are read only, i am using RMapCache<String, String>  and I am using default config, not changed threads/nettry threads etc.
During load testing (max 200 requests per second), getting below different exception intermittently (DNS , out of memory, readtimout) and once we get these exception , they are not recovered.
Could please let me know how we can fine tune the configs to support heavy reads?.
DNS Logs:
Read timeout Logs:


3869
org.redisson.client.RedisResponseTimeoutException: Redis server response timeout when use RLock

My Redis don't use cluster just only one node address.
I used RLock for locking but was not successful because of Redis timeout. I restarted the service, it worked but it's not the best way in the production stage.
I referred to the same issue about Redis timeout such as an increased nettyThreads or timeout config but it's not successful.


3870
How to get notified when the key has been expired by TTL

No description provided.


3871
Connection Leak

(Maybe related to #3840)
Expected behavior
Following fresh startup of service utilizing Redisson client, AWS ElastiCache nodes each maintain consistent ~1k active connections from our service without change (with exception of node failovers, re-sharding, etc)
Actual behavior
Slow connection leak after deployment of 3.16.3 client & constant spam of new connections being created. Previous client versions (tested all of 3.15.6, 3.16.0, 3.16.1, 3.16.2) have maintained constant ~1k connections per node without new connection spam.
Pattern of connection leak is unclear - connections increased continuously for ~11 hours, slowly decreased over another ~10 hours. Starting experiencing complete cache failure a bit before lowest peak of active connections during leak was hit.
AWS ElastiCache metrics:
(First drop is from trying re-deployment, where connection leak occurred again)
Sample of debug-level logs (sanitized): https
Reverting to previous client version resolves issue.
Steps to reproduce or test case
We have been able to repeat this issue across service deployments, but can't give general reproduction steps.


3873
Reddison 3.16.3 is using netty-common 4.1.68.Final and netty-handler 4.1.68.Final but when I upgrade latest version of reddison is still using netty 4.1.66 version

Hi Everyone!
I am using in my pom.xml the latest version of reddison - 3.16.3 which is supposed to use the latest versions of netty-handler and netty-codec, but when I run mvn dependency:tree -Dincludes=io.netty:netty-codec and mvn dependency:tree -Dincludes=io.netty:netty-handler I see it is using 4.1.66 version instead of 4.1.68 version.
Can we take a look at this please?
Thank you.


3874
use LocalCachedMapOptions.SyncStrategy.UPDATE,Perform put(), remove(), and get() operations in order, I got the value of put().




3875
redis-sentinel connection with ssl not working as expected

we have three VMs running redis and redis-sentinal in ssl mode. and we are facing issue connecting to it with redisson
Expected behavior
we should be able to connect with redisson to the cluster
Actual behavior
Message


3876
Unable to get connection! Try to increase 'nettyThreads' and/or connection pool size settingsNode source

Expected behavior
When the Redis network has  restored, applications send  requests to redis cluster operation,
redisson operation to All master  are  OK  after master/slave switch.
Actual behavior
When the Redis network has  restored, applications send  requests to redis cluster operation,
redisson operation to these old master is normal, but redisson operation to   another new master is  exception occurs after master/slave switch
What causes this?
The whole network failure of redis cluster was simulated and the production problem was restored
[ Step one ]
View the current cluster status,result  is healthy
[ Step two ]
Shut down the Redis network and check the application log:
The ClusterConnectionManager detects a network exception and fails to connect to the host every 5s
[ Step three ]
Restore the Redis network and check the application log.
The ClusterConnectionManager detects the cluster node status.
An master/slave switch occurs on 7001 and 7005, and the cluster status is abnormal.
The Redis cluster status check is cancelled.
[ Step Four ]
Send a request to check the status of redis operation. The result is as follows:
Redisson  operated  7003 7002 is normal, and operated  7001 exception of  master/slave switch occured


3877
NPE in CommandPubSubDecoder.messageDecoder

Actual behavior


3878
none




3879
How does "RedisTimeoutException: Unable to get connection! Try to increase 'nettyThreads' and/or connection pool size settingsNode source" happe

the 6 nodes cluster is composed of 7005,7002,7004 that are master nodes,and 7001,7003,7006 that are replica nodes.
When Node 7001 replicas 7005 and 7005 fails, the cluster promote node 7001 as the new master and continue to operate.
After Node 7005 is replica node and Node 7001 is master node, the redisson client write to Node 7001 and replies RedisTimeoutException


3880
IndexOutOfBoundsException on reading PENDING Array[Byte] message

Expected behavior
Possibly a null for a message value could be returned instead of an exception.
Actual behavior
An exception is thrown
Steps to reproduce or test case
I had a steam consumer that had both new and PENDING messages.
Then I cleaned up my stream from the old messages using XTRIM my-stream MINID 1633844273000-0 command. All the events up to this point have been removed.
It happened that some of the PENDING messages were also removed by XTRIM command. Still, they are present in PENDING list of my consumer, but the values of the messages are nil.
When I try to look for data for one of those nil events (1632735948072-0), I do not find them, but Redis is providing me newer message:
I understand this looks like Redis bug and PENDING should not reference the message that no longer exists.
But I think Redisson could handle better this case and return at least null as a message value instead of throwing an exception. The reason is, I am reading 10 messages and only 1 of them can be problematic, while now the whole XREADGROUP command blows, and I am unable to handle that problematic message programmatically, e.g. acknowledge this message as having wrong message value.


3881
Transaction.commit

redisson 3.12.1  The thread is always in this state


3882
I am using the "redisson-spring-boot-starter" dependency to read the yaml file and encountered some problems

xxx


3883
Systematic timeouts since 3.16.1

Expected behavior
No negative performance impact between redisson releases.
Actual behavior
After upgrading to redisson 3.16.3 from 3.15.0 operations started to time out, once it got rolled back, timeouts got back to regular values:
I've tried to gradually bump from 3.15.0 all the way to 3.16.3, and we experience the same performance problems when migrating from redisson 3.16.0 to 3.16.1.
Most of the timeouts are either PSETEX or lock acquiring and renewals:


3884
Netty memory leak error

Hey, I saw a few other similar posts already but they weren't this exact error. I am running version 3.16.3.
I am using AWS elasticache with a replicated server setup in cluster mode and am only really using redisson to try and store sessions.
The below is the stack trace I get, it happens while tomcat is starting up.
12-Oct-2021 16:22:07.359 SEVERE [redisson-netty-2-28] io.netty.util.ResourceLeakDetector.reportTracedLeak LEAK: ByteBuf.release() was not called before it's garbage-collected. See for more information.
Recent access records:
There are a few other redisson-netty errors with similar stacktraces - all seems to be related to the Servlet filters on my application


3885
RListMultimapCache & RSetMultimapCache is not available for RedissonReactiveClient

Is your feature request related to a problem? Please describe.
RListMultimapCache & RSetMultimapCache is available only for RedissonClient and not RedissonReactiveClient.
Describe the solution you'd like
RListMultimapCache & RSetMultimapCache is also available for RedissonReactiveClient.
Describe alternatives you've considered


3886
Low ScanInterval burns CPU

Hello.
We tried to scale cluster under the load, but we got a lot of Node hasn't been discovered yet exceptions. To prevent them we changed scanInterval to 25ms. It helped, but according to JFR 30+% of CPU is burned to refresh cluster state:
For me it seems that ClusterConnectionManager.checkMasterNodesChange has a O(n^2) complexity and can be simplified to O(n) using map instead of inner loop.
Are there any recommendations what values should scanInterval have? And how can we update it on the fly to scale cluster?


3887
Unable to send PING command over channel: L:/127.0.0.1:65454 - R:localhost/127.0.0.1:7000

I have a local redis server (version: 6.2.6), redisson(3.16.0) and after a few mins of application startup, I see errors related to Redis connect timeout in logs:
Unable to send PING command over channel: [id: 0x87172b36, L:/127.0.0.1:65454 - R:localhost/127.0.0.1:7000]
Is this related to pingConnectionInterval settings? Also one other question, is retryAttempts = 1 considered as first attempt?


3888
Regression in 3.16.3 fails EVALSHA operation on multiple-shard Redis Cluster with authenticated connections

Redisson version 3.16.3 EVALSHA no longer works with AWS ElastiCache Redis Cluster that has more than 1 shard when the Redisson client is configured to use Redis authentication and TLS connections.
Downgrading to Redisson version 3.12.5 fixes this issue, and operations with multiple shard clusters with authentication work as expected.
Expected behavior
EVALSHA operation on multi-shard cluster completes successfully when connection is using Redis authentication
Actual behavior
The following code works on multi-shard clusters when clsuter Redis authentication and TLS connections are disabled, but fails when Redis authentication and TLS connections are enabled.
EVALSHA fails with the following error:
Steps to reproduce or test case
Create AWS ElastiCache Redis Cluster 5.0.6 and enable authentication and TLS connections
Use Redisson redisson-spring-boot-starter 3.16.3 with Spring RedisTemplate to run a Lua script operation against that cluster, which will end up calling EVALSHA operation on Redisson client.
Thank you!


3889
Unreleased Resources

RedissonRegionFactory  125line  classLoader.getResourceAsStream(filename)


3890
Redis keep the keys even if they are expired

Hi !
I'm using Redisson 3.16.1 with a RMapCache with a MaxIdleTime, a TTL and a MaxSize in LRU mode
The key of the cached value in the map contains a date so it won't be called the next day.
I was expecting for those keys to disapear after the TTL has expired but it doesn't seems to work this way. I can reduce the number of keys per cache but that's quite weird
My understanding is that the framework wait for the key to be called to clean up.
Notice that I have activated  :
useScriptCache: true
cleanUpKeysAmount: 1000
Thank you for your help


3891
Concurrent attempt to RReadWriteLock writeLock leaves thread in blocked state after lock is released.

Two Threads, thread-1 and thread-2 attempt to acquire a RReadWriteLock.writeLock() using lock().  thread-1 gets the lock, thread-2 waits for lock to be released.  thread-1 releases lock, thread-2 acquires lock.
When thread-1 releases lock (using unlock()), thread-2 does not acquire lock.  Wait for lock expires after 35 seconds.
2 threads call lock() on the same RReadWriteLock at or near the same time.
thread that gets the lock release the lock (after a second or two).
Note that thread-2 doesn't automatically get the released lock..
Redisson version 3.16.3


3892
Is RBatch a single get/put call to Redis server using MGET/MSET functionality ·

RBuckets uses MSET/MGET functionality but RBuckets.set() doesn't have an option to set TTL for entries.
From documentation of RBatch, it was mentioned: RBatch requests are batched to separate queue and could be executed later with execute(). Does this mean each request in batch gets executed at once or is MSET/MGET functionality used to execute all requests of batch at once?
@mrniko Can you please confirm if results of batch.execute() is in order and if value is not present in cache for get request, does it return null?


3893
none




3894
RBloomFilter batch and async mode

Hi,
I faced a problem similar to one mentioned in #3094 but for the contains method. When I want to test a large number of elements it's more sensible to test a group of objects in the same call.
I implemented batch method Map<T, Boolean> contains(Collection<T> objects) and immediately decided that if we want to make it performant RFuture should be used.
And here comes my question: if I wanted to create PR for those changes, should aync version (RFuture<Map<T, Boolean>> containsAsync(Collection<T> objects)) be implemented in RBloomFilter or should I create RBloomFilterAsync as it seems to be a convention used for other classes? The second option is more tedious as RBloomFilter hasn't extended RBloomFilterAsync so far for some reason.


3895
java.lang.StackOverflowError in releaseConnection

We have random StackOverflowError where only redisson is involved in the stack trace. There seems to be no pattern. Since we don't have this behavior in staging it eighter has to do with high loads or is just very unlikly,
Expected behavior
No StackOverflowError
Actual behavior
Stack OverflowError
Steps to reproduce or test case
No reproducer found so far. Maybe if we can limit the problem with your help


3896
RMapCache#addListener method.Obtain the operating system type is null ·

serverFuture.getNow().get("os") The obtained result is null


3897
AWS Elasticache Redis Replicated server and master failover

Hi,
we use the latest version of redisson and a 3 node AWS Redis (one master, 2 replica).
The config yaml list all three node as replicated server.
During a service update deployment, AWS update the 3 nodes, doing a failover of the master to an updated replica to update the last node.
Our application has logged a few errors -READONLY You can't write against a read only replica.
for around 500ms.
Is there an automatic system in redisson that will try to revalidate where is the master node in case of READONLY error ?
does those 500ms between the moment AWS swith the old master to a read replica and promote a new master ?
or is it the leftover of the scaninterval use by the connection manager to check for new master ?
Any way to avoid or react (retry) easily on those errors ?
(this error popup in code using cachemanager, but we also use RBucket)
Thanks.


3898
BloomFilter false judgment does not meet expectations

Expected behavior
Actual behavior
Steps to reproduce or test case
Redis version 4.0.13
Redisson version 3.16.0
Redisson configuration


3900
none




3901
Performing a GET on an existing key, which is set outside Redisson, returns `Unsupported protocol version 53`·

Trying with redisson - 3.16.3
Not able to get the value already set in the redis.
Key type stored in redis is of type STRING ( normal SET and GET operation )
In this test, I have set the key 'b' as follows using redis-cli:
Trying the below code gives the following error:
If I uncomment the bucket.set("5") and then try, it works.
But the value of key "b" is something like:
Why there are extra characters while creating a STRING key-value using RBucket?
Is there a way to streamline this so that [STRING] values set from other sources can be read with RBucket ?


3902
TransferQueue blocks connection for poll

Is your feature request related to a problem? Please describe.
I want to send an Object to a specific server if it does not respond I want to use a fallback solution. Since ReliableTopics don't give me a way the check if the request really came though we are using TransferQueue each takeAsync permanently allocates a connection (or more precisely the BlockingQueue from the RemoteService that is used in the TransferQueue).
Describe the solution you'd like
Either ReliableTopics giving me a way to detect when the request was received or TransferQueue not allocating one connection,
Describe alternatives you've considered
I guess I could build something like this myself with multiple topics but I thought this could be useful for other people two.


3903
RBatch to execute MULTI key operations across different key slots as single command similar to RBuckets get

Is your feature request related to a problem? Please describe.
RBatch to execute MULTI SET across different key slots. MSET doesn't allow to set TTL for all entries.  RBatch with IN_MEMORY_ATOMIC throws error: CROSSSLOT Keys in request don't hash to the same slot.
Describe the solution you'd like
RBatch with multiple get/set operations shouldn't throw CROSSLOT error similar to get(List keys) in RBuckets interface
Describe alternatives you've considered
We don't want to put all keys to one slot so just want to know if it's possible to get cluster node to slot mapping from existing API or do I have to execute CLUSTER NODES command?
@mrniko Would like to know if there are any other alternatives to execute multiple SET operations (with TTL) as single command on Redis.


3904
redisson print slots added and slots removed when application run a period of time

redisson version: 3.16.2
and use redisson-spring-data-21 to adapter spring boot 2.1.6.RELEASE
os: red hat 7.6
here is the log of org.redisson.cluster when it start print the infos
why it happend?


3905
springboot 2.2.9 use redisson-spring-boot-starter 3.16.3 always throw StackOverflowError

Expected behavior
true
Actual behavior
Steps to reproduce or test case
application.yml


3906
Unable to change master after the Redis singleServer changes Ip address

Hi, we are using singleServerConfig to connect to Redis server hosted in Cloud. we are using Redisson client 3.16.0 and pointing to elastic cache Reader endpoint and Redis server is running with one master one read replica. After the Redis server changes the IP address, DnsMonitor detected the IP address change correctly but is not able to connect again and throwing error


3907
Is it possible to have batch/bulk getWithTTLOnly and getWithTTLOnlyAsync methods in RMapCache?

Hi! We are using RMapCache object to store key-value pair with TTL per key in an AWS ElactiCache cluster mode enabled setup. In this setup, we have multiple shards and at least one replica per shard and we want the application reads to strictly be from the replica nodes for performance reasons. We were earlier using RMapCache.getAllAsync method and realized that, as explained in #2165, this method will always read from the primary node. Upon further reading, we came across #2981, which mentions the RMapCache.getWithTTLOnly method that can serve the reads from replica nodes.
In our use case, we will be reading multiple keys from the RMapCache all at once. In the case when the values for these keys are not present in RMapCache object, we will be making one network call for each missing key to Redis. Hence we wanted to understand if it would be possible to have bulk/batch variants of these methods, similar to other getAll and getAllAsync?
Happy to share more details.


3908
java.lang.ClassNotFoundException: java.util.Comparator$$Lambda$170




3909
Latency much higher than jedis in certain condition

The result is "redisson avg 7.8" and "jedis avg 0.7". I think this is related to epoll being slow but I don't how to confirm that.


3910
none·




3911
when domain's ip change, redisson also reconnect old ip

redisson version:3.11.5
After the IP of the domain name changes, redisson always reconnects the old IP. The correct way is to disconnect from the server after the IP of the domain name changes. Redisson should reconnect to the new cluster IP
why?What configuration is needed?


3912
REntity.TransformationMode.IMPLEMENTATION_BASED is not working using Live Object Service

Expected behavior
I annotate my object with @rentity(fieldTransformation = REntity.TransformationMode.IMPLEMENTATION_BASED) to make sure that my map is not converted to RedissonMap. According to documentation at Section 9.2.5. Annotations
fieldTransformation - You can also specify a field transformation mode for the RLO. As mentioned before, in order to keep everything as close to standard Java as possible, Redisson will automatically transform fields with commonly-used Java util classes to Redisson compatible classes. This uses ANNOTATION_BASED as the default value. You can set it to IMPLEMENTATION_BASED which will skip the transformation.
I expect that my map will be always stay as HashMap or at least as a normal JVM map instance.
Actual behavior
When I read back the object using attach, object returns map as an instance of RedissionMap.
Steps to reproduce or test case


3913
Buckets.set method saves value that is not encoded by codec·

Expected behavior
saved value by Buckets.set is encoded by codec
Actual behavior
saved value by Buckets.set is encoded by toString method
Steps to reproduce or test case


3914
this cron 33 3/5 * * * ?  only execute once

redisson version
jdk version:
oracle jdk 11
This is the correct expression : 33 3/1 * * * ?
When the starting time is long, the probability will not be executed
33 3/5 * * * ? will be not executed at all, if now time is "2021-10-25 10:03:50"


3915
duplicated with

i do not use docker ,but still Constantly repeating sentinel WARN.
here is the conf


3916
Why is Redisson not writing data to some shards in AWS ElactiCache (cluster mode enabled)? 16 ·

Hi! I am using Redisson 3.16.3 with AWS ElastiCache in cluster mode enabled.
AWS ElastiCache Setup:
Stage#1: Redis in cluster mode enabled, with 2 shards and each shard having 1 primary and 2 replica nodes.
Stage#2: After some time, I added 2 more shards to this cluster, thus it has a total of 4 shards (4 primaries + 8 replicas).
Stage#3: Eventually, I removed one cluster, thus the final setup is 3 shards (3 primaries + 6 replicas).
I have used this application code to put various keys into Redis in all the three stages on my AWS ElastiCache setup. While transitioning between each stage, I can see Redisson has identified the shard addition/removal and the ClusterConnectionManager is logging slot movements (... slots added to ..., ... slots removed from ...). I can also see that all the shards in all the stages have active connections with my application based on the "Current Connections" AWS graph of each shard.
Problem/Issue Faced:
But in all 3 stages, some shards are never receiving any data at all. And I believe these shards should be receiving the data because my slot partitioning logline is printing the key's slot to be on these no-data-receiving shards.
Is it possible that I am logging the slot partitioning incorrectly here, and Redisson is appending some metadata to $myRedisKey before inserting it into Redis? Or have I misconfigured something in this entire setup?
Please find attached some logs and graphs supporting that data for a key that should be going to shard#3 in stage#2 when there are 4 shards in total, but there are no items at all on shard#3.
Happy to share more details.


3918
Upgrading from 3.16.1 to 3.16.3 increases connection usage 30x and doubles response times

Expected behavior
Minimal differences between minor versions
Actual behavior
Severe performance degradation and increased resource usage
Steps to reproduce or test case
We are exclusively using Redisson for lock management.


3919
RLock lease expiry not being extended in spite of RLock being acquired

Our Microservice is running in Azure. It is deployed with 2 pods. Each pod attempts to lock the same RLock, the idea being that only one pod at a time holds the lock.
RLock is obtained using org.redisson.api.RLockAsync.lockAsync() and onComplete() lambda is used to get notified about lock acquisition.
We observed following: pod1 had the lock but then pod2 got notified of lock acquisition.
So we lock again and within 1 msec get notified about success: heldByCurrentThread=true, ttl=29998
This cycle continues from then on:
we get the lock without issues, very quickly
within 30 seconds we lose the lock and so go back to 1)
I think 30 seconds matches lockWatchdogTimeout setting. I see no warn/error log related to Redis connectivity
I have logs for around 3 hours when this issue has persisted but it might have well lasted for much longer.
Expected behavior
If a client acquires RLock then it should also be able to extend its (lease) time
Actual behavior
A client acquires RLock but then seems unable to extend its (lease) time


3920
How do sentinel round reconnect to when all are down ?

Hello, when redisson work in scheme 1 master and 2 slave with sentinel daemon on each, then 2 slave go down, some time master go down too, and then one or two of slaves go up, but redisson try connect to master only sentinel/redis node.
Question: How to do round-reconnect to sentinels servers if no one server not avialable ?


3921
ReplicatedConnectionManager not follow dns change when elasticache node is modified.

Expected behavior
connections are renew when dns change.
Actual behavior
dns changing doesn't affect to connections.
Steps to reproduce or test case
modify elasticache node type.


3922
master change checking in Replicated ConnectionManager is stopped when exception occurs in slaveUp

Expected behavior
master can't be changed in current try but keep checking.
Actual behavior
stop checking.
Steps to reproduce or test case
If the master monitoring job is executed before the dns change is applied.
LoadBalancerManger.getEntry returns null
LoadBalancerManager.unfreeze throws exception
exception occures in master monitoring job and scheduleMasterChangeCheck is not called again.


3923
PubSup close due to buffer size is not handled

Expected behavior
Redisson should notify about closed subscriptions
Actual behavior
The subscription is closed quitely mem dump of redisson shows that the pubsubs are even still in PublishSubscribeService maps.
Steps to reproduce or test case


3924
Redisson reconnection issue | version : 3.16.3

Please find the following series of events that bring the redisson connection to dead state
Redis server goes down, please find the logs :
After this redisson detects the DNS change, the switch to new master couldn't happen because we have disabled connection to public IP using Azure's private redis endpoint feature. Please find the logs :
Now after this, we keep seeing such logs where the DNS monitor looks for the change in IP and throws error that it is not able to connect even though the redis server becomes healthy again.
Now if we hit the service we get (though, now the redis server is up):
Please find the following connection config :
Also, If we restart the service it will be able to connect properly.


3925
Redisson client injects weird characters at the beginning of strings

I'm using Redisson client to publish String messages on a topic, but for some reasons, the published messages always contain some weird characters at the beginning:
Any idea how I can make those weird chars go away?
My java code looks like this:
I'm using redis:3.2 & radisson-spring-boot-starter 3.16.1
Thanks


3926
FstCodec

FstCodec
Why did YOU rewrite the map
Is there a problem


3927
Strange mess with data being read from different keys causing mysterious ClassCastExceptions until application is restarted

Expected behavior
Values read from different keys concurrently should be returned to a proper calling thread. I.e. RedissonClient.getBucket("Key_1", new FstCodec()).get() should return value stored under key "Key_1".
Actual behavior
We get sometimes very strange situtations causing the whole process to mix up all values from different caches, causing ClassCastException(s) or deserialization exceptions with values from different types of keys trying to be deserialized or cast to types used by completely different redis keys.
Probably it happens after a small networking problem in production when there are some timeouts or slow server responses.
Here is an excerpt from our production logs from a single application instance:
It looks like it has read Long value from a key that is used for RedissonLock objects instead of com.xxx.customers.CustomerInfo at 01/11/2021, 09:10:16.421, and then later at 01/11/2021, 09:10:18.120 tried to cast String read from com.xxx.customers.CustomerInfo key (which is actually a FstCodec encoded binary object) cast to Long used by RedissonLock.
And if such thing happens, then we continue getting such strange errors for other keys/locks until we restart the JVM.
Steps to reproduce or test case
Don't know, it happens too randomly and not so frequently, but if it happens, it causes random errors in production causing problems to our customers.


3928
Redisson client should be created even without all connections being initialized

The problem we are facing now with Redisson is that we create the Redisson client at the application start-up and quite often we get an error like the following:
Unable to init enough connections amount! Only 49 of 50 were initialized.
or for a different use case:
Unable to init enough connections amount! Only 1 of 2 were initialized.
This leads to the client not being created.
We don't want to retry synchronously because it would slow down the application start-up which in turn would slow down the AutoScalingGroup outscaling.
We would like to get an instance of the Redisson client even if none of the connections are initialized. There should be some async retry mechanism for re-establishing the connections.
We currently use a Dummy client as a fallback (when the Redis is not critical)) or manage the client creation async retry by ourselves, but we need to replicate this retry mechanism for each Redisson client (we have different use cases with different Redis clusters).
Would be very useful to have such a functionality built-in. We used to have Aerospike before Redis and Aerospike had such a functionality (you were able to set this property to false)


3929
msetnx command (getBuckets().trySet(Map<String, ?>)) in redis cluster throw CROSSSLOT·

#3810
Redis version: 6.2.5 in cluster mode
Redisson version: 3.16.3
when i use redisson.getBuckets().trySet(Map<String,?>) and keys hashed in different slot,throw a CROSSSLOT


3931
FstCodec 31 ·

String deserialization with high concurrency "{}"  or Object reference


3932
j.l.IllegalArgumentException: port out of range:-1 with Sentinel setup

I noticed weird warnings in our logs during investigation of one of issues:
Right before this warning, trace logs:


3933
Problems founded with jcache license file

Hi!
In your application you use jcache 1.0.0 version. This version has not correct license file. This page shows that license was change on Oct 11, 2015 and than was corrected from JSR-000107 JCACHE 2.9 Public Review - Updated Specification to Apache License, Version 2.0 on Oct 14, 2016.
Release jcache 1.0.0 was on 18 March 2014. LICENSE file version was:
This causes some problems with other users using your application. Using jcache 1.1.0 version or higher will help to resolve this problem.


3934
Leak of connection leads to redisson unable to perform action correctly

Expected behavior
The connection pool remain stable and keep the number of opened connection to the minimum.
Actual behavior
Connection pool is full of blocked connection and redisson can't open another connection to perform any request.
Steps to reproduce or test case
We have not idea what was the cause of this. The only thing we know is:
We have one service that use redisson and on both instance of this service the number of opened connection has increased since 10 days without any connection being freed. When we restarted the two instances of the service, the number of open connections on our redis dropped by 80. On the JVM side, there is no thread stuck during this period.
We are using redisson for distributed task using the RScheduledExecutorService. It's possible to have task that are cancelled during execution.
Replicated server with a node config containing one worker group of 5 with 8 redis thread, 16 netty thread and a the default MasterPubSub connection pool (24min, 64 max)
Here is some log about the problem after the connection pool is full of blocked connection:


3935
none




3936
PriorityBlockingQueue can duplicate elements be removed?

I want to a sort queue and it can remove the duplicate elements.


3937
Redis Sentinel doesn't add resurrected master back into node cluster  unless one of the sentinel is restarted externally in Redisson setup

Explored and Tried lot of ways to automate redis sentinel process of auto discovering failed/resurrected master node in Master Slave Setup.  Tried this setup in containerized environment, unless I manually restart one of the sentinels the old master node will be discovered by the sentinels and would be converted as slave in the new master.
Need immediate help for this issue
Sample Snippet of Redisson Sentinel Setup
Please let me know what I'm missing in the setup and provide workaround at the earliest
Thanks
Varun


3938
Issue with adding resurrected master as slave after master is restarted back from failover

Expected behavior
Redis Sentinel should auto reconfigure the resurrected master from failover and be placed as slave under new master. This setup is working only when I manually restart one of the sentinel node
Actual behavior
Resurrected master from failover is not added back into master slave setup and becomes an independent node unless one of the sentinel node is restarted and old master becomes a slave to the new master
Steps to reproduce or test case
Setup a RedissonClient with Sentinel setup


3939
Significant performance drop and loss of scalability after Redisson client upgrade

Hello,
There is a significant performance drop and loss of scalability after upgrading Redisson client from 2.2.12 to 3.10.6.
The performance (throughput - number of requests per second) dropped by almost 40% and the scalability of the Spring-boot app using it was lost, meaning that adding more instances of the Spring-boot app doesn't increase the system's throughput.
Some technical details:
Redis 3.0.7 64 bit in cluster mode - 3 masters and 3 slaves.
Please find attached redisson.json file redisson-3.10.6.json.txt
The reason why the client was originally upgraded was because of the following error that appeared in the log:
With the previous client version the performance was excellent and the solution was scalable.
Please advise.
Regards,
Nethanel


3940
Intermittently, after Azure Redis maintenance, Redis pubsub channel is removed and Redisson listeners subscribe successfully but don't deliver any messages

We observed and intermittent issue after Azure Redis scheduled maintenance.
The issue occurred on one of service pods; other pods didn't experience the same issue.
Our application creates a pub/sub listener, publishes messages every second but doesn't get these events back; as a result it thinks Redisson-Redis connection is broken and so resubscribes, but the same issue occurs even with new listeners. The issue has persisted for many hours, even though Redis maintenance was fairly short.
In attached logs (both from our service and from Redisson) following can be seen:
Expected behavior
Published messages are received back
Actual behavior
Published messages are not received back
Steps to reproduce or test case
Issue intermittent, observed after Azure Redis scheduled maintenance on one of service pods; other pods didn't experience the same issue


3942
Add support of SINTERCARD and ZINTERCARD commands

No description provided.


3943
redisson-quarkus-20 can't get config from envirement variable

can't get envirement variable config,@buildstep is Before it


3944
ttl key with no expire time , return 0

when i  use stringRedisTemplate.getExpire(key, TimeUnit) to judge key is not set expire time, i expect -1, but it return 0.however i user spring-boot-starter-data-redis, it return -1 with expect. here is the environment:
the redis i use is sentinel , and redisson version is 3.16.1 or 3.11.1, springboot version 2.1.6.RELEASE
here is the test case and result:


3945
Redisson connection uses unsafe.Allocatememory() cause direct memory leak

Hey,
In the production environment, we found that the memory occupied by the program has been increasing. Using the top command, we found that the value of RES has been increasing, even exceeding Xmx. We use jconsole.exe to observe that the number of threads and classes is stable, and the size of heap memory and meta space are within the normal range. Therefore, we begin to suspect that the program is constantly occupying native memory and is not released.
When we use gperftools to analyze the memory allocation occupied by the program, we will find that the method unsafe.Allocatememory0 occupies a very large proportion of memory and increases over time.
This is the original PDF file generated using gperftools analyzer memory
After debugging with debug, it is found that the thread redisson-netty calls unsafe.Allocatememory().
After modifying the redisson configuration so that redisson is no longer used to connect to redis, we use gperftools to observe that there is no Unsafe_AllocateMemory0, and the memory occupied by the program remains stable and will not increase,so we now suspect that redisson caused the program's native memory leak
Expected behavior
We hope to get your help so that we can use redisson without increasing the memory all the time
My environment


3946
java.lang.ClassCastException: java.lang.String cannot be cast to java.util.Set

What can cause such an error?


3947
Redisson Client AWS Elastic Cache Configuration Best Practice

I want to configure Redisson Client to connect it to AWS ElasticCache. There is not much documentation that what's the best practice to do so.
AWS ElasticCache provides Primary Endpoint and Reader Endpoint for writes and reads respectively.
Now instead of mentioning each nodes endpoint I would prefer to use Primary Endpoint and Reader Endpoint.
But from what I saw in multiple github issues in this repo, it was advises to use node endpoints directly. Why was that ? Reader Endpoint helps me to add more servers to Redis without changing the code base. Will Redisson pick up more servers automatically ?
Thanks


3948
Redisson doesn't support username for sentinels

Expected behavior
Redisson shall be able to support sentinel authentication.
Maybe a sentinelUsername shall suffice.
Actual behavior
Only the sentinel Password is used for authentication
Steps to reproduce or test case


3949
UnsatisfiedDependencyException ProxyCachingConfiguration NoSuchFieldError cacheManager

Hi,
I tried integrating redisson into our springboot project, but got the following error upon adding the dependency:
Here are all the Redis-related dependencies we have:
Before adding redisson dependency, there was no error. I was wondering if there is any conflict between these dependencies or their versions? Thanks.


3950
redis-sentinel connection with ssl not working as expected fixed in regards to issue  #3875

hello, I believe that I have fixed the issue in  #3875 please check it out and let me know


3953
Distributed iterator

Hello.
We have a huge sorted set (1m+ elements), that should be processed in parallel by different application instances. We came up to the idea to have a LUA script that will call a ZSCAN command using a saved cursor to return each element to app only once. Due to single-threaded nature of Redis engine, it would make a iterator, shared across all clients.
I didn't find anything like it in Redisson. If you think that this feature would be useful, I can prepare a PR in a week. If not - sorry for disturbance


3954
How can i configure TypedJsonJacksonCodec from yaml file ?

No description provided.


3955
Connection configuration for a replicaset behind anycasted address:

Hi!
First of all, thanks for an amazing library!
I'm looking for advice here on the client configuration for the following setup:
Redis 4 instance consists of:
1 master
2 slaves
sentinels
All servers are, so to say, ephemeral, and hence in front of the instances, there is haproxy server + bird2 that together achieve anycast advertisement of a fixed IP address and proxy traffic to the current master. Users are instructed to connect to master only and given the DNS entry for the anycast IP. Slaves are not in use and are only there to pick up the role of master in the event of the failover. Setup is similar to what is described in haproxy blog.
As a result, for Redission client I have only a single host:ip endpoint to use in configuration. I tried configuring Redission with both:
It seems neither of these two appear to be able to detect a failover event. When failover happens and a new master is elected, Redission keeps using existing established connections trying to write to what now became a slave, and getting:
READONLY You can't write against a read-only slave
My question is: isn't useReplicatedServers() supposed to periodically check the actual ROLE of a server it is connected to, so that when such a "silent" change in topology happens behind haproxy? Could it be that it is a problem on haproxy side, that keeps proxying traffic through open connections to previously connected node? I'd expect exactly a periodic ROLE check to address this.
Thank you.


3956
Question: After enabling redisson, sessionID does not update if node goes down

Hello,
After deploying redisson to my tomcat cluster sessionID does not update at all and it is causing all kinds of problems.


3957
IdleConnectionWatcher closes active PubSubConnections

We have a Problem were subscriptions seem to be removed (still in PublishSubscribeService#name2PubSubConnection but not showing on redis server itself)
Expected behavior
PubSubConnections should not be closed
Actual behavior
PubSubConnections get closed even with multiple active subscriptions that don't get reconnected from watchdog as the RedisConnection was marked as closed via setClosed(true)
Steps to reproduce or test case
Not yet but maybe if you could point us in a direction


3958
Unintelligible symbols in YAML config format

i see parameter and its value (codec and the class that implements it)
But what do the symbols mean:


3959
Mybatis RedissonCache cannot read config file `redisson.yaml`

Expected behavior
Actual behavior
throw error
Steps to reproduce or test case
is it should be InputStream is = getClass().getClassLoader().getResourceAsStream(config);?


3961
Returning Null Value  from  redissonClient.getMapCache(CLIENT_MAP).get(key)  in replicated  multinode cluster.

Hello,
I am trying to fetch  a value for a particular key from a replicated  multinode cluster.  This cluster has 2 nodes. Node1, Node2 with authentication on. I am inserting values and trying to fetch the same value.
Key-value pair insertion happened in node1. And while fetching the same key-value pair , I am suspecting it it trying to get it from node2.
Please find my code below
From redis cli I had to do readonly on node2 inorder to c the keys. If readonly is only option to fetch the key-value pair from java code, how to code it?
Help is appreciated . Thank you in advance.


3962
java.lang.IllegalArgumentException: Can't parse packet

I got such an error when I try to clear the RedissonLocalCachedMap.


3963
Cannot inject dependencies into runnable scheduled task

Hi, I am having trouble injecting beans into scheduled tasks. I am able to connect with redis to do other things so I don't believe it is a configuration issue.  ​I saw someone else had posted a similar issue but it seems like it got closed without being resolved: #2318
Essentially, I am trying to schedule a tasks on a distributed server to send a reminder to a user after x amount of time. In order to do this, I need to inject a bean to be able to get the current state of the user at the time the task is executed and another bean to be able to send the notification. However, I am running into the same Null Pointer and Not Serializable exceptions as from the issue above.
I have also tried another approach where I register the task to a RRemoteService so when it tries to execute, it will call a server-side RRemoteService that has the dependencies autowired. However, when I do that, it gives an IllegalArgumentException: Unable to serialize lambda.
I'm pretty stuck on what to do and I was wondering if someone could help provide guidance on if this would even be possible with Redisson or if I should try to find another solution? It would be helpful if someone could provide an example of an @Autowired service being injected into a task and it working.


3964
use redisson-spring-boot-starter maven  library, Redis is a cluster deployment, stringRedisTemplate  can set value ,but get value is null

springboot start is ok
the redisson and redis initialize is ok
now, stringRedisTemplate can set value, but get value is null


3965
I want save lock state with redis instance failover. What configuration for lock and redis can do this?

Hello, i search distributed lock, that if one redis instance crash all setted locks can be transfered and accessed from other redis instances.
I think this situation is solved only by redlock or multilock with 3 redis master nodes but not cluster ?
In documentation:
8.4. RedLock
This object is deprecated. RLock operations now propagated to all Redis slaves.
Is a blocking redundancy scheme possible with master-slave replication(sentinel, not cluster) ?


3966
Local cache not working as expected when executing multiple put and get operations on the same key

Expected behavior
We found an unexpected behavior using the Redisson local cache in our application.
This application is loading a redis map constantly using Redisson local cache, executing put and get operations.
The get operation returns the expected value almost all the time, but sometimes we found that it does not return the expected value. The expected value is what the application just put before the get operation.
This is something that only happens when we use a LocalCachedMap. If we switch to a Map then it works as expected. Anyway, we need to use a LocalCachedMap in this application.
In short: we expect to execute a put operation, then a get operation with the same key and receive the value that we just put before.
Actual behavior
Sometimes we execute a put operation on a "localCachedMap", then a get operation with the same key and receive a different value than what we just put before.
Steps to reproduce or test case
A test to reproduce the issue:
It fails on different iterations when you execute the test more than once:
We tried to remove the line 292 from RedissonLocalCachedMap.getAsync() and the test just works:
But we don't know why it reaches that line because the getAsync() method should end on line 262 when it finds the value on the local cache (the value should be on the local cache because we execute a put before the get):


3967
Too much log

How to get rid of this too much log? I use this dependency. i do not have anything else. logging.level.root=off does not help.


3968
How to get the list of group names associated with a stream?

How to get the list of group names associated with a stream?
I was hoping I could see the group names by calling stream.getInfo(). But we do not have any.


3969
RedissonLocalCachedMap should overwrite expire* methods

Local cache exists after redis' key expired. Here is my code:
Expected result: val is null.
Actual result: val is "bbb".


3971
Add Spring Data Redis 2.6.0 support

No description provided.


3972
Command still hasn't been written into connection! Increase nettyThreads and/or retryInterval settings

We are experiencing the error what seems like network related errors using the 3.13.2 version of redisson.
We run  code in the docker of rancher,  then have been occurred  on some pods. so confused am I.


3973
Is pipeline response list ordered?

Are pipelineMapList and keys kept the same order? If not, is there a way to get ordered result with response to the keys order.


3974
Unable to send PING command over channel

redisson:3.16.3


3975
Getting Out of memory error while reading RMap, Map contains over 200k data

Code:
RMap.readAllValues().stream().forEach => OOM Getting here..
Can someone please help me out, Is any available solution to read this load data in RMap, or will have to be read in batches ??


3976
Insertion order is not preserved when JSONJackson codec is used in RMap or RMapCache

Expected behavior
Insertion order should be preserved regardless of codecs configuration but unfortunately it is working only for StringCodec . The problem with string codec is during retrieval it will display the contents as "to string" implementation of java . So need resolution for JSONJackson Codec for preserving insertion order
Actual behavior
Currently it is not working for JSONJackson Codec , it is only working for String codec
Steps to reproduce or test case
Just Create a Bean of RedissonClient and then setup a RMap or RMapCache Bean with JSONJacksonCodec instance and try to insert the contents into redis the latest item is placed first and the previous one to the last no insertion order is maintained


3978
Local cache not working as expected when executing get, put and get operations on the same key

This is a extension of the issue #3966 because we could not reproduce the problem with the provided test.
So, we are trying to provide a new test trying to reproduce the actual issue that we observed on our application.
Expected behavior
We execute these operations on a local cache that points to a redis map already initialized:
We expect to receive the new value on the third operation.
Actual behavior
Sometimes we get the initial value on the third operation.
Steps to reproduce or test case
A test to reproduce the issue:
It fails on different iterations when you execute the test more than once:


3979
none




3980
 org.redisson.client.RedisConnectionException: SlaveConnectionPool no available Redis entries

Specification we are using:
AWS Elasticache- Redis 5.0.6 (Cluster Mode with master and slave)
We are intermittently facing the below error. I think this is because the Master instance is loosing connection to the slave instance.
If we check the elasticache, all instance in the cluster are in available status.
Only way to resolve is to redeploy the application.
Any idea on configuration that should be tweaked? Or does redisson provides any time interval to refresh the connection to avoid this?
I checked the other post but looks it is closed but doesn't have an answer to the question.


3981
SlaveConnectionPool no available Redis entries. Master entry host

Spec Used:
We intermittently get below error .. I think this is because the Master instance is loosing connection with the Slave instance. If we check in Elasticache, all the nodes are in "available" status.  Only solution we do is to redeploy the app to resolve the error.
Any idea what parameter should be added or tweaked related to this issue? or can Redisson provide any interval option to refresh the connection pool?
Note: I verifed the post 2535 .. it is in closed state but the question isn't addressed.


3982
Redisson locks can consistency guarantee ?

Redisson locks can consistency guarantee as raft consensus protocol (ex:hazelcast) with schemes cluser and master+slave(sentinel) ? It dont have problems as has hazelcast before cp-subsystem(ver3.12) "at least once"


3983
 SlaveConnectionPool no available Redis entries after Redis pod restart

Expected behaviour : When the Redis pod(stateful set) restarts, the application should be able to reconnect to the redis pod automatically.
Actual behaviour : When the Redis pod restarts, the application is unable to reconnect to Redis even after multiple retry attempts. I tried this in a single node setup. When Redis pod is brought down, another pod is spun up in few seconds. But the app is unable to reconnect automatically. After the app pod restart, it works fine.
This is the exception thrown.
Please let me know if there's any workaround for this other than the restart. Thanks


3984
Stuck on joining HashedWheelTimer worker thread when shutting down

Sometimes Redisson seems to be stuck when calling Redisson.shutdown(). Some Services are stuck for mutliple days. But it seems to be a very rare event,
This is the Thread netty tries to join. Stack trace does not seem to change over time (took multiple thread dumps)
Expected behavior
Redisson.shutdown() should be blocking but not for ever
Actual behavior
Redisson.shutdown() is stuck for days (in some rare cases) and the Timer thread is taking huge amounts of processing power (this is not a typical profiler bug with parking threads but acutally showing in the process list)
Steps to reproduce or test case
Not tried but maybe if you could point us in a direction.


3985
java.lang.IllegalArgumentException: com.fasterxml.jackson.core.JsonParseException: Unrecognized token 'local': was expecting

Hello all i am trying to access json filed in criteria query but getting above error could you please help me for the same.
subquery.select(root).where(this.criteriaBuilder.equal((packageRoot.get("publis")), userEmail));
here publis is the json in repository


3986
Codec

That code format is stable and I see a change in the code format


3987
Failed slaves aren't detected in Replicated Mode.

No description provided.


3988
Why Redisson is unable to connect?

On connection with redis I'm getting this:


3989
 ERR Error running script (call to : @user_script:1: user_script:1: bad argument #2 to 'unpack' (data string too short

I am unable to understand this error. Please help.
I am trying to read using getMapCache(ALLUS_XXX)
also, in redis cli if I do hgetall ALLUS_XXX.  This is the output
This is easlily reproducible,
Now try to access this using redisson getMapCache("ALLUS_XXX").readAllEntrySet()


3990
none




3991
 Inquire about the distributed scheduling task service (Scheduler Service), how to achieve that only one of the multiple worker servers (worker) executes tasks at a time?

Inquire about the distributed scheduling task service (Scheduler Service), how to achieve that only one of the multiple worker servers (worker) executes tasks at a time?
My code is as follows:
Configuration code:
Schedule task code:
According to the configuration, log("task has been executed!") will be output every 5 seconds. It is currently started on a single server, and the scheduled task service can run.
But if you start the service on multiple servers, the process on each server will output every 5 seconds, but what I want to achieve is: on multiple workers (workers), only one of them (or Random, or polling, or preemption) execute a task every 5 seconds.
How should I configure the distributed scheduling task service to achieve this effect?


3992
CROSSSLOT error when rename spring session id

Expected behavior
rename session id
Actual behavior
Suppressed: reactor.core.publisher.FluxOnAssembly$OnAssemblyException:
Steps to reproduce or test case
My app is a spring cloud gateway app, and store session information in Redis through Redission.
This is my facroty bean:
I found some issurs with the same CROSSSLOT error at October, 2020 and fixed by
But the reactive connection do not use the ReactiveKeyCommands class fixed in that PR. Maybe this bug is happening again?


3993
Redisson can client-side sharding or partitioning?

Redisson can client-side sharding or partitioning?


3994
RLock syncedSlaves in BatchResult is not checked

I tried RLock(Redisson master branch, redis 5.0.5) with the following config and tried to test whether synchronous replication works with master-slave. After I killed one replica and the lock can still be granted(there was only one client trying to get the lock), what I expect is that the client failed to acquired the lock cause the command was not able to propagate to all the replicas.
After debug for a while, I found that BatchResult for EVAL & WAIT command was not checked in RedissonBaseLock.evalWriteAsync method,  i.e the syncedSlaves in BatchResult was not checked.
So is it because i misunderstand the synchronous replication mechanism used in Redisson or it's a bug


3995
Why Redisson is  connect  Timeout?




3996
java.lang.OutOfMemoryError after upgrading to 3.16.5 (LocalCachedMap)

Expected behavior
no OutOfMemoryError on applications using the same Redis server but the previous version of redisson 3.16.3
Actual behavior
applications starting to OOM running version 3.16.3 while an application running with 3.16.5 was fine
Steps to reproduce or test case
access the same Redis server with different versions of the library (3.16.3 vs. 3.16.5)


3997
none




3998
Redis vendor rename command 'eval' to 'xxx_eval', redisson throws exception when I use it.

Can I configure this command somewhere?


3999
none




4000
Redisson 3.16.4 is using netty-transport 4.1.68.Final but when I upgrade to 3.16.4 of redisson is still using netty-transport 4.1.65 version

When upgrade the redisson version from 3.10.4 to 3.16.4
netty-transport should be 4.1.68
just upgrade the redisson version 3.16.4 in a gradle project
Hello, I have the same issue for 3.16.4. I am using gradle and I updated my redissson version from 3.10.4 to 3.16.4 to solve a CVE. But when I checked the dependencies I realised that some how I do not know why, the versions were downgraded from 4.1.68 to 4.1.65 for netty-transport (it comes with redisson).
Could you take a look, please?
Thank you.
Here is the output;


4001
Read operations are not evenly distributed among all the redis nodes in replicated mode and master_slave read mode.

Expected behavior
We use redisson to connect to 3 redis nodes in replicated mode and MASTER_SLAVE read mode (AWS ElastiCache).
We expect to distribute the redis read operations evenly among the 3 redis nodes.
Actual behavior
Since the upgrade of redisson to version 3.16.15 PRO we notice that our application does not distribute the redis read opeations evenly to all the nodes, and only one redis node receives almost 100% of the read operations.
Yesterday at 20:40 we deployed our application with only one change: upgrade redisson from 3.16.4 to 3.16.5.
And today at 11:10 we rolled back our application to the redisson 3.16.4 version.
This graph shows:
Until 20:40 the 3 redis nodes received the read operations evenly (redisson 3.16.4)
Steps to reproduce or test case
Connect to 3 nodes in replicated mode and MASTER_SLAVE read mode.
Execute multiple read operations.
Check redis read operations metrics.


4002
Can MessageListener annotated with @FunctionInterface for java8?

Is your feature request related to a problem? Please describe.
MessageListener can be annotated by FunctionalInterface to use lambda?
Describe the solution you'd like
java.lang.FunctionalInterface
Describe alternatives you've considered
this interface have only one method  onMessage  now


4003
WARN logs when using SentinelServers config

Expected behavior
Connected using SentinelServer config, all the Redis pods(1master, 2 slave) are up and running in the Kubernetes cluster. Sentinels are also running along with the Redis containers like a sidecar. No WARN logs to be printed when connection is fine.
I am connecting to the Redis headless service in kube.
Actual behavior
Getting continuous WARN logs like below for all the IPs where Redis pods are running
Steps to reproduce or test case
3 Redis pods running along with Sentinels
App connected to Redis with Sentinel config
Please let me know if i have mis-configured anything. Thanks.


4004
Unable to connect to host using DNS resolver on Java 9+

Expected behavior
Using Java 16/17 I can connect with a host by host name successfully, just as with Java 8
Actual behavior
When running the same code with Java 8, I can successfully connect to a remote host by name, but with Java 9, 16 and 17 I cannot.
Stacktrace:
Steps to reproduce or test case
I am using Redisson, which is using Netty:


4005
Can't Find Node in Slaves in Version 3.16.5

Expected behavior
Have 1 master and 1 slave (with AWS ElastiCache). When testing failover by through modifying of the node type of the redis instance, expect after failover that there are no errors when querying the new master/slave.
Actual behavior
Getting the following error message:
Can't find replicaAddr/<host> in slaves! Available slaves:
Steps to reproduce or test case
Deploy Service
Modify node type of redis instance
View application logs and see errors


4006
none




4007
RateLimiter - Can't expire RateLimiter value/permits although can expire config?

When using RRateLimiter.expire(), RRateLimiter sets TTL to config Hash set, but doesn't set TTL to value and permits.
IIUC, value and permits consumes more memory compared to config Hash set.
Is there a way to expire value and permits?
NOTE:


4008
Buffer overflow error while running tests after adding Redisson dependency

This is happening on my CI/CD tool (Semaphore CI). After adding the Redisson dependency, the build always fails with the error:
My CI/CD uses a Ubuntu 18.04 VM and has Java 11.0.11 installed.
I think the problem is likely related to that VM, as if I run the tests locally (Ubuntu 20.04, OpenJDK Runtime Environment AdoptOpenJDK-11.0.11+9) the tests are executed as expected.
Has anybody had this problem before? Do you have any idea on what might be creating this error?
Thanks in advance for any help!


4009
Read Only (not writable_ access from redisson

We want to enforce that Application can only read the data from Redis Master node but is not able to write or make into modifications into the Redis Master node in replicatedServerConfig. Can you please inform how can we do that?  Is that using readMode :MASTER ? Can you please provide the yaml configuration for that ?


4010
ClientConnectionsEntry.getFreeAmount() removed?

Hey guys.
When moving from version 3.16.3 to 3.16.5 I've noticed compilation issues due to the missing method getAmount() which underneath was running freeConnectionsCounter.getCounter():
My question is was that intentional and is there a substitute method somewhere? I couldn't find a quick solution for this.


4011
Incorrect connection calculations in version 3.16.5 and 3.16.6

I have a limit of 20 connections per server and in previous versions the initialization was correct. But in version 3.16.5, the SlaveConnectionPool was initialized, which creates 24 connections by default. But I cannot reduce their number for configuration in single server mode and I cannot disable the creation of this pool either.


4012
none




4013
get LocalCachedMap lead to OOM

Expected behavior
not hope to oom;
Actual behavior
home get  redissonClient.getLocalCachedMap() can olny single entity,but evrytime get a new new RedissonLocalCachedMap<K, V>(xxxx),more request lead to OOM


4014
Why redisson opens many connection to slave even creates client by single server?

Above code by default it create client using single server config, but it still opens many connection for other purpose, why?
connected_slaves:0


4015
none




4016
Got a NullPointerException in WriteReadLock

the redis model is cluster


4017
RSet.distributedIterator() and RScoredSortedSet.distributedIterator() methods throw script error

No description provided.


4018
none




4019
redisson-mybatis - Application still works if Redis does not respond

Hi, We are looking to configure redisson-mybatis, so that when for some reason Redis does not respond, the application can be running without problems.
The idea is to leave a trace of the connection error, but that the application executes the sentences and continues working.
I found this similar report, but for Tomcar. Issue
The question is if this behavior is possible, and if not, could I report a feature?
Thanks for your time


4020
Redisson executor: service rolling upgrade compatibility

Consider the following scenario in a service HA cluster:
service 1 node 1 is at version 1, with task-legacy-1
service 1 node 2 is upgraded to version 2, with task-legacy-1, task-new-1
service 1 node 2 submits task-new-1 to Redisson executor.
There's a chance that service 1 node 1 picks up the submitted task-new-1, but will fail due to lack of definition.
I think this issue is common for all services that using Redisson executor. What's the best practice?
Thinking of potential solutions:
Normally with distributed scheduler, there's a tag filter, to filter worker nodes for task. But can't find similar thing in Redisson. ------ please advise.
Another idea is to use different executor namespaces, and each service version N submits tasks to executor-N (the latest) and executes task from both executor-N-1 and executor N.  However this is also hard for upgrade and eviction of old executor is needed. Seems a blocker when there's recurring schedule submitted in old executor. Not sure how to migrate.  ----- please advise.


4021
redisson-spring-data: RedissonConnection eval codec bug?

Any one can help me ?
Why the eval method in RedissonConnection use codec:StringCodec.INSTANCE , but evalSha method use ByteArrayCodec.INSTANCE.
I found that the eval may encode the byte array (response from redis server ) into String, which may cause Serialization problems.
Is it a bug?


4022
Error while aquiring ReadWriteLock and Lock at the same time

When I call method runWithRwLock and method runWithMultiLock at same time, it works fine. When I call method runWithLock and method runWithRwLock/runWithMultiLock, the following error is frequently reported
This is my test code:


4023
Error while acquire Lock and ReadLock

Steps to reproduce or test case
Let me simplify the reproduce process:
Thread x get Lock "A" and hold the Lock
Thread y get ReadLock "A" and also hold the ReadLock
Thread x and thread y all acquired lock
Thread y call method unlock to release ReadLock y
After a few seconds, thread x also call method unlock to release Lock x,and then it causes an exception
Here is stacktrace


4024
 Unable to init enough connections amount! Only 3 of 8 were initialized.

The Redis version was upgraded from 5.0.3 to 6.2.4, and this problem occurred.
The configuration file for Redission has not been modified
Redission version is 3.15.5
This is a detailed error message :


4025
none




4026
Mention that classes need to be Serializable in guides and documentation

We've wasted way to much time searching for a problem in our codebase. I think it won't hurt to add a note in the official guide :)
Here:


4027
link display problem




4028
org.springframework.dao.QueryTimeoutException: Command still hasn't been written into connection! Increase nettyThreads and/or retryInterval settings. Payload size in bytes: 0. Node source: NodeSource




4029
Is hibernate-redisson support Hibernate 4.1.2.Final ?

No description provided.


4030
hibernate-redisson4 expire time configuration not working

I am trying to integrate redis with hibernate 4.1.3.Final. But expire time configuration not working.
Here are my redission configuratio:


4033
multilock fail

Expected behavior
lock successful
Actual behavior
lock fail when get first lock in multi lock case
Steps to reproduce or test case
when I set waitTime=0in multi lock , it fail, but I set waitTime=0 in RLock, it success, why?
then , debug RedissonMultiLock,  until Line 413
I think it is a bug in RedissonMultiLock


4034
RLocalCachedMap sometime does not sync data from Redis

Hi,
I have 2 servers that use the same RLocalCachedMap. Server A I use to put data and Server B just use to query data.
I'm facing with issue that sometime Server A updates data but Server B data is still old (cached value is not updated). I checked log but no Redisson exception there.
If I invoke localCachedMap.preloadCache() on server B (via SOS REST call), data of server B will be updated.
I'm using Redisson 3.16.5
This is my LocalCacheOptions
LocalCachedMapOptions.defaults() .evictionPolicy(LocalCachedMapOptions.EvictionPolicy.NONE) .cacheSize(0) .syncStrategy(LocalCachedMapOptions.SyncStrategy.UPDATE) .reconnectionStrategy(LocalCachedMapOptions.ReconnectionStrategy.NONE) .writeMode(MapOptions.WriteMode.WRITE_BEHIND);
This is my RedissonConfig
Please help me to point out some ways to investigate and resolve this issue.
Thanks


4035
mget send multi commands on same master slave entry in cluster mode

Expected behavior
mget  group keys by master slave entry,  different slot with same master slave entry keys send one command
Actual behavior
mget  group keys by slot, different slot with same master slave entry keys send multi command
Steps to reproduce or test case


4036
none




4037
none




4038
none




4039
Subscription allocation per Redisson and not local cache instance.

No description provided.


4040
Config readMode from SLAVE but redirect to MASTER

Expected behavior
The Lua script executes on the Slave node
Actual behavior
The Lua script executes on the Master node
Steps to reproduce or test case
Here is the Java code:
Here is the Lua script
After executing Java code and the Redis's log like bellow
We can see that the Lua script is executed on the master node (127.0.0.1:7001) instead of the slave node (127.0.0.1:7005), but I have already config the readMode to SLAVE & pass the RScript.Mode.READ_ONLY config when evalSha.
Please help me correct if I'm wrong, thanks!


4041
hibernate-redisson4 application don't start if redis server is down. What should I do that if redis server is down it won't stop the application?

No description provided.


4042
SlaveConnectionPool enabled when use single server

Expected behavior
There should be just MasterConnectionPool enabled when useSingleServer.
Actual behavior
When trying to connect to Redis containing one node, slave connection pool will also be created.
Steps to reproduce or test case
Connect to single redis server.
there is a addSlave() call when single server is used.
This maybe edited for creating slave connection correctly in some cases. But it will also create a pool when using single server.


4043
how to batch add object to bloomfilter

first, please forgive my poor english.
my question :
is there any efficient way to batch add object with bloomfilter?
such as pipeline?


4044
multi lock fail

Expected behavior
lock successful
Actual behavior
lock fail when get first lock in multi lock case
Steps to reproduce or test case
when I set waitTime=0in multi lock , it fail, but I set waitTime=0 in RLock, it success, why?
then , debug RedissonMultiLock,  until Line 413
I think it is a bug in RedissonMultiLock


4046
Reads only happening from Master Node for Redis Cache in Elastic Cache replicated mode

We are using the clustered connection in aws for redis, but the read is always happening from the primary node.
The versions we are using:
@mrniko  Could you check this once you have some time. I am sure you can provide a relevant answer very fast.


4047
How to use Reactive/RxJava api?

Unfortunately, the docs doesn't contain any information about Reactive and RxJava Redisson apis. How you even use them?
For example, RMapRx#get(K) returns Maybe<V>, how it can be considered reactive? Shouldn't it be an Observable<V>? How it is any more useful than just returning something like a CompletableFuture<V>?
What is the use case of these apis?
Also, .getLocalCachedMap() is unavailable in reactive and rx apis, why?


4048
[Bug] Version 3.16.6: RedisConnectionException: Unable to init enough connections amount

Expected behavior
I should be able to create a RedissonClient
Actual behavior
This only happens with version 3.16.6. 3.16.4 doesn't cause this error. Also, this error only happens with the local embedded Redis. On a real remote Redis server, it works fine.
On create, I get this error:


4049
PooledUnsafeDirectByteBuf Error

use codec
What's happen? Sometimes this error happens


4050
MultiLock causes deadlocks in high concurrency cases

Expected behavior
No DeadLock
Actual behavior
DeadLock
Steps to reproduce or test case
The complete code is as follows
Deadlocks don't happen every time. After running the program for a while, I found that the process stopped and the keys in redis were fixed, not added or reduced. What is even more strange is that the expiration time I added the lock is 800ms, and if I use the ttl command to get the expiration time, the result should be 0 or 1, or a negative number. But, I found a number greater than 1! And it keeps changing, like this: 4s -> 3s -> 2s -> 4s


4051
Allow specifying class instance each time when deserializing

Currently, if you deserialize an object it will always be created using the same class instance as when it was serialized. This will result in a ClassCastException if you serialize and deserialize from classes loaded by different class loaders (which is a case when using something like hot code reload).
The proposed solution is to add a type parameter in every method that deserializes an object, e.g.
MyClass value = rMap.get("key", MyClass.class);
Which is the same as in a popular GSON library.


4052
What If RLock Implement java.io.Closeable? ·

Is your feature request related to a problem? Please describe.
Describe the solution you'd like
auto unlock with try...with...resource
maybe code like this
Describe alternatives you've considered
haha. just make code eaiser.


4053
ScoredSortedSet - diff is broken

diff method is broken RScoredSortedSetReactive.
Create 2 SortedSet and do the diffstore in redis.
check what set:1 contains. It contains only "a"
Now do the exact thing with redission.
It does not do any diff. set:1 contains all the original elements.


4054
RedissonCommands.EVAL_MAP_KEY_SET using MapValueDecoder

Expected behavior
When invoking RedissonMapCache.readAllKeySet() the codec's map key decoder should be invoked, i.e  Codec.getMapKeyDecoder()
Actual behavior
The codec's map value decoder is being used to decode keys, i.e. Codec.getMapValueDecoder() which causes exceptions to be thrown depending on the codec being used.
This is caused by RedisCommands.EVAL_MAP_KEY_SET being defined using MapValueDecoder instead of MapKeyDecoder.  I have locally amended the command to use MapKeyDecoder which fixed the problem
Steps to reproduce or test case


4055
High Memory Consumption with publishAsync

Hey! After doing this as just a test of Redisson pubsub
The thing is, when using the method .publishAsync, memory usage increases too much really fast, but when using .publish, it doesn't
Is this an expected behavior? am I doing something wrong that could be causing that?
I'm running this with 8GB of ram


4057
Redisson WriteRedisConnectionException timeout




4058
Cannot connect to redis memory store mode standard on GCP

Hi. I create memory store redis mode standard with replicas on GCP. I using single server config to connect to primary endpoint, but error.
Anyone know config to connect to redis, this is myconfig. Thanks!


4059
What is behaviour with getList with non existent key

Hi Team,
Can you describe about the case when we do a getList(key) for a non existent key and also we did some operations on Rlist from previous call
i could not found a javadoc i can find which states this case


4060
Time to live for cache elements from both Local and Redis in Near Cache

How can I evict cache elements based on time to live and idle time from both Local and Redis cache for RLocalCachedMap (near-cache). As of now, is this possible in open source edition (or) do I need to buy Pro license.
It would be a great feature if its available in open source edition.


4062
clusterSlots() Method Throwing Type Exception (Redisson 3.16.7)

Expected behavior
No exceptions expected when querying for clusterSlots:
Actual behavior
Get the following exception:
Steps to reproduce or test case
Use Redisson in clustered mode
Call the following code:


4063
Requirement of Insertion Order in RMap Data Structure in Redisson

Is your feature request related to a problem? Please describe.
Currently have been using RMap for Read-through and Write through Caching Operations and have leveraged benefits out of it. The only benefit we still need is the requirement of Insertion order in RMap as per implementation it is using HashMap .
Describe the solution you'd like
So can insertion order requirement be considered using LinkedHashMap Implementation, which will be most beneficial to many of us
Describe alternatives you've considered
We considered going for dequeue, list and other ds but they didn't provide flexibility and performance offered by RMap DataStructure.


4064
Thread safe problem when acquiring locks resulting in a pubsub channel not being unsubscribed · 64 ·

This seems to be related to:  #2575
Expected behavior
The pub/sub channels that are created while trying to acquire a lock with RedissonLock should be unsubscribed when no longer needed.
Actual behavior
In some cases when 2 pub sub channels are created around the same time for (2 different lock keys) one of the two throws an error:
Subscribe timeout: (7500ms). Increase 'subscriptionsPerConnection' and/or 'subscriptionConnectionPoolSize' parameters.
After this error the failed lock key will lock fine when not locked. If it is however locked by another thread it will fail instantly.
see the logging from the test case below, notice how thread [pool-1-thread-12] successfully locks key 0. When thread [pool-1-thread-19] tries to lock lockkey-0  it instantly throws the subscribe timeout exception (notice it does not wait 7500ms).
If there is no locking going on and the app is still running it kept a channel active for lockkey-0
Some logging from the test case when it fails:


4065
How to use 'zAdd'?

How to use 'RedisZSetCommands.zAdd(byte[] key, double score, byte[] value)'?
not implemented?


4067
How to use multiple entities with AvroJacksonCodec

I have two entities in a package.
I try to use AvroJacksonCodec(ClassLoader classLoader), the classLoader is got from one entity.
When I try to save data to Redis.
It has the error
java.lang.IllegalStateException: Can not write Avro output without specifying Schema
How should I resolve it?
Or the AvroJacksonCodec only for one entity for a RedissonClient?


4068
ERR WAIT cannot be used with slave instances

This occurs when trying to acquire a lock.
Currently, we are using redisson library 3.16.3 with readmode: SLAVE


4069
Unable to resolve master.****.cache.amazonaws.com ·

Expected behavior
expected no exception
Actual behavior
Unable to resolve master.****.cache.amazonaws.com


4070
I have migrate my spring boot prject from 1.5.x to 2.3.12 and I have used redis cache to get the user details but it is not working

when I am tring the get the data from redisson.getmap it is showing this error


4071
Why list has all value, but redisson get one by index from the list will reconnect Redis?

1、List has all values, but when get by index redisson will reconnect redis.
2、Isn't it dangerous to get all the data of the list in memory?


4072
delayedqueue  serialization is not expected ·

view by rdm:


4073
Change RedissonLocalCachedMap.cachePut access modifier

Hi,
I want to monitor latest updated time of Redisson local cache map. But I see that cachePut access modifier is private and I cannot override it.
Now I'm copy the original RedissonLocalCachedMap.java to a new file for my purpose.
I wonder that can Redisson change RedissonLocalCachedMap.cachePut method access modifier to protected or public?
Thanks


4074
io.netty.resolver.dns.DnsNameResolverTimeoutException: query via UDP timed out after 5000 milliseconds

io.netty.resolver.dns.DnsNameResolverTimeoutException:query via UDP timed out after 5000 milliseconds
You need to check dns server.
If it is DNS problem, there will be happened all over the entire K8S cluster, but the phenomenon is a few services, there are several exceptions, and the frequency of occurrence is 1-2 days.
Originally posted by @Brainhu in #4069 (comment)


4075
Hi @ybonda  facing similar issue. Could you please provide more details what the issue was in Redis configuration?

Hi @ybonda  facing similar issue. Could you please provide more details what the issue was in Redis configuration?
Originally posted by @Lakshmihm in #474 (comment)


4076
Quarkus redisson config fails to load in cluster mode with only one node address

Configuration is not successfully loaded if there is only one node address configured in cluster mode.
Expected behavior
Configuration should be loaded successfully, documentation states that only one is required.
Actual behavior
Steps to reproduce or test case
Setup Quarkus project
Add redisson-quarkus-20 dependency
Configure Redisson client to use cluster mode with single node address


4077
RedissonMap keySet() is inefficient

This feature request is partially driven by a problem we are having and our attempts to fix it.
We have multiple services and are utilizing LocalCachedMap's for various write once read many use-cases. The problem arises when a different service needs to invalidate keys in those LocalCachedMap's without the required keys in the class path. We started out with this looking like
localCacheMap.fastRemove(localCacheMap.keySet("pattern*").toArray(String[]::new));
But were getting ClassNotFoundException as Redisson is executing an HSCAN which is returning both the Key and Value and these were being run through the Codec leading to this error.
Currently our workaround is to use a custom codec that just discards the value to avoid this issue.
The only reason I call this a workaround and not a solution is because the values we have in the map are vary large when compared to the keys, so there is an overhead to moving those all over the network that would be great to be able to avoid.
Currently it looks like in RedissonMap the keyIterator(...) will use a RedissonMapIterator and just grab the key and do nothing with the value.
It may be possible to use a Lua script such as the one found here  to only actually return the keys from the HSCAN call and prevent the overhead of moving them over the network and unmashalling them.
A new iterator RedissonMapKeyIterator could be implemented for this specific use case.


4078
old messages in Reliable Topic are ignored

Expected behavior
When publishing a message to a Reliable Topic with no subscribers, then registering a subscriber the messages should be received.
Actual behavior
Messages published before the registration of listeners are ignored
Steps to reproduce or test case
App 1
App 2
Run App 1, let it send the message/messages.
Run App 2, messages won't be received.


4079
About RReadWriteLock can work ?

The code as follow can work?
@jackygurui


4080
Redisson : Issue while unlock lock for a key ,  attempt to unlock lock, not locked by current thread

Hi, I am getting below errors in my logs.
I am using below dependency for redisson:
And I've implemented a wrapper that will acquire and release the lock:
But the log "Released lock for key" is logged rarely. The task after acquiring the lock gets finished within 1 or 2 seconds and the wait and lease time are 5 and 15 secs respectively.
RedisConfig is :
We have redis server in Kubernetes cluster with 2 pod instances both as master.
Would appreciate any suggestions?


4081
RMapCache size() method is inconsistent with keySet()/values()/entrySet() methods

Expected behavior
size() method should return the same value as count of items in collections returned from keySet()/values()/entrySet() methods.
It is needed to safely convert RMapCache to other collections. Typical conversion involves 2 steps: retrieve size(); then based on that value do further conversions. Some implementations could use iterator().next() right after checking that size() > 0, it is expected to be safe.
Actual behavior
size() method does not take expired items in mind, but keySet()/values()/entrySet() methods return not expired items only. It gives count inconsistency. Implementations using iterator().next() right after checking that size() > 0 will fail with java.util.NoSuchElementException
Steps to reproduce or test case
Unit tests in Kotlin illustrates the problem:


4082
org.redisson.client.RedisException: ERR unknown command 'WAIT'

When I use Redisson of V3.14.1 and advanced version, it occur a error such as code below. But if I use V3.14.0 and older version, the error didn't occur.My redis is redis-5.0_0.3.4 of community version and it deploys as cluster mode.My jdk version is 1.8.0_261.
I guess it has something to do with the jdk version or netty-buffer version.But I can't find the answer.
When I use V3.16.7, it also occur the same error, and the error contains , params: [1, 1000]', such as:


4083
Add configuration to MasterSlaveServersConfig to manually set syncSlaves

Hello,
I'm using a MasterSlaveServersConfig with readMode="SLAVE" and Redis Enterprise. While this configuration works with Redis OSS, it is not always applicable to Redis Enterprise since read-replicas are scaled-out at the database-level; not shard.
Redis Enterprise can guarantee HA with a single replica shard however the throughput requires multiple read-replicas. This mismatch between the total slaveAddresses registered in the configuration and total shards used for HA causes a timeout in the WAIT command issued by Redisson Transactions.
I checked Redisson’s code and found that the MasterSlaveServersConfig is passed to the MasterSlaveEntry which is used by BatchOptions to set syncSlaves based on the amount of slaveAddresses configured. When a Redisson Transaction is executed, the amount of syncSlaves determines how many HA replica shards are needed to respond before the WAIT command releases its lock. With the mismatch, this means that they will always timeout.
As a workaround, I'm using a single slaveAddress in MasterSlaveServersConfig which points to a reverse-proxy for load-balancing of reads between two separate Redis Enterprise database endpoints. Those databases are kept in-synch using Redis Enterprise's replica-of and it worked. However, this is not an optimal solution since it adds an extra network-hop and deployment complexity.
So, my feature request is to add a new optional field in the MasterSlaveServersConfig to set syncSlaves manually which will allow users to pass multiple slaveAddresses without impacting the use of the WAIT command on the master database/shard. Since the freeze logic is run in other connection related methods, there would still be protection to handle unavailable read-replicas.
Thanks, Allen


4084
Classloader issue when using RScheduledExecutorService

Classloader error thrown when invoking method of Autowired Spring Bean in a Runnable task.
I tried a couple of things,
Supplying class loader to constructor of codec (MarshallingCodec) - no difference
config.setUseThreadClassLoader(false) - no difference. It does not seem to be used at all TasksRunnerService
See for full example: https
Redisson version: 3.16.7


4085
how to loadAllKeys  into redis stream?

The following MapLoader can load all key into redis map,
but my quesiton is : how  loadAllKeys  into redis stream?


4086
RPermitExpirableSemaphore.tryRelease returns true for already expired semaphore

Expected behavior
RPermitExpirableSemaphore.tryRelease(permitId) method returns false if the semaphore was already expired
Actual behavior
RPermitExpirableSemaphore.tryRelease(permitId) method returns true even if the semaphore was already expired
Steps to reproduce or test case
Create a semaphore with TTL
Wait long enough for TTL to expire
call tryRelease() method
Note: I couldn't figure out how to make a PR for contribution (push it unauthorized), so below is my suggested fix in RPermitExpirableSemaphore.tryRelease(String permitId) method :


4088
RedissonDelayedQueue stop transfer timeout elements to destination queue

After using for a while, the RedissonDelayedQueue stop work.All added elements are backlogged in the queue, even if many elements have already timeout.
When I restarted the application,all the elements will transfer to the destination queue.
Even if I use the following code to force trigger the publish,it still doesn't work.Only restart can resolve.
My Redisson version is 3.15.5 ,And used in SingleServer mode.  Redis version is 6.0.0


4089
can not cast to JSONObject

Error message after storing data


4090
[BUG]#2 to 'unpack' (data string too short) Exception in RRateLimiter

#2 to 'unpack' (data string too short) Exception in RRateLimiter
Steps to reproduce or test case


4092
spring boot application with redisson for spring cache usig aws elasticache redis

Our redis nodes seems to use lots of cpu, how can we find more information about why that much cpu?
And what sort of redisson configuration we can do to help that ?
Having bigger instances in AWS would not sove it as redis is still limited to one cpu core.
we use redisson for caching with spring boot cache. One cache is caching 'big' data  (heavy structure for pagination), another one has more smaller entries but lots of potential cache check/write.
What sort of metrics we can get from redisson to get a better understanding of the cpu use in redis ?


4093
RMapCache EntryExpiredListener doesn't work after AWS ElastiCache failover

Expected behavior
When AWS ElasticCache fails over, and redisson client automatically reconnects to ElastiCache, the EntryExpiredListener , which is added to RMapCache, should still get notified when an entry is expired.
Actual behavior
When AWS ElastiCache failed over, and redisson client reconnects, the EntryExpiredListener is not notified.
And we see logs like this	at io.netty.util.concurrent.PromiseTask.runTask(PromiseTask.java:98)
Steps to reproduce or test case
Connect to AWS ElastiCache with Replicated Mode
Create RMapCache, add EntryExpiredListener
Test with correct behavior:
--3.1 Save key/value pair into RMapCache with ttl= 5 minutes
--3.2 When the key/value expires, EntryExpiredListener is notified
Test with Failover
--4.1 Save a new Key/value pair into RMapCache with ttl= 5 minutes
--4.2 Failover ElastiCache Primary node
--4.3 After Redisson client reconnects, EntryExpiredListener is NOT notified
--4.4 Continue to add another new key/value pair with ttl = 5 minutes
--4.5 When the new key/value pair ttl expires, EntryExpiredListener is NOT notified


4094
java.lang.NegativeArraySizeException after upgrading Redisson from 3.16.1 to 3.16.8

Hi, I'm facing with this exception after upgrading Redisson. Please help me out.
Expected behavior
System should work probably
Actual behavior
After upgrading from 3.16.1 to 3.16.8. This exception is thrown
Redisson version
3.16.8
Thanks


4095
For ReplicatedServers, Reads still going to Master with default settings

Expected behavior
Reads only go to Slaves (read replicas)
Actual behavior
Reads go to Master node as well.
Steps to reproduce or test case
Use replicated servers, have 1 master with 4 replicas in AWS ElastiCache
Observe read load on Master Node, it is way above non-zero.


4096
RedissonLocalCachedMap throws NullPointerException

RedissonLocalCachedMap init ,it may throws NullPointerException
Expected behavior
behavior normal
Actual behavior
Steps to reproduce or test case
RedissonLocalCachedMap is in init,and the listener received msg at the same time,it throws NullPointerException just like the picture


4097
Introduce WAIT command to RPermitExpirableSemaphore

Is your feature request related to a problem? Please describe.
In Issue 2669, Redlock was deprecated by integration of WAIT command to RLock. However, the problems caused by out of synchronization nodes still exist for semaphores.
Describe the solution you'd like
It could be helpful to introduce the WAIT command to RPermitExpirableSemaphore.
Describe alternatives you've considered
Couldn't find many alternatives other than implementing a Redlock like algorithm for semaphores.


4098
Quarkus environment variables not working

Some environment variables are not working.
In case we want to override this value with the environment variable: QUARKUS_REDISSON_SINGLESERVERCONFIG_ADDRESS, the configuration fails to load. It seems that: #3943 didn't completely solve issues with environment variables.
Expected behavior
Configuration should successfully load when using ENV variables.
Actual behavior
Steps to reproduce or test case
Setup Quarkus project
Add redisson-quarkus-20 dependency


4100
RPermitExpirableSemaphore memory not released after expiration

Expected behavior
If RPermitExpirableSemaphore with a single permit is acquired but never released, the memory is released after TLL is over.
Actual behavior
RPermitExpirableSemaphore is not released after expiration time. Probably keys with resource-name, and {resource-name}:timeout are not cleaned up.
Steps to reproduce or test case
A load test with only random name acquires but no releases shows memory usage increasing. After the test is over, Redis memory usage level stays the same and does not decrease.  The line chart below shows Redis memory usage of 2 consecutive load tests with a pause interval between them.
Below is the graph for number of keys for the same tests:


4101
Configuration doc error. tcpNoDelay is true by default

Expected behavior
Read in doc:
tcpNoDelay
Default value: true
Actual behavior
tcpNoDelay
Default value: false
Steps to reproduce or test case
Check https and read any tcpNoDelay entry.
I can not fork wiki project to create pull request :( (but I've added a patch)


4102
Support CH option in addIfLess and addIfGreater for ScoredSortedSet

RedissonScoredSortedSet addIfLess and addIfGreater methods don't support CH option.
Is that possible to add such support?
E.g. introduce new methods changeIfLess and changeIfGreater which will run ZADD command with both CH and XX options


4103
Redisson Snappy Codec failed decompress value

Hi,
I am working on a project which uses a python app to write data to the Redis cluster, and another Java app reads it.
The issue happens when I try to use Snappy to compress the data write into the Redis. And the Redisson client start to give "Unable to decode data" exception while trying to read it.
Here is the detail of the python app where I use to write the data:
Main Library:
Sample Code:
Here is the exception I encountered:
I am new to use the data serialization in Redis, and I didn't find too much example or guidance about how to utilize these Codec listed in here (https:). So I would like to ask which part I implemented incorrectly in the code above?
Thanks for your time!


4105
Add Sharded pubsub feature

More details here: https


4106
Conditions.contains(field, value)

Wanted to know if it was possible to Condition a String Index of a LiveObject from "containing" another string value, and not just equaling it.
Thank you!


4107
TimeSeries - does not handle same values for different timestamps

The problem as it is described in redis documents here. https
Trying to add 1000 same values to different timestamps yield a 558 items only as a result of RANGE command.
here is the tail of that command.
Expected behavior
all 1000 items to be returned.
Actual behavior
only 558 items returned as a result of the problem
Steps to reproduce or test case


4108
Redis single for AWS ElastiCache

Hi,
Is Redis single compatible with Amazon ElastiCache or only GCP and Azure ?


4109
response timeout in a job lead to deadlock

redisson version: 3.9.0
action:
creating a thread makes a job every 5 seconds
job acquire fairlock  trylock(10, 10, timeunit.seconds)
redis busy or bad network, response timeout(default 3s)
5s, this instance will reentrance  lock
other intance will not acquire lock
suggestion:
when redis response timeout , should redisson release the lock?


4110
Disable DNS caching

Is it possible to customize DnsResolver and disable caching ?


4111
Add SORT_RO command

No description provided.


4112
Redisson Tomcat stores attributes locally in readMode=REDIS

Expected behavior
Attributes are only stored in redis, as described in the documentation
Actual behavior
Attributes are also stored locally in Tomcat, potentially causing a Heap Overflow. This is caused by a call to super.setAttribute in the RedissonSession class. I believe this call should only be made when readMode=MEMORY, or the StandardSession internal attributes map should be cleared in endUsage
Steps to reproduce or test case
Install redisson-tomcat as described in the README


4114
SentinelServersConfig: sentinelUsername is not copied in copy constructor

#3948 introduced sentinel username, but forgot to copy it in copy constructor. Result: authentication with username and password is not possible because config is always copied in org.redisson.Redisson constructor.
#4113 should do the trick.


4115
Add RScoredSortedSet.pollFirstFromAny() pollLastFromAny() methods with count

No description provided.


4116
Add RScoredSortedSet.pollFirstFromAny() pollLastFromAny() methods with count and without timeout

No description provided.


4117
Add FUNCTION support

No description provided.


4118
Add EXPIRETIME and PEXPIRETIME commands

No description provided.


4119
Add RTimeSeries.range() rangeReversed() entryRange() entryRangeReversed() with count

No description provided.


4120
Add RTimeSeries.pollFirstEntries() and pollLastEntries() methods

No description provided.


4121
Original hostname: 'redis' failed to resolve 'redis.svc.cluster.local' In k8s




4122
While run task Unable to inject Spring beans

My config class:
my task class:
then when task running,throw exception
Expect your help,thanks!


4123
How the increase of the memory/key usage cause the Redis timeout exception ?

Hi community,
I am using a 3-master and 3-slave redis cluster. The redisson client version is 3.15.1.
Previously the memory usages is approx. 20G, and the total keys are approx. 20million. And I didn't encounter a single exception.
Recently the memory usage is increased to 40G, and the total keys are around 40million. Now I start to get following exceptions randomly
For example:
and
There are other exceptions relate to other redis command, but the common part is "Unable to acquire connection! Avoid to use blocking commands in Async/JavaRx/Reactive handlers. Try to increase connection pool size".
The code is same, the only difference that I can see is the increase memory & key usage. Could this be the culprit which causing these issues? And why?
Thanks ahead for your time!


4124
reliableTopicWatchdogTimeout is 10, which is not divisible by 3

The default value of reliableTopicWatchdogTimeout is 10, which is not divisible by 3. I remember it was 30 before, did i remember wrong?
Thanks ahead for your time!


4127
java.lang.IllegalStateException: Batch already executed!

add redis stream in batch with batch=10000,
the first 3 batch always succeed , then report  Batch already executed
Expected behavior
Actual behavior


4128
Spring Data Connection in multi mode causes thread stuck

No description provided.


4129
Redisson pool size

I use the next configuration:
Why idle connections does not clearing by redisson ?


4131
Redisson Using AWS Elasticache / Problems Connecting

An application, that I am trying to troubleshoot, is unable to establish connections to a Redis replica, using AWS Elasticache, using the Redisson Java client. An example of an exception that occurs is this:
The settings, and the values that they are being set to, are as follows:
Any thoughts on how I can resolve this issue?
We have used versions 3.16.8 and 3.10.1 of the Redisson library.


4132
Engine CPU Regression when using Redisson (compared to other libraries)

Expected behavior
There seems to be an elevated Engine CPU when switching to Redisson from Lettuce.
Not sure this is due to increase in connection count due to to each instance connecting to all replicas.
Actual behavior
Steps to reproduce or test case
Switch from lettuce to Redisson (we are using Micronaut)


4133
Entry.connections is always equals to minimumAmount

This is my configuration:
I have problem with IdleConnectionWatcher, method validateAmount is always return false, because Entry.connections size is always equals to minimumIdleAmount. How can I fix it?


4134
Add addAllIfLess(), addAllIfGreater(), addAllIfExist(), addAllIfAbsent() methods to RScoredSortedSet object.

No description provided.


4135
The doLoop method in the StreamPollTask class always reports a null pointer exception

The version used is


4136
Exception from redis : MasterConnectionPool no available Redis entries




4137
Add RScoredSortedSet.pollFirst() pollLast() methods with timeout and count

No description provided.


4138
Add RBucket.getAndExpire and getAndClearExpire() methods

No description provided.


4139
Azure Premium Cluster Configuration Failover Issue

We are connecting to an azure premium cluster with 3 nodes using the clustering configuration with redisson 3.16.8.  Whenever azure starts doing failovers removing and promoting nodes for patching we receive the following:
Can someone please tell us how to properly configure redisson in this scenario to avoid these errors? If we reboot the cluster everything fails over successfully. It is only when they are promoting a slave to master during failover and removing the master for patching that we seem to experience the issue.
thanks!


4140
Redisson LZ4 decoder encounter java.lang.IllegalArgumentException: initialCapacity

Hi,
I am trying to use LZ4 encoding in my python code to write data to the Redis cluster, and my Java app reads it.
The issue happens when I try to use the Redisson LZ4 Codec to decompress the LZ4 encoded data from Redis. And the Redisson client start to give "java.lang.IllegalArgumentException: initialCapacity -2147483648 (expected: >= 0)" exception.
This exception happens if the original String is more than 127 characters (include space). If the original String shorter or equal to 127 characters, then decompression works fine and no exception.
Here is the detail of the python app where I use to write the data:
Main Library:
Here is the detail of the java app where I use to read and decode the data:
Main Library:
Redisson 3.15.1
Here is the exception I encountered:
After digging into the code, the value "-2147483648" is coming from the function "buf.readInt()" in "LZ4Codec.java" .
If the original string contains 127 or fewer characters, this "buf.readInt()" will return a positive number.
If the original string contains more than 127 character, this "buf.readInt()" will return the negative number as shown above. And "ByteBufAllocator.DEFAULT.buffer(decompressSize)" failed with the exception above.
Both python lz4 library and the lz4-java that I use are based on Yann Collet's LZ4 library written by C. I would like to ask for help if there is anything that I am doing wrong.
Thanks for your time!


4141
none




4142
Disable Dns caching

I would to disable Dns caching, so I use DnsAddressResolverGroup with ttlmin&max=0. Is there any way to set it to Config ?
Or maybe any better ways to disable DNS caching ?
I have the next configuration:


4143
DNSMonitor doesn't see changes.

Hi, I'm testing case in which domain name change IP. So I start my application when file hosts has 127.0.0.1 redis.test.
Then after starting I change to 128.0.0.1 redis.test. DNSMonitor doesn't see this changes. Also TTL set to 10 java.security.Security.setProperty("networkaddress.cache.ttl", "10");


4144
MOVED redirection loop detected in cluster mode

Hi,
We are experiencing issues with connecting using redisson to a AWS redis cluster
This results with
The target is $NODENAME1 and the source is the corresponding $IP1=IPADDRESS($NODENAME1)
Is there a workaround/fix?
Will adding ignoreRedirect config flag help?
Thanks


4145
none




4146
none




4147
Add RExpirable.expireIfSet() expireIfNotSet() expireIfGreater() expireIfLess() methods

No description provided.


4148
expireAt(Instant instant) method of RExpirableReactive and RExpirableRx interfaces doesn't work

No description provided.


4149
How can we apply multiple rate limit in minimum redis call?

Correct me if I am wrong, currently, we have to make 3 calls to redis if I want to apply 3 rate limit to a call before allowing it. Is there any way we can reduce the number of calls by making a batch call?


4150
org.redisson.client.RedisNodeNotFoundException: Node: NodeSource hasn't been discovered yet

Hi Team,
We are getting below error while using elasticache redis cluster. While update or save values we are getting this error everytime.
It is not the case of failover. All nodes are active and i can see slot 7188 is also available.
Redisson version - 3.7.5
org.redisson.client.RedisNodeNotFoundException: Node: NodeSource  hasn't been discovered yet
Could you please help to look into the issue on priority.
Thanks,


4151
Add RScoredSortedSet.pollLastEntriesFromAny() and pollFirstEntriesFromAny() methods

No description provided.


4152
none




4153
Fair Lock attempt to compare nil with number

In my code, I am trying to acquire a fair lock with a fixed waitTime and leaseTime as so
fairLock.tryLockAsync(waitTime, leaseTime, timeUnit, ID)
Occasionally, I face this error
I also see a queue is being formed for the fair lock, even though it is not currently held.
The waiting requests eventually time out after the waitTime expires.
The queue is being formed for the same lock that this exception is being thrown for.
At times, I have also seen the queue being formed for no reason without this error being thrown.
I am not able to reproduce this locally,


4154
IllegalStateException: Only 2 of 1 slaves were synced

Hello, I started getting weird exception after sentinel cluster failover. Application restart does not help. Looks like sentinel cluster might be at a faulty state, but there's no signs of it.
Redisson version: 3.16.7
Steps to reproduce or test case
Still figuring it out. We were experimenting on sentinel cluster with 3 nodes, killing master for test purposes.


4155
redisson-spring-data: RedissonConnection execute codec bug?

the execute method does not compare the parameter length and parameter type. When a method is overloaded,such as the ttl method, it may cause java.lang.IllegalArgumentException exceptions.


4156
RBlockingQueue.pollFromAny() method doesn't include self queue name

No description provided.


4157
Regression: 3.16.8 refactor on deleteByPattern does not always delete keys correctly.

Expected behavior
All keys matching pattern are deleted
Actual behavior
Keys are not deleted
Steps to reproduce or test case
The above code works correctly on 3.16.7 to delete all keys matching 2 patterns we pass in.  On 3.16.8 the keys are not deleted.


4158
Exception when two modules use different Redisson version (3.16.1 and 3.16.8) ·58 ·

Hi,
I have 2 module A and B, using same Redisson 3.16.1. The modules are using a RLocalCachedMap. I want to change Redisson version of B server to 3.16.8. And I'm facing with exception.
I know that LocalCachedMessageCodec encode and decode methods were changed for a reason. And this exception is thrown when LocalCachedMap updated.
I wonder that does it have any way to run server A and B with different Redisson version?
P/s: That is my example. Now I have more than 10 modules are using Redisson and I just want to update some of them
Thanks


4159
RedissonMapMultimap

I'd like to add a Distributed data structure named RedissonMapMultimap (It'll be similar to RedissonListMultimap).
For The following Map:
Map("id1" to Map("innerId1" : "value1", "innerId2": "value2"))
the user could use the RedissonMapMultimap to get value1 without making 2 network calls / writing the logic themselves.
The interface will have functions like RedissonMapMultimap.get(key: Key, innerKey: Key).


4160
Is Rbatch excute operation atomic?

I have keys in array of ByteArray (ByteArray for each key) and I am wondering if redisson enable returning value/timeout/null(miss) for different key with batch execute. Would batch support this? Or batch.execute() is just an atomic operation and will fail for all batch once a key is missed?
eg:


4161
TOML Config Support

Is your feature request related to a problem? Please describe.
My application uses TOML for its configurations and it would be nice if the Redisson configs were TOML too. TOML is an INI-like human-readable config language that's increasing in popularity.
Here's some references on TOML:
Describe the solution you'd like
TOML support should be added to Redisson Config using Jackson.
Redisson Config seems to use Jackson to handle JSON and YAML. As of Jackson 2.13, jackson-dataformats-text supports TOML in addition to YAML. It seems that Redisson upgraded to Jackson 2.13 with commit 3f457c9 on Dec 21, 2021.
By adding the TOML backend, jackson-dataformats-toml, the TomlFactory type can be used similar to how the YAMLFactory type is used in org.redisson.config.ConfigSupport.
Describe alternatives you've considered
Current workaround is to not use TOML and have Redisson's configs stored in YAML. Resulting in my application requiring multiple config formats.


4163
Using any Codec that isn't MarshallingCodec or SerializationCodec with RRemoteService timeout on reply

Simplest service interface:
Service is instantiated locally and then the client (both on same JVM, Redis server is running locally with default Ubuntu 20 configuration)
Expected behavior
Log to have the line "I was pinged"
Log to have the line "pinged"
No timeout or exceptions
Actual behavior
Log has "I was pinged"
Exception:
Redisson configuration
As seen in the code, bare minimal


4164
Problem with RRemoteService and passing maps that contains generics

Used classes:
Service is instantiated locally and then the client (both on same JVM, Redis server is running locally with default Ubuntu 20 configuration)
Expected behavior
Expected log output:
Redisson version
Redisson configuration
As seen in the code, bare minimal


4165
Unable to send PING command over channel

Expected behavior
Error not occurring.
Actual behavior
Error occurring.
Steps to reproduce or test case
Create a topic and send objects through the topic every second. After a few minutes or so this error occurs repeatedly randomly.
Question
Is there maven dependencies for snapshot versions such as 3.16.9? If not, can they be added?


4166
Respecting serialVersionUID

I am saving and later retrieving a serialized object using an RBucket. When doing so, the serialVersionUID has no effect - redisson tries to retrieve and de-serialized the object and throws an exception it this fails. Is this done this way deliberately? Is there a way to make redisson respect the serialVersionUID, or do I need to serialize and de-serialize  the object myself?


4167
Unable to Acquire Fair Lock

In my code, I am trying to acquire a fair lock with a fixed waitTime and leaseTime as so
fairLock.tryLockAsync(waitTime, leaseTime, timeUnit, ID)
Sometimes, all the requests will get queued up for apparently no reason, while no request has acquired the lock.
I can see a wait queue being formed for the lock, but the actual lock is not held by anyone.
Eventually, all of these waiting requests will time out and fail, and new requests will work fine.
This seems to happen randomly when there are a lot of simultaneous requests.
I am not able to reproduce this locally.


4168
Missing cluster settings in wiki

Please add a below settings description in cluster settings wiki
failedSlaveReconnectionInterval
Default value: 3000
Interval of Redis Slave reconnection attempt when it was excluded from internal list of available servers. On each timeout event Redisson tries to connect to disconnected Redis server. Value in milliseconds.
failedSlaveCheckInterval
Default value: 60000
Redis Slave node failing to execute commands is excluded from the internal list of available nodes when the time interval from the moment of first Redis command execution failure on this server reaches defined value. Value in milliseconds.


4169
Add RBlockingQueue.pollFirstFromAny() and pollLastFromAny() methods.

No description provided.


4170
Session Attributes not synced  - 2 tomcats without sticky session - Read mode REDIS

Is this condition here restricting REDIS read mode from syncing attributes between tomcats utilizing same JSESSIONID for the same user?
Have two tomcats running same application. Sticky session disabled.
Redission tomcat session manager configured (version 3.16.4)
Scenario:
Tomcat1 --> updates a attribute in Session.
After 1 second, Tomcat2 --> reads the same attribute in session but do not have updated value but instead it reads the old value.
@mrniko could you please help?
Please help on fixing this scenario.


4171
Redisson threw MOVED redirection loop detected

There's an existing closed bug #1548 that seems to be manifesting in my installation.  I'm using AWS Managed Redis CLUSTER with Hibernate.


4172
ExecutorOptions.taskRetryInterval not working for RExecutorService

I submit tasks to RExecutorService with ExecutorOptions.taskRetryInterval=5m and expect the tasks will be resumed by another nodes after 5m if some nodes are down.
In my test , I submit 32 tasks to 2 nodes ( Server A/B , each have 20 threads to consume tasks ) , each consume 16 tasks.
The tasks take 30 seconds to complete and I manually kill one node (Server B) before tasks complete.
I expect Server A will consume all 32 tasks after 5m
Expected behavior
Server A will consume all 32 tasks after 5m.
Actual behavior
Server A only consume 16 tasks, another 16 tasks consume by Server B ( but not complete) remain in scheduler and tasks and are NOT processed by Server A.
Steps to reproduce or test case


4173
Redisson requires reflect-config to run

I have a LockFactory class which provides the default and multilock. The following code results in a bad request with no logs at all:
In normal mode and in native mode locally, I see redisson logs. However, when I deploy the native build, I don't see a single redisson log. Any ideas what might be happening here?


4174
bug

it let this code always error.
throw new RedisConnectionException("SENTINEL SENTINELS command returns less than 2 nodes! At least two sentinels should be defined in Redis configuration. Set checkSentinelsList = false to avoid this check.", lastException);


4175
Get values of all keys matching a given pattern

Is there a way to retrieve the value of all the keys matching the given pattern?
Also, can it be generalised to any key type? I'm able to get keys matching the pattern but how can we get all the values at once too?
Below is code snippet, however here I'm calling get for each key:


4176
Available permits for `RRateLimiter` not getting updated

Using RRateLimiter if the thread which acquired the permit crashed or is long-running the permits never again become available again. Have created a rate limiter as below and once the permit is acquired even if the thread crashes or is closed the permit doesn't get available again.
Expected behaviour
Permits should get available again when the thread crashes or is closed
Actual behaviour
Permits not getting available


4177
when i set waitTime=0 in multi lock, it fail

about issue#4033,I don't need to wait,so i set waittime=0,but the result is failure,why Rlock set waittime=0 result is successful?i need get the lock fail,end business at once.
see source code,when waitime=0,leaseTime assignment zero
Expected behavior
Actual behavior
Steps to reproduce or test case


4178
Only one thread can get lock after unlock timeout

I have an annotation RLock which works with an aspect, it work well in some programs.
Here is the codes:
Someday a program throws Exception at every tryLock in two of three containers. I checked ELK and find RedisTimeoutException before the first exception.
By the way, every container works with only one thread to consume kafka messages.
It seems taht  the first RLock unlock timeout and then redisson treats next RLocks as reentrant cause they have the same thread Id.
How to ensure that the lock could be released correctly after unlock timeout.


4179
CPU Spike & WriteRedisConnectionException on Elasticache Redis Data Tiering with Redisson

Elastic-cache recently released a data-tiering which lets offload LRU keys to disk.
In an attempt to onboard to the feature, we ran some tests where we would fill up our memory till 100% and observe keys being offloaded to disk. We repeated the test using both redis-benchmark tool & Redisson ( Client we use for production).
With redisson as soon as MemoryUtilisation reached 100% we observed a sudden spike in CPU , accompanied with WriteRedisConnectionException . This CPU spike lead to node failures again and again. We didnt observe the same behaviour with redis-benchmark tool.
My question is : Why would there be a spike in CPU with Redisson ? How can we avoid this & is there an ability to perform exponential backoff timeout in redisson?
Redisson Error Message when memory reaches 100%  : Error message: org.redisson.client.WriteRedisConnectionException: Unable to write command into connection! Increase connection pool size).
IMO, the timeouts are already quite high. I dont see new connections being formed as well.


4180
See the following error intermittently when trying to initialize the redisson client during the start of our Spring Application : "Unable to decode data. channel"" ·

Redisson version :
We have the following RMapCache beans that will basically create the RMapCache for us :
Stacktrace :
Expected :
For our spring application to start without any issues. The application fails to start because the redisson client cannot be initialized. This error is intermittent and difficult to reproduce all the time


4181
issue with RedissonLocalCachedMap#removeAsync with LOCALCACHE_REDIS store mode

Expected behavior
When I remove values, using RedissonLocalCachedMap#removeAsync method, expectation is that values are removed i.e. no longer retrievable from cache.
Actual behavior
Does not seem to be the case. "Removed" values are retrievable via "getAsync" operation
Steps to reproduce or test case
Here's the reproducible test project:
Steps to reproduce:
clone the project
in the system-out element body, we observe the following:
i.e. all values with even "attribute" are removed from the cache.
However, the test fails with:


4182
Reisson delay queue execution throw "ERROR org.redisson.QueueTransferTask -Unable to acquire connection!"

In the process of using reisson, when reisson delay queue is normally used, it will be thrown during operation
I confirm that the redis service is normal because there is no problem with another redisson delay queue. Normal after service restart
What are the possible causes of this problem? Is it because the connection is suddenly unavailable?
I need your help

