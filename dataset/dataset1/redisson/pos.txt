Implement RedissonSortedSet.Implement with binary insertion algorithm.
SCAN or ZRANGE operations as Java Iterators?Just an idea, would this be possible? Still new to Redis / Redisson.
Rework connection management to use master/slave redis instances.No description provided.
Add support for TIME command.It would be great to see TIME supported.See also #19 in lettuce.
Promises vs Futures?Hi there!As I understand, Future returned by RedisAsyncConnection moves API user back to the blocking world. Java futures are NOT non-blocking by nature, they have blocking get(). Thus API user needs to spawn new threads and say hello to threading overhead again. Then why Netty is used?I propose to return promises (Java's 8 CompletableFuture, Guava's ListenableFuture or jdeferred's promises).Thanks,Denis.
Is all methods of  collections redisson provide synchronized?No description provided.
Setting expiry.Hi.I could not find a way to set expiry for the contents of the cache from within Java. Is this true, or did I miss something?Thank you.Jozsef.
WRITE_BIGDECIMAL_AS_PLAIN Error.I just imported redisson 1.0.3 via maven, set up a redis-server on localhost on default port and wanted to try the redisson redis client. My test code looks as following:But I'm getting an Error:java.lang.NoSuchFieldError:Am I doing something wrong or is this a dependency problem?
this "synchronized " protect what?in RedisClient.java.this "synchronized " protect what?
load balancer does not work as expected.I have test code for the load balance, but only the first instance got the load:Do I miss any thing?
Provide access to the underlying connection manager.It would be nice if the Redisson class exposed its connection manager.  The use case is to access low level redis commands using the same pool of connections as the high-level redisson abstractions.  Currently its protected and private which means I have to resort to ugly hacks to get to it.
Eval method does not work in RedisAsyncConnection.The eval method does not seem to work for me.  I traced the cause to this line in theRedisAsyncConnection:eval() method:It should instead be:In its current form, the script is escaped with double quotes and cannot be interpreted by redis.
Add Kryo Encoder.See GIST: https.
URGENT: java.lang.NoSuchFieldError: WRITE_BIGDECIMAL_AS_PLAIN.I do not have Jackson and do not want to use it. Sadly, the Config class has a hard pointer on it:Thus when creating a new Config instance I have the exception:Caused by: java.lang.NoSuchFieldError:Codecs should be made optional or at least the default should be the Serializer codec which only depends on the JDK, or a simple String <=> String codec.For now I cannot use Redisson properly :-(.
Publish message method should be moved out from RTopic.Pub a message doesn't require a pubsub connection, however get a RTopic does. There are many cases just want to publish a message, get a RTopic from Redisson will automatically subscribe on the channel, which is unnecessary and there is no safe way to close topic after publish message since there may be some listeners are actually interested in the topic.BTW, RedisConnection has a method  publish(K channel, V message)Unfortunelty the underlying connection manager is not exposed, see 13.Provide access to the underlying connection manager.
Support for HLL · 18.It would be really nice if you can add support for PFADD | PFCOUNT | PFMERGE commands in Redisson.
Android Support.Hi,I want to use this inside Android, is it supported?Thanks.
Question: Why do you have imported lettuce code into your project?Hi,why do you have imported lettuce code into your project instead of referencing it via artifact?The approach your library works is quite cool providing collections. It's just somehow annoying having no access to the underlying RedisClient. Redisson.create(RedisClient client) or even redisson.getList(RedisClient client, String name) etc. would be a way opener approach. The current way, it's Redisson who manages all the Redis stuff for you. I see Redisson as a sort of valueable add-on.
ConnectionWatchdog not works as expected.Hi Nikita, when I ran some load test, ConnectionWatchdog did not restore PubsubConnection correctly (my env is redis 2.8.3, java 1.7.0_45,Netty 4.0.19 final, OSX 10.9.2). After some digging, I found a couple of problems,When ChannelInitilizor ChannelInitializer.initChannel is called,           pipeLine.get(CommandHandler.class) and pipeLine.get(RedisAsyncConnection.class) return null, I guess the old ChannelPipeline had been destroyed.The connection retry and backoff doesn’t seem right, the connection attempt seems only fired when the channel is inactive, if re-connect did not work, no further attempt will be fired.RedissonTopic.promise.get().setSuccess(true) will throw IllegalStateException: complete already when PubsubConnection is re established.4)Though this is not a bug, it seems unnecessary to use a dedicated HashedTimeWheel to schedule reconnection task.I will push a patch later.
Make ConnectionManager accessible from Redisson.Hi,When we create a Redisson object, I would also need to execute some Redis commands.What is the best way ? Do I need to create another ConnectionManager completely separate from the one in the Redisson class, or it would be better to access the one created on the Redisson object, so that we can re-use it ?Thanks!
Support For Master Detection?Does reddison support the ability to add both a master and slave addresses and only write to the master?
Thread-safety questions - access to Thread-safe connection.In RBucket we have:get connection.do something.return back to pool.Before using this, I was simply getting a RedisConnection from the connection manager like this:The RedisConnection class javadoc states that the connection is thread-safe. So I was keeping a singleton reference over one connection to issue some simple commands like get, set, del, ... from several threads.Questions:Is a RedisConnection class is intended to be used this way (multiple threads doing get/set/del ops) ?If yes, would it be possible to expose this behavior so that users could get from Redisson a connection (with auto-reconnect) ? This connection could be kept as a singleton ref during the entire lifetime of the server and not be returned back to the pool, because this connection will be used often (i.e. session management). This will avoid the burden of the get from pool / return to pool code.Thanks!
Question: Does redisson handle redis clusters?Redisson clusters may return a 'MOVED' if a key is on another shard, does redisson handle that?
Sorted set scores collapsed to zeros.After running for a week or two, the scores collapsed to zeros or nead zero (10^-300) and we encountered an infinite loop in redisson when adding (it couldnt settle on a score). So we will manage the score ourselves.
Auth Issue Only On Read.I just added requirepass and masterauth to my configuration for 3 slaves and a master. Using 1.5 I am able to write just fine, but when I tried Map::get I get a RedisException: "NOAUTH Authentication required.".I've tried just using a single connection to the master, a 'useMasterSlaveConnection' with only 'setMasterAddress', and a 'useMasterSlaveConnection' with all hosts configured.When I connect with a tool like Redis Desktop Manager I am able to view the updated values just fine.
Detecting any the elected master changes (using redis sentinels)....No description provided.
Add removeAsync, addAsync methods to RSortedSet and RSet.No description provided.
NPE On RedissonTopic.publish & RedisPubSubConnection.channelRead.Same client code worked with 1.4 but not 1.5.
Warning in Redisson 1.1.0 - NullPointerException (An exceptionCaught() event was fired)
getBucket().get() returns null on Redisson 1.1.0.redis monitor shows the setex followed by the get.code returns null.
Several question about Redisson/Jedis.Note: I don't really know if there is a better place to ask for these sorts of questions... ;-)Besides all the cool features added to Redisson to use locks, queues, maps, etc... How does Redisson performs compared to Jedis in terms of:memory usage.speed.number of concurrent connections supported.use in multi-threading app requiring in both case using a pool.thread-safety.etc...For having used both, I strongly prefer the api of Redisson (using publish subscribe in a reliable way with Jedis is a pain, and also there is no codec). But I am wondering, since their implementation only rely on simple sockets and a pool, how it compares to Redisson, which is based on Netty.Also concerning thread-safety, having already aked a question about it, and in both libraries a connection pool is used for each operation and it is better to do so. So does thread-safety on a connection level really used ?Thanks!
Wrong password error if auth fails.No description provided.
Cluster support.No description provided.
Locking on Jersey.I'm trying to use Lock and Unlock on Jersey Resource.User makes a POST request.System LOCK "A".System does some stuff.System UNLOCK "A".User makes another POST request.System LOCK "A".System does some stuff.System UNLOCK "A".The system crashes at point 6 (view attachment).If i try to make some LOCK-UNLOCK in a while loop it works, but when i make these LOCK-UNLOCK from different Threads it does not works.
Lock TTL.Any plan to add TTL to a Lock operation? Don't confuse with tryLock with TIME.I refer to a situation where a thread is dead and leave a resource locked (deadlock).
Two serious issues.1.Sentinel not support auth password.(I have solve this problem)2.When redis sentinel occur failover,redisson can not failover to new master automatic.
Batch/Pipeline operations support.Operates with async methods only. Code example:
Transactions support.No description provided.
Add RMap.fastPut method.No description provided.
Implement operation auto-retry.No description provided.
Add RMap.fastRemove method.No description provided.
Use interfaces to easy DI and Unit testing.[].
Get Object From Distributed Map, Command timed out.Using Distributed Map, put obj is ok, when get some obj by key, an exception will occur:the exception will not occur when get naive java obj (String, int, ...)
Implement RLock.newCondition.No description provided.
1.3.No description provided.
Exceptions handling during deserialization.No description provided.
Local cache for Redission.Does redisson support local cache?For some usage scenario, local read is very heavy, local write is not much, and the delay of data synchronization can be tolerated in seconds. Some configurable cache mechanism could be helpful.
Add RMap.getAll(Set<K> keys)Use hmget.
Add RMap.filterKeys.No description provided.
Add RMap.filterValues.No description provided.
Add RMap.filterEntries.No description provided.
Sentinel event listeners.ability to register event listeners for sentinel server events.
Timeout and database.I don't see any way to configure a timeout or select a database. Am I missing something?
RedissonList.RedissonList.subList() doesn't conform to the specifications of java.util.List, which states that subList() returns a view backed by the current list.On a related note, it would be nice to also have access to some of the buffered collections in addition to the redisson wrapper collections. If you're expecting to read all or most of a list, it would be wasteful to have to call RedissonList.get() for each element, resulting in another redis query each time. (Currently you can get a buffered list by calling subList(), but that's a workaround unique to the list collection, and it shouldn't really work that way - as mentioned above.)
Why RTopic.removeListener unsubscribes underlying PubSub channel.I ran into an issue in which I found if I remove a listener from an RTopic, it will unsubscribe the entire channel, which will kill the connection for all listeners and RTopic subscribed to the same channel. Following is the code in question.I am not quite sure whether I am using Redisson RTopic in the right way. Would you please help me to understand what’s the reason to unsubscribe the channel when removing one listener? And if I need to have multiple listeners subscribed on the same channel and the list of listeners will change dynamically (since it’s used on the application server to propagate changes to clients), what’s the right way to use RTopic?Your help will be greatly appreciated.
Netty NPE.Hey folks, I'm seeing this error on redisson 1.1.5 and it seems completely sporadic.
Failover in Redisson with Redis Cluster.I have created a cluster with 3 master and 3 slave.port 7000 seems to be myself,master.If 7000 goes down I get a connection refused exception with Redisson. Ideally it should shift to its slave.I am copying the exception here.Is it a known issue?
Key exists.Is there a way to distinguish between empty and non-existent collections? (Or some way to invoke the EXISTS command?)
RedissonList concurrency problem.How is it ever safe to rely on RedissonList.size() when each invocation can technically return a different value? This would mean that calling subList(0, size()), or even two consecutive calls to hasNext() on the iterator (which is normally what happens) can potentially cause an exception.
"Connection Leak" in RedissonBucket.Hi guys!When I get some error, eg: redis servers down, in getAsync and setAsync the connection is not released, once the release is done in a Promise listener, that never executes, can you check this please?Regards,Marcio.
Keys adding quotes when going to data store.I was working with redisson adding data to the data store.  I was having issues, so I went to the command line to check what was in the data store and couldn't find my structures (although the program seemed to find them OK).  So I listed the keys and got this:then from the cli, I entered "set foo bar" and listed the keys again and got this:it seems that redisson is surrounding the key names with quotes before storing them.
Constructors for RBucket, RList, etc should be protected, not default.Use Case:1)Extending the Redisson data types as part of a data abstraction layer.
StackOverflowError.Invocation of init method failed; nested exception is java.lang.StackOverflowError.
Lua Script Evaluation Support.Hey, I was wondering if there is any way to execute a LUA script in redisson. I can do it through the connection manager, using something like this:But obviously that's not the cleanest solution. Would it be possible to add a public evalScript() method, or something of the sort to the Redisson class? Thanks!
BSON support for compress.No description provided.
Guava RateLimiter Redisson implementation.No description provided.
Add wildcard pubsub support (psubscribe/punsubscribe)The RedisPubSubConnection class already had a psubscribe and punsubscribe methods for dispatching commands to Redis, but they are not hooked up to anything.The RTopic interface should get a new addPListener and removePListener and all the underlying changes necessary to propagate down to RedisPubSubConnection.
it reached at the tail of the pipelin.
Redisson keys should be objects.Since RedissonCodec supports any type of serialized key, RedissonObject.name should be of type Object so that we can invoke Redisson.getList(someSerializableObject) etc.
Error while deserializing arrays with JsonJacksonCodec.I'm getting the following exception when deserializing some array types with JsonJacksonCodec:To reproduce:
Allow separate Master/Slave password configuration.No description provided.
Deadlock while obtaining lock.Thread gets stuck while obtaining lock. Running 'keys L*' in redis-cli returns an empty list.The same lock name was likely concurrently obtained and held by another thread possibly on another jvm, and then released.Redisson version used: 1.1.5.
Lock reentrancy race.At line A the lock key is set only if it doesn't exist (NX), but on line B it's set assuming it still exists. If the lock timeouts between A and B, another process may obtain the lock, which is then overwritten at B.Here's a test case:This will reliably fail if:run in debug mode with a breakpoint placed in RedissonLock.tryLockInner(long, TimeUnit) on line B (line 306 for 508b903).the breakpoint is released after waiting at least half a second.The same problem is also present in the no-args method RedissonLock.tryLockInner(). (though a race condition is possible only if upgrading an expiring lock)I wonder if reentrancy support shouldn't be done purely in java.
Topic subscription: not re-subscribing after slave down or master change.Hi,Redis: 2.8.14.Redisson: 1.1.5.Environment: 1 master & 2 slaves on separate hosts (each running Redis & Redis Sentinel)Redisson connection: SentinelServersConfig (with 3 sentinels configured)We subscribe to a number of topics from all our clients talking to Redis via SentinelServersConfig. If there is a Redis failover/down event, the topics aren't properly re-subscribed to and messaging stops. Unsubscription is called, but re-subcription isn't.For a:slave down (re-subscription never works)sentinel initiated failover (re-subscription eventually always fails, but could work once or twice)
How do I register a Module on the Jackson ObjectMapper instance Redisson is using under the covers so it can handle Java8 time types?We are using Java8 java.time.Instant as the type in our objects, and running into this problem:com.fasterxml.jackson.databind.JsonMappingException: No suitable constructor found for type [simple type, class java.time.Instant]: can not instantiate from JSON object (need to add/enable type information?)And according to the Jaxson question I asked here: FasterXML/jackson-docs#3 I need to register a Module on the ObjectMapper instance that Redisson is using. How do I do that?
Unhandled IllegalStateException in RedissonLock.I make heavy use of RLock in my app, and from time to time I find this in my logs.
RedissonLock locks up.Under heavy use on production, Redisson's locks get all locked up, and the application stalls. I'm using Redisson 1.1.5.I have 1 thread locked trying to release a lock:Also of note, I have about 30 other threads locked awaiting for a lock (a different one from the one used by the previous thread).I checked the threads with jstack, here is the relevant output:I checked Redis's state:this key is the one corresponding to the thread blocked trying to release a lock. The other threads, that are waiting for a separate lock are locked even though there is no-one taking up such lock....
Infinite loop on connection failure.I'm using Redisson in Master/Slave configuration, and I'm running into an endless loop when using a bad address. BaseLoadBalancer.nextConnection() get called, catches the RedisConnectionException, then loops until clientsCopy is empty, then enters nextConnection() again, resulting in an infinite recursive loop.
list name has extra Quotation marks.when I put a list named monitor_list into redis through redisson, It come up like "monitor_list" . The key in redis has extra Quotation marks. Please check it out.
README.md not up to date.Kudos on the new release! I'm already deploying it to production. Unfortunately, README.md is now outdated (no changelog, the version for Maven users is still 1.1.5, so on). It could be misleading for new users.
use treeMap putall Rmap throw nullpoitn.when throw this exception ..i found the rmap and other reference is error but not null???!!!
when thread is interrupt...all Reference variables is locked!!the redisson is locked!all Reference variables is locked!!
SAdd in RedisAsyncConnection uses wrong AddValues.line 629 uses addMapValues for sadd rather than addValues.This causes JsonJacksonCodec to fail on Longs stored with the mapObjectMapper to fail to be deparsed by objectMapper;Change line 629.Test code follows :
How can I get all the keys in Redisson?I need to delete all the keys in the database. How do I do this in Redisson? I can't figure out a way to get the RedisConnection handle from my Redisson object so I can call the flushdb() call.
RedissonAtomicLong expiring during get causes NullPointerException.This happens on RedissonAtomicLong , line 101 " return res.longValue(); " as the Number res is null after async.Theres the dirty fix of wrapping with something akin to.Also likely occurs in other methods.Heres the unit test if you're interested:
use rmap class not have default consturctor throw exception.use rmap class not have default consturctor throw exception , and the network is broken.
RedissonList's Iterator Race Conditions.RedissonList iterator as it tries to keep "up to date" with data has a race condition in which if between the .hasNext() and the .next() call the set is emptied the list will throw NoSuchElementException.Unit Test.Additional Information.This also effects RedissonSet, but much less likely to hit the race condition. It causes RedissonSet line 96 to throw a null pointer exception.This is akin to issue #104.
How to config read data from slave servers?No description provided.
Config a specific slave for read operation.Assume that I have 3 zones z1, z2, and z3. Also I setup master node at z1, slave node 01 at z2, and slave node 02 at z3. I want to config like this:Read operation from z1 is redirected to master node.Read operation  from z2 is redirected to slave node 01.Read operation  from z3 is redirected to slave node 02.I want to achieve this because there is long distance between different zones. I think read from a slave in another zone is not a good idea. Of course failover need to be achieved also.
Can't get Redisson 1.1.7 to work in an OSGi container.Apologies if this is not the right forum to raise this bug.I have  been trying to deploy redisson to an OSGi container however I can't get v1.1.7 to work even though it's one of Radissons features. Here are some details of what I have so far found.Redisson has a "provided" scoped maven dependency on kryo (com.esotericsoftware.kryo:kryo:2.24.0), but the OSGi manifest imports com.esotericsoftware.kryo,version=[2.24,3)This means that the radisson OSGi bundle won't start up as it depends on kryo 2.24.*  Unfortunately due to an OSGi issue in Kryo (EsotericSoftware/kryo#189), there is no release of kryo after v2.24 that has the bug fixed (only v 3.0.0 which is too new according to the OSGi requirements of redisson - import com.esotericsoftware.kryo,version=[2.24,3)) . This means that Redisson 1.1.7 won't and can't work in an OSGi environment unless it is manually hacked.Kryo v 3.0.0 has been released that contains the OSGi fixes thus Redisson should probably be modified to utilise kryo v 3.0.0 to fix the OSGi issues. Also the dependency should be changed to be a compile time dependency (rather than provided) if radisson has a hard runtime depdency on kryo.If Kryo is not required at runtime (i.e. it's an optional dependency that can somehow be configured and sorry I haven't used radisson before so this is a newbie assumption) then the maven-bundle-plugin configuration could be changed to dynamically import kryo (see below) as and when it's needed. The upgrade to kryo v3.0.0 should still be considered.Also note that kryo maven groupId has changed to com.esotericsoftware.I hope you can help... thanks.
could redisson provide integration with netty5 snapshot?netty5 seems widely used and does many enhancement for last year. does any test or integration with redisson take into consideration or provide some small modification to make it compatible or provide some new branch for testing ? if any done it would be much appreciated.
weird null exception error.I was wondering if anyone else has seen this and what the cause would be(threading?)
LockInterruptibly.General Question.would calling lockInterruptibly(long leaseTime, TimeUnit unit) multiple times act like a watchdog reset? and reset the TTL.
ClassCastException in RedissonCountDownLatch.trySetCount.Take a nice and clean redis server.Execute the following code twice.At the second execution you get a ClassCastException.And the redis monitor output is.Running on Java 8.
Does Redisson support BlockingQueue ?I just read the documentation, but in the documentation there is no mention of BlockingQueue.Does redisson support this ? I'm wondering because redis supports natively blocking operation on queues. Am I missing something ?
java.lang.ClassCastException  java.lang.Integer cannot be cast to org.redisson.RedissonLock$LockValue.when use lock,but throw some class cast exception,sample code :error stack:
SingleConnectionManager doesn't respect timeouts.SingleConnectionManager ignores timeouts set by the configuration, defaults to MasterSlaveConnectionManager timeouts.
When using Redisson.getMap("mapName").addAndGet() setting data, Redisson.getMap("mapName").get() call will be blocked.When using Redisson.getMap("mapName").addAndGet() setting data, Redisson.getMap("mapName").get() call will be blocked.
IllegalArgumentException when hostname is the local loop back in IPv6 format "::1".When the connection returns a master address that is the local loop back in IPv6 format, meaning "::1", it causes the following exception:IPv6 addresses are permitted for the host component. An IPv6 address must be enclosed in square brackets ('[' and ']') as specified by RFC 2732.
ClusterConnectionManager sets nodesValues as null.Hi,Following the examples given in the docs, I've initialized my cluster servers as follows:Now, I get a null pointer exception when I try to do Redisson.create using the above config. I've traced it down to the ClusterConnectionManager class, where the following is carried out:String nodesValue = connection.clusterNodes().awaitUninterruptibly().getNow();Nodes Value is always null, no matter which port i start redis server on (confirmed that it is running). I'd appreciate any guidance that you can give me as I'm stuck here and cannot proceed with my POC using Redisson otherwise.BTW, this works perfectly:
Promise timeout (temporary) resource leak.When a promise has been fulfilled the timeout task should be cancelled. Currently this is not the case and means that the (potentially very large) amounts of data included in the promise will remain on the heap until the timeout fires.An example:A request is made for a large (millions of entries) dataset.The promise is returned and then fulfilled.The data is consumed and the promise goes out of scope.repeat.What should happen is that the garbage collector should clean up the promise since it is now out of scope but this can't happen since the timeout task still has a reference to it so it remains in memory for 60 secs (deadline) and very quickly you get OOM.cc @group-papa @priyeshpatel.
Connection timeout.I am testing redisson library with the situation when redis server is down at some point.The scenario is:Redis server is up.My java app initialises the connection with redis server properly.Redis server goes down.Java app wants to read an example key from redis.After aprox 4 mins I have timeout exception which is completely fine:My question is: How can I change the timeout? Waiting 4 minutes is definitely too long in my case.I am using SingleServerConfig and what I tried is following (500ms) but this doesnt seem to work:
Implement getBuckets(String pattern)To be able to get a list of buckets from a key pattern.
KryoCodec: do not encode / decode keys.Have the smae behavior as Jackson codec, because encoding / decoding keys made them unable to be retreived by patterns such as api:sessions:*.
Java Redisson on single server.I am trying to understan how redisson lib works with redis on my single server. I've downloaded redis, started it and can to the following:Then I've installed in my javaee osgi application redisson and its libs. However, I can't understand how to get my "mykey". The connection I create this way:Please, help me.
Redisson and multiple like inserts.Lets suppose I have a list of some students - the current list has students with ids: 3,5,8. As I understand I don't need to use redis list here as I don't need to keep order. The order I don't need as it's clear it's just SOME of students. However I want to cache them.I think I need to use here redis type string and do something like db:stundents:{id}. My question - how can I do multiple insert of these three stundents? To insert one I use Bucket.set().
Redisson sorted set creates list in redis server.I do the following:but when I do../redis-cli.type test.it return "list". Why does redisson creates list and how can I do sorted set with scores using redisson?
Storing RBucket<Map<Integer,String>> returns RBucket<Map<String,String>>.I store HashMap<Integer,String> but after taking it from redisson I get HashMap<String,String> or HashMap<Object,Object>. Checking it via cli I get.How to fix it?
more than one decoder/encoder for redisson and auto Type detection.auto detection support will be nice, json,xml,protocolbuffer,kyro.
Autocomplete functions for redisson?
Addings string to set stores the string with quotes.Storing the string "myString" using myset.add("myString") ends up being stored as ""myString"" in redis.
Add ability to specify codec per RTopic.Being able to specify codec per pub/sub topic is helpful when you would like to re-use the same Redisson client for a variety of topics all with different serialization strategies.
How to check if Redis Server is available ?Hi,This may be a stupid question but we fail to find a quick way to check if the Redis server is up & running before trying anything on it.is there any quick and simple way to check for the servers connection ?Many thanks in advance,Cheers!
Support for onSubscribe and onUnsubscribe events for PubSub.Is there a way to simulate that right now? MessageListener currently only supports event listening for message events. Users(like me) are also interested in reacting to subscribe and unsubscribe events.
How to rename a key in Redisson?It seems that redisson is not providing access to low-level redis connector which makes issuing RENAME command on any key impossible, though sometimes it could be very handy.
Feature request.Ability to auto-unlock RLock's when the owning server is stopped, crashes, leaves the cluster, etc.
SortedSet needed.It's inconvenience  to use sorted set like this:<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<.
SortedSet.subSet() support.No description provided.
Connection errors handling breaks redis watch/multi/exec semantics.Let's look into org.redisson.RedissonMap#replace(K, V, V)Good scenario:watch -> ok.hexists -> ok.multi -> ok.hset -> queued.exec -> ok.Bad scenario:watch -> ok.hexists -> ok.multi -> ok.hset -> operation timeout or other error handled by MasterSlaveConnectionManager#readAsync , retry on new connection, result ok.exec -> "exec without multi" failure.Impact: in bad scenario map content can be replaced with invalid value for key K.
Long as Key in Hashs.I tried to use the library then I started running  the next code , the map has K-->String(JSON)but unfortunately  when I checked the redis I found the key stored  in the hash as String by the next format.is there is any way to store the Key as Long to save space on my redis node.
Use issues ----lock(long leaseTime, TimeUnit unit)when i run the method.com.lambdaworks.redis.RedisException: ERR wrong number of arguments for 'set' command.How to solve this problem?
BRPOPLPUSH and RPOPLPUSH support.No description provided.
Get/Set strings.How do I get/set a simple string with Redisson?
Naming connection.Is there a way to name the Redis connection? I haven't see an option on the config object.
Old readme version.The readme's pom.xml extract refers to 1.2.0, but 1.2.1 is released. Is 1.2.1 not pushed to maven repository, or is the readme simply not updated?
[Question] What if I don't call Redission#shutdown()?Hi,I'm using this library together with Storm. Since the connection should essentially be alive during streaming to be able to read/write continuously, I don't want to call Redission#shutdown(). I wonder what would happen to the connection? What if a node that uses the connection fails in the middle of a stream?Thank you.Huy.
Calling Publish On Topic in the Listener of Another Topic.I have an issue related to publish message on topic inside the subscribe listener on another topic. I am getting this exception io.netty.util.concurrent.BlockingOperationException: DefaultPromise@6c7a158e(incomplete).The code.
lock.lock(2, TimeUnit.SECONDS)RLock lock = redisson.getLock("anyLock");lock.lock(2, TimeUnit.SECONDS);lock.unlock();run it ,report error:
lock.lock(2, TimeUnit.SECONDS) report error ERR wrong number of arguments for 'set' command.RLock lock = redisson.getLock("anyLock");lock.lock(2, TimeUnit.SECONDS);lock.unlock();run it ,report error:
How to set the RMap put timeout.Hello  I'm testing the redisson with Master/Slave module .When redis memory is exhaustion the RMap.put will be wait.There is no any Exception or someting.Is anyway to fix this?
[Question] Using Redission how to achieve LRU?(1) Using Redission how to achieve LRU?(2) How to set expiry for one particular object of the Bucket or List or Set ?
No enum const class org.redisson.connection.ClusterNodeInfo$Flag.HANDSHAKE.redis version: redis-3.0.0../src/redis-cli -c -p 7001 cluster nodes.
suggest  StringCodec as default Codec.JsonJacksonCodec performance is not so Good  , suggest  StringCodec as default Codec .JsonJacksonCodec VS StringCodec :server 8core16G , one redis node , concurrent 200 ,total task 2000*1000,each task set 128byte to redis.
NPE in RedissonExpirable.hi,i keep seeing occasional null pointer exceptions in RedissonExpriable, line 37 (when i try to extend the lifetime of a bucket). i only see this in one environment, not on a second one and not on my local. i am assuming that i am having some connectivity issues there. could that be a cause? why is it an NPE?
[BUG]Thread dead lock when using distributed lock on 1.2.1.I run into a thread dead lock problem when using distributed lock on 1.2.1:After a certain period, some threads will be dead lock, and we can tell this by VisualVM's thread dump:
Thread dead lock bug when using distributed lock on 1.2.1.I run into a thread dead lock problem when using distributed lock on 1.2.1:There are ten threads call this function like this in a thread pool:After a certain period, some threads will be dead lock, and we can tell this by VisualVM's thread dump:I don't know why, is it a bug?
will redisson support ASKING when migrating slot?No description provided.
RedisConnectionException when using Amazon ElastiCache.We encountered an issue when using Redisson to connect our application running on Ubuntu to Amazon ElastiCache for Redis.When performing any operation Redisson throws a RedisConnectionException: Unable to connect xxxx.cache.amazonaws.com/10.xxx.xxx.xxx:6379. However, after installing the redis-tools package (using apt-get) the issue goes away and everything works correctly.Does Redisson requires the redis-cli binary or the redis-tools package? Did anyone had a similar issue?
KryoCodec strange behaviour.Between client restarts, KyroCodec serialisation randomly fails with exception;Prior to release this feature, did you run some regression tests for it? Also do you have any comment about the exception?P.S: Content of the redis and the classes are same between restarts and I am simply applying Predicate upon RMap.Edit: Between restarts, Kyro is sweeping the classes and give them uniqueIds in order to identify and serialise/deserialise them. I used to give Kyro exact list of classes in the exact order but with the auto discovery I think class loading order causes this issue right now.IMHO, best solution would be to provide an interface for registering the Kyro classes to the underlying KyroCodec impl.
ClassCastException with StringCodec and RSet iterator.I've got a problem with iterating over a RSet, the following code throws a ClassCastException when using the StringCodec:Stacktrace:With a List everything works.
ConnectionManager call hangs forever if exception is thrown during Command processing.Bug found that can cause MasterSlaveConnectionManager to hang forever on get() call if exception is thrown anywhere in CommandHandler.To replicate the bug, you can use RedissonMap with JsonJacksonCodec to put instance of class that doesn't have default constructor. When you try to fetch that object by using RedissonMap.get() call, deserialization of object will fail in MapOutput because of missing appropriate constructor and thread calling RedissonMap.get() will block forever.In more details, this is happening because get() method awaits forever on Future object, which is released when Command.complete() is called. This complete() call is executed in decode() method of CommandHandler after RedisStateMachine processes Redis response. If, for example, RedisStateMachine throws an exception, complete() won't be called and result/exception will never be set to the Future object. This is causing calling thread to block forever in MasterSlaveConnectionManager.get() method.Pull request with test case that is proving this bug and bug fix proposition will be published shortly.
Issue in locking on key in concurrency.In my project, I have a servlet, that call a utility class.Utility class calls a wrapper class that  I have implemented over redisson lock.Wrapper class holds RLock object for a thread and provides lock and unlock methods that call RLock's lock and unlock method.But while running a apache ab-test tool for concurrency, Following exception occurs.Can you tell me if I am missing something over here?
Use Redis client to add a set , but in Redisson got a error.Redis 3.0.1.Redisson 1.2.0.I got a problem.Firstly , in redis client , I put a set named "hello", the set numbers are "hello1"  and "hello2".Second,in Redisson , I get this set.
Unix Sockets.Do you have a plan to develop  the client to be able to use  unix sockets instead of tcp.
Redisson and leap second.Hello,I am using redis and redisson for my service deployed on Amazon server. Server has older kernel version that suffers from leap second bug. Will it affect redis or redisson lock in any manner? If so what is the possible solution to it?
Reddison tries to connect to a slave which is down.Redisson library version: 1.2.1.Hi,We are using SentinelServersConfig and during the tests we observed that if a slave is down, and sentinel properly reports this by putting the s_down flag, Redisson still considers it at initialization and during the operation tries to connect to it.This affects badly the performance, since RoundRobin tries periodically send though that slave.WARN  o.r.c.RoundRobinLoadBalancer - Can't connect to /192.168.150.163:6379, trying next connection!As I see, the SentinelConnectionManager constructor does not check for the "s_down" flag when initializes the list of available slaves, thus the Redisson snapshot of slave status does not reflects the status of slave servers.
org.redisson.RedissonLock.tryLockInner  throw  java.lang.NullPointerException.in RedissonLock.java Line 291, if Boolean res is null, the 291 line if(!res)  throw java.lang.NullPointerException.java.lang.NullPointerException.
expose async operation to List Queue etc.It worth to expose the async operation to these data straction eg:Future<V> popAsync(timeout),Future<Collection> popAsync(Int maxNumber,timeout) etc,maybe add something like AsyncList,AsncQueue?
NPE when call queue.poll.
How can i specify the redis database in Redisson?How can i specify the redis database in Redisson?Thanks for reading.
New Redis client.The idea is go away from lettuce due to some api limitiations and absence of commands pipeline support. Also command handling - encoding/decoding should be implemented with lock free approach.
Are the recent Netty related features alerting Netty for other libraries?Today attempted to migrate Redisson from version 1.2.1 to 1.3.0 and that caused the 2.1.6 version of the DataStax Java driver to write a WARN + stack trace instead of an INFO to the log.With org.redisson:redisson:1.2.1, I see:With org.redisson:redisson:1.3.0, I see:I also tried version 2.2.0-rc1 of the DataStax Java driver and see the same thing.I also tried adding a dependency on io.netty:netty-transport-native-epoll:4.0.29.Final, which I believe contains the linux-x86_64 jars but still see the same thing.For reference, I'm deploying to Ubuntu 14.04.1 LTS (GNU/Linux 3.13.0-44-generic x86_64).Please advise.Thanks,Peter Luttrell.
can't stop via shutdown.when call shutdown(),it cause these error again and again and never stop the application.I single the JVM via Ctrl + D and there is a shutdown() hooked in Play's lifecycle's onShutdown() callback.
Extract async interfaces.Extract async interfaces for all redisson objects. This is necessary for further development of batch operations feature support.
Migrate and Move commands support.Add migrate and move commands to RedissonObject class.
Flushall support.No description provided.
Bloom filter.No description provided.
add some java doc about the codec's method.it would be great to  add some java doc here:
Compiled "java.util.regex.Pattern" gets corrupted.Look the below smaple code, the compiled Java Regex looses its flags once you keep your object in Redis.  The below code Prints 2 before put operation, But Prints 0 after put operation to Redisson Map.
Compability with Guava (com.google.common.collect.ImmutableSet).I tried to do this:The test fails on the line "assertTrue(testSet.contains(newSet));", that is, testSet.contains(newSet) return false, but set1 equals newSet and set1.hashCode() equals newSet.hashCode().Redisson version is 1.2.1.
how to  delete keys like redis  del keys in fuzzy matching.No description provided.
How to set up the expired time of different object in RMap?No description provided.
redisson client is connected.any method to know if redisson client is connected or not? i have a "connection is closed" error and i don"t know when re-use the same client or should create new one...
NullPointerException When Using Cluster Config.With release 2.0.0, while using sample cluster setup using the create-cluster script from redis (http) and this Redisson sample code:I always get the following NPE:
Redisson calls do not time out and very long cache times depending on ttl setting.Hi, while developing using redisson some problems with timeouts and cache times are experienced.Consider the following scenario:Now there are several problems here. Timeout exceptions are being thrown, but seemingly at random times ignoring the timeout setting of redisson. It is also somehow being affected by ttl setting as the shorter ttl yields lower cache times, as well as the frequency of hitting the cache. You can see it from the following graphs of CACHE_TIME timer:In all cases the timeout was set to 100ms, 3 attempts with 100ms interval. In all the cases in the end requests succeed to fall over to the database (either through a timeout error or through returning null). Regardless, the timeout is not being thrown according to the settings. Please let me know if you might know the cause of the issue. Thoroughly investigated the code on this side and it seems like the issue is in redisson. Let me know if you need more context.
Concurrency Issues.Today I tried some tests to experiment with Redisson's performance using a build from /master and discovered significant concurrency issues. I'm not sure what the state of this code is, so perhaps these issues are known ones, but wanted to make sure you guys are aware of them.I have a very simple app that a) Creates a Redisson instance with a connection pool of 50 to masters and 50 to slaves, then b) creates a quick thread pool using Executors.newFixedThreadPool() and then c) feeds it Runnables, each of which generates a random string and adds it to the end of a Deque.Whenever I do any of these three things: 1) Add >1 millions of queued Runnables or 2) Increase the number of threads >20 or 3) add a .contains() call on the Deque (more on that in a sec), I get a ton of exceptions that don't include any of my code in the stack trace. Here's one such snippet:
RBatch NPE's.No description provided.
add RSet.removeRandom and RSet.removeRandomAsync methods.No description provided.
Infinispan redis integration.I'm contributing a redis integration to infinispan and am investigating the use of Redisson to use as the client.I need an efficient way to retrieve a list of all keys and iterate over them for processing, but because Redis can store millions of records, I wanted to avoid a list/queue of data pulled from the Redis server and held in memory on the client as this could wind up exhausting resources on the client.Will getBuckets, findKeysByPattern or findKeysByPatternAsync retrieve the keys in an efficient manor, like a database cursor stepping over each record, or is there another approach that is recommended to efficiently cater for this?
SCAN command support.add findKeysByPatternIterator, findKeysByPatternIteratorAsync, getKeysIterator, getKeysIteratorAsync methods. Move keys operations to RKeys object.
can't deserialize object when JsonTypeInfo.As.PROPERTY was different to @class.hi,when i put the "toto" object in the MAP there is no problem but when i do a get operation i get an exception.error when deserialize object, simply because i used jackson for other operation and i forced property to "type".Exception :
Check connections at client startup.No description provided.
ReentrantReadWriteLock implementation.No description provided.
Semaphore implementation.No description provided.
ExecutorService implementation.Introduce redisson-all.jar to have ability to run it as standalone node.Add isAnonymousClass checking for Runnable param.Add ability to inject RedissonClient object into task.
RANDOMKEY support.No description provided.
Reactive Streams support.No description provided.
Empty slot error.Add slot checking for MasterSlaveEntry. Fire an error if correspond entry for slot not found.
extract drainToAsync?this would be nice.
Scheduler support.No description provided.
Examples update.Add links to object interfaces.Add low-level Redis client usage example.
Redis healthcheck using Redisson PING.Can you add ping in Redisson which helps in healthcheck?
Warnings about serialization exceptions being swallowed (using SerializationCodec with non-Serializable class)I wound up pulling my hair out after upgrading from 1.3.1 to 2.1.0 and starting some new projects - the root cause being my attempt to use the SerilizationCodec with objects that were not Serializable. Simplest reproduction:Expected: a warning about serialization with a root cause of a java.io.NotSerializableException.Actual: nothing in the logs, threads just hang around wait()ing on DefaultPromise.I'm not a netty expert so unfortunately I have no PR to fix this. My best guess at root cause lies in CommandExecutorService#async. If I modify the ChannelFutureListener to.I get a nice warning message:The listener originated in 2019283.
Is it possible to have RSortedSet as part of batch.Was wondering if its possible to include RSortedSet as part of batch commands.
How can I do set and get operation in cluster mode.Thanks in advance :)
Add ability to subscribe for keyevents.
Sentinel auto discovery.No description provided.
Cluster mode "Too many open files" (java.net.SocketException)Cluster mode Redisson client running out of files (sockets) in communicating with Redis.This occurs even when the Redisson client is not receiving any requests.  It must be a problem with cluster mode connectivity.To reproduce, I simply made two calls to my server using Redisson to set a simple value on Redis and then retrieve a simple value.  Then we did nothing at all.It appears the Redisson in cluster mode is continually opening new socket connections but not closing existing ones.After about an hour, we started seeing the following exceptions in our server logs.Note:  I am may have seen a similar behavior in sentinel mode.  We recently upgraded Redisson to 2.1.0 from 1.1.5.  Could this be a more general problem?  We will upgrade to 2.1.1 and test again.Thank you very much.--Michael.
Opening new connections in org.redisson.CommandExecutorService#async.Rmap.addAndGetAsync (and any *Async methonds) - as i understand it shouldn't lock the calling thread, and return value (Future) as soon as possible.But if for any reason connection is not established yet the calling thread will be blocked.And if redis server is not available at all it will be blocked for very long period of time.Maybe i'm wrong but it doesn't look like async nor lock-free.
Expirable RCountDownLatch.Is there a reason that RCountDownLatch doesn't implement RExpirable? I'd like to be able to create a CountDownLatch that goes to 0 or is deleted if countDown isn't called the desired number of times before a timeout.
RObject#delete returns false object doesn't exist.It seems that in the following test, RObject#delete() will always return false, even though it appears the delete call should be synchronous.
RLock.tryLock() thows Exception.org.redisson.client.RedisException: ERR Error running script (call to f_2d027cdc209d32fe7dade9ba284110f88d497180): @user_script:1: WRONGTYPE Operation against a key holding the wrong kind of value . channel: [id: 0x24baaaa8, /192.168.99.1:64875 => /192.168.99.100:6379].ENV: redis 3.0.3/2.8.3.REDISSON: 2.1.1/1.3.1.
Major Issue: iterators that uses SCAN/SSCAN/HSCAN command are not using the same node.Since the fact that keys/Sets/Hashes in redis does not guarantee the order of the elements within, iterators should stick to the same node when iteration was first started, to avoid duplicate and/or missing items.For example, when you have a Set "A" in master node contains:a slave node could have it in a completely different ordering:Obviously, the running the command SSCAN "A" 0 on master, the result is going to be different to the one from the slave. Further cursor call SSCAN "A" n, could also be different.The problem is, under the default setting, SentinelConnectionManager uses the RoundRobinBalancer which is utilised to read from both master and slave nodes, and when you have a for loop like this:The output could contain duplicate/missing item(s), and the results could be different each time you run it.
CommandBatchExecutor executeAsync method freezes.Hello,Nice work on the redis client.I noticed that executeAsync did not complete while running a batch of rediscommands against a cluster.I noticed that in the line:voidPromise may never complete successfully because it is being re-initialized for every slot entry and its successful completion depends on the number of slots being decremented to zero after all the entries run as shown in the line below from execute(...)Note that mainPromise is voidPromise from above.Perhaps the previous line in executeAsync should have been like.
support max or min connectionPoolSize?i read redisson code that imply only the max connectionpoolsize is provide. but all other collection framework also support min size (and the not longest not used time).when the system is not high load, as if cut down the connection that not used offen?I found that if connection is create,it not close!(when one down the watch dog create a new one asap)
bug? watchdog create new channel not attr connection obj.RedisConnection.updateChannel update the new channel obj.but the channel attr NOT on it, so the second time new channel is down, the watchdog channelInactive invoke method attr(RedisConnection.CONNECTION).get() can NPE.i thinkd it is a bug.version 2.1.1.
Subscription connection leak in PubSubConnectionEntry::removeListener.We have a production system using Redisson to handle notification. However, recently we constantly run into subscription connection exhausted issue. After investigation, I found Redisson doesn't release the subscription connection after the last listener is removed.Eventually, this issue is caused by the following line. It seems ConcurrentLinedQueue doesn't fully implement equals method to compare 2 linked list. Therefore, an empty linked list will never equals to another empty linked list, which eventually leaks all subscription connections.This is a very urgent issue to us. Any help or workaround will be greatly appreciated.
Leak issues.When using redisson, I'm occasionally getting errors like this: "LEAK: you are creating too many HashedWheelTimer instances".What are possible causes of this issue?I'm also seeing (probably related) errors like this: "LEAK: HashedWheelTimer.release() was not called before it's garbage-collected." I assume this is related to my problem, but I don't know where to look in my code for this leak. Could this be a bug?Thanks!
Read split feature in Sentinel mode.Hi,I have a setup with a master, 3 slaves and 3 sentinel nodes. I do not have too much data and cluster setup is not required. I should be able to support high throughput(400K Ops/sec). Most of them are read operations. Is there any way to split read requests among master and slaves?If there is no way to do this, can this feature be added?Thanks.Naresh.
Elasticache and failover; Redisson configuration question.We're using Redisson 2.1.1 on our production web cluster for session persistence: https:Our redis implemention is AWS's ElastiCache where we have 2 nodes in a replication group. Elasticache provides 3 endpoints for this scenario:foobar.elasticache.com - always points to the primary (read/write) node of the cluster.Normally node1 is the read/write master and node2 is a read slave with foobar.elasticache.com pointing to node1. In a failover scenario. Elasticache promotes node2 and repoints foobar.elasticache.com to now point at node2.Our Redisson configuration is to use a SingleServerConfig with the endpoint of foobar.elasticache.com.Last night we experienced our first ever failover (exciting!). Unfortunately, this brought our application to a standstill with errors of.The 10.0.x.x address listed is that of node1 which was demoted to read slave when node2 was promoted to master.My belief is that using SingleServerConfig here is incorrect and led to this issue (i.e., redisson remained connected to node1 and never reconnected to foobar.elasticache.com to now be connected to node2. Am I correct in this analysis?  If so, I can't really seem to figure out which config is the proper one to use. MasterSlaveServersConfig seems logical at first glance, but looking through the code it appears only Sentinel and Cluster configurations invoke the paths that switch the master node.Any help would be greatly appreciated.  Thanks!
reconnection functionality doesn't work with AUTH enabled on redis.If I enable security on redis, re-connection functionality no longer works - wihout security redisson works as expected and re-connects.
Fst and snappy codecs · Issue #245.No description provided.
Feature Request: Redisson backed ObjectCodec (Object-Hash Mapping)Now, the ability to specify a different codec per object feature is added.d484c19, this has paved the way to implement a new type of object codec that serialise each field of POJO object into a redis hash.Thinking it as a persistent layer for persisting an object to redis like the EntityManager does. Using reflection/javasisst to proxy the accessors of the POJO to read/write fields straight from/to redis.It would allow different programs to be able to share sets of live data without needing to serialise and deserialise the entire object.
Add serialization codec for java Number.By default any Number class descendants is serialized as ["java.lang.Long",1843] for example.
Resubscribe to topics when RedisPubSubConnection has been reconnected.No description provided.
Ringbuffer structure.No description provided.
Redis master change is not detected properly.Redisson does not seem to be detecting Redis master change in failover scenario.  (We are using Redisson 2.1.3).I have 2 questions regarding this.After the 60-second timeout (described below) everything started working again, although not in the original configuration.  Can this timeout be changed (lowered) and done so safely?Should Redisson should be able to detect and react to this last master change back to our original configuration?  We were assuming that it should.Details are below.I can provide the redis commands we used to reconfigure Redis if they will help.Thank you very much.--Michael.In testing redis failover we have discovered that moving a master instance frmo one instance to another causes all our servers to hang.  We have reproduced the issue several times with the following process.We are running 3 Redis servers (redis-01, redis-02, and redis-03).  Each server is running both a redis master and a redis slave.  Each master is associated with a slave on one of the other redis servers.Start multiple work sessions on our application servers running light load.[At this point everything appears great - the test continues to run.  The slave instance has taken over the responsibilities for the failed redis node.  run "redis-cli cluster nodes" for a list of all the nodes, the reassigned master and a list of the failed shards.].restart redis on the "failed" server - "service redis_master start" "service redis_slave start".[After 60 seconds, we see our first indication of trouble - we get a redis connection timeout exception on each of the application servers.  If you look at the "cluster node" output you should see the two instances back in the list, however at this point they are both slave nodes.  Another server will have two master instances on it.].rebalance the redis nodes - on the server that you just restarted the services, run "redis-cli cluster failover" this tells redis to failover the remote master to this instance.  After this step you should be back to the original configuration with one master and one slave instance on each server, with no master/slave combination on the same server.This is where our application servers seem to hang.  From yourkit we see several of these:
Report possible race issues.Hi, Developers of mrniko/redisson,I am writing to report two race issues on use of ConcurrentHashMap. The issues are reported by our tool in an automatic way. Although manually confirmed, they would be false positives, given we do not know the specification of the program. We would very appreciate if you could check below for details and confirm with us whether they are real problems. For more information, please refer to our website:Line 120 is in the synchronized block on "ENTRIES". If the intention is to guarantee exclusive access for the !containsKey checking on "ENTRIES" and to ensure the atomicity of the checking and unsubscription (line 120,121), then the write operations on "ENTRIES" in line 66, 115, 117, 136 may break this. Relying on the ConcurrentHashMap to ensure exclusive access is dangerous since ConcurrentHashMap has no guarantee of exclusive access.
ReplayingDecoder.callDecode() thows NP Exception.
NPE during load testing.Hi.I'm relatively new to java, so sorry if i say something stupid.When i'm storming my server with 50 concurrent requests using AB, i'm getting NPE during some channel negotiating (as i guess). The following line (CommandDecoder:267):results in null pointer exception:I'm not 100% sure where does this problem originate from, but i can tell that those requests use Redisson for inter-process locks and fetching/updating two string sets.I'm using Redisson 2.1.3 against dockerized Redis 3.0.2 (the standard docker library image)upd: debugger told me that client has received null for hannels.get() for redisson__lock__channel__{lock:pn:phone-number:79219767095}, which, i guess, means trouble with lock.
EOFException when I use RLock with SerializationCodec.I configure Redisson to use SerializationCodec instead of default JsonJacksonCodec. Then I run my code in environment with concurrent threads and use Lock object to sync thread. After that I get exception and unlock only after expiration in 30 sec. Previous major version of Redisson does't contain this issues. Similar problem I have when I use CountDown.
unknown command EVAL when call.I am getting an exception when trying to add an ArrayList to a redisson RMap  on a Linux Server. I cam using Redis 3.0.4.  Below is an example of the code I am using.This code works perfectly fine when running on an OSX machine but the folllowing exception is thrown when it is run on a Linux Server.
Codec key and value decoders are opposite.When implementing my own custom code, I've found that it seems Codec key and value decoders are opposite.This does not work.
NPE in pub/sub.
Mocking Redisson.Is there any library for mocking Redisson? I have a scenario where I do not want to have Redis server running for unit tests.There is a library for Jedis.
AddSentinelAddress(...) non-running instance ClosedChannelException.Hi,I have noticed something running some load tests recently.I have a 3 sentinels, 1 slave and 1 master set up.Initially I was running load tests on this exact set up and would occasionally run into org.redisson.client.RedisConnectionException: Slave connection pool gets exhausted! which is fine since when the load is reduced the app goes back to normal.Then I had to switch off one of the sentinels and forgot to restart it, so now I was running with 2 sentinels, 1 slave and 1 master.I would first again run into org.redisson.client.RedisConnectionException: Slave connection pool gets exhausted! but would also run into.After reducing the load, org.redisson.client.RedisConnectionException: Slave connection pool gets exhausted! disappear, but org.redisson.client.WriteRedisConnectionException: Can't send command... persist and appear on every couple of calls even for 0.5QPS.I tried this several times and it always was like this, 3 sentinels - all good, 2 sentinels - WriteRedisConnectionException exceptions.Note that in both cases I passed all 3 sentinel's addresses to addSentinelAddress(...) for useSentinelConnection()Maybe a check on the new Redis(...) call to ping all the sentinels would be nice.
Can i use redisson for the "mget/mset" multi-command?I can not find "mget/mset" api in redisson, whether redisson support those multi-command? and for redis cluster mode?
A serious mistake for redisson cluster!hi, @mrniko.I review the parse() function in ClusterConnectionManager.java, and it only parses one pair start_slot and end_slot.Is it right, or my understanding is wrong?
RMap.putAll not working.I have RMap<String, String> and static map with default values which I need to save but RMap.putAll keeps throwing exception:
Handle Redis Cluster memory.Hi @mrniko,I want to know what Redisson can do with Redis Cluster:-check Redis Cluster memory.-handle exception when Redis Cluster exceed memory.Thanks & regard.
LZ4 codec support.No description provided.
Implement realtime cluster nodes scan list.No description provided.
CROSSLOT handling.No description provided.
BitSet implementation.No description provided.
Cluster slave servers info update.No description provided.
Add readFromSlaves config param for cluster mode.No description provided.
Handling MOVED response.Command with MOVED response could be redirected to Master or Slave node.
Async reconnection to channel.No description provided.
check Android compatibility.No description provided.
receiving multiplied PubSub messages.Little modification to the testHeavyLoad reveals the problem I encountered when having a single listener processing many messages sent at the same time (in latest version):volatile long counter;Running the test will fail for me many (but not every) time saying the listener got like 9000 messages instead of the 500 sent.
RedissonSet iterator in Sentinel mode doesn't seem to be sticking to one slave for the lifetime of the iterator.Hi,I have a Redis setup with 3 nodes (master, slave, slave) and 3 sentinels (one per node). When I try to iterate over a set within Redis, I'm getting some odd results that are breaking the Redis SCAN guarantees - that is, I'm losing some entries.I'm pretty sure this is because the iterator isn't sticking to a single slave during its lifetime, and rather that it's using the default RoundRobinLoadBalancer switching between slaves for the same scan (which otherwise works well).Example.Let's say I have a big set with 100K entries:with all nodes up (two slaves), and when iterating over the collection, adding all my results to a java.util.Set such as below, then I'm getting some random size result sets:However, if I turn off a slave, I get the correct result:and I agree with the behavior of the RScript (as Redisson would never implicitly know when to stick to a single server). Incidentally, the latter use of RScript provides me with a workaround, but it'd be nice to use the inbuilt iterators for simplicity.Hope that make sense-cheers!
Why RedissonLock.tryLockInner not call 'setnx' command?No description provided.
I want a codec for msgpack.HELP ME PLEASE..Thanks in advanced:)
RList add at index inserts data in different format causing an exception on read.Hi,I have code running against redisson 2.1.3 that was adding a value at an index and after the add is called the list can no longer read, throwing this exception:I wrote a simple test to see what was going on.  The code from test1 executes without issue.  The code for test2 throws the exception on the first pass through the for loop.I queried the redis server and here are the two lists.  In test 2 you can see that bar does not get the escaped quotes around it.
Add RMap values, keys and entries iterator.No description provided.
RLock.isLocked() get hung when I disable/enable my local network.I was crashed into a blocking issue when I was doing some configuration on my windows laptop. RLock.isLocked()  got hung forever with callstack as following:Callstack:The issue is repreduceable. Steps to reproduce the issue:My os is windows, and I haven't tested it on linux.Steps: disable network.  Then enable network. The program will be blocked with the callstack I pasted.
LOADING response handling.Error like "LOADING Redis is loading the dataset in memory" should be handled correctly.
Add connectTimeout param.No description provided.
Use PEXPIRE and PEXPIREAT instead of EXPIRE and EXPIREAT.No description provided.
KEYSLOT command support.No description provided.
Where is ZRANGEBYSCORE command.I can not find anything in RScoredSortedSet class...
handle MASTERDOWN response.When slave-serve-stale-data is set to 'no' then this error occur:MASTERDOWN Link with MASTER is down and slave-serve-stale-data is set to 'no'.
BLPOP from multiple queues.No description provided.
What does RBatch.execute() return?Hello. I have an RBatch variable that I've added some commands to. I noticed if I tax redis a bunch sometimes it has trouble writing a backup file (this might be the fault of my weak vm). At any rate, I'd like to detect this failure mode and tell the user about it if it ever happens.I'm trying to figure out what RBatch.execute returns. There aren't any javadocs on this. I either get one of two responses:The second one indicates failure.The wiki suggests these are responses to the specific commands, which agrees with what I would assume from EXEC, but I'm not sure why I'm getting boolean results, because the commands I'm running should all be add commands (like HSET, ZADD, etc).Do you mind updating the javadoc, and do you know why I'm getting booleans back (and what they mean) instead of ints?
connection-status  handling (question)Hi there, is there any hook somewhere for client to handle when connection to server gets dropped/lost ?thany.
Add geo commands.No description provided.
Revise return value for some methods.Return value of follow methods: RedissonScoredSortedSet.remove, RedissonScoredSortedSet.add, RedissonMap.fastPutAsync and so on could be changed from boolean to value returned by Redis.
Rename config params.Rename useSentinelConnection to useSentinelServers.Rename useMasterSlaveConnection to useMasterSlaveServers.
Add redis client state listeners.No description provided.
Duplicate values are returned with redisson.getSet00.Hi,I'm getting duplicate entries with redisson.getSet.Redis command "SMEMBERS pSet" returns the following.""MOBD5G7DDCRHQCHS"".""MOBE4G6GTTD33ZUT"".""MOBEY39PGWFVQHQE"".""9788129135728"".""MOBDP6W6MCUWCFGV"".""MOBDDA5Y6BKX6VHR"".""MOBDA3N2XBF74DSJ"".""MOBE4G2SKSQJSPGJ"".""MOBEBZPYZEVYCYWM"".""MOBDGY7DGAAN7SZY"".""MOBDCAJJJ55SCWBY"".""MOBEBZZGKH7QGZKH"".redisson.getSet is returning the following values."MOBEBZPYZEVYCYWM","MOBE4G6GTTD33ZUT","MOBDDA5Y6BKX6VHR","9788129135728","MOBEY39PGWFVQHQE","MOBDCAJJJ55SCWBY","MOBD5G7DDCRHQCHS","MOBE4G2SKSQJSPGJ","MOBDGY7DGAAN7SZY","MOBDP6W6MCUWCFGV","MOBEBZPYZEVYCYWM","MOBDP6W6MCUWCFGV","MOBDDA5Y6BKX6VHR","MOBDA3N2XBF74DSJ","MOBDGY7DGAAN7SZY","MOBDCAJJJ55SCWBY","MOBEBZZGKH7QGZKH".Please notice that MOBDGY7DGAAN7SZY is repeated.
Add redissonlist equals.No description provided.
Add RMap.getAllAsync method.No description provided.
Ping fails if requirePass is set.Can't ping single node either with ping or pingAll commands - getting NOAUTH Authentication required.Piece of code.Full exception.
Сheck lock existence in forceUnlockAsync method.No description provided.
Extract Async interface for RedissonCountDownLatch.No description provided.
Redisson shutdown hangs if redis server was down.Start redis server.Create redisson bean.Stop on a breakpoint inside test.Shutdown redis server.call redisson.shutdown()What I see is that ConnectionWatchdog is scheduling tryReconnect indefinitely incrementing attempts and connection is not closing. But if I put break point in ConnectionWatchdog#channelInactive (line 64) and stop there, connections are closing properly. Perhaps there is race condition somewhere?
RScript.Mode.READ_ONLY... not read only?I have a script that deletes some things. Here's how I'm executing it:myRScript.evalSha(Mode.READ_ONLY, mySha, ReturnType.BOOLEAN, myKeyNames);It's working (deleting things). This is confusing to me. Shouldn't Mode.READ_ONLY not allow that? I think what is happening is this is using redis' READONLY command, which I think is okay with letting me change data, as long as I'm not hitting a slave (which I'm not, because I'm only running one node locally). I think this will cause an issue once I run this on something like Amazon's ElastiCache.Do you know if my assumptions about what's happening are correct? I wasn't able to figure that out. If so, maybe adding some documentation to that enum would make things less confusing. If not, maybe there's a bug? Anyway I'll start using Mode.READ_WRITE, but I thought it was strange that Mode.READ_ONLY worked too, so I figured I'd report it.
SortedMap.It would be useful to have a SortedMap implementation.Could this feature be added? or are there any nifty tricks with SortedSet to hack around the issue?
Add 'pollFirst' and 'pollLast' methods to RScoredSortedSet.No description provided.
Precache lua scripts in all Redisson objects.No description provided.
Map/Reduce implementation.No description provided.
Cache convertor instances.No description provided.
Add JCache API support.
Apache Spark integration.No description provided.
Add RObject.isExists.No description provided.
Add WAIT command support.No description provided.
Add RCacheReactive implementation.No description provided.
Add RSetCache implementation.No description provided.
Add BlockingDeque implementation.No description provided.
Add RSetCacheReactive.No description provided.
Add TransferQueue implementation.No description provided.
RedissonClient `isShutdown` check.I'm somehow missing a possibility to check whether the current Redisson instance has been shut down already.Are there some run-state flags that one could check? Would a isShutdown method  make sense in the RedissonClient interface? Would this be possible with the changes required for #299 ?
bug! expire expireAsync use toSeconds with PEXPIRE.the code above timeUnit.toSeconds is wrong,shoud be toMillis.
a error in RedissonExpirable 2.2.1.PEXPIRE is milliseconds ,not seconds.
Auto Deploy Redis Clusters function.Redisson.createCluster.node(ipAddress,sshUsername,sshpassword).node(ipAddress,sshUsername,sshpassword).node(ipAddress,sshUsername,sshpassword).deploy();
BlockingQueue questions.Hello,I have some questions about BlockingQueue, if I have two different consumers, can I be sure that an object in the queue won't be consumed by both consumers at the same time? Does it implement any locking mechanism to prevent that?
an error in RedissonSortedSet.
RLock did not work.It's very wired. I just run a very simple test case to try redisson lock. But the result is not good.Can anyone show me why RLock didn't work?The results are as below. It seems the lock failed completely.
Add MGET command support via loadBucketValues method.No description provided.
Add size method to RKeys.No description provided.
NoClassDefFoundError: Could not initialize class org.redisson.client.handler.CommandsQueue.I am getting below exception, not sure why I am getting NoClassDefFoundError while I do see that class in the jar.Using Redis redis-2.8.14 and redisson-2.2.1.jar.
Return queue name in RBlockingQueue.pollFromAny result.No description provided.
Move flushdb and flushall methods to RKeys object.No description provided.
Add RBlockingDequeReactive.No description provided.
Add saveBuckets method to RedissonClient.No description provided.
New version 2.1.4 or greater performance is low.When I use redisson 2.1.3 the ubuntu's load average is 1.8 ~ 2.3; but I use 2.1.4 or greater, the load average is often greater than 3.00, my java application often overload.
Suspected Memory Leak under load.Version 2.2.3 under load doing simple asynchronous set operation with small string value is running out of heap.  Heap dump shows a large number of promise objects.  I will post more details soon.
Aliyun redis use 2.8.19 and not support LUA script.Aliyun(http)redis use redis v2.8.19 and not support LUA script(eg. command EVAL EVALSHA SCRIPT EXISTS SCRIPT FLUSH SCRIPT KILL SCRIPT LOAD),  Redisson's RLock RList RMap use EVAL command, so I.can not use Redisson in the Aliyun redis.How can I do a branch from  redisson v2.1.3 and remove the LUA script to resolve this problem?
topic listener decode error.An exceptionCaught() event was fired, and it reached at the tail of the pipeline. It usually means the last handler in the pipeline did not handle the exception. (io.netty.channel.DefaultChannelPipeline)io.netty.handler.codec.DecoderException: com.fasterxml.jackson.core.JsonParseException: Unrecognized token 'aa': was expecting ('true', 'false' or 'null')Is it an issue ? or a mistake made by me? thx.
use StringCodec with config,RedissonLock.tryLock() will occur ClassCastException.
How to not throw an exception on connection error and retry infinitely.I'm add Redis as a non-crucial data store (application can survive without it). However, when redis is down, the application will not start and will throw Exception in thread "main" org.redisson.client.RedisConnectionException: Can't init enough connections amount!. I would like the application to continue as usual, ideally to retry infinitely. I couldn't find this setting, and it seems like there's no way to catch the exception. Any ideas?
Redisson MasterSlaveMode with weighted load.can you add this feature with load balance control between serveral slaves.this is important when the cluster have non uniform performance.
Redisson cluster Read connections issue.I use Redisson 2.2 to implement distributed lock in my project and use Redis cluster.  And I found the Redisson client will create new connection and do not use the connection in the pool while invoke some readOnly methods which execute evalRead. So when I start to run the test it will produce lots of TIME_WAIT connection on my server. The followings are some logs on my server.The codes are very spectacular and I only understand a bit. But I doubt whether the client get the connection from the pool but also create a new one?
Spring cache integration.No description provided.
Bounded queue.No description provided.
Implement AtomicReference.No description provided.
pollLastAndOfferFirstToAsync does not block properly.RedissonBlockingQueue#pollLastAndOfferFirstTo(String queueName, long timeout, TimeUnit unit) does not seem to behave as defined in.I'm expecting the invocation in this piece of code to block until there is an element in myqueue. Instead it continues after 1 second and returns null.a different time interval doesn't change the behavior either.i've also tried using the lower level functions:
A problem.This is a simple code:Look at the attach picture..RMap<String, Integer> generate two key:str and "str", It seems to be a bug..But RMap<Integer, Integer> will be all right..
Add ability to read config from json.No description provided.
Add max-idle param to RSetCache and RMapCache.No description provided.
Add ZADD command support with NX option.No description provided.
Add RScoredSortedSet.addAll method.No description provided.
RedisConnectionException in High Concurrence.I use redis as required data store, but in high concurrence, there are almost 50% connection failed. I want to know whether to optimize my redis server(use cluster) or my client? Is there any great suggestion? infinity retry until success? And My test code are list after:I use 1000 threads, and find that if i set the connection pool size to 500, the successful proportion achieves maximum.
hello i got a server error when i use redisson to connet AliyunRedis.the error like this:"ERR unknown command eval. channel: [id: 0x73e1562f, /10.47.102.114:35465 => 126748df08bd4eea.m.cnhza.kvstore.aliyuncs.com/100.99.113.11:6379] command: CommandData [promise=DefaultPromise@40a65eef(incomplete), command=(EVAL), params=[local v = redis.call('hget', KEYS[1], ARGV[1]); redis.call('hset', KEYS[1], ARGV[1], ARGV[2]); return v, 1, loginInfo, admin, com.expresscne.parcelconfig.data.model.UserAndPermission.UserPermissionObject@175b609e], codec=org.redisson.codec.JsonJacksonCodec@5bcaeaef]","path": "/system/userPermissionEndPoint".I ask Ali's tech support about it. He told me this issue was caused by AliyunRedis not supported EVAL operation.How can I do?
I found a bug when using RMap! infinity loop!Here is the code:the loop is endless!!! I am sure there is only one Object in this map because program prints same key in the console !!How to deal with it!?
Add fastPutIfAbsent and fastPutIfAbsentAsync method.the  public Future putIfAbsentAsync(K key, V value)return null or value, can you add fastPutIfAbsent return 0 or 1 for fast put?
Please add RedissonAtomicDouble implementation.I use RedisAtomicDouble with spring data redis ,but redisson only implement RedissonAtomicLong.
Optimize RedissonAtomicLong.getAndSetAsync & RedissonAtomicLong.getAndAddAsync.No description provided.
this is a bug?I can't use RBatch.these codes will throw NullPointerException. but data has save into redis.but these codes work properly.:
Add RAtomicDoubleReactive.No description provided.
2.2.6.No description provided.
RedissonList add LTRIM Command.Can you add the method in RList?
SMOVE command support.I think this would be a good addition to the RSet family.
Add SUNIONSTORE command support.No description provided.
Add SINTERSTORE command support.No description provided.
A RMap error in 2.2.5.these codes work right in 2.2.4,but  in 2.2.5 will throw Exception:
Can't init enough connections amount.Hi,I am trying to connect to redis using RedissonClient. When I create the client without any configuration it works. However, whenever I try to pass the configuration as parameter it gives the following error," org.redisson.client.RedisConnectionException: Can't init enough connections amount! from /127.0.0.1:6397".By default it is using the same port and host. But when I try to enter it using the config param it gives me the error.Following is the code snippet,Any suggestion?Thanks.
Add max-idle param to RMapCache.No description provided.
Add max-idle param to RSetCache.No description provided.
RSet add getAll(SMEMBERS) method.RedissonSet  has toArray() method to invoke readAllAsync (SMEMBERS) , it is return Arrays.I want add a method directly return Set or List to local, then I can use these collections in local, don't need to access the redis anymore.
Can't init enough connections amount.Caused by: org.redisson.client.RedisConnectionException: Can't init enough connections amount! from /192.168.1.87:6379.This exception  appeared sometimes.who can tell me how to solve this problerm?stacktrace:
Implement MultiLock object based on RLock objects collection.No description provided.
Connecting to localhost.Hi,I am trying to connect to the localhost redis client as follows:RedissonClient redisson = Redisson.create();But I do get the following error, not sure what is the issue.Thanks for your help.
How can I use mget/mset in redis cluster?Hi.I want to use this.but when cluster mode, RedissonClient#loadBucketValues return unsupported error.how can I use it?thanks!
Question: Does redisson handle redis clusters with password?when i tried with codes below.i got this exception.and i debuged into redisson code ,it seems exception is throwed when doing a sync operation while creating a ClusterConnectionManager,my redisson version is 2.2.5.thanks.
Add readFrom (SLAVE, MASTER, MASTER_SLAVE) option to all master slave connection modes.No description provided.
Healthcheck for Redisson.I am using this client in a dropwizard service and I want to add a healthcheck. Jedis has a PING command, here using the RedissonClient I can't issue a ping command. I need to create a instance of RedisClient for the same. I should be able to retrieve instance of RedisClient from RedissonClient, or suggest me a way to perform a healthCheck for the same.
Implement vertx-redisson module.From @jackygurui: Since there are still people prefers to just use hazelcast as cluster manager but use redisson for other tasks, it would be wise to make redisson cluster manager implementation into a sparate jar and use can just pick and choose themselves.
"Can't connect to servers!" aways occured.my config as following:before if (lastPartitions.isEmpty()) ,  maybe  lastPartitions is not initialed ?
Add readAll method to RSetReactive and RListReactive.No description provided.
Running out of connections.I use Elasticache Redis as my redis server, 1 master, 1 slave (fairly large machine, this is an autoscaling micro webservice).  I used to use an older version and it worked good (from a connections point of view), but I had to upgrade from 2.1.2 due to distributed lock fixes. I am currently using 2.2.4, but after about 12-24 hours I see the " RedisConnectionException:Can't aquire connection from pool! " exceptions.I expected it had to do with Elasticache closing idle connections, so I turned that back off for now, but it didn't effect this behavior, it seems to be related with my update from 2.1.2 to 2.2.4.Does redisson not refresh its connection pool as connections close, do they timeout, or is this something else entirely?I am using SingleServer or MasterSlave Configuration, with defaults, the current behavior is seen with SingleServer. (I haven't added configurations for slaves yet)The only functionality I currently use in Redisson is the Distributed lock mechanism, to control 2 sets of locks.Flow of using lock: get lock, set expire to 15s, (try) process,(finally) unlock (or set lock to expire in 500ms)Redis has plenty of connections available. only 1300 or so used out of about 7k.
An exception when upgrade from 2.2.5 to 2.2.6.i do "mvn clean" before start tomcat.
RedissonCacheManager use custom Codec and must be more simply.build CacheConfig Map is hard and more code,I expect use these config:
Restore RMap.keySet and RMap.values methods with eager fetch loading.Those methods were deleted in a07e4d4ebdf0a2c2436942c8e537eebe48aee7f5 commit.
Add readAllKeySet, readAllValues, readAllEntry to RMapReactive.No description provided.
Sentinel error when no slaves.if there are no slaves on SentinelConnectionManager:82 we have a List<Map<String, String>> sentinelSlaves = connection.sync(StringCodec.INSTANCE, RedisCommands.SENTINEL_SLAVES, cfg.getMasterName()); which returns just Map not List of Maps.So, the exception I get is:You may argue that it is not correct if there are no slaves, but, this cut config is used on test machines and not on production (which is fully configured with slaves). So, would be nice to handle this error.Thanks.
RKeys.deleteByPattern in cluster mode throws error.No description provided.
Sentinel "ERR unknown command 'AUTH'" error after upgrade from 2.2.5 to 2.2.6,2.2.7.Stacktrace:
Redisson.Hi mrniko,since upgrading to 2.2.6 from 2.1.4, suddenly the Rmap only returns 10 elements - although it reports size correctly to 1000. Below is my test scenario - please help! I have attached output log.
Log Level.Hi,I want to stop receiving the default debug logs in my tomcat logs, how do I change the log level?Sorry for the noob question, thanks in advance!Regards,Balaji B R.
Lots of string allocations by exception.Doing some load testing I found that this line:exceptionRef.set(new RedisTimeoutException("Command execution timeout for command: " + command + " with params: " + Arrays.toString(params)));in CommandExecutorService can do a lot of string allocation and generate garbage. Could this exception be improved so the array is only built when necessary?thanks.
Add sunion command to RSet.No description provided.
Add type to Node.Methods to get master and slave nodes are needed too.
Redisson keep retry commands during shutdown.No description provided.
Read all values of set.Hi,When I am trying to read all the values of set I get the following exception. Let me know if you require more details.Version: 2.2.7.
Multimap.Implement Set and List based multimaps RSetMultimap and RListMultimap.
an exception of RedissonSpringCacheManager.
Where is ZREVRANGEBYSCORE command.Returns all the elements in the sorted set at key with a score between max and min (including elements with score equal to max or min). In contrary to the default ordering of sorted sets, for this command the elements are considered to be ordered from high to low scores.Sorry, I can't find it...
redisson.shutdown()  time consuming 2s.I use  distributed lock,but redisson.shutdown()  method  time consuming 2s,help! help!
why not invoke FSTObjectInput.close() in FstCodec?
ElasticacheCluster not working correctly with DistributedLocks.I am trying to use redisson 2.2.7 for distributed locks. I have a 3 node Elasticache cluster with one of them as master.When I try to get lock using the following code, i get an error saying that i cant write to a Slave. My assumption is that i can feed a list of nodes to the redisson client as Elasticache nodes and it will figure out who the master is...is that not true?The error that i get is shown below..Here is how i am setting up a redisson client.
Add DynamicImport-Package to OSGi-instructions.If you cache domain models (i.e. via the Serialization-Codec) within an OSGi-environment and want to retrieve those back you will hit ClassNotFoundException as the Redis-Bundle doesn't import the appropriate packages. One way to avoid this would be the additional "*" declaration for the OSGi headers,
Throw RedisOutOfMemoryException on OOM error from Redis.No description provided.
New connection pool.Connection pool could be improved. Each connection has own commands queue which should be used and connection acquire/release and consequently connection waiting logic will be removed.
Add CLIENT REPLY command support.No description provided.
Add config option to reuse existing netty EventLoopGroup.Our application (and many others :) uses netty for networking and it would be good to have option to reuse main EventLoopGroup instead of creating new.
Google App engine support.No description provided.
Redis Logback appender.No description provided.
Add HSTRLEN command.No description provided.
Add INFO command.No description provided.
orphan netty threads on connection failure.If you try to create a RedissonClient and get a timeout error, the created netty threads aren't destroyed and you can never terminate the Java program but with a System.exit(). For example:If this code fails, then several netty threads remain in execution and they are never destroyed, because the "client" variable is the only point where you can "shutdown" those threads, but that RedissonClient instance hasn't been created (because an exception has been thrown).A possible solution is to shutdown the failed connection at MasterSlaveConnectionManager.init(), which is the point that all kind of connection managers run to create a connection. Surrounding:
Version.logVersion() error.version:redisson-2.2.9.exception:
An exception was thrown by org.redisson.RedissonLock$8$1.operationComplete()- java.lang.NullPointerException.An exception was thrown by org.redisson.RedissonLock$8$1.operationComplete()in class RedissonLock ,row 580, futureRef.get() may be null.
Async version of RSetMultimap/RListMultimap.Is there a plan to implement RSetMultimapAsync and RListMultimapAsync?
Missing entries in RMapAsync using single redis server and multiple web servers in servlet enviornment.I am testing out using RMapAsync to store connected users to our web service in a servlet environment with two or more web servers and one redis server.  When a user creates or removes a session, I'm adding/removing to the RMapAsync like so:and similarly, when a session is removed:I am seeing that there are a few hundred missing with a total user count of 3K or so.  Is this possibly because the same redis key/hashmap is being altered simultaneously from more than one server?  Is it best to get the map and edit it like I'm doing here? or would it be better to have one class member instance of the map in my class and just add remove in the relevant methods (so I'm not continuously calling get map for every add/remove)?  What's the best practice for a setup like this if this isn't a bug, but a misuse of the RMapAsync?  (awesome project btw)
RScoredSortedSet should be able to handle +/-inf as value range.Credit to @ZizhengTai.
RSetMultimapCache and RListMultimapCache.There should be field-expirable versions of the multimap classes.
Add LINSERT operation to RList.Add RList.addBefore() and RList.addAfter() methods.
Add MSETNX command support.No description provided.
RedisConnectionException: Can't init enough connections.Redisson version: all from 2.2.3 to 2.2.9.Redis version: 3.0.4.Initializaition:
Please add RScoredSortedSet#revRank method.corresponding the ZREVRANK command.Thanks in advanced..
RemoteService.
Read Write lock cannot be correctly unlocked.in ReadLock and WriteLock,  the unlock method use thread id to determine whether it is owned by this thread. it works fine for a single machine.However, when it is used in a distributed processing framework such as MapReduce, the Read and Write lock cannot be correctly unlocked.I browse the source codes and find that the UUID is generated in the lock, I think it is better to use UUID as lock id  istead of thread id or provides a way to let users to set a unque id.
Connection pool exhausted! All connections are busy.version: redisson-2.2.9.test as following:
Connection pool exhausted! All connections are busy.version: redisson-2.2.9.test as following:
Allow injecting custom ConnectionManager.Use case:Redis clustering is implemented using twemproxy, and its location should be discovered and monitored using Consul, etcd or whatever else. Currently I have to either use DNS monitoring (which is not an option in some cases) or wrap Redisson instances into a proxy to implement this. It would be better to have an option to implement such behavior in custom ConnectionManager.I can make pull request with implementation, if anyone else needs this.
Optimization on interactions between Redis and Redission.I have seen the source codes and found that many codes use java string join parameter.I think it is not inefficient.May be use StringBuffer of use static string values, so that the interactions between Redis and Redission can be more efficient.
Add oneShotListener to RTopic.oneShotListener must remove itself automatically after execution.
Ability to cancel BRPOP and BLPOP async command execution.Implement correct cancellation handling for Future object returned by pollAsync, pollFromAnyAsync, takeAsync, pollLastAsync, pollLastFromAnyAsync, takeAsync and pollLastAndOfferFirstToAsync methods.
Fix delete and expire Multimap methods.No description provided.
MOVED, ASK handling in cluster mode using RBatch.No description provided.
Long BlockingQueue\Deque commands reattaching.BlockingQueue\Deque Commands like take, poll and pollLastAndOfferFirstTo must be reconnected to a new channel after RedisConnection has been reconnected.
2.2.11.No description provided.
Is Redisson a good candidate for session manager?I know my question is not an issue but I couldn't find a better way to get an answer, sorry!Would you recommend Redisson as a session manager (as in HttpSession)?Spring Session comes with a clustered version using Redis but it does not support locks (AFAIK) and personally I find that useless. Then I found this project and it sounds suitable but there's so much to consider and trying to get advise from the community I thought this is the best place to ask.
Add Spring session integration.No description provided.
Exception on  pub / subscribe and after whole system becomes unstable.i use Reddison framework with scala and noticed very strange behavior. If I use sync. and pub \ subscribe features all system get unstable and issue an exception listed below. Also below is the simple test which produce this behavior. Any comments ?
RSetCache not checking expiration.From gitter:I just want to confirm but redisson.getSetCache would be appropriate for locking? That is using .add() to see if it was able to add a guid to the set (unlocked) or not (locked)@mrniko  As you can see lua-script from this method doesn't check element expiration as others do. Could you create an issue about this?
Long latency issue while call Redis.I use Redisson 2.2.10 to implement distributed lock in my project. And then I run load test for this distributed lock using SINGLE redis mode. But I found there are many long latency APIs and it's wired that almost all the long latency APIs are a little greater than 1000ms. The average latency and 99 percent latecy is about 15ms and 30ms respectively. And then I used jstack to get the call stack and found most of the threads are WAITING at the same place just as the following.Meanwhile, during the test, I dumped the network packages using tcpdump and found that it took about 1000ms before the first package was sent to Redis. And in Redis server, I didn't find any slow query whose latency is more than 10ms. So I think, for the long latency API, most of the time might be cost in the project not the network. So can you help me to have a check or give me some suggestion about this issue?  Many thanks.
Add TIME command to Node object.No description provided.
Add ZCOUNT command.No description provided.
remove "lex" workd from method names in RLexSortedSet.No description provided.
Move all mass bucket methods to RBuckets object.No description provided.
Exception occurred. org.redisson.client.RedisTimeoutException: Redis server response timeout for command: (HGET) with params:Hi,I have setup Redis in sentinel mode with 4 slaves and 1 master. As I increase the number of read requests, Redission is throwing RedisTimeoutException. The TimeOut is set to 5 sec and retry count is set to 5. Will increasing the number of slaves help?
wrong SCAN commands handling, affects Iterator objects.No description provided.
Reconsider interface hierarchy used in RMultimap.get methods.No description provided.
Need suggestion for connection issue.Hi,I am using a single server connection and set the connection pool size to 10. I have created multiple threads to test a code snippet where I am saving an object to RBucket<> object and deleting it afterwards in a same transaction block. I get following error sometime in the process,Any suggestion?Thanks.
RedisTimeoutException with "large" objects.I have a simple setup with a SingleServer connected to a ElasticCache-Redis instance. I upload various sizes of bytes to measure the performance between those. Small objects up to 3 MB perform fine but above that I receive this error:In "Batch" mode is also see this:My setup for connecting looks as following (I have a similar setup with redisson-reactive showing the same problem):I have tried using the latest versions (release + HEAD). I have debugged the issue but haven't found any obvious problem. The only thing I found is the timeout in "new HashedWheelTimer(minTimeout, TimeUnit.MILLISECONDS);" which is set to a 100ms (from MasterSlaveConfig) and seems to be the reason for cancelling the commands? Though I tried changing this without success.Somebody has an idea about what might be causing the timeouts? Can I configure those to be suitable for bigger objects?
Deadlock using RedissonMultiLock.I am using simple app to run on 2 clients to test locks.While using RedissonMultiLock with 3 locks both clients blocks.
IllegalStateException while iterating over RMapCache using an iterator.While iterating over an RMapCache object with an iterator, an "IllegalStateException" occurs  on the second removal of an entry from the map.The map structure is RMapCache<String, List>.The iterator is received via cacheMap.entrySet().iterator().The iterator removes successfully the first entry, but upon the second entry removal it fails with the exception mentioned above.Please note this code used to work fine with a regular Java Map.Here is the code:And here is the relevant stack trace:
RMapCache.values() fails.I recently change some code to use maxIdle timeouts on a map.  I.e changed from RMap to RMapCache.   Put and gets are working as expected but the .values() call doesnt work.I have attached a test class to show this.
Add RTopic.waitMessage method.No description provided.
In Cluster when master goes down and his slave becomes a master, Redisson does not recognize the new master.Hi,I configured Redisson, see below, and it works, but when I shutdown one redis master and his slave on other machine becomes a master (in 5 sec) Redisson cannot recognize the new master and the request seems like still go to the old master which is not exist.Please assist ASAP.Thanks!
Master change in cluster mode causes an unneccesary slots migration.No description provided.
Redisson fails to recognize slave that become a master due to master down in Redis Cluster.Hi Niko, seems like problem really exists with redisson driver for cluster.Here is our configuration:When I did this Redis cluster reorganized to following:As you can see cluster is ok, but requests are failing for some reason.If I restart tomcat without touching anything on Redis requests are not failing.Very strange.This is the link to the redisson log:Please assist,Thank you!
Error if first node is down in 3 node Master-Master cluster.I have a Master Master redis cluster of 3 (node1,node2,node3). Locking mechanism works fine if we block the network for node2 or node 3. But if we block node1's network then it fails with the below error.Below is how I'm creating the Redission client.
A bug about RScoredSortedSet#revRank method.
Connection pool exhausted! error in Redis Cluster.Hi Niko!We constantly have "connection pool exhausted" errors on our env.The configuration is : 3 machines with 1 master and 1 slave on each machine.May be we should tune some configurations in our redisson config?Can you please explain briefly the meaning of these:
Rlock Exception in cluster mode.Hi.I am using redis 3.0.6 (4 node cluster  ) and redisson version 2.2.5.Sometimes when I try lock a key I get the following exceptions:my code :
RSetCache TTL doesnt readd after expiry via RSetCache.add.I have a problem with a RSetCache with TTL.   The problem seems to be that the value is not returned from the iterator and calling readAll throws an exception.Redisson : 2.2.12.Redis : 3.0.7 (00000000/0) 64 bit.I have attached a test which reproduces the issue.When I run this, it keeps adding a string into the set and it should expire but be replaced quickly, this doesn't happen and the set is empty after the 30 seconds.Calling readAll() on the set it fails with the following error.hscan testRSetCacheTTL 0.shows the value in the set while its running and after (when I disable the delete() call).Also note that removing the delete() call seems to stop the exception from readAll().  So using readAll() with no delete() works or using delete() without the readAll().   But I have a feeling that it could be timing related.
Rlock performance issue.Hi.I am using reddison Rlock with a cluster setup , and sometimes I see latency( up to 1000ms)  when trying to acquire the lock or unlock.I saw this issue opened by zhxjouc (#455) with a similar problem  and I am working with 2.2.13 but I am still getting latency when a thread is trying  lock a key.My code is running with Java thread pool for accessing redis, I notice that if I work with pool of size 1-2.almost no latency when getting the lock, but working with 30-50 threads cause the lock delay.It could be thread overhead issue but I think that 1000ms is too long for that.Any help on how can I get better performance when locking an unlocking?.Thanks.
getBlockingQueue throws IndexOutOfBoundsException.Hi:when I was using getBlockingQueue method.following exception happened to me:
expireAt(Date) use second instead of ms.
Dead Locks Happen in lock() Process.when heavy concurrency happens in my application, a few lock requests will "sink" without any responses, even after the lock lease time has passed. All of these requests wait at RedissonLock.lockInterruptibly().The exact position is RedissonLock.get() after RedissonLock.subscribe().In my opinion, this may be due to a thread removes the netty listener which is used by another thread. It can happen in this way:Thread A is in the loop of getting the lock after subscription.Thread B has also applied subscription and waits for result.Thread A gets the lock very soon and enters  RedissonLock.unsubscribe(). In this step, it possibly removes all the listeners on the same channel, which includes the listener used by Thread B. It causes Thread B can never get subscription response and hang on forever.The similar issue is at http. But I think it is not solved completely.Also I suggest  to apply the ttl algorithm to RedissonLock.get() because this step can cost some time. And if it has a timeout, dead lock can be prevented in a work-around way.This is the thread dump when dead lock happens:
Move all config classes to org.redisson.config package.No description provided.
RedissonRemoteService: executorsAmount vs invokeMethod.This is more a question than an issue, and please excuse me if this is a dumb question, I may be wrong, I am just beginning to dig into the code.Here I suppose that the clients are able to issue calls more quickly that the servers can respond to.In RedissonRemoteService, is it possible that the server ends up invoking simultaneously more than the expected executorsAmount given that it re-subscribe before the invokeMethod, and even before the ack ?
RedissonRemoteService ideas.Here, two things that would be great additions (I think) to the RedissonRemoteService.1) Be able to choose the remote service interface prefix.Right now its hardcoded to redisson_remote_service:.The use case is simple: for example I want to be able to deploy the same worker application (that expose the same service) on two types of instances (say some AWS m3-* for standard use, and some c4-* for hardcore use).So on the server side I would call:And on the client side:1) Be able to issue one-way call (ie: wait for the ack, but not the actual response)This could be a client side only change, for example, by having a new set of RRemoteService.get(...) methods, that takes a boolean waitForResponse...Or, maybe, re-use the RRemoteService.get(...)'s long executionTimeout, where a value of executionTimeout < 0 would indicate to the client to wait for the ack, but not the actual response.
Java 8 compatibility.No description provided.
Asynchronous lock release.Hi,I'm trying to create an infrastructure where different machines acquire shared locks through Redisson. Once the lock is acquired, some async tasks gets done, finally, when I finish the job, I'm releasing the Redisson lock through the thread currently running - but i receive the following error.java.lang.IllegalMonitorStateException: attempt to unlock lock, not locked by current thread by node id: xxxxx thread-id: 57.So, I understand the meaning of that, but since I want to perform asynchronous work, I cannot use the acquiring thread to perform the release.Is there a solution for asynchronous programming? Should I not use Redisson Lock?I also references the issue on SO.Thanks.
Async Semaphore.No description provided.
FstCodec: FSTObjectOutput proper usage.Juste a little something.In the FstCodec, when an object in encoded, an FSTObjectOutput is first borrowed from the FSTConfiguration, then used to write the object and then closed.In the FST Serialization Recommended threadsafe Use, they recommend, when using the factory method, not closing this stream in order for it to be reused.I think that only an oos.flush() instead of a oos.close() will do the job here.Not a big deal, but still....
Only `connect` Topic under Cluster mode Not Working in win7.my OS is win7, so i use MSOpenTech/redis 3.0.1 and running redis under cluster mode.i learn from redisson topic and use redisson.getTopic("anyTopic"), it is working well.but only redisson.getTopic("connect") not working!?i changed redisson.getTopic("connect") to redisson.getTopic("connected") or use redissonConfig.useSingleServer() it is still working well.
Possible race-condition in RemoteService.Race-condition during ack checking is possible. For example, ack timeout = 1000 ms:worker receives Request in 999 ms sends ack, but it comes in 1010ms or something like that.client checks ack in 1000 ms and throws RemoteServiceAckTimeoutException.worker invokes method.To solve this problem ackObject was introduced. Worker or client set it to 1 via SETNX command. Worker set it during ack sending. Client during ack receiving.Client check ackObject only if ack timeout has occurred. If client can't set it means that worker have done it already. So client should poll an element from queue again.If worker can't set ackObject then it means that ack timeout already occurred on client side and invocation should skipped.
Add RedissonFairLock.No description provided.
Allow to execute interface methods used for RemoteService in asynchronous way.No description provided.
RedissonSortedSet's order seems broken.Hi, we have been using RedissonSortedSet and just found that on certain cases the order can be broken and I assume RedissonSortedSet is supposedly thread safe.Assuming RedissonSortedSet of integers are added with the following integers : 103, 101, 102. RedissonSortedSet state (list in the redis server) should be: 101, 102, 103. However, there are cases when it is not. It may become 102, 101, 103 instead. And looking at RedissonSortedSet's source code, it uses binary search that requires the list/state to be always sorted. Therefore it breaks many other functionality.The use case that breaks (in my case) is when we are adding multiple items and there is another thread that delete an item in between. Looking the source code implementation briefly, it may be because when removing an item it does not consider getCurrentVersion() (just a quick guess).
RKeys.getKeysByPattern infinite scan when no keys are present.After updating to version 2.2.14 RKeys.getKeysByPattern is doing infinite scans when there is not even 1 key by this pattern. It was working fine earlier.It works fine when there is at least 1 key with this pattern.
Guava BiMap.No description provided.
redis master/slaver switch exception.When redis master-slave switch,my project throw exception.I ues redisson 2.2.8 and cluster mode.Thank you very much.--Marck.
Redisson cannot recover from password protected rebooted redis server.Steps:Redis Server up.Client is up connecting and connected to Redis Server. It required AUTH password.Redis Server down and passed the failedAttemps, so the server is excluded.Redis goes back up.Client is trying to reconnect, but the mechanism to check if server is alive is broken for password protected server.I think the following line of code can be improved by including authentication:
Support for ssdb as a replacement of redis.No description provided.
Storing simple key/value pairs in RMap vs. RBucket.Sorry for using an issue for my question, but I couldn't find a mailing list to post this question to :)I am using Redisson to store key/value pairs and was wondering whether it makes more sense to use just plain RBuckets for each pair or a single RMap. I am especially interested in the possibility of sharding these across nodes in a cluster setup (PRO feature?). The key/value pairs are immutable and I would expect a lof of PUTs and DELETEs of them. Any pros and cons?I do also use a lot of different "types" (around 8) of caches (with different serializations and TTLs). Currently I am using a different redis databases  for each type. This means I have to create a new connection (aka RedisonClient) for each of these. This also means a lot of Threads in the different ThreadPools, though I am already sharing the EventLoopGroup between the instances. Would there be any particular drawback in storing all of these in just one database to avoid the Thread overhead?Thanks in advance!
Add RGeo to RBatch object.No description provided.
Add ability to define Codec for RemoteService.No description provided.
Add Multimap to RBatch object.No description provided.
Add MultimapCache to RBatch object.No description provided.
Conflicting setter definitions for property "masterAddress.Hi,I am getting below error while creating instance of config through json ObjectMapper.Exception in thread "main" com.fasterxml.jackson.databind.JsonMappingException: Conflicting setter definitions for property "masterAddress": org.redisson.MasterSlaveServersConfig#setMasterAddress(1 params) vs org.redisson.MasterSlaveServersConfig#setMasterAddress(1 params)I tried both yml and json but still facing the same issue with both.Please let me know, what I am missing in config.Thanks,Sid.
Add TYPE command.Add TYPE command RKeys interface.
Deadlock on lock() and not only.Hi,I want to raise the issue with deadlocks again.This bug is still exist and making big headache. As before, It present itself only on very heavy loaded tasks, but in this case I is happens only when client talks to the claster which is located remotely.With a single-local or claster-local servers I was unable to reproduce it, but with remote server it happens with rate 1 / 20 (means from 20 runs of "heavy-load" JUnit test it happens only once)I can see where thread is locked down, it always stuck in CommandAsyncService.get(Future), on l.await() line and never exits from it. As I understand something wrong with mainPromise object, it is staying in incomplete state... and nobody change it. I tried to understand the logics in CommandAsyncService.async(...) function, which is actually deals with connection, retry, redirections and at end should release (or fail) the mainPromise object, but it is nightmare. All these spagetty with promises and futures made the code difficult to read and impossible to analyse. For sure BUG is there, but I am near to give-up. Any thoughts?
Writing to Redis failed without any exception.Hi,I'm using Redisson version2.1.5. Writing (Synchronously) to Redis has failed without throwing an exception. Is there any known issue?
A type based codec for json.The current JacksonJsonCodec embeds the class information into the json payload, therefore coupling the redis data with the java client.What do you think about me adding a codec dedicated to a specific type, so we can get away with clean json?Thanks.
Exception in using RedissonMultiLock.I have 5 independent masters and I use single server config to create Redission instance.The RedissonMultiLock works fine if all the redis nodes are alive.If I shutdown one of the redis nodes, it will throw RedisConnectionException.Exception in thread "main" org.redisson.client.RedisConnectionException: Can't init enough connections amount! Only 0 from 5 were initialized. Server: /192.168.223.128:8000.According to The Redlock algorithm, it should try to lock another node but not throw exception. Do I use RedissonMultiLock correctly?It tries to acquire the lock in all the N instances sequentially, using the same key name and random value in all the instances. During step 2, when setting the lock in each instance, the client uses a timeout which is small compared to the total lock auto-release time in order to acquire it. For example if the auto-release time is 10 seconds, the timeout could be in the ~ 5-50 milliseconds range. This prevents the client from remaining blocked for a long time trying to talk with a Redis node which is down: if an instance is not available, we should try to talk with the next instance ASAP.
Add SCAN command support to RedissonKeys.deleteByPattern.No description provided.
memory leak.
Scalability of Channels (Pub/Sub)I'm building a real-time text based chat program where people can chat with ONLY 1 other person.Each person can chat with 1 other person, but the aim is they can chat with Many people at once. (i.e. MANY one to one chats with different people). The aim is to have it scaleable, not necessarily to snapchat's level, but enough for 1 City.I'm just wondering what is more scaleable:Having 1 channel for the entire application and filtering who the message is for and who sent the message based on the data encoded in the message.OR.Having 1 channel for each person and all the different people sending messages to that person send their messages through that channel with data encoding who sent the message.OR.Have an individual channel for EACH Chat between 2 people.OR.For Option 1 (1 channel for entire app), perhaps an intermediate solution of having 1 channel per city.I'm wondering what approach is best for Java and Redis. If there is no clear cut answer, what the conditions/criteria are for making the decision.
RMapCache with timeout leaves redisson__idle__set__ behind.If you create a RMapCache with a TTL entry then delete the map, the idle_set is left behind.  This should be deleted too.
pub/sub timeout.500 num cur time.
RedissonRedLock.unlock() is using forceUnlockAsync()RedissonRedlLock overrides unlock() of RedissonMultiLock and it will force to unlock all instances.Is it more reasonable to use unlock method of RedissonMultiLock?
RLock trylock blocks forever.Found this in 2.2.16, seems like this was not around in 2.2.10. But still verifying.When tryLock is called with 0 wait time, the thread blocks forever. I took a thread dump and it looks like the stack pasted below.A note on the environment: We are running this against an Elasticache cluster in AWS and accessing from 4 EC2 instances. We have seen a lot of command timeouts. I am not sure if that is some way leading to this.
RedissonLock.isHeldByCurrentThread() doesn't check properly.I am using RedissonLock in my system.The lock realted logic in service is like this:But in the log I found:I can see the the thread name is same, so the thread got the lock and the thread try to unlock is same thread.Is there any problem in my code? Or in the logic of lock.isHeldByCurrentThread()?
ConnectionListener.onConnect()/onDisconnect() are not invoked when redis server becomes active/inactive.I am trying to utilize ConnectionListener to monitor connections to redis servers. The way I add connection listener is pretty similar to the sample code showing in wiki 9.1:The way I test it:start two redis server on port 6379, 6380, let server on port 6380 to be the slave.setup and start redis client. I am using ElasticacheServersConfig here.Once all connections are stable, kill redis master server and check output.However, what I saw is onDisconnect() of my listener is never invoked after I shut down my redis server. If I restart my redis server again, I can see connectionEventHub.fireConnect() is called. But since the check maps.get(addr) == Status.CONNECTED always return true, my listener.onConnect() is also not invoked.Can anybody help explain why this happens? Did I misunderstand what connection listeners should be used for? Thanks in advance.The version I am using is redisson-2.2.13.Below is the console output after master is down.
redisson creates non-daemon threads.There are times we don't want to explicitly call RedissonClient::shutdown,but because redisson creates some non-daemon threads when using the MasterSlaveConnectionManager (by using HashedWheelTimer's default thread factory)then the JVM will never be able to quit without calling the shutdown method.Please add support or change the default behaviour to start HashedWheelTimer with daemon threads.
redisson org.redisson.client.RedisException: NOAUTH Authentication required. exception in 2.1.0.I got redisson org.redisson.client.RedisException: NOAUTH Authentication required. exception in 2.1.0.
Connection pool exhausted.I met similar problem these days online  used  of sub/pub.The version I use is 2.2.17, I have 2 redis server, one master and one slave, in sentinel mode. It is in test environment so net work and cpu usage is low.This error appears about every 1 day.
Move classes from `org.redisson.core` to `org.redisson.api`.No description provided.
Redis server response timeout.My program often occured the following error:
Consider consolidating tests on Travis CI.Hello!Thank you for using Travis CI for your testing needs.We noticed, however, that currently this repository configures 180 jobs for each push. This puts undue burden on the system, not to mention long waits for each build to complete.I have marked the user @mrniko as an offender to prevent further queueing of builds from this repository at this time.I apologize for the inconvenience. Please send email to support@travis-ci.com when the jobs are sufficiently consolidated.Thank you!
why key never don,t expire?hi:i have use ression ,ression version is:2.2.15.problem for: my code is mylock.lock(2L, TimeUnit.SECONDS);why ttl key value is loop for 20-30 ,  un locked.please help me,  thank you.
Command execution timeout for command.I started getting RedisTimeoutException("Command execution timeout for command") for put operation on RMap. I have been using Redisson in production for 6 months. I'm seeing this exception now. I'm using Sentine mode with the following configuration.What could be the reason for it?
java.lang.UnsupportedOperationException during command batch usage with netty 4.0.38 and higher.Starting from netty 4.0.38 java.lang.UnsupportedOperationException occurs during command batch usage. This is issue related to netty/netty#5581.
loop lock blocked when master-slave failover.description: after master-slave failover , the test code blocked forever .redis cluster :test code:exception:
Ack object used to prevent race-condition during ack receiving should be created per request.Because of this issue RemoteServiceAckTimeoutException could be thrown prior the end of ackTimeout.
Add Future.cancel method handling for remote method call.No description provided.
Redisson map get makes the thread waiting forever.The map is a regular <Integer, String> map, and by calling a get on some key we see the following thread trace:
attempt to unlock lock, not locked by current thread by node id.redisson version:2.2.21.implement code:
Add ability to cancel remoteService task execution.No description provided.
Help needed with elastic cache configuration.Hi @mrniko , we are checking the work with AWS elastiCache instead of Redis-labs, and wanted to check if the following parameters seems ok in that case:Thanks.
Improve BLPOP response timeout.According timeout issue with blpop command redis/redis#874 one second should be added to response timeout handler.
Exceptions handling in CommandDecoder.Unhandled exceptions in CommandDecoder during decoding leads to response timeout exception.
Exceptions handling in CommandEncoder.Same thing as for CommandDecoder: unhandled exceptions leads to response timeout exception.
Limit Payload String on RedisTimeoutException.If a timeout occurs while inserting a ginormous payload, the entire payload is logged in the error message.Is it possible to limit the payload portion of the error log?
Unable to redefine RedisClient command execution timeout.command execution timeout should be = retryInterval * retryAttempts.
Add Smile and Avro codecs.No description provided.
redisson can't subscribe to the slot after fix Redis Cluster PubSub  Scalability Issues.redis PubSub Scalability issure:after fixed it , redisson can't receive message becauseof following code:
Connection pool exhausted.When set rertyAttemps to 0. connection pool size is 100. use 100 threads to read the redis cluster,it will throw exception like "Connection pool exhausted! for slots:In my point of view,it's caused by LoadBalance.
"Command execution timeout" for INFO replication.Hi @mrniko,I am getting the Command execution timeout when my application comes up. Looks like the first INFO replication command is being timed out. Same command I have tried from the command and the same command works well in almost no time. Can you please suggest if there is any such open issue? I am using 2.2.24 of the library.Following is the stack trace:
Replace Future interface to RFuture for async methods.No description provided.
diffrent topic subscribe to the same node.redisson version: 2.2.17.redis version: 3.2.3.redis cluster nodes:test code:we expect  SUBSCRIBE test0-test9 to all nodes of cluster .
Cannot create Redisson Client if it cannot connect to the only Slave in SLAVE and MASTER_SLAVE read mode.Hi all.As the issue title says, we cannot create Redisson Client if it cannot connect to the only Slave in SLAVE and MASTER_SLAVE read mode. While this looks like the expected behaviour, since creation of RedissonClient object can be very critical for an application startup, may be the redisson library can fallback to something more forgiving, like using the Master for reads with some error logs.We have encountered this issue due to firewall rules not being setup correctly (which can happen, no matter how much effort is put in) and the consequence of this was our app did not start up and the deployment had to be rolled back. We couldn't explain why Redisson Client cannot be created when the connection to the Master was working, until I tested it out using the unit test below.We have fixed up the firewall rules, but just wanted to inform as this feels like a rough edge. By the way, we were using 2.2.13 and this issue seems to be in the latest release 2.2.24 as well.Thanks.The setup used for the unit test below is:testReadModeSlave and testReadModeMaster tests fail with the following error:I have also seen the following error when running the tests above, but does not seem to happen consistently:
tryLock method throw Exception:attempt to unlock lock, not locked by current thread by node id: 157ddcf5-0cc2-445d-bdea-98160a459bd5 thread-id: 42.@mrniko.hi, I stress test tryLock(long waitTime, long leaseTime, TimeUnit unit) method, throw Exception:attempt to unlock lock, not locked by current thread by node id: 157ddcf5-0cc2-445d-bdea-98160a459bd5 thread-id: 42.unnormal code:1:but use lock() or lock(long leaseTime, TimeUnit unit) method is normal, why?2:tryLock() can not be block? lock() is blocked?3:tryLock(long waitTime, long leaseTime, TimeUnit unit) method, waitTime must be more than leaseTime value, otherwise occasionally have "attempt to unlock lock, not locked by current thread by node id" ecxeption, in stress test condition, why?
java.lang.ArithmeticException: / by zero in WeightedRoundRobinBalancer if the connections to the only Slave are frozen.I was trying to use the WeightedRoundRobinBalancer to give preference to a Redis server over another for reads and encountered java.lang.ArithmeticException: / by zero. Following is the unit test and the stacktace. Interestingly, this error happens only when the slave is given an higher weight; if the master is given a weight of 2 and slave a weight of 1, then the error does not occur.The setup used for the unit test below is:Sentinels running on localhost:5000, localhost:5001 and localhost:5002.All the above processes running in a guest VM.With port forwarding setup from host to guest for 6379, 6380, 5001, 5001 and 5002.But the slave on the guest had the bind configuration to listen only on 127.0.0.1. i.e. connections from host wouldn't work.
lock.unlock.if (lock.getHoldCount() > 0) this ,why not include unlock?
Improve re-connection scheduling accuracy in ConnectionWatchdog.EventExecutorGroup scheduler can't provide scheduling accuracy in milliseconds. ConnectionWatchdog should use HashedWheelTimer instead of EventExecutorGroup.
redisson lock failure problem.redisson version:2.2.24.@mrniko.hi, i user jmeter pressure measurement  redisson lock.scene :Pressure test scenarios:Using two tomcat, simulating the two service requests, each request the server queue to obtain a lock, concurrency of 5000, continued request for 20 minutes,After acquiring the lock counter, increments by 1. It appears six times double counting problem, log is as follows::A server.lock and unlock code.
how to del expire key in hash?when i use redisson ,just like redissionCache.put(key, value, this.time, this.timeUnit), value is obj,but the key just use once, now we do some stress-testing ,there are lots of expire keys ,i don't know how to clean these expire keys.
Q: To use RedissonRedLock locking mechanism do we need to create multiple locks?My use case is simple (I think). I need to make sure that for a specific keyspace, only one client can create an entry i.e. akey with value for it. If multiple threads/clients etc access the "creation" method at the very same time, then only the first one should get access to create the entry & all others should be rejected.I was trying to accomplish using the following code snippet.But this seems to not work at all. I executed this method using executor service, where I ran 2 threads in parallel.And it seems that one of the threads gets is able create the lock, do the work & unlock it. But the second one is not even able to get the lock & the method never finishes execution.After I changed the locking mechanism to Fair Lock things work as expected.I am not sure why this is? Is it because of the fact that the RedissonRedLock expects multiple locks? But I dont think I would need that in my case.FYI here is the snippet of code I use to paralelly start 2 executions.Am I doing something wrong?
Duplicate objects in a set.Hi,I seem to be able to create duplicate POJO objects in a Redisson distributed set. The implementation doesn't seem to call equals(), which I find odd. I've tried the sorted set implementation too, which calls compare(), but I can get duplicates there as well. Am I missing some implementation details?Thnkas.Nick.
Tomcat session manager.Support all versions starting from 6.0.
possible memory leak due to unlimited io.netty.util.internal.MpscLinkedQueue size.as the titles tells, when the qps is big enough, say 30000, the MpscLinkedQueue size may run out of control and worse, even full GC can not save any capacity.and this is code.
Implement LocalCachedMap.Supports LRU and LFU eviction policy.Supports time to live and max idle time support.Supports size limitation. If cache max size reached then elements evicted according eviction policy and/or object TTL.If element has been added/removed then invalidation message sent to all LocalCachedMap instances and element evicted in all of them.
can't find slaves.My program in the process of running.Occasionally, there will be no node to find!my redisson 2.2.14. master/slaver mode . redis cluster 3.x.
Wrong object encoding during RedissonScoredSortedSet.addScore usage.No description provided.
Add ZINTERSTORE and ZUNIONSTORE support.No description provided.
Implement Phaser.No description provided.
Check that RLock still belongs to owner during renewal expiration.No description provided.
Could not initialize class org.redisson.codec.JsonJacksonCodec.Hello,I`m having the next issue (trying to use an Elasticache-Server):StandardWrapperValve[Login]: Servlet.service() for servlet Session threw exception.Server conf:64bit Debian jessie v2.1.6 running GlassFish 4.1 Java 8 (Preconfigured - Docker)
Getting memory leak warnings when gracefully shutting down tomcat.I am getting warnings about potential memory leaks when gracefully shutting down tomcat:In each webapp I configure a RedissonClient bean with a "useSingleServer" config:After that I use this bean by autowiring it in other spring beans:Any idea why this happens?
java.lang.NoClassDefFoundError: io/netty/channel/epoll/EpollEventLoopGroup.
Trouble with change from io.netty.util.concurrent.Future to org.redisson.api.RFuture.I'm updating our app to use Redisson 2.3.0, and I'm having some trouble with the breaking change (io.netty.util.concurrent.Future to org.redisson.api.RFuture).Previously, I had been using the fastPutAsync method for RMapAsync like this:I'm trying to change that Future<Boolean> (which is the netty Future) to RFuture, but I'm having a bit of trouble getting it right. All I'm really after is being able to log success/failures of the fastPutAsync() method.How would this be accomplished using the RFuture?
Issue with using Executor Service.I am trying to use Executor Service to do a distribute processing of some records. I started with a basic configuration as follows.Here is my Executor Service and Callabable.But I am running into serialization issue with below stacktrace.
Implement Semaphore.reducePermits method.No description provided.
Implement PermitExpirableSemaphore.In some cases ability to acquire permit with leaseTime is required. It's not possible to implement it with standard Semaphore object, because it's impossible to determine which permit should be expired. Example:1. client #1 acquires 1 permit with leaseTime = 30 seconds.2. client #2 acquires 1 permit with leaseTime = 15 seconds.3. client #2 or someone else releases 1 permit.How to know which timeout should be deleted in this case for 30 seconds or 15 seconds?To overcome this problem each acquired permit should have own unique id - 128-bits random number (UUID). So new RSemaphoreWithIds object should be introduced. Thus client could release only own acquired permits. If it tries to release wrong id or same id second time exception would be thrown.
Check Jackson 2.8.x compatibility.No description provided.
Need to be able to set expiry on a Live Object.I haven't been able to find a way to EXPIRE the key for a live object. I am working around this by extracting the underlying RMap field with reflection and calling expire on that.Obviously thats not a great solution:)
Sync commands usage in connectionListener leads to connection timeout exception.No description provided.
rlock error report.
Update ProjectReactor dependency to 3.x.No description provided.
MasterConnectionPool exhausted!  Hosts with fully busy connections.I am using a RScheduledExecutorService as a job queue backed by a java ThreadPoolExecutor:Other code schedules jobs on the executor. The problem I have is that after a while if the service is busy it eventually runs out of connections.I added some hackery to get info on the number of free connections and print this periodically:The freeConnectionsCounter + freeConnectionsAmount value started dropping as more and more requests are executed. It doesn't drop one-for-one with requests so at least some of the time connections are being released. Interesting if the server gets less busy for a while before running out of connections then suddenly a bunch get released and things recover.Any idea whats going on here and how I can fix this? Tx.
Log unexpected errors in netty handlers.No description provided.
Channel shouldn't be closed on exceptionCaught.No description provided.
Add `nettyThreads` and `executor` settings.No description provided.
org.redisson.client.RedisException: ERR unknown command 'EVAL'.I have installed redis-2.4.6-setup-64-bit on windows.I am getting the following exception.
Executor service execution.The following call does not return.It neither prints "Executing" nor returns.I am using Redis 2.8.2402 and Resisson 2.3.0.
Kindly Implement CompletionService.As it is done in Infinispan.
Docker support for Redisson Node.No description provided.
Incorrect RedissonRedLock.tryLock behaviour.Lock could acquired by several threads at once when leaseTime parameter less than waitTime parameter passed into RedissonRedLock.tryLock.
Keep RMap insertion ordering during iteration.No description provided.
Allow to use Jackson mixins with ExecutorService.No description provided.
Usage samples.Hello,Is it possible to add some easy and working usage samples?? I'm studying about hibernate / redis / redisson and the documentation available, alone, doesn't make any sense for a newbie on these tools.
why ScoredSortedSet not supports the redis command "ZREVRANGE".i just found it supports command "ZREVRANGEBYSCORE" , why not supports "ZREVRANGE".
Add RBucket.size method.No description provided.
RedissonRedLock & RedissonMultiLock lock method stuck.If more than 3 locks are supplied to RedissonRedLock or RedissonMultiLock instance then lock method could stuck.
ClassCastException error happen when use sentinel server mode.Test code as below:
Implement random wait time in RedissonRedLock & RedissonMultiLock lock method.This issue related to #575.
Remain time calculation for RLock, RSemaphore and RCountDownLatch objects should take in account command time execution.Remain time calculation should take in account command time execution when waitTime param defined during "sync" method invocation of RLock, RSemaphore, RCountDownLatch object.
RGeo should extends RScoredSortedSet.No description provided.
LiveObjectService doesn't work with id without setter.No description provided.
LiveObjectService doesn't create objects mapped to Redisson objects in runtime.Let's consider such object:
LiveObjectService can't detach content of List object.No description provided.
Remove `create` and `getOrCreate` methods of RLiveObjectService.persist method should be used instead of create and getOrCreate methods.
RLexSortedSet.addAll(Collection) doesn't work.If I try to call addAll I get a RedisException:I am using 2.4.0.
Not persisted REntity object allowed to store automatically.No description provided.
Cyclic dependencies during LiveObjectService.detach process lead to stackoverflow.No description provided.
RId generator should be empty by default.No description provided.
Replace fields with Redisson object in proxied object returned by LiveObjectService.It's not possible to encapsulate logic to work with fields in LiveObject proxied object.
LiveObjectService doesn't support protected constructors.No description provided.
RedissonSetCache TTL not updated if element already present.When using RedissonSetCache.add(value, ttl, unit) method, TTL is not updated if the element is already in the set. I think the problem is in the addAsync(value, ttl, unit) method, in the script passed to redis:If I'm getting it right, when the element is not expired the script returns 0 without calling ZADD and updating the TTL. I would expect 'false' return code (according to Set interface), but also TTL to be updated.
LiveObjectService swallow exceptions during merge or persist operation.No description provided.
Cascade LiveObjectService.persist whole object graph.No description provided.
Cascade LiveObjectService.merge whole object graph.No description provided.
Cascade delete object graph for LiveObjectService.No description provided.
Introduce RCascade annotation for LiveObject.No description provided.
Setter for collection field of LiveObject entity should rewrite collection content.No description provided.
Support setter/getter with protected visibility scope for LiveObject.No description provided.
RedissonRedLock trylock success while another thread already hold the lock in specific conditions.it's reproducible, my code is below.redlock lock result will be success, but when I check redis, I found the multi locks belong to different thread.like:I did more test and found:if the single lock is the first of redlock, it's ok.when I move multilock2 to first position ,it will return false correctly.the code below.I am wondering if it is a bug or not?
redis list operation throw exception.
RLocalCacheMap.readAllValues and readAllEntrySet methods return wrong values.No description provided.
RPermitExpirableSemaphore.availablePermits doesn't return actual permits account under certain conditions.No description provided.
java.util.LinkedHashSet support.Hello!Will it be a big effort to support java.util.LinkedHashSet-like behavior in one of redisson data structures?Basically what I need is a collection with element uniqueness and preserved insertion order.Would be happy to contribute as well, but I would need some guidance or example where to start from.
Add COUNT and ASC/DESC support to RGeo.radius methods.No description provided.
MasterConnectionPool exhausted.redis use  Sentinel when switch master slave  where cause it.
Live Object: @RId is returned/overwritten by similarly named methods.Hi!First off, thank you for this awesome library! :)I've noticed a potential bug with Live Objects IDs. It is caused by the calls to isGetter and isSetter in the.These helper methods only compare prefix and suffix of method name. For example, this means that an @RId field named Id is overwritten by a call to  setSomeOtherId.As a workaround, I avoid naming things get...Id and set...Id for now:)
RMapCache doesn't keep entries insertion order during iteration.No description provided.
NullPointerException in CommandDecoder.Hi,under heavy load we experience a NPE in the CommandDecoder sometimes[1]. Do you have a guess about what could be going wrong here?Thanks.Cheers,Philipp.An exceptionCaught() event was fired, and it reached at the tail of the pipeline. It usually means the last handler in the pipeline did not handle the exception.
Runtime dependencies.Is it safe to exclude the byte-buddy dependency, or is it required at runtime?
InputStream and OutputStream support.From Gitter user @cdeszaq:Wanting to keep memory usage within my app as low as possible. We're getting large collection-like responses from a backend system, processing them "item" at a time, and we want to be able to cache that response in a streamy way.Needs to keep memory low are many concurrent requests, large collections of things processed a streamy way, and we're hitting issues with OOM due to having large strings flying around.It's a CSV response from a back-end webservice, so we process it in a streamy way, but it'll easily get to sizes of 100MB for each response, and we often have to have 30+ of these responses being processed at once. We process it 1 row at a time within our code to keep memory low, but hit OOM when we go to/from our current caching layer because it converts to/from massive strings.
redis lock subscribe.when redis unlock publish the message,where is deal with the message and release semaphore?I can't find.
ConnectionWatchdog throws NullPointerException when connection drops (Redisson 2.5.0)When restarting the Redis server all connection threads logged the following exception.The host resolves to the same IP so that isn't a problem and I am able to telnet and issue the replication command without problems (immediate response)..
performance slow, when multiple thread.I use 1000 mutliple thread to test the list operation. the costTime is average 1000~2000ms. But when single thread it costs 1ms.
redisson Sentinel error.
Documentation: RBatch.executeSkipResult only available with Redis >= 3.2.see http. probably most AWS users are still on 2.8 as 3.2 has just made available, so it might make sense to document this on the API.
Configured Timeout in ElasticCacheServerConfig being ignored.Hello,I am using Redisson library version 2.2.4. I have the following settings configured for when I want to create a Redisson Client object for connecting to the datastore.As you can see from the above settings I am setting the timeout explicitly to be 3 seconds. But I am seeing exceptions in the log which says mentions 1 second timeout. Here is the exception,I am wondering how is this is possible? Also I think there is also auto-retry feature in Redisson, which defaults to 3 attempts. Then why would this happen?Can I provide some more info to debug this issue?
RMapCache.fastPutIfAbsentAsync doesn't take in account expiration.No description provided.
2 different NPEs under heavy load.Hey, I experienced two more NPE if I am using Redisson under load. Do you have an idea what might be the problem? Thx Philipp.
Remove `Connection pool exhausted` exception.Connection pool should wait for free connection instead of throwing pool exhausted error. This improves command handling performance.
Check ElastiCache | Redis Cluster support.Amazon has announced new version of ElastiCache with Redis Cluster support. Redisson should be checked for proper work with it.
Don't log byte arrays in CommandDecoder.Hi,we sometimes run into OutOfMemoryException while Redisson is trying to log a warning, since it includes the content in the log message [1]. Would it be possible to check for the instance type and in case of byte[] just log something else? I.e.An exceptionCaught() event was fired, and it reached at the tail of the pipeline. It usually means the last handler in the pipeline did not handle the exception. io.netty.handler.codec.DecoderException:
CommandAsyncService blocks indefinitely.Hi,I have a thread stuck in the CommandAsyncService#get() indefinitely waiting for the CountdownLatch. I don't have a particular repro case but this happens every once in a while on our servers (under load). Redis itself is still delivering events and the instance receives objects on other threads as well.Would it make sense instead of waiting indefinitely on the latch to only wait as long as the timeout is configured (as a safe belt) and abort the action if there hasn't been any success/failure by then?Cheers,Philipp.
Always timeout when get/set objects from/to redis within onMessage handler.In our micro services system, we use RTopic process messages between services. In the onMessage method, I need to get data from redis, or set data. But in the test env, when it got or set data from/to redis, there ware always timeout errors (maybe one error for 2 tests). When I commented the code, no more errors.So, is there any handling time limitation in onMessage method for RTopic? Or any limitation to interact with redis in onMessage method?
redisson scheduled job question.I add schedule job and cron quartz expression,but it' not exectue.
Fix exception message.Fix message at https:
How to use Redisson to upload byte array?Hello,I haven't found an explanation about how to upload pure array of bytes. Redisson has a RBitSet but it manages an array of bits not bytes. How to store a byte array by using Redisson?Here is my configuration:
redisson schedule job dependency.I have two schedule job parent and children,the children depend on parent job.when parent job done,then  the children job execute.but the children can not execute.
Add `RKeys.isExists` method with multiple keys.No description provided.
NullPointerException in CommandDecoder.handleResult.I have experienced some NullPointerExceptions in the CommandDecoder (besides the ones reported in #667.  In the handleResult method is a check if data is null so I guess there are situations where this can be null. In the bottom of the method where the NPE occurs the check is missing though. Should this be checked as well? I am using Redisson 3.0.0.
Redisson JUnit tests due leaks connections/clients/threads.If you run the JUnit tests for Redisson a lot of client and their associated connections/threads are leaking because they are not properly shutdown. This will prevent the build to be successful on system with limited number of user-processes/open-files (i.e. MacOS El Capitain).To verify this, build the project with an attached debugger and watch the constantly growing amount of threads.
Add BlockingFairQueue implementation.In case when queue consumers in different parts of network: some of them closer to redis and some farther."Farther" consumers will get lower amount of messages from queue due to network delays. In turn "closer" consumers will get higher amount and this could lead to client overloading.Blocking queue with fair polling and guarantees access order for poll and take methods and allows to get uniformly distributed consumption by clients.
Add Redisson.shutdownAsync method.No description provided.
Add RMapCache.fastPutIfAbsent with ttl.No description provided.
Wrong parsing nodes in result of cluster info command.Address like 192.168.234.129:7001@17001 should be converted to 192.168.234.129:7001.
Add RSortedSet.readAll method.No description provided.
In SpringCacheManager, Can the cache name use wildcard . for example '*'.In the below code snippet , can the cache name use wildcard . for example '*'.when i write '*' in the code, but donot effective.
Add SORT command support.No description provided.
Add TOUCH command support.No description provided.
Add `putAll` method to all the distributed cache objects.No description provided.
Add DelayedQueue object.Could be attached to destination queue only. All elements are inserted with transfer delay to destination queue.
Add RQueue.readAll method.No description provided.
Test redisson error.
Error retrieving a hash map that was created/written from PHP app.We started using redis hash for our logged in user session data, and I am having trouble getting a simple map of string key/vals.  I made a little test, where I create the same hash map in java/redisson and in PHP, and I am getting errors when I try to read the map that was created in our PHP application.This is what they look like via rediscli:When I try to retrieve a redis hash with redisson that originated in our PHP application (via Predis), I get that exception and I am unable to read that hash map from PHP key: "web:test_string_map".Is there a way to handle cases like these?
RMap.getAll doesn't not preserve the order of elements.No description provided.
Add timeout param to RBatch.No description provided.
Refactor EvictionScheduler.Introduce task objects instead of methods.
Expires for RMapCache/RSetCache entries and restarting java.Not really an issue per say, more of a clarification really.  I'm about to launch a new feature that will be making use of the expires for individual entries in RMapCache and RSetCache, and I was wondering how that works regarding restarting the Java process that created/set it.  Will they be expired on shutdown, not touched at all and the expire is lost?Just want to be sure of what is expected when I restart my Java service.Thanks!
Blocking queue/deque poll method blocks infinitely.Poll method blocks infinitely if timeout specified during invocation less than 1 second.
Executor Service cannot execute Task.When I try RExecutorService ,found the task not execute.my example:normal the console whill output : 000000000.but the console output nothing;when i try this:the console output:00000000.redission version:2.6.0.jdk:1.6.
RedissonBaseIterator.hasNext() doesn't return false on Object based RedissonSet.I encountered an issue on using RedissonBaseIterator.Inside of RedissonBaseIterator.hasNext(), it checked the end of iteration by lastValues.removeAll(firstValues) when scanned result is larger than default scan count 10.It failed to return true on lastValues.removeAll(firstValues) when values are in custom object type since ArrayList.removeAll() uses Object.equals(). An object not implementing equals causing infinite loop while processing the iterator.I'd rather check nextIterPos == 0 && nextIter != null && !nextIter.hasNext() at the start of hasNext() method.
Implement RLocalCacheMapCache.No description provided.
Add number argument to RSet.removeRandom method.SPOP accepts an optional count argument since 3.2.0 version. It should be supported by RSet object.
Reduce default connection pool size to 70.Default connection pool could be reduced to 70 because #680 issue has been fixed.
Config can not handle underscore in host.Redisson 3.1.0.
Exceptions during shutdown.Sometimes there are few exceptions occur during Redisson shutdown process.
Possible PublishSubscribe race-condition.There is a rare possibility of race-condition during channel re-connection and RTopic subscription invoked first time.
Add timeout for subscribe operation.No description provided.
IndexOutOfBoundsException when reading from RMapCache.I am using Redisson 3.2.0 and currently facing a problem reading for a cached collection. The following error is thrown.
Inconsistent Behavior in RListMultimap.I'm seeing a scenario in which RListMultimap.keySet() will return an empty set in spite of the fact that I have confirmed that data exists in the map.  The same goes for keySet().size() as well as simply calling size() on the map.I captured the behavior .  Note that the in the expression editor the sizes are even though I had just immediately inserted the value into the map.  I also have confirmed that my local Redis instance actually contains the keys mentioned.I tried to write a test case to demonstrate the issue, but it seems to work fine when running my test case.  However, I'm a bit perplexed to see it happening in my production code.Could this be related to serialization or string encoding?  I dug pretty deep into Redisson's source code, but I had a hard time pinning down where in the client it actually issues the KEYS command to determine the keyset of the map.I'd be happy to continue writing a test case, and a fix if necessary but I'm having difficulty reproducing the issue.  Any thoughts?
Improvements to ClusterConnectionManager.Currently we are running Redisson on hundreds of application servers to communicate with a redis cluster acting as cache. During a restart of the app servers there is a stampeding of the herd that can result in slower responses from the cluster. For our application we want to ensure that the cluster is available so we have a long connectTimeout. However we don't want to wait very long on key lookups (since we can bypass the cache if needed) so we have a short commandTimeout. In other words, we can tolerate occasional slow lookups, but we abort startup of our application if the redis cluster is not available.As part of ClusterConnectionManager instantiation, ClusterNodeInfo is retrieved synchronously via RedisCommands.CLUSTER_NODES. It would be nice if this command respected the connectTimeout value rather than commandTimeout.Example stacktrace of timeout leading to initialization failure:
Add sync listeners support for JCache.No description provided.
RTopic Superclass Listener.It would be quite useful to be able to add a MessageListener of any generic type, or at least supertypes. This would be extremely useful for topics that might contain multiple types of packets, especially when subscribing to a pattern. Thanks for considering it:)
Javadoc for org.redisson.api.RMapCache#putIfAbsent states that it replaces existing value.Same for overloaded variant. The last paragraph seems incorrect.
How to get redis information from RedissonClient.Now  I want to get the redis information  that  from exceute info  command.The message content  is.
URL.setURLStreamHandlerFactory(new URLStreamHandlerFactory()) causes throw new Error("factory already defined");when called setAddress("127.0.0.1:6379"), it would invoke URLBuilder.init method and then URL.setURLStreamHandlerFactory(new URLStreamHandlerFactory()) which causes throw new Error("factory already defined");Because the tomcat server already registered a URLStreamHandlerFactory, and jvm did not allow a second registration for the URLStreamHandlerFactory.
connection timeout problem.Hi,In my operating environment, there is firewall settings that interrupt network connections that are not operating within a certain period of time.For some reason, I can't modify firewall settings.Now when using redisson, the console will throw an exception if it does not operate at some time.Exception information as follows:How should I deal with these problems?
NoClassDefFoundError while trying to use FstCodec.Is there an extra configuration setting that needs to be set for setting a different codec via the Config object?  I'm getting this error when setting up the client:Setting up the RedissonClient (sentinel) like so:Redisson 3.2.2.The json configuration is basically copy/paste from the documentation, and it works just fine if I comment out that config.setCodec(new FstCodec()); line.Is there an additional maven dependency that needs to be included or something like that?
can not config with file in spring-boot.I want to configure redisson in a spring boot project, but encounter such exception:I searched java manual and found that's because setURLStreamHandlerFactory can only be called once in a given jvm. In my case, this method has been called by org.apache.catalina.webresources.TomcatURLStreamHandlerFactory() , so when I configure RedissonClient using following code, the exception came out:Is there a way to avoid such exception?
DistributedLock - Lock is getting acquired by multiple threads.We are using distributed lock to ensure that only one thread can take a particular action, among a group of threads spread across multiple EC2 instances.Here is a snippet that represents what we are doing.The issue is that we are seeing multiple threads from being able to acquire and do the job.What might be the issue? Do you see an error in the way we are using distributed locks...is there a better way to solve this problem?Our goal is to ensure that for every job run...only one thread gets to do the job.
Divide by zero error in RedissonBloomFilter contains() when bloom filter is empty.If a user of Redisson sets up a RBloomFilter (the bloom filter has been successfully initialized) but does not populate it with any values, a call to the contains() method will throw a Divide By Zero exception.  The exception occurs within the hash() method when an attempt is made to use the mod operation with a size of zero.(hash & Long.MAX_VALUE)%size;A value of false should be returned instead.  It is reasonable that a bloom filter would be created but might be populated after application startup with values encountered by the running application.Using Redisson 3.2.2.
3.2.2 regression "Can't decode replay T".3.2.1 doesn't have this issue, seems a regression:
3.2.1 regression "Could not initialize class org.redisson.misc.URLBuilder" @ Tomcat1.3.2.0 doesn't have this issue, seems a regression:URLBuilder.init() seems registering a protocol handler which could cause SecurityException. Just trying to help brainstorm: any chance to catch & log/warn & move on? Above Error prevents Redisson from being loaded/used, not just that particular protocol handling...
Right usage of persist since getOrCreate is deprecated.Hi There,What's the right usage of persist method since getOrCreate was deprecated on #639 ?Thanks,Tiago.
Wiki sidebar is a bit difficult to use.The wiki is a great resource, but currently the sidebar is rather difficult to use. There are two things I think might be improved.First, the wiki sidebar is sorted lexically, so the items appear in the order 1, 10, 11, 12 ... 2, 20, 21 ... I don't think github has an option to change how the pages are sorted so it's probably easy to just prefix each single digit page number with a 0, so 01, 02, ... 09, 10, 11 ... The table of contents could also be 00 to make it appear as the first item in the sidebar.Second, every page is also in Chinese. I think it's awesome that the documentation has multi language support, but github doesn't have good support for wikis in multiple languages. Since both English and Chinese pages are side-by-side in the sidebar, only 7 pages are easily accessible without expanding the sidebar all the way. This obviously doesn't scale well as docs are added for more languages. Perhaps we could prefix the page number with an identifying code for the language so that the lexical sorting groups them together?Thoughts? @jackygurui.
org.redisson.client.RedisTimeoutException.
tomcat-8.0.39 session.
NoSuchFieldError.I use tomcat-8.0.23 and java7.I find NoSuchFieldError.
Add getLock(key) method to RMap, RMultimap interfaces.No description provided.
Benchmark.I need to compare what is the performance of RCache vs RMap or redisson vs other libraries. Could you provide benchmarks?This is more of a suggestion than an issue per se.
Reusing submited tasks.Hello,I'm trying to use redisson for distributed task scheduling, but i have some problems with that.For each app restarting executorService.scheduleAtFixedRate pushing new task to Redis, but  i want to reuse it, is there any way to solve it?
How to config jackson Serialize and Deserialize method for LocalDate?If use the default data serialization——org.redisson.codec.JsonJacksonCodec; deserializer can't successful.
Pub/Sub removeListener/unsubscribe by the topic.Hello,I would like to have an option to remove all listeners for a given topic which then unsubscribes the given topic from redis.PS: probably a hint for removeListener which listenerId to use would be great or a possibility to remove by listener instance.Thank in advance.
Redisson get api  is very slow !!!!I am using Redisson client with Redis and implemented Redisson as JSR 107 .I am simply calling a cache through jsp but it is taking a lot of time in CountDownLatch.await().This wait is common for every single request , so what is the possible reason for this wait ?????Is there any client side or server side setting effecting it....Please find Jprofiler snapshot showing Api call trace.
RMap get value fail.My  test code:This is my test data:And this is error:And jedis work is ok.My  redisson version is 3.2.3.And how can I get test2 value by redisson?
Documentation on locks.I was wondering if the documentation could be clarified on what happens to each of the lock types should one redisson node request a lock, then die before releasing it while another node is waiting on it.i.e.If the documentation could also note suggested ways to prevent deadlocking in such cases (should deadlocking occur) that would be good too. It's not clear if the distributed locking takes into account the loss of a node while holding a lock.
Wiki RLiveObjectService documentation isn't up to date.The documentation shows still the old way of using the RLiveObjectService.But it's deprecated (issue #639) and not usable anymore.
Unlock does not really unlock.If you unlock a FairLock from some thread, there is a delay until all threads actually see that lock as available.Example test clase.
RReadWriteLock is not reentrant.I was expecting the RReadWriteLock to be reentrant, as the wiki page describes it as (emphasis mine):Redisson distributed reentrant ReadWriteLock object for Java.However, in my simple test:The "reentrancy" clause of the ReentrantReadWriteLock Javadoc states:Additionally, a writer can acquire the read lock, but not vice-versa.My use of redisson relies on these locks being reentrant (at least within the same Thread), however this does not seem to be the case - is this a bug, or a configuration issue on my end?
Allow to specify Redisson instance/config during JCache cache creation.No description provided.
Remote service registry process to consider usage of method overload scenario.No description provided.
NullPointerException on some weird Redis cluster status.Hi,I use redisson 3.2.3 on my project. I try to do some Resilience test and sometimes i had this exception :As you can see, node 299302f881862c83c4f4046df9da28a068b76b40 is slave of f19eb78f3165b800f8b2189f307c1ba1d3563476 which is a another slave (Maybe a redis bug ?)So ClusterConnectionManager.parsePartitions generate for that slave a line like that.I'm not sur how, but it seem after that there is no other scheduleClusterChangeCheck and  this is a big probleme.I hope this is clear. (Sorry about my english, i'm a french guy).I'm going to to do a PR for this particular problem, but i want help to understand why this NullPoint completly kill the scheduleClusterChangeCheck thread.
Problem with Rlock - unlock not releasing lock to waiting threads.I am seeing an intermittent issue with Rlocks. I am implementing what is basically a distributed cyclic barrier using Redisson.I am running multiple instances of a service on different virtual machines. Each instance receives multiple HTTP REST api requests, handled by multiple threads. As each request is received it waits at a redisson count down latch until the threshold for # of requests has been reached.At this point, I need one thread to calculate the results and store it in redis so it can be available to all the other threads across all instances. So each thread tries to acquire an Rlock (with TTL of 5 seconds). One thread gets the lock, does the calculation, and stores the result back to redis. It then releases the Rlock.Now all the other threads that are waiting on the Rlock can (one at a time) acquire the lock, see that the data is already in redis, and simply release the lock and send the result back via HTTP, without repeating the calculation.We are using a master/slave redis cluster with 1 master and 2 or more slaves. As well as using redisson for the countdown latch and rlock, we use jedis for standard redis reads and writes, but never using the same keys as we use for the latch and locks.This is all working about 99% of the time. However periodically, I can see that after the Rlock is released, none of the threads that are waiting for it are able to acquire the lock. I was originally using lock(), and finding that HTTP threads were hanging forever. I switched to using trylock, and this returns, but it returns false, indicating a timeout waiting for the lock.I have added logging to be 100% sure that unlock is being called on the lock in the failure case. Any suggestions on how I can debug this issue, or any known problems with our configuration that might be causing it?We are running Redisson 3.2.3 and redis 3.2.5.Thanks for the help,Sue.
RLocalCachedMap is not Redis cluster compatible.No description provided.
Redisson may log RedissonShutdownException on shutdown when configured with ReplicatedConnectionManager.
compatible with Netty5.0.x?when to?
Add RPriorityQueue object.No description provided.
Lz4 or Snappy?Which one gives better compression result when used with redisson in our application ?Description :1- I have tested both compression algorithms by importing their .jar files.2- I have written one java program which creates a hashmap for 15000 entries.3- I have compressed this hashmap with both algorithm and in that following is the result .Snappy Output for hashMap with 15000 entries Object.Which one would be a better option for us in a longer run in terms of performance and code compatibility?
FST compatibility.Which version of FST jar  is compatible with jdk 1.6  with structure org/nustaq/serialization/FSTConfiguration ?
Tomcat Session Manager with Multiple Tomcat Instances.Hi,I am trying to have tomcat session to be stored in centralized location using redisson in order to have load balancing on tomcat instances.I have two tomcat machines behind Load Balancer. Redis stored on one of the machines. Following are the contents of redisson.conf.address is same for both the tomcat machines.I am assuming that the session for both the tomcat machines are stored in the same location and accessed from the same location. But that is not happening. Please let me know if I am missing anything here.Regards,Rajesh.
Redisson Sentinel and pub/sub.Is there a simple way I'm missing to get the current master from redisson setup using sentinel?  I'd like to subscribe to channels/topics but only on the current master as reported via sentinel.  When I subscribe to a topic, it chooses a server randomly, but I'd like to keep it to the master so I can get the number of subscribers and number of received publishes (external app doing the publishing to communicate with Java app via redis pub/sub), which doesn't work when you publish to master and subscribe on a slave (although the message is received, just no stats).I figure either one of two solutions would work.  Query sentinel for the current master and then setup singleServer client to that master or would setting the SentinelServersConfig to read from master work to limit the redissonClient to master only? i.e.What would be the ideal way to setup the redisson client to subscribe to channels/topics so the publisher (ext app) can see those nubmers for subscribers and msg received etc ?As always, thanks for any help you provide.
Unix Domain Socket (UDS) Support.No description provided.
Redisson connects to slaves of other masters.When sentinel announces a new slave:+slave slave 1.1.1.1:6379 1.1.1.1 6379 @ redis-master-A 2.2.2.2 6379.redisson adds this slave to its configuration but it does not check if it's a slave of the master used by redisson. As a result redisson attempts to connect to another cluster.The issue is in SentinelConnectionManager.onSlaveAdded.
Indefinite lock lost during master failover.I've found my indefinitely held locks will sometimes disappear after a master/slave failover.  The block here will not reschedule a renewal if the attempt of the update fails.The update can fail during a failover, in which case the lock is gone for good.The exception that gets thrown when the update fails:
StackOverflowException in URLBuilder.URIBuilder is not thread-safe. Following scenario causes infinite recursion and StackOverflowException when someone tries to create new URL:URLBuilder.replaceURLFactory() - URLBuilder.currentFactory set to null, URL.factory set to custom.URLBuilder.replaceURLFactory() - URLBuilder.currentFactory set to custom, URL.factory set to custom again.new URL fails on StackOverflowException. Following code is an infinite loop because currentFactory points to "this":Affected version: 3.3.0.
When try to define some variable throught redisson, it will read all value ofthe key!when using the codes such as nether( found it when debug):
Intermittent issue with MapCache.
RedisNodeNotFoundException : Never catch, so never release the countdownlatch.Hello,I have a cluster 3 master and 3 slaves, freshly created.You can see the conf in config dir and the creation script is init_and_launch_cluster.sh.I launch a Java junit test which use Redisson.The test initialise redisson (with a scan interval set to 100 ms in order to produce the bug quicker),and insert key into the redis cluster in 15 thread.I launch the kill-random-redis-master_local.sh script. This script kill a random master, wait 15s (nodetimeout is 10s),relaunch the killed master, wait 10s, and start over.In generally 10 minutes, I have this exception :I can't understand why there is this exception, but it is not catch anywhere.So the thread which handle this command is stuck in await of the countdownlatch (CountDownLatch:148)After 15 RedisNodeNotFoundException, all my insert thread are stuck, i can't insert any more.I made a little project on github, to help people reproduce this:Thanks for you're help.Ps :  In pj you found the log of the last reproction i made (redis 3.2.6 and redission 3.3.0)logs.tar.gz.
Tomcat Manger App still showing session count.Hi,I am have implemented redisson tomcat session manager. I am able to see sessions created on redis-server. But when I verify tomcat manager app - I am seeing number of sessions there as well. As session being stored in redis - i believe tomcat manager app should show 0 number of session. Please let me know if this fine.Regards,Rajesh.
Redisson Client Memory Issues.Hello,I've been stress-testing Redis using Redisson as the client in single server mode and am experiencing steady memory consumption as I increase the client transaction rate, to the point of memory exhaustion.  Indeed, it appears Redisson connections are using gigabytes of memory.  I'm performing simple batch gets (see code snippet below).I'm initializing and sharing the Redisson client via a simple singleton:My Redis instance has about 54 million keys and uses about 20GB of memory.Any advice you could provide would be much appreciated.Thanks!HarryTheHawk.
Class org.redisson.codec.SerializationCodec not subtype of [simple type, class org.redisson.client.codec.Codec].Hello,I am getting the following error when I am restarting the tomcat server.  can you please let me know what is the issue here?
Using redisson as JCache implementation AND for session replication.We want to use redisson for JCache and for Tomcat session replication.However, if we place the two jars inside the /lib folder (as explained by the documentation), the serialization of cached objects fails (ClassNotFoundException). And if we place them in the application, the application will not start because the application context initialization cannot find the RedissonSessionManager.How can we configure redisson for both use cases?
command=(INFO REPLICATION) response has been skipped due to timeout.redisson-2.7.4.Every now and then logs are flooded with (org.redisson.client.handler.CommandDecoder) response has been skipped due to timeout, something funky going on wrt the INFO REPLICATION command..?
Can anyone provide me small Java code to implement redis pipelining ? I am using " redisson-3.2.2.jar" as Redis client.No description provided.
IllegalStateException when accessing an invalidated session.Just using TomEE (Tomcat), when I invalidate a session using session.invalidate();, the next request the browser sends still has the old JSESSIONID. Tomcat doesn't seem to care about that, creates a new session and changes the cookie.With redisson however, I get the exception posted below.It seems that the ManagerBase does not return a session with the given ID, which is correct since the session was invalidated earlier, but then a new RedissionSession is created with that same ID which in turn leads to the exception.After that, a new session seems to be created elsewhere, as the response contains a new JSESSIONID.
Call Config.fromJson(File file) method, throws StackOverflowError.When call Config.fromJson(File file) method, throws StackOverflowError, because loop call itself.The following java test code:
Use PSETEX for time to live with precision of less than second.Right now only usage of SETEX is mapped.Therefore even though the API allows setting ttl using value(long) and TimeUnit.Using values like 1500ms gets translated into 1s, since it's using SETEX command which only takes seconds.And using values like 700ms gets translated to 0s, which makes the command fail by being an invalid SETEX parameter ("ERR invalid expire time in setex").Unless there is performance/memory implication i am not aware, using PSETEX for higher precision should cover that.
DelayedQueue.remve(),DelayedQueue.remveAll() can't work,the element has not been deleted.I deleted the element, but still can consume the element.
More modular/optional dependency management.We are using Redisson in an OSGi environment and have a lot of trouble with updating to new versions due to additional dependencies being introduced for optional features.In OSGi we have to make sure that appropriate bundles are available for each mvn-dependecy (whether they are only compile time or runtime) b/c the mvn-bundle-plugin will generate "Import-Packages" for these. As said that had been kind of a burden in the past b/c not all dependencies are available as OSGi-bundles.By optional features I am mostly talking about different compression-, serialization-algorithms, javax.cache-api, Spring-Cache, etc.I have somewhat two ideas around this:(simplistic, short term): mark dependencies for "optional" features as an optional mvn-dependeny. By that the mvn-bundle-plugin will also mark the "Import-Packages" as optional.(sophisticated, long term): split up the redisson library into a core-library which contains only the core functionality. Create separate projects for each compression and serialization. Which only contain the implementation of the CODEC, etc. The same for Spring- and javax.cache: they should really be two different libraries which build upon the core library. Every user can then decide which libraries need to be added to the project.
redisson-tomcat-8-3.3.1.jar not compatible with Tomcat 8.5.2.Using redisson-tomcat-8-3.3.1.jar inside a TomEE 7.0.0, which in turn is based on Tomcat 8.5.2, leads to the exception below. It looks like the API has changed from Tomcat 8.0 to 8.5 by at least leaving out org.apache.catalina.util.LifecycleSupport as can be seen in Tomcats repository.
factory already defined error when starts tomcat with two WAR apps.Hi,I have met an issue seems have been fixed :(.software stack info is as follows:Configuration  in context.xml of tomcat.Process  to reproduce this issue.Please note that, if I place only one war in the webapps directory, this issue won't occur ...error  message when this issue occurs.
org.redisson.codec.AvroJacksonCodec is not covered by tests.I've noticed that the org.redisson.codec.AvroJacksonCodec is not covered by tests like the others Codecs.The test class: org.redisson.RedissonCodecTest instantiate all codecs with objective of test each of them.At org.redisson.RedissonCodecTest class def, you can see this declarations:Look for the two first lines, avroCodec is being instantiated using the same class as smileCodec,and there is two Test cases:But avroCodec is a SmileCodec object.And to confirm, you can search for usages of org.redisson.codec.AvroJacksonCodec, and you'll not find any.
Is there any way to provide/plugin connection manager.Hi,Currently i am trying to plugin a Connection manager and config which can auto-discover nodes in AWS ElastiCache calling an AWS api, Current ReplicatedServersConfig is limited, where in it cannot add/remove newly added/removed slaves automatically and it needs me to configure individual node addresses instead of configuration endpoint.But i see that ConfigSupport.createConnectionManager is static method. is there any way to plugin new connection manager?
add attribute distribution lock to "LiveObject".
auto config between 'dev' and 'prod' environment.This is my application-dev.yml file.How can i config this in Application.java in Spring-boot?
xml schema not working.So I am setting up redisson with spring per the doc. However the schema doesn't seem to be working. I'm getting 301 and is redirected to the homepage of redisson. Am I missing something?Please check following links:Thanks!
what cause the wrong?I have a issue,blew the exception it's what mean?
session data stored successfully but cannot  be reused after restart: Session xxx has already been invalidate.I have configured redisson in my tomcat and ran an web application successfuly,after an ajax request,the session data  has been stored in redis successfully,but when I restarted tomcat and called the ajax request again,an error occured and the request responsed with error code 500, then I called the ajax request again, a new session has bean created.the stacktrace:
Stack Overflow using Config.fromJSON()Tried to update my project to redisson 3.3.1 (from 3.3.0) and I'm using redis sentinel configured via json file, and it is giving me a stack overflow (same config that works fine in 3.3.0).  Were there any changes in 3.3.1 that could break sentinel config via json?Error is:
NPE during RLocalCachedMap.fastRemove invocation.No description provided.
add metho RScoredSortedSet.firstScore()Something like.
Cache @Cacheable with sync=true never expires.I am using redisson for Spring Cache.If I set sync=true for @Cacheable then this cache never expires (cache ttl is ignored).Probably the reason of this issue is in code of function.Also no ZSET "redisson__idle__set__{...}" is created in Redis in this case.
[documentation] Config from YAML.Could I clarify if the example YAML at for cluster configuration is sufficient, I am getting "server(s) address(es) not defined!" (IllegalStateException in ConfigSupport). I already have a working cluster, YAML config documentation seems incomplete to me. (Also a cluster restart seems necessary after this config has failed).Please note that I have just spent two hours on this problem, I am asking a question about documentation, not asking for support, I've tried just about everything I can think of, including Config.useClusterServers() which seems to reset the config somehow.
Redisson Compiled jar lost package.I am using redisson for Spring Session.In the source code,I can find the package "org.redisson.spring.support".but in compiled jar from maven,The package "org.redisson.spring.support" is missing.
Wrong encoder usage for value in `RedissonLocalCachedMap::fastPutAsync`.RedissonLocalCachedMap should use encodeMapValue instead of encodeMapKey at here.
`RedissonSpringCacheManager` creates new cache on  each `getCache` call.Currently RedissonSpringCacheManager creates new cache on each getCache call. But it should reuse existing caches if there are. Otherwise, Spring cache interceptor retrieves new cache at each time.This behaviour can be implemented by just extending from  org.springframework.cache.support.AbstractCacheManager and overriding getMissingCache method as implemented in current getCache method.
org.redisson.client.RedisTimeoutException: Redis server response timeout.We are seeing an increase in the number of timeouts lately when we try to use SET or SETX commands lately with Elasticache. Here are some details about our setup.We use a 4 node cache.m3.xlarge Elasticache Redis cluster.Our Redisson initialization code:Exception thrown:We are using Redisson client version: 2.2.27.Is 5 second timeout too low for EC2? We are operating within a VPC. All EC2 instances and cache is running within the same VPC.Any help/guidance will be very helpful...please do let me know if i can provide any additional info.
Can Scheduled executor run non-serializable tasks?I have a non-serializable task to schedule. The executor is failing to submit this task with a NotSerializableException. The task is available to the worker node in its classpath. Is there a way I can execute these kind of tasks on the worker node.
How can I get ttl by key directly?Is there a way to get ttl like jedis.ttl(key) in redisson?
[StackOverFlowError].I use.Java 1.7.0_75.tomcat-8.0.23.redisson-tomcat-8-2.8.1.jar.redisson-all-2.8.1.jar.And.StackOverflowError.
why redisson start up  error   Caused by :NoSuchMethodError.
Add NodesGroup.time method.No description provided.
putIfAbsent followed by addAndGet causes bad argument #2 to 'unpack' (data string too short)Hello , have peculiar situation where below works only first time around (reason for first API call is to establish "expire" on key as addAndGet does not allow one to specify expire)so below works fine during first run, subsequent runs Redisson throws an exception (below at the end of this post)thanks for any input on this.
URIBuilder seems not to be thread safe.We test this in case of a multi cluster setup and sometimes went the java.net.URL.factory to null instead of the original factory.Best,ebersb.
Encountered unregistered class ID: 32.please tell me why kryo with DefaultClassResolver.readClass to error.i see #166 kryocodec kryo.setReferences(false); was change.
Can RedissonFairLock work if my application was deployed on more than one server.For example, i deploy my application on 3 servers.now,the first request as req1 processed by server1.the secoind request as req2 processed by server2.the third request as req3 processed by server3.will RedissonFairLock works to make sure three requests be synchronized and the process order is.req1,req2,req3?
Configuration in cloud.Hi Team,We are planning to use redisson in pivotal cloud foundry. Can you please help me to configure that.if you guys can provide some example it will be nice.We are using redis as a service.
schema error in Integration with Spring  by namespack.
Bean property 'address' is not writable or has an invalid setter method.Hi,I have configured a plain single server install of Redis. When I configure the Redisson client within my spring XML config with a simple single-server configuration. Spring gives the following error:Bean property 'address' is not writable or has an invalid setter method.I had a look at the file SingleServerConfig.java file and I noticed that it has both a public SingleServerConfig setAddress(String address) method as well as a void setAddress(URL address) method. I am not sure if this is what is causing the configuration error. I have created a gist with my XML config.Spring Version: 3.1.3.RELEASE.Java Version: 1.7.Redisson Version: 2.8.2.
GitHub · Where software is built.[].
No field factory in class Ljava/net/URL.Configure as above, but raise java.lang.IllegalStateException: java.lang.NoSuchFieldException: No field factory in class Ljava/net/URL; (declaration of 'java.net.URL' appears in /system/framework/core-libart.jar) Exception.
SSL connection (Azure Redis Cache)Hello!I would like connect to Azure Redis Cache service with redisson, but I didn't find how to connect over ssl. I searched here in the redisson wiki, looked up more forums, but I didn't find anything. Can you show me a descriptoin or code sample!Thank you!Tamas.
redisson with spring.hey,gays.i want use redisson with spring.
 RMap with byte[] key?Is it wrong way  to use RMap?
redisson is so slow!redisson is so slow!code bellow will output :
change <xsd:attribute name="database" type="xsd:int"> to type="xsd:string".org/redisson/spring/support/redisson-1.0.xsd.It will be wrong like this:Is it?
Suspicious subtle bug in [RedissonCacheMap.putIfAbsentAsync].I think there is some bug in [RedissonCacheMap.putIfAbsentAsync].And I made this test code.This test should be passed, but failed.As you can see, there is no code for checking ttl or idle time in [putIfAbsentAsync] method,not like [getAsync] or [fastPutIfAbsent] I have added.If it's alright, I'm ready to PR to fix it.Please verify whethrer my found is right.
JSR107 cache implementation should throw javax.cache.CacheException.The redisson JSR107 org.redisson.jcache.JCache implementation throws exception like org.redisson.client.RedisException. According to the JSR107 specification this exception should be wrapped into javax.cache.CacheException . This way when interchanging cache implementation one can expect same error handling.
Spring boot with redisson 3.3.2, 2.8.2 fails without optional actuator dependency.Actuator is an optional feature in Spring Boot, there are a lot of projects that do not use actuator due to additional dependencies and complexity.Redisson 3.3.1 worked fine without actuator but 3.3.2 fails to start with ClassNotFoundException for org.springframework.boot.actuate.cache.CacheStatisticsProvider.Suggested change registers Redisson AutoConfiguration only if actuator is in the classpath.Pull request #851.That pull request is only for 3.0.0 but change changes apply for the master branch.
RedissonCache should put NullValue object instead of null.No description provided.
Support STORE for GEORADIUS and GEORADIUSBYMEMBER.With GEORADIUS | GEORADIUSBYMEMBER ... STORE key, Redis stores the result to the specified key, and returns the result size.I see two ways to implement this into the Redisson API:Add new radiusStore...() methods to RGeo and RGeoAsync, with a fromKey parameter. Search the Geo specified by fromKey, and store the result in this RGeo. This mirrors the API for intersecting and unioning sorted sets.GEORADIUS fromKey ... STORE getName()Add new radiusStore...() methods to RGeo and RGeoAsync, with a storeKey parameter. Search this Geo, and store the results in the Geo specified by storeKey. This is more straightforward to implement.GEORADIUS getName() ... STORE storeKey.Which is preferred? Are there alternate suggestions? I vote for # 1.
about version 2.8.2 compatibly to jdk 1.6.Do Redisson  version 2.8.2 compatibly to jdk 1.6???
Redisson 2.8.1,application can not start.
Jackson annotation @JsonDeserialize does not worked.Hi, I used redisson to keep my tomcat session, and deserializing session error when the tomcat was restart.The error info is 'the class missing default constructor or creator, or perhaps need to add/enable type information'.So I add jackson annotation JsonDeserialize to my class, but it does not worked.Can you help me solve this problem?I have try deserializing the class with Jackson, and it can working.The code:
NoClassDefFoundError after upgrading from 3.3.1 to 3.3.2.I'm using redisson JSR107 implementation and after upgrading from version 3.3.1 to 3.3.2 I start to get following exception immediately:
java.lang.IllegalStateException: Can't decode replay.I have this message quite often in my logs. There is a StackOverflowException happening right before that (though I am not sure whether these two correlate). Do you have an idea what is happening? Is the message too long to be processed? (Just for the context we have a pub/sub on expired keys.)
DnsMontioring not available in Master Slave Mode.One of our use case requires that if there is a failover, we reconnect automatically to another node. This is available in single server config as DnsMonitoring but not in Master Slave mode. Is there a specific reason for this? Can there be a support added? @mrniko.
Lcom/fasterxml/jackson/dataformat/avro/PackageVersion.
org.redisson.client.RedisOutOfMemoryException: command not allowed when used memory > 'maxmemory'.hello friend.For blow code with stress test redisson client, but test_redisson_set method add loop items, have Exception message.
redisson cluster startup very slow (1.5 sec) in AWS Lambda with AWS Elasticache Redis.Hello,I'm trying to use redisson for my project that will run on AWS lambda and will use AWS Elasticache Redis Cluster. I have the following snippet:I had the threads and nettyThreads as 0 and that was even worse. I now set it up to 4... and the startup is about 1440 ms.Can someone please advise the right cluster configuration for Redisson in AWS Lambda?Rgds.Dheepak.
RMap.addAndGet(key,number)  threw 'org.redisson.client.RedisException' exception.My RedissonClient codec is.use this codec. Get RMap via RedissonClient, and then call RMAP's addAndGet method. Can be successful, but I then throw out the RMap when the exception thrown: Throws an exception: Unable to evaluate the expression Method threw 'org.redisson.client.RedisException' exception.p.s:If the codec from KryoCodec into StringCodec or default codec(Jackson JSON) will not be an error.
Dropwizard support.Add metric for each command execution.Add metrics for succeed and failed commands.Add metrics for connections utilization.
Issues with AvroCodec.Running redisson 2.9.1, jasckon dataformat 2.7.2.I'm attempting to use AvroJacksonCodec with redisson client. This stack trace occurs when attempting to serialize and deserialize avro data from redis.This is how the codec is being created (note, the environment is scala).It works when I use JsonJacksonCodec, but not with AvroJacksonCodec. Am I doing something incorrectly which would be causing this issue?
why excuted RAtomicLong.addAndGet(long delta), but Bucket.get() return Integer result?hello mrniko:But (bucket.get()) return Integer result? why?
To search more than one live object by id or by attributes.With present radisson is it possible to search more than one item by id or  other properties ?for example :if not this way. are there any other ways to do this ?Question 2:Is it possible to search objects by property name?for eg: searching customer by product id.
RBlockingQueue.pollLastAndOfferFirstTo does not block properly.This  bug could be a duplicate of #349 but this is not the same method.The following code:Does not block until a message is available.In the documentation, it is said that BRPOPLPUSH can be replaced by a call to RBlockingQueue.pollLastAndOfferFirstTo().So this call should bock until a message is available.As a workaround, I can use RBlockingQueue.pollLastAndOfferFirstToAsync() or pollLastAndOfferFirstTo(String queueName, long timeout, TimeUnit unit) throws InterruptedException.By the way,  Reddis is a fantastic framework and I love it.
what about lazy connecte to redis?what about delay to  connect to redis, by the first function call ?rather than connect to redis immediately  when  application startup .
How to listen for changes to an RMap (migrating from Hazelcast)?I'm investigating moving from Hazelcast to Redisson and one question popped up that I can't seem to work out the answer for. Perhaps I'm trying to incorrectly compare functionality between the two?Anyway, in our code that uses Hazelcast, we create a distributed IMap and add listeners so that each process (Hazelcast client) can listen for changes to that map. I can't seem to work out how to get the same functionality using the RMap. Is this possible or is this functionality only available using the LiveObject? Or do I have to mimic this functionality using a topic perhaps?Thanks.
remove dependency of jackson selectively.I configure Redisson by spring xml, and I use gson as codec, I want to remove jackson dependencies from maven, but report "No class com/fastxml/...... found" error.
Add RBlockingQueue.takeLastAndOfferFirstTo method.No description provided.
Add method to RedissonSpringCacheManager for setting an option to cache null values or not.No description provided.
Data serialization error.
Scan / getKeysByPattern infinite scan.I am using version 2.2.24 of redisson and using getKeysByPattern command. It works fine if no keys are found in the redis. But, if at least one key is found then the code returns successfully. But the scan command keeps on running on the redis server.Sample code:Please share the sample code of getKeysByPattern command.
Composite Spring Cache resolution Bug.When I use CompositeCacheManager with many different CacheManagers, for example:where commonCacheManager - is a  CaffeineCacheManager and redissonCacheManager is a RedissonSpringCacheManager, and when I try to use @Cacheable(value = "cacheName"), there is a bug in discovering a needed cache.The deal is - spring trying to find cache by its name from @Cacheable and it's iterating through all registered caches in composite manager, calling  getCache(String name) in every cacheManager.The problem is - in another cache managers there is an additional variable for dynamic getting cache and usual discovering. When you make a simple cacheManager.getCache("cache"), method getCache() creates a new cache if it's null and it's normal, but in dynamic resolving as in the @Cacheable annotation getCache() should return null.Here is an example, how it's done in CaffeineCacheManager:
Metrics with Redisson.Is Redisson support querying metrics from Redis?For example:
is someone use the Tomcat Session Manager?i got in trouble when i use it to share session,  i Configure it as the document and  create two pods with docker ,then i visit the webapp in docker , After I login successfully, I refresh the page, it  indicating that I am not logged in,Is there anyone like me? can someone tell me something ,please.
CommandAsyncService blocks indefinitely [without OutOfMemoryError].all application threads are blocked with stack trace.
Need some help to understand the cause of this error please.Details : Redisson (3.3.1) using cluster mode:Exception:
RReadWriteLock is incompatible with reentry r&w op.While using RReadWriteLock, a bug (or not?) confuse me for a long time.I described a wrong ops yesterday, and fix it now. Sorry about this.There is a sure logic problem if ops like this:So if there is no holding check and running in a concurrent environment, op4 may throw IllegalMonitorException.But it's ok as follows:I found that "read unlock" will delete the whole lock without checking if there is any other write lock.Is it a bug, or it just shouldn't do and need to do in another way?
Codec usage.The default is Jaxson, can we use a combination of Jaxson with Snappy for compression?
JaxsonCodec and abstract classes.We are storing objects that is an abstract class.The Jaxson codec fails while de-serializing the object, how to i set subType can you help me out with an example?
JCache: NOAUTH Authentication required error after slave crash and restart.I'm testing Redisson JCache with following configuration:After crashing the slave (DEBUG SEGFAULT) the client reconnects but doesn't authenticate. I see endless errors like this:Is this a bug or wrong configuration?
RedissonBoundedBlockingQueue.pollAsync blocks if timeout is less than 1 second.In RedissonBoundedBlockingQueue.pollAsync, if timeout is less than 1 second, it will be round to 0. 0 is interpreted as indefinite timeout. Thus, pollAsync never returns.I understand timeout < 1 second is not supported in  BLPOP command, but at least, this behavior is a surprise for me who didn't know poll is map to BLPOP command.I am not sure what is the best way to improve this, here are some ideas:default behavior should round up to 1 second if not 0.do not allow time out less than 1 second.just mention this behavior in the documentation.
redisson can use oracle jdk?redission can  use oracle jdk? there is a old project in my company, I use the redisson as a redis client in my project ,but the console like this:java.lang.ClassNotFoundException: jdk.internal.misc.Unsafe, so I see the oracle jdk , it only sun.misc.Unsafe, thank you!
Nested live object returns RedissonReference?I have a LiveObject A, with a List of B as a field. Definitions are as below:When I iterate through listB of A, it sometimes fails with error message: "java.lang.ClassCastException: org.redisson.RedissonReference cannot be cast to com.xxx.B.".When I run in debug mode, I found out the reference has content as below:Is this a bug or wrong usage of live object?
Cache ops taking too long.Currently i'm using Redisson 2.7.4  as JCache Provider, and some cache operations are taking a long time to execute, as can be seen in the log below:in some cases it takes ~30 minutes.Taking a thread dump I noticed that all EJB async threads (and some http-executor threads too) were in the same state, generating a huge queue in the async thread pool:Thread dump for some threads (Complete thread dump can be downloaded here):it looks like that is a lock issue, but i don't know how to solve it.
java.lang.StackOverflowError.
Data deserialization error after upgrade to version 2.9.2.I upgraded Redisson to 2.9.2 and several JsonMappingException occurred:Looking for why it happened i discovered that it happens because support for @ConstructorProperties was added only in Jackson 2.7 version (FasterXML/jackson-databind#905) and in this commit c14e97c jackson was downgraded to 2.6.7 to maintain JDK 1.6 compatibility.According to Jackson release notes, still be possible to use Jackson 2.7 on Java 6:@mrniko can i open a pull request to upgrade jackson to 2.7.6 again?
Port out of range:-1 when using 'redis://' to configure RedissonClient.I made the following test:I had an error message like this:Using like this:It works perfectly.Shouldn't be better to accept all the configuration formats without problems? Like using config.useClusterServers().addNodeAddress("redis://127.0.0.1:7181"); (from Wiki).
spring boot support?spring boot support?
Any way to get a list of all the map caches in Redisson?I may have missed this, but is there a way to get a list of all the map caches in Redisson? I have this functionality in my hazelcast based code that I am trying to update and it's useful to use for logging.Thinking about it, this feature would be useful for other collections and objects etc.Thanks.
Using locks to synchronize master/standby functionality?I'm using a lock in Hazelcast to implement "single master" functionality for service applications. Hazelcast's lock is release when the owner dies.So basically, say I have two applications that provide the same service, called A and B. A and B both start, but B grabs the lock for that service. B becomes ACTIVE and starts its processing. A becomes STANDBY and waits for that lock.B dies, the lock is released. A grabs the lock and it becomes ACTIVE and starts its processing.B restarts, tries to grab the lock but fails, so it becomes STANDBY and it waits for the lock.Now I read in a ticket that a lock is still held when the owning process dies, which is counter to what I need.Can you make any suggestions how to implement this functionality in Redisson?Thanks again.
Question with AWS Elasticache Redis cluster.Questions.I recently switched from Hazelcast to Redisson and I have a question about the cluster mode and sharding.When I create my configuration, should I use useClusterServers method or another?Which nodes address should I add? All? One node per shard? Other?The great feature of the cluster mode is the ability to partition data accross shards. But I'm asking myself if it is automatically done by AWS? Actually, I saw in the documentation that the RClusteredLocalCachedMap is a pro feature, but by using RLocalCachedMap and AWS redis, does the sharding works as if I was using RClusteredLocalCachedMap? Or you "simply" put the data in all the nodes I provide at start?Is there an auto-discovery features of all nodes so I don't have to hardcode endpoint addresses in the application?Thanks,
Exception when removing entry from a map cache.I'm sure I'm missing something obvious here but I'm getting an exception when I remove an entry from the map cache, using the KryoNet encoder. I can put an entry into the map cache but I can't remove from it.Any suggestions would be appreciated, thanks.
Feature like EntryProcessor.Would it be possible in the future to have a feature which can get entries matching a Predicate?With an EntryProcessor i could have the ability to get all MyObject in the map that match a == "hello" for instance.
Simple example about how to retrieve object using RBucketReactive.I didn't find any simple examples about how to retrieve an object using RBucketReactive. Here's my example:Can someone help?
Security vulnerability with jackson.There is a deserialization security vulnerability in the jackson-databind version you are using.See Jackson Deserializer security vulnerability issue 1599.Fixed in 2.7.9.1.
Can redisson use IBM JDK?This is the error which i was receiving while with Oracle JDK this was working fine.
Redisson reconnection issue.When the network is unavailable I get the following error.Which is expected but once the network connection is restored redisson never reconnects. I am using ElasticCache and Redisson version 3.4.2. Most of my settings are default, I tried some settings but nothing works. I presume that this should happen by default which is the case when I use Jedis.
using redisson "\xA6testok" problem.look at the code below:why the value include :\xA2 ?
NPE when the value type is byte[].I try to get the value of future.getNow() when debugging, but I get io.netty.util.concurrent.DefaultPromise#SUCCESS and the value is null.
configuration java.lang.IllegalArgumentException with 2.9.3.I got the error message as followed when the code to the singleServerConfig.setAddress(address);.Fortunately, there is no error with 2.9.2.
Error occurred of serialization of kryo.Caused by: com.esotericsoftware.kryo.KryoException: Class cannot be created (missing no-arg constructor): java.util.Arrays$ArrayList.Serialization trace:
Introduce config setting to handle PubSub messages in arrival order.No description provided.
ExecutorService should return RExecutorFuture object with taskId.TaskId parameter should be exposed by api during task submission through RExecutorService. To achieve a new interface RExecutorFuture is required.Usage example:
Add ability to submit few tasks atomically (in batch) through RExecutorService interface.No description provided.
Clarification on RLocalCachedMap.Just looking for some clarification on how the RLocalCachedMap works.The documentation says it's better suited for read heavy operations (and less network round trips), which sounds perfect for something I'm implementing currently, which is a small map of runtime configurations (for simple settings like max for this and limit on that etc... Then the map in redis can be altered externally, and in turn my application without having to restart, since it's a service)My question is does the RLocalCachedMap periodically update it's values from Redis every so often?  If so, how frequent?  If not, is there a mechanism to force it to update?  Would RLocalCachedMap be a good use case for having update on the fly, runtime config vals?Thanks and keep up the awesome work!P.S.Using Redisson 3.4.3 (sentinel master/slave setup), and Java 8 on Centos linux 64bit.
Add RList.get method to load elements in a batch.No description provided.
When i use sentinel mode,the attribute "database" doesn't work.here is  my config code:when i start my application,some exception happen:and i track the sourecode,the code RedisConnection connection = client.connect() throws Exception:it's seem like execute 'select 3' in sentinel, then cause the exception.
RScoredSortedSet<String> appends unexpected double quotes to the string value.RScoredSortedSet always put the double quotes to the string value which stored in Redis. The following is how to reproduce the issue:Add string value to RScoredSortedSet in Java.List all the values in the ZSet via redis-cli.The listed value should be "1:100" instead of "\"1:100\"".
Sentinel: MasterConnectionPool no available Redis entries.Hi,I have 3 nodes of redis configured as sentinel.This is my config:When terminating the master node, redis cluster allocated a new master but Redisson fails to recognize that and starts to fail with this error:MasterConnectionPool no available Redis entries.  Disconnected hosts: [/100.127.5.18:6379].Seems that it fails to recover and locate the new master.
Add read-through, write-through and write-behind support for RMap objects.No description provided.
Can't cache methods resulting in Optional.Using Spring + RedissonSpringCacheManager, I can't cache methods returning Optional<T>. Sample:Spring automatically "unwraps" the result from Optional before sending it to cache manager, see org.springframework.cache.interceptor.CacheAspectSupport#unwrapReturnValue:Which returns null when the optional is empty:Then org.redisson.RedissonMap#fastPutAsync doesn't support map's value being null, so I receive a NullPointerException.
Live Object with Map<> field.I am trying to use a Live Object with a Map<DateTime, T> field. I use the rLiveObjectService.merge() to persist to Redis.I can retrieve the Live Object OK using get(), but the Map field is always empty. I have stepped through the code and the Map field is populated OK - something appears to be going wrong when persisting the Map to Redis.If I use a List field, this returns correctly i.e. is populated.From the Live Object example code, the Map should work.I'm using Redisson 3.4.3.Are there any known issues with using a Map<> field on Live Object?
Live Object service have issues while working with inherited classes.So i have the following use-case :And when i make Child object as my live object as Follows :I get the following error --.
Add Amazon Ion codec.No description provided.
Redisson (3.x.x) failed to initialize in Replicated connection with one of the nodes is not online.A connection refused exception is been thrown at this line when a node is offline during the initialization period.Problem is only related to CompletableFuture.
Executor and ScheduledExecutor should have the ability to unregister workers.No description provided.
org.redisson.client.RedisTimeoutException: Redis server response timeout (6000 ms) occured for command.
URI Builder Issue in 3.4.3 jar- java.lang.IllegalArgumentException: Illegal character in scheme name at index 0:Host and Port removed. tried using the 3.4.3 redisson all jar and receiving the above issue, however, this was not observed with the 3.4.2 jar. Did the node address syntax change?
Make RMapReactive and RMapCacheReactive interfaces match RMap and RMapCache.RMapReactive and RMapCacheReactive objects haven't been update for a long time.
RBinaryStream doesn't work in Redis cluster environment.No description provided.
No Such Method Error while upgrading from Redisson 2.2.4 to 2.9.3.Caused by: java.lang.NoSuchMethodError: io.netty.channel.DefaultChannelId.newInstance()Lio/netty/channel/DefaultChannelId;
Reactive Stream methods are executed immediately after Publisher object creation.Reactive Stream methods should be executed only after Subscription.request invocation.
RLexSortedSet should extend RSortedSet.No description provided.
Resisson Spring Session - Spring Security.Friends I am integrating redisson with spring session and spring security I have the detail may be something in my configuration.I understand was added to Jacksson2 support to spring security but I do not know if it is only for the client that they handle could guide me in this please.Based on the following example and add what the redisson documentation indicates. In the redis client I see that the session key is created.Thanks, forgive me, my English is new to this.
SCAN command is not getting used in deleteByPattern.#534 issue is not fixed.The code is still not fixed. I am using elasticache servers and redisson version 3.4.3.
Cannot connect using Sentinel and Database != 0 ("unknown Command SELECT")SentinelConnectionManager fails with.because Sentinel does not understand SELECT.should be fixed in org.redisson.connection.MasterSlaveConnectionManager#createRedisConfig.setDatabase should only be called for non-sentinel instances.
RedisNodeNotFoundException: Node: /xxx.xxx.xxx.xxx:xxx for slot: 15242 hasn't been discovered yet.This is log print.......This is jstack print......Whenever this problem occurs, restarting application will resolve this error.i had talked to Nikita Koksharov.and i think the problem is that.when redis cluster update metadata, redisson can't be noticed right away,then it read the old metadata,but why the thread be stopped?please help.
Redisson tries to write to a read-only slave.I have a requirement where I need to read and write from only master, so that our application gets consistent data from Redis. At the same time, we need HA and automatic failover.To satisfy above requirements, I am using Redis master-slave setup, with sentinel, and with read mode as MASTER. The issue I am facing is, Redisson tries to write to a read-only slave and Redis throws exception.To reproduce the issue, perform following steps:Configuration and other details are as follows:Maven dependency:A test spring scheduled job that reads and writes dummy data:As you can from see in above above logs, node 127.0.0.1:6381 joined as slave (but was master in the beginning). But Redisson tries to insert data into it.Please let me know if I am doing anything wrong in my configuration, or this is a bug with Redisson.
reconnect on network down.Hi. Debugging my swarm cluster and down my network, then I see:Message: org.redisson.client.RedisTimeoutException: Redis server response timeout (500 ms) occured for command: (INCRBY) with params: [..., 0] channel: [id: 0x315e345a, L:/172.18.0.8:54874 - R:/192.168.167.182:6379].Only restart help me. Why can you reconnect?
Connection Count.Who controls the count of connection to the remote server? You or I?
Pls implement Priority Blocking Queue.Hi,I have a requirement where I need to use take() from RPriorityQueue, But I can't found any RPriorityBlockingQueue, can you implement Priority Blocking Queue?PriorityBlockingQueue oracle doc.
RMapCache remove, put, putIfAbsent, replace methods aren't respect entry expiration.No description provided.
cloud not find redisson:client in config xml when server start.errorInfo:org.springframework.beans.factory.xml.XmlBeanDefinitionStoreException: Line 26 in XML document from class path resource [application-service.xml] is invalid; nested exception is org.xml.sax.SAXParseException; lineNumber: 26; columnNumber: 42; cvc-complex-type.2.4.c:my config as bellow:
RedisException: ERR Error running script.
can I use redisson with spring-session as a spring-xml config.I can't find the example how can i use redisson with spring-session as a spring-xml config.this is my spring-xml.Now I config redis-server twice  and  i must  add spring-data-redis and jedis for the spring-session. the redisson's wiki show the code  we can config with java code to use this 2, but i don't know how can i use thsi 2 with  spring-xml config.
Parse URI error in 3.4.3.After updating to 3.4.3 I got a parse URI exception by setting my Redis address, which is in the form: redis-instance.something.else.0001.euc3.cache.amazonaws.com. Switching back to 3.4.2 everything works fine. The error relies in org.redisson.misc.URLBuilder.create which has been changed in 3.4.3.
[Question] Netty dependencies problems / shading.Since netty keeps being a source of headaches sometimes, specially when using this library in combination with Play Framerwork or AsyncHttpClient or gRPC, as all of them use Netty, and netty seems to not play very nice with differences even on minor and hotfix versions.Now i am testing with the newly release play 2.6 which has netty 4.0.x but since this version they shaded it, but i am still having issues when trying to use the nativeEpoll and including the dependency to redisson, I am still trying to figure out the cause, since the dependency is there but i still get.java.lang.NoSuchMethodError: Method io.netty.channel.epoll.Native.recvFd0(I)I not found.I will be testing a few more things soon, but if anyone has observed anything like that using play 2.6, feel free to mention.
 what is the best way  to store a MultiLock between web request?If i want to lock a MultiLock in a web request,and unlock it in another web request, what is the best.way to store the multilock ? Maybe  the two web request will been distribute to different tomcat server.The root cause is we can not unlock a multilock with a lock name .
how to use redLock in cluster.I have build the cluster of redis, 3 master, 3 slave. According to the Redlock algorithm: 'It tries to acquire the lock in all the N instances sequentially, using the same key name and random value in all the instances'.'.i think every lock name is must same, it's right?the following is my example, this is right?Thanks!
Redisson 3.4.3. Wildfly. Sentinel. Netty exception : "Too many open files".Hello! Could you please explain what's going on?Using Redisson 3.4.3 in Java EE with Wildfly 10.1.0.Final on Linux in production.JRE 1.8.This is how I configure it (may be not the excelent solution, but anyway...):And all the Stateless beans use this static RedissonClient instance to use API's business.After some time (about several hours) I started to face to this stack trace (even if no invocations of Redisson API were done) :ulimit -a gives me nofiles = 64000 soft and hard, and it is said to be good for production environment.How to deal with it?(Fortunatelly the problem had some not excellent solution : I switched to single server configuration, and that worked for me, but how about API's sentinel configuration?)By the way since Redisson uses netty, how to (or should I at all) correctly deal with EventLoopGroup, mentioned in this theme with almost the same issue ?As far as I understood from that article, EventLoopGroup should be shared between clients.But EventLoopGroup is not mentioned in Redisson documentation at all (Am I wrong?)
Migration to Project Reactor 3.1.0.Reactor is about to be released. It would be great have Redisson compatible with the latest version.
Can Redisson3.4.3 support spring session 1.3.x?When I use spring session with redisson, I got some error when call session method.
how to set comparator when using priority queue.Hi, I'm new to redisson. And I'm learning using priority queue with customized comparator. My code works well for the first time, but fails the second. Seems it cannot load the comparator class.Here's my code.The exception:So anybody can tell me how to write customized comparator for priority queue.Thanks so much !
Unable to locate Spring NamespaceHandler for XML schema namespace.version:2.9.3.
Add RLockReactive.No description provided.
Add RReadWriteLockReactive.No description provided.
RLocalCachedMap with JsonJacksonCodec.Hi. Why this code does not work?
Add support for DEL unlink and async FLUSHDB & FLUSHALL operations.No description provided.
why not poll a RedisConnection directly without using connectionFuture.in class CommandAsyncService 498-503 line.In my opinion, after the bootstrap(RedissonClient redisson = Redisson.create(config)),we have.Created serveral long connections  from the client to redis server.Can we poll the connection from che ClientConnectionsEntry.freeSubscribeConnections  directly.without using the connectionFuture. I think using che connectionFuture is nonecessary.Who can answer the question?Thanks.
java.net.URISyntaxException: Illegal character in scheme name at index 0.Hi team,It throw an error, but it works fine @3.4.2 without prefix (redis://)
reactor/fn/Supplier : Unsupported major.minor version 51.0 (unable to load class reactor.fn.Supplier)When i use redisson 2.9.4 , i find this error in logs.
Redis timeout in AWS Lambda.Hi,We are trying to figure out the cause of an error we are seeing in our logs.  We are using AWS Lambdas and using a Redisson read write lock, with a lease time of 10 seconds.  There is no obvious place where there error is raised so we are wondering if this is a background task that is timing out as a result of the AWS life cycle see The Freeze/Thaw Cycle https.Is this an exception we should be worried about?Thanks,John.
Tomcat does not delete keys on Redis when session expires.Hello,I'm using Redisson with two Tomcat, each one in a virtual instance behind a Load Balancer on Azure, using Azure Redis PaaS as centralized database.Everything works great, both Tomcat can create and store session on Redis (I can easily see keys/values serialized on Redis) and both can retrieve the stored session correctly.My issue/question is: should Tomcat be able to delete keys automatically from Redis when the session expires? The sessionDestroyed() method on the SessionListener in correctly invoked, so I'm sure that Tomcat is destroying the session internally, but keys keep staying on Redis. I was assuming that Tomcat, through Redisson, whould be able to delete keys from Redis as well.Thanks.IP.
How to use the pagination in redisson.If I have a list or set to save data,How can l get data by pagination?Thanks.
tomcat session replication with non-sticky session not working, multiple issues.Hi,I'm trying to setup a Tomcat 8 cluster with 2 nodes without sticky session.Issues:1.java.lang.IllegalStateException: setAttribute: Session [F766FB4EAE8FE29451215A67300EF46A] has already been invalidated.1. From RedissonSessionManager and RedissonSession i can't understand how this solution replicates in real time( no sticky sessions) the same session from one node to another.I was expecting that method getAttribute should use the map also. If someone can explain this.And a feature if it is possible:can we filter some session attributes from going into RMap?Thanks.
Exception in thread "redisson-netty-17-12" java.lang.NoClassDefFoundError: ch/qos/logback/classic/spi/ThrowableProxy.I use redisson with springboot,throw the following Exception when starting:
RLocalCachedMap doesn't work with non-json and non-binary codecs.No description provided.
Add RSemaphoreReactive.No description provided.
Retrieve RMap keys by pattern.Hi,Redis has the feature HSCAN to retrieve the hash keys that matches the given pattern.I will retrieve the values one by one through get after filtering the keys because some of the keys will contain objects that do not exists for the certain environment.Is there a way to do this without modifying your code?Thanks =)
Spring Cache Manager with local cache support.No description provided.
none.
Class org.redisson.spring.cache.NullValue does not implement Serializable or externalizable.Hi team:redisson throw an error when I put a "null value" into cache with fst codec, but works fine when I use kryo codec.
memory leak.Hi, I got some error when I try to undeploy or reloading my webapp in tomcat manager.spring config.I also tried @PreDestroy on app destroy event as following code, but same error.any idea?
org.redisson.spring.cache.createDefaultConfig() return CacheConfig can`t use in application.
none.
connectionListener methods won't get triggered.I wanted to sure the connection still alive while putting objects to Redis and so tried to add connection listener. But the methods won't get triggered.The redis version I'm working on:The output:
RScoredSortedSet race condition with Redis cluster.We are running two redis servers in AWS, one master, and a replica. The read mode is the default (slave).In our application code we have something like this..The issue is that since reads go to the slave, addasync returns from master and before the data replicates to the other server it tries to pull the new revrank and returns null. imo the following api would make more sense and avoid that race condition..In the meantime I will either add retry logic or change the read mode to master but that's not going to scale in the long run so it would be nice to have this addressed.Cheers!
SSO One Login APP  Different applications.Greetings.I have an application consisting of two applications in one ear. And we have separated them in two .war.These applications share the session in redis database whit Spring Session Fst coded. The point is that there are classes that an application does not have in another and deserializacion fails. Is there any way to add a list of in each app to omit deserialization by class name so that each application gets the object it wants to share. There apps in Jsf and various session manage bean each .war.Thanks sorry for My English.
none.
o.r.c.ClusterConnectionManager - Command execution timeout for Nodes.I am not able to connect to redis cluster on my local machine using redisson but single redis server is working in redisson - kindly check the issue and let me know if there is something wrong on my end or some actually with 3.4.3 version of redisson.
Hibernate Cache with local cache support.No description provided.
Exeption with netty 4.1.13.We are using cache to generate some events on key expiry. As version 3.4.4 has support to add listeners directly using cache.getCollection.addListener. We are getting following exceptions and unable to find out the reason.I checked the code of netty.jar we are using and Bootstrap.config is present.
Redisson Connect to Cluster via DNS.It will be nice to have a functionality to connect via redisson to redis using a DNS as hostname instead of specifying host:port of all the nodes.
Android build issue Invalid class reference (redisson 2.9.4)While building for Android I get following error.Error:Execution failed for task ':app:transformClassesWithNewClassShrinkerForFikDebug'. com.android.build.gradle.shrinker.ClassLookupException: Invalid class reference: org/springframework/beans/support/ArgumentConvertingMethodInvoker.
none.
Expiring a live object won't expire those fields that are distirbuted objects.I define a live object like this:Then try to expire a live object:RLiveObjectSerivce service;ExampleLiveObject liveObject;The live object will be removed after one second, but the map in the object won't. Is this behavior expected?My current workaround is to expire each distributed object field in a live object explicitly.
redisson getkeys iterator got more keys than counts.The counts of keys are 3000 for example, but the iterator seem never stops counting. Why?
Storing Redisson Live Object in RSetCache.Hi,Is it possible to store Redisson Live Object in RSetCache such that when the live object expires, it is evicted from RSetCache as well?Also can we access the Live Objects from RSetCache?  While iterating over the live objects in RSetCache, I tried to assign the object to an instance of Live Object Class but I got an error stating that I cannot typecast object of type RedissonReference to object of type Class X.
Issues when master goes down.Hi,I have configured redisson with the following configuration.I am initalising reddison client at the start of my application like this.I wanted to test the scenario of how redisson behaves when master  goes down.I brought the master node down and  it was back up within a minute.I see this in redisson logs.So redisson aware of the new master.However I am getting this exception from the logs.My redis cluster is very simple. It is using kubernetes helm chart https to use redis as an in memory cache.Could you please advice if anything is wrong with the configuration or is it a bug?
RemoteService invoke very fast,the remoteServer register point has a warn,what wrong is it?I do a RemoteService invoke test,it report a warn,then the remote client wait timeout.what wrong is it?
about RedissonRedLock.I need a exclusive lock,but it not work,my code is :java 1.7.redis_version 2.8.6.thanks.
RedissonLock confuse.I wanna know when to execute the 'else' block?because tryLockInnerAsync just return null or pttl.The command returns -2 if the key does not exist.The command returns -1 if the key exists but has no associated expire.firstly, if the key exists, it must have a ttl time, so return -1 will not happen.secondly, if the key not exists, the lua script will return nil before execute pttl.conclusion: 'else' block will not be executed.or is there really happen in lua script:
Does redissonLock  enforce the same memory synchronization semantics.as we all know,redisson lock implemts java.util.Lock,so dose it enforce the same memory synchronization semantics as provided by the built-in monitor lock  just like ReentrantLock??
Class Cast Exception while converting object to RExpirable.I'm using an REntity object that I'd like to store in the redis store. And I'd also like to set the expiry time as 30 miutes for the same. But whenever I use the RExpirable function I get the ClassCastException.The REntity class that I'm using.The persist function works as I'm able to retreive the data back. So the redis config is fine. But the following exception is being thrown.Any help is appreciated. Thanks!
RMapCache Listener in Cluster Environment.Hi,We have a trouble with Redisson RMapCache in a redis cluster.Map Initialization.With our app configured with one redis, we have no trouble, the listener is called once.But we experienced troubles with a redis cluster with 3 nodes, the listener is called 3 times.It seems that every node send an expiry event...Did you have any similar troubles?Thanks.
Hibernate Second level cache with Redisson JCache API.We want to use JCache API for hibernate second level cache. We have successfully done a POC for basic scenarios of Caching using hibernate-jcache 5.2.9 with Redisson 3.4.4.How do we provide configurations such as expiry time (time-to-live) for individual Cache(s)?(Couldn't find much info in the documentation for JCache API.)
none.
Traversing the RLiveObjectService.Hi. Is it possible to traverse all the objects in RLiveObject Service?
DNS monitoring in Replicated mode?Hi,I have a question regarding the DNS monitoring. Looks like the 'dnsMonitoring' can only be set when using single server config, but not in ReplicatedServersConfig. We are currently using AWS elasticache and we found in the AWS document, it highlights that "It is important that client applications are configured to frequently resolve DNS names of cache nodes when they attempt to connect to a cache node endpoint." So does redisson have the ability to detect potential ip changes on endpoints when using Elasticache?Based on my test, when I 'restored' an endpoint with the same host url but a different ip address, redisson kept using the last known ip address to try connect to that endpoint, but never detected the new one. I tried to change the ttl in java.security and it didn't help.Please let know if you have any ideas on this one. Thanks.
Latencies when Redis server is down.Hi,During our tests of redisson, we noticed that if the redis server is down, the latency is around 100ms, no matter what.This is problematic for our use case because it slows down too much and we would prefer a fast response/error.After carefully reading configuration options and experimenting with many tests, we could not find a solution.Do you have an idea of what could provoke this latency ?Below is a simplified code allowing to reproduce it (no need to launch a redis instance):
none.
none.
[maybe a bug]I use RBatch to read and write bucket data,when redis cluster failover,the old master's ops and cpu ratio become very high.Hi,please check whether this situation is a bug:1)I use RBatch to read and write bucket data,so that I'can use the redis pipeline mechanism.2)redis is in cluster mode,the version is 3.2.9; redisson version is 3.5.0.3)when I killed the redis master instance,until failover,and restart it.now the old master become slave.4)use info command to observe the old master's cpu ratio and instantaneous_ops_per_sec indicator,I find it's very high.cpu ratio is 400%,and ops is nearly 200,000.5)I killed the redisson process,and the old master instance become normal.here is my configuration:and my code below,I implement codec interface using proto buf as the codec:
none.
why the property 'address' is not writable or has an invalid setter method?This is my set in the spring.xml:Please help me,Thank you.
Config.fromJSON thow an exception.the redisson version is 3.5.0,follow is the StackTrace.then i copy this code to eclipse ,and eclipse report an Compile error like follow: The method setFilterProvider(FilterProvider) is undefined for the type ObjectMapper.so I think there is some problem in the jar of 3.5.0 version.
Can't create SentinelServersConfig using ip:port configuration.Hello, I'm trying to use redisson 3.5.0 with the same settings where I previously used 3.4.1. However, the steps below don't work anymore.SentinelServersConfig sentinelConfig = config.useSentinelServers();sentinelConfig.addSentinelAddress("10.10.10.0:16380");This code results in the following error messages:
Optimize memory allocation during encoding process.No description provided.
redisson 3.5.0 clusterServersConfig server can't start.my project can't start. i debug ClusterConnectionManager.class file. connectionFuture is not completed.redisson:3.3.1 is OK.
none.
Connection could be in closed state during reconnection process for blocking queue.No description provided.
support fair share scheduling?alll client try to get  lock fair .
Sentinel response timeout defined as retryInterval*retryAttempts in Sentinel Mode.In sentinel mode timeout for sentinel response is configured as retryInterval*retryAttempts. This make it impossible to set retryAttempts =0 in sentinel mode.Also RBatch retryAttempts cannot be set to zero.
Add iterator by patter method to RSet objects.No description provided.
Monitor calls to redis.Hi,We wanted to monitor the calls made by our service to redis. For this, we were currently checking the calls made to RedissonCache get/put/putIfAbsent functions.Could you please let us know if this is the best approach or we should be monitoring some base method that is ultimately used by all wrappers to execute redis operations.Thanks.
During the load testing got org.redisson.RedissonShutdownException: Redisson is shutdown , but there isn't  start() method to restart it again! 0.My application only use the Redisson lock/unlock feature as below:redissonClient.getFairLock(name).lockInterruptibly(expiredTime, timeUnit); redissonClient.getFairLock(name).unlock();Then I do load testing finally I got the un-recoverable errors as below:org.redisson.RedissonShutdownException: Redisson is shutdown.        at org.redisson.command.CommandAsyncService.async(CommandAsyncService.java:477)        at org.redisson.command.CommandAsyncService.evalAsync(CommandAsyncService.java:453)        at org.redisson.command.CommandAsyncService.evalWriteAsync(CommandAsyncService.java:395)        at org.redisson.RedissonFairLock.tryLockInnerAsync(RedissonFairLock.java:126)        at org.redisson.RedissonLock.tryAcquireAsync(RedissonLock.java:172)        at org.redisson.RedissonLock.tryAcquire(RedissonLock.java:145)        at org.redisson.RedissonLock.lockInterruptibly(RedissonLock.java:114)So I post two issues:Issue 1: What does cause the Redisson shutdown without call redissonClient.shutdown() during testing.Issue 2: It need to provider below API when application encounter this error to restart its connections:redissonClient.start();or.redissonClient.restart();when encounter this error, but there isn't this method.
class 'LoadBalancerManager' in  version 2.10.1  may cause the NullpointException in method 'returnConnection'.i updated the version to 2.10.1 in my project.when i use redissonClient.getBucket("thekey").isExists(),some exception happen:the code connection.getRedisClient().getAddr().getAddress().getHostAddress() returns ip address, but the map ip2Entry need the key: ip + port.so null is returned.
Huge log messages.I started testing redisson with my app (Redisson 3.5.1), first issue i discovered:Writing about ~23mb data to redis map.Error message generated with size ~180mb when RedisTimeoutException accured.I guess issue with line that blindly call toString:
Support for setting maxSize for bounded RedissonMapCache.While implementing support for setMaxSize in RedissonMapCache we noticed a bug in the eviction where it may evict more elements than the value set for max size. Here is our work in progress.
RedissonMapCache merge conflict lost fix for setting large amount of items.@mrniko 2bdccfc#comments.
NullPointerException is thrown during cache deletion.We encountered an issue during deleting cache while using RedissonKeys.delete after upgrade Redisson from 2.2.16 to 2.3.0. I have verified same issue with latest version 2.10.1 as well as 3.5.0.My unit test was very simple, the main thread keeps deleting 40 keys while another thread keeps setting the same.I am very curious why 2.2.16 does not have this issue. The only change I could find related to this is "switched from io.netty.util.concurrent.Future to org.redisson.api.RFuture".Well also surprisingly I could not find any same issue reported by anyone else.The exception information is like this:
RMapCache EntryListener events.I am testing the RMapCache listeners using redisson 2.10.0 release, when I executed the sample code from the wiki of distributed collections, the code is not executed. I am not sure what I am missing here or is this a feature that is only available with Redis Pro, can you please take a look and guide me.Below is the code.
Single connection sharing.Example context:When you have multiple client apps (near 1000) connecting to the same redis nodes and you don't want the redis nodes (or they can't) handle the amount of connections from all those client connections pools (file descriptors, etc).Besides of course, having small connection pools or having more redis nodes.Is there any plan or way to utilize redisson on a single shared connection model?Like for example other redis libraries does.
Bug/Feature-Request: Non-Expiry updating  boolean add(...)  in RSetCache.Hello,I am using RSetCache as a lock for various work item.If the item is in the Set, somebody is working on it. The worker that "locks" the item has a certain amount of time to finish the work, otherwise the "lock" on the item is removed and some other worker can try to claim the item.See.boolean org.redisson.api.RSetCache.add(Long value, long ttl, TimeUnit unit)Unfortunately, each call to add updates the expiry timestamp of the item, even if add was not successful  because it was already added.That means that, when the worker is killed/hangs/..., the work will never be picked up after the 5 minutes, because each try to reserve the item fails, but updates the expiry.It would be great to have an atomic method which:Only adds if new.Only sets expiry if added.Returns true if value was added.
none.[].
Redisson 3.5.2 memory leak with pooled buffers.
[Feature enquiry] Redisson create throws exception when the redis cluster is not ready.I was wondering whether the presence of the redis cluster is must to instantiate the redisson client via Redisson.create(config)).I am evaluating the Redisson along with Jedis. I noticed that Jedis does not require the redis cluster to reachable when instantiating the client. However, redisson throws exception if there is no redis cluster exists.We have the use case where our service is started when redis is not available and we expect the redisson client to retry to connect to redis cluster by itself when it is asked to retrieve value.Could confirm whether this is supported feature or not?Sincerely,Peter.
Redisson hang on RBatch.execute()Hi, we are using redisson client for our multi-threaded application.We use RBatch to batch two commands as below:During the test, we noticed the hang several time.We first show this error first before the hang:Then our thread calling the batch hung. There is the stacktrack:I tried to set the lower lockWatchdogTimeout and set the batch timeout but this did not help.
[Redisson 3.5.0 and 3.5.3]Executor service Error.The following call does not return.It neither prints "result" nor returns and Redisson node prints many errors.I am using Redis 4.0.1 and Resisson 3.5.0.
none.
Redisson 3.5.1 NullPointerException in Sentinel mode - Not working at all.We just upgraded our redisson library from 3.3.2 to 3.5.1. Our application has no problems when run in a single Redis server mode or with 3.3.2, but when we run it in a sentinel mode with 3.5.1 it does not work at all, constantly generating error messages. Our sentinel cluster consists of 3 servers (master and 2 slaves) and 5 sentinel clients. Redis version :3.2.8. Here is example of error log.Here is our Sentinel info.
[Redisson 3.5.3] MR Collator Nullpoint Error.Classes:Result as following: mapReduce.execute(new WordCollator()) is error.
EnableRedissonHttpSession and spring security throw exceptions.use spring-session+redisson+spring security(spring boot 1.5.7, redisson3.5.3, spring-security4.2.3),when i access controller throw exception like this:
[Anti-Fraud]Is Redisson suitable for redis to develop the realtime anti-fraud system?@mrniko.Hi, Master.Is Redisson suitable for developing the realtime anti-fraud system which needs high performance, such as 10 millisecond to finish the computing?Thank you very much!
Is RedissonBoundedBlockingQueue thread safe?I'm confused when I read RedissonBoundedBlockingQueue.takeAsync() as follow.the takeAsync method first use BLPOP to take object from redis,then if success will call releaseAsync() to increment capacity, I think that two request is not atomic operation, and will cause concurrent issues?
none.
Clean stale scheduled tasks.How properly remove stale tasks if my supervisor(who submits tasks) not gracefully exited - crashed.Workers(redisson nodes) see submited task, executes them and put result back to redis. So after several crashes of supervisor I'v got alot of staled tasks: around 3k.So how gracefully handle this? What you would recommend to handle this situation?I have used Distributed scheduled executor service.
Use map,when some value be null,can't get from redis server,and can't set to redis server too.Because map use the jaskson codec,it seem can't resove empty value.But redis server support it.How can i do this?
Possible race-condition during write operation cancellation.No description provided.
"Too many open files" error when running redisson pro in clustered mode.We are receiving an issue where we start getting the "too many open files" error in production.  This happens roughly 60 minutes after the application is running.We create a singleton (using Guice) that is injected into relevant classes in our application:
Is there a way to make a specific key locate on a specific redis instance in cluster mode?I want to make my multi-locks locate on different redis instances.I find out that redission can specify an instance to execute command on, but if the command is key-related, the instance specified will transmit the command to another instance.Can you give me some advice?
Spring Cache Too Many Eval Calls and not setting TTL on the keys.We are using redisson with spring cache and setting ttl on our keys. The problem is that we are not seeing any ttl being set on any key. Instead, I can see that some unnecessary keys are present in the redis database.Here is the result of "keys *" command:You can see that for a key "release", the redisson creates two more keys "redisson__timeout__set:{release}" and "redisson__idle__set:{release}". Also, there is no ttl present on key "release".My code is :We are using caching here:We are not using zset and eval commands. But, still the use of these calls are too high from redisson.Also, I have see that there are almost ~4M sortedSetTypeCommands on the redis cluster from redisson under our peak load which is degrading our performance.I want to know why redisson is not setting ttl on the key and managing it using sorted sets on the client side. It is not advisable to do it on the client side if the server automatically gives that feature.Is there any way to disable this ttl management from redisson so that it will just set that on the redis server and these calls are not fired.PS: We are using AWS elasticache redis server.Redisson version: 3.4.2.Redis Version: 3.2.4 with 1 master and 3 slaves.
initialDelay: -1 (expected: >= 0)use redisson in spring-boot with spring-data-redis-stater.startup exception stack:
Use host alias throw Exception when alias contain '_’.My host alias is redis_db, test found that contain '_’  will throw this Exception.Caused by: org.springframework.beans.PropertyBatchUpdateException; nested PropertyAccessExceptions (1) are:
Add maxSize setting for SpringCacheManager.No description provided.
redisson throw exception 'Exception in thread "redisson-3-10" java.lang.ArrayIndexOutOfBoundsException: 1'.redisson running on tomcat.The program is working.redisson throw exception few minutes,
Making dependencies optional for easier OSGi deployment.Marking javax.cache api and reactor-stream dependencies as optional in pom makes it easier to deploy redisson in an OSGi environment when not using these modules. This change is in continuation to #793.
Bogus map entries in RMapCache.Using version 3.5.0, we've noticed a very strange behavior in RMapCache map-iteration APIs (keySet,  entrySet, etc). It seems that the map sometimes contains "inverted" entries in which the key looks like a (bogus) instance produced by a value encoder, and the value looks like an (again) bogus instance produced by the key encoder*. When they do, these entries show alongside the normal entries. It's only because of Type Erasure that the code doesn't break until one actually calls an iterartion API: Because the original entries are still in place, get, put, etc. works as expected even when the map is in this broken state. We've managed to workaround this issue by using readAllKeys rather than keySet.We have a custom extremely type-aware jackson-based codec, which makes this bug very easy to spot.
RedissonSpringCacheManager does not take into account default cache config parameters.Hello, seems there is some tricky code which creates the wrong type of cache map.RedissonSpringCacheManager has the protected method:Also it would be really great to have an ability to set ttl and max idle time by default for all caches.
UI - Project Dashboard.Wrong window.
Implement proper RedisLoadingException handling during RedisClient reconnection.Code:Test.redis-cli PUBLISH aaa 111 # works.
RedisConnection can not close.
RedissonClient with useSentinelServers cannot reconnect resurected slave.Hi,I'm testing the useSentinelServers connexion. I have 1 master and 1 slave.If I kill the slave, wait and then restart it, I have the folowing trace in the Tomcat console when.calling redisson.getNodesGroup().getNodes().If I look at the Redisson ConnectionPool.java, I see that the method will never retry a connexion on a freezed slave :Question : How can I get Redisson to reconnect the resurected slave ?thx,Xavier.
Upgrade from 3.4.2 to 3.5.3.We have been using Redisson successfully for the past few months, since our version was pretty old we just tried and upgrade to the latest version today.With version 3.4.2 we used  SnappyCodec as follows.This setup fails with the new 3.5.3 version.Example client usage.With so many release since 3.4.2, many other codecs have been added. We store JSON string so which is the best codec to use for this case?.
Wait Command Support.Is the wait command not yet supported in Redisson?
Many invocations of getEntry and getClient.Hello,We have performance issue in org.redisson.connection.MasterSlaveConnectionManager#getEntry(java.net.InetSocketAddress)We did profile the JVM to see what's happening and we have a lot's of invocations in this method.While looking at the code, we found a.Is there an optimization planned on this part of the lib soon ? Do you have any workaround to fix this ?Thanks !
Add null value support in RMap.No description provided.
Data encoding should be executed on client thread only.It's important to do execute data encoding on client thread rather than netty's event loop.
Better collection handling for RedissonReference.No description provided.
Test classes compilation fails on master.Hi, when I try to run tests on master (063dcab) as CONTRIBUTING.md states, I get the following error:It's likely due to the spring version being used, [3.1,4.3).Maven version:Am I doing something wrong or is it actually failing?Thanks!
Current Connection Max Out when using Distributed Schedule Service ·.Hi,We are using AWS Elastic Cache (3.2.4-cache.m3.xLarge).We are trying to solve for scheduling events using Redisson Executor Service (https). We have a setup of 1master and 4 slave nodes.When we are trying to send scheduling request at rate of around 1000 request per sec for more than 1hour duration, we are seeing that current connections shoots up to max and they are never reclaimed and the app starts throwing errors.These are our Redisson Client setting: (Replicated servers configuration)We are creating a executor service on startup and use it throughout the app. We are using the scheduleAsync function and Runnable implementation.We have a 6node (EC2 instanceC3.xLarge) app Cluster taking to Redis. (Each node has the above configuration)Can you please help provide guidance as to what might be the issue here and how we can resolve it.Thanks.
Add connection PING support.No description provided.
"too many results to unpack" when callin RMapCache::getAll on a large (10000+) keyset.I get "too many results to unpack" exception when calling RMapCache::getAll on a large (~10000+) keyset. Tested on both v.3.5.0 and v3.5.4.
Cannot shutdown RedissonNode if there infinite lock is locked.To reproduce the problem:1 Create a Runnable job which will last ~ 1 minutes (greater than "internalLockLeaseTime" used by RedissonLock.java), get a lock and lock it by lock.tryLock(), release the lock after the job is done.2 Schedule and run this job using Redission framework.This is because RedissonLock.scheduleExpirationRenewal still running after we shutdown the node.Can Redisson stop the scheduleExpirationRenewal when user call node.shutdown()?
RLocalCachedMap.Hi,I have very large objects that are hard to serialize, so opted for RLocalCachedMap with eviction policy as LRU and Invalidation policy on change. I notice that when I add key, value to the map, both key and value are serialized sent to redis server in serialized format often resulting in errors. Is there any way to preserve the eviction and invalidation and not send the value to redis server with serialization.From redis monitor.
MasterConnectionPool no available Redis entries.
Redisson Client cannot link properly after the master - slave relationship changes.Redis cluster, when the master-slave relationship changes, the Redisson Client links to the original master node and cannot link the changed master node, resulting in no data write.
outofDirectMemory Netty exception with redisson pipelining.i'm trying to learn Redis through Redisson. Here is my code to insert into redis using multiple threads.package redisson.This code works fine until totalSize=400000. When i put the totalSize=500000, its throwing the following exception:Can someone explain to me the reason why this is happening?
redisson not handling failover in sentinel mode.Hello, i'm new to redisson and using version 2.10.4. Assume that i have a master node M1 and a slave node R1. 3 sentinels are connected to M1 namely, S1,S2,S3. I have connected Redisson to the 3 sentinels and started inserting data. Following is my code:My question is whether this is some configuration issue from my side or does redisson not support failover?
RedissonBlockingQueue.take() returns null in case of internal error.The take() method in RedissonBlockingQueue uses Future.getNow(), which returns null if an exception occurs. In our case, we have tons of NPEs when the application is stopped.
Connection Count in Redis Servers increases when Failover happens.I am using redisson 2.8.2 with Java 1.7 and redis in Cluster mode. Recently we had an incident related to connection count of redis servers. After further investigation we have found that after each redis failover, connection count from each client to redis servers get increased and not going back to the earlier values. This happens after each failover in the redis servers whose role got change.Then eventually connection count reaches maximum connection count and application goes to a freeze state.
CROSSSLOT key error on #getMap#getReadWriteLock when clustered.#Hi,I'm encountering the CROSSSLOT keys error when I get a lock a ReadWriteLock of a map in a clustered environment. The normal Lock of a map works fine tho.or do I need the RClusteredMap instead of the normal map when clustered even if I don't need the data partitioning?
none.
why is redisson faster than jedis, could you description some main reasons?No description provided.
none.
com.fasterxml.jackson.databind.JsonMappingException: No suitable constructor found for type.Using the latest 3.5.4 version and Java 8. getting the error when deserialize the json to Java objects.For my own classes, I could implement a default constructor to workaround the issue, but not on other classes that I dont have access to.
Making redisson operation atomic.Hi, i have a usecase that i'm trying to implement using redisson. I have 2 redisson instances running on the same server performing the same operation.Code snippet of redisson instance 1:Code snippet of redisson instance 2:My use case is this: At an instant of time both the instances could access the same key and update its value twice. I want to restrict this i.e., if both instances are accessing the same key at the same time, only one update should occur and not both.My question is this, which would be the best locking mechanism to deal with this or should i handle this on my own???
RFairLock dead lock issue.Hi,I would like to report a locking issue we are seeing using redisson versions 3.3.2 to 3.5.4, using RFairLock.We have 3 instances of an application competing for a fair lock. After some time, the timeout of the fair lock queue gets set to a time many hours in the future, and no thread ever gets the lock.Here is what redis is reporting during one of the occurences - both commands ran at about 9:30AM PST on 10/17/2017 (1508257800000):You can see that the timeout (zscore of the timeout keys) is set about 6 hours in the future.So far, we haven't been able to reproduce the issue locally, but it is happening daily in our production environment. We are suspecting the problem is happening randomly when one of the application gets killed by the operating system (kill -9), something that can happen quite often due to the way we manage the apps.We were using redisson version 3.2.3 before, and never experienced the issue.Earlier this year, we tried updating to version 3.3.2 and started seeing the problem within a day or so. We reverted to 3.2.3, and waited for an updated version.Two days ago, we decided to upgrade to 3.5.4 assuming the problem was fixed, but it happened again within a few hours.I will keep on trying to reproduce the issue, but any help is appreciated.Thanks,Michael.
none.
Support for Socks proxy?Hi there,I was looking around and I cannot find if there is socks proxy support.I am creating the socks Authenticator like this.And the RedissonClient is created like so:But when it tries to initialize the connection it always tries to access the redisHost directly.Is there support for socks proxy and if so how can I properly enable it?
Redisson trying to connect to a dead slave on sentinel setup.Guys,I have a redis 3.2 setup with sentinel (3 nodes). I'm using redisson 2x.I'm performing some HA tests, dropping some slaves or making them fail to test the resilience of the system.My simple config:So I got this scenario where one of slaves is disconnected and with error on master link (check lines 10 and 33):sentinel slaves mymaster.The problem is that redisson tries to connect to this slave for reading regardless of its status instead of picking another slave.  Shouldn't redisson consider sentinel flags in this case? Maybe it is just a configuration I'm missing.
Unexpected exception while processing command.I got this problem when I trying to locking an object. Here is the problem:Date: Thu, 19 Oct 2017 10:15:31 GMT.what I'm missing?
RReadWriteLock reentry is incompatible.This issue is related to #891.write lock for 10 seconds.write lock for 1 second.Now after 1 second the whole lock is released. I'm not sure if this is a bug, but logically the system should not unlock the because the first lock request is done for 10 seconds.Manually calling l2.unlock() manually works as expected, that is fixed in #891.
none.
Cron schedules stop after a certain time.Hi,I'm using cron schedules on an executor service but the schedules stop after a certain amount of time.I've reproduced the issue in a small standalone project.Here the scenario ;Use latest redisson (3.5.4) with single node redis and using linux native epoll in configuration.Create a single worker for an executor service.Create the corresponding executor service.Schedule a cron task every seconds.Schedule a cron task every days at midnight.After a certain amount of time, the cron task every seconds will stop working.When midnight comes, the midnight cron task works, and the every seconds task resume, but then stop again after a certain time.I did not wait midnight on the standalone project, but I have had this behaviour in my project.I looked into redis and saw that the every seconds task is still here, and the zset contains valid value for the next run in the score.Note that I also reproduced the bug with every 5 seconds or every 5 minutes task and the task every days at midnight, but I had to wait longer.I reproduced also without using the native linux epoll.
none.[].
Configuring redisson to work with Azure Redis Cache standard tier.What's the correct way of setting redisson up to work against a standard tier Azure Redis Cache? I'm asking because the standard tier Redis Cache is replicated, but Azure doesn't provide the connection details for the slave instance.According to the documentation, Redisson's "replicated mode" requires that.All nodes (master and slaves) should be provided.So do I use "replicated mode" and only specify a single instance, or do I use "single instance mode"?
none.No description provided.
Add checking for failed masters during Redisson startup in Cluster mode.No description provided.
Introduce separate binary codec for messages used in LocalCachedMap object.No description provided.
Handle server down with singleServer mode.Using singleServer mode without slave.I'd like to handle this in our app, but it looks like the getBucket() or get() is an async call, so the function doesnt throw the exception, I look through the docs, and found nothing to configure Redission to work in synchronized mode. Is  synchronous mode supported by Redission or is there a different way to handle this?
org.redisson.client.RedisTimeoutException.
Scheduled Tasks Failover.How can I make sure that if a certain nodes takes a scheduled task but crashes, someone else would try and recover it?
none.
Seeing lots of redisson errors - RedisTimeoutException and RedisConnectionException.Hi. I am using redisson 3.5.4.I am using redisson for task service management. However, I am seeing a bunch of redis errors - not for every call, but for enough calls to where I am concerned. Here is a sample:and a different error:I am also seeing some RemoteServiceAckTimeException: No ACK response after 5000ms for request: RemoteServiceRequest.Here is my configuration:Is there any config setting I could change to help with this? Am I doing something wrong?thanks!
Reset maxIdleTime and ttl on read is not working.I am using redis with elastic cache in my spring application where i am using spring annotations for accessing cache.I need to reset cache idle time and ttl on read so that i can keep my user active until user goes idle beyond timeout.But read is not resetting the timeout and cache is evicted as per idle time and ttl set in configuration. Using below annotation in both the cases for creating and reading cache, the issue is same in both single and multiple server configuration.What is the configuration needed to reset idle time and ttl on read? please advise.
presist feature not working as expected.We're are struggling with basic persist function.When have written a piece of code to persist a simple Customer object that is annotated as @REntity with its guid field marked as @RId.The piece of code used to persist is as follows:Customer object is getting stored in Redis server with the key:We expected it to be saved using its field guid as the key. Nevertheless, now when we try to get this object back, it returns a object (which we believe is a proxy object) with all null values.service.get(Customer.class, "1")returns.
Data Object Hierarchy not working for live objects (2.10.4 as well as 3.5.4)Parent -child is still not working for me. I am getting no such field exception when the RId is a part of the parent class. Can you please guide? What am I missing?Thanks,Salil.
Redisson not set-up correctly when using JCache API and custom config file.I have a Spring Boot application and a Bean that implements org.springframework.boot.autoconfigure.cache.JCacheManagerCustomizer, i.e. there is a method that takes a javax.cache.CacheManager, and then follows the instructions provided here. Specifically, I have implemented a mixture of the code snippets for:"Using config file with custom location"."Using Redisson's config object:".Essentially, I have the following that does create caches as I would expect on my local Redis instance:@Override.However, when I run tests or start/stop the Spring boot application, I always receive the following Log message and the Redis caches are not cleared.  Note that the caches are reset if multiple tests are run in sequence but the data cached in the last test is still present in the Redis instance after the test has been run.After debugging, it seems that there is no org.redisson.Redisson object created. This appears to be caused by the checks for either a redisson-jcache.json and redisson-jcache.yaml being on the classpath in org.redisson.jcache.JCachingProvider#loadConfig(URI uri). If these files are not found, the config returned is null which means that org.redisson.jcache.JCachingProvider#getCacheManager(URI uri, ClassLoader classLoader, Properties properties) does not invoke the code inside the if conditional below:I do not have either a redisson-jcache.json and redisson-jcache.yaml file on the classpath since my team are trying to develop a way of loading different Redisson configuration files based upon the Spring Boot profile that is used to launch a Spring Boot application.  Configuration files are instead searched for in a specified location with a specified file name (the name of a Spring Boot profile).
Retrieving objects using non-@RId fields.I have a Customer object as below.I store this object in Redis using the persist method as below:I can use the service.get(Customer.class, "1")  method to retrieve this object based on the guid we pass to it. However, I have following requirements:Can you point me to the right api for such requirement?
Delayed writes.Hello,I was testing the behavior of Redis/Redisson when a network failure happens (say for few minutes) and then recovers. I observed the following un and wondering if there is a way to avoid this scenario.Observation:SADD command was issued at 14:46 PM and failed due to RedisTimeoutException. This seems to have happened just about when network failure just started.At 14:50 (A full 4 minutes later), it looks like Redisson heard back from Redis master node but due to client side timeout set, just skipped the response.Here are the logs:Redis Version:Redisson Version: 3.4.1.
useSentinelServers in ReadMode of MASTER_SLAVE, the master never got read.Tried following config.I wish both master and 2 slaves could be read (33% chance on RoundRobin algo). But I see the master never got read.Tried different Balancer and dug into the source, seems that the LB seems only be applied to slaves. The master server is setFreezed(true) and it won't get read unless both slaves get disconnected.Looks like ReadMode of "MASTER_SLAVE" is actually same as ReadMode of "SLAVE".
Add RListMultimapReactive object.No description provided.
Redisson 3.5.5 will not accept "localhost:6379" as address for SingleServerConfig.it used to accept "localhost:6379", but now the address seems have to be: "redis://127.0.0.1:6379".this is because the change in org.redisson.misc.URIBuilder.java.Should it more developer friendly?
timeout configuration in Replicated Mode.Hi, i'm using redisson with a Replicated Mode configuration (1 master and 2 slaves).When attempting to debug an issue, i found that apparently the timeout configuration parameter is not being used in the implementation as documented.I was receiving a fair amount of unexpected RedisTimeoutException: Command execution timeout messages.Changing the retryAttempts and retryInterval allowed to circumvent the issue - but not changing timeout - which seemed odd to me, so i decided to dig further.In ReplicatedConnectionManager#L123,A value of 0 for retryAttempts, or even a higher number matched with a relatively low retryInterval always causes the RedissonClient instantiation to fail (due toCommand execution timeout).Raising these values can bypass the error on the initial connection and allow the instantiation.Still, the same applies to subsequent calls: they also won't also use the timeout provided in the configuration.Am i observing this correctly or is there something i'm missing here?
[Performance] Potential performance issue or improvement.One of our teams has been running some load tests that involve calling deleting keys from a redis cluster among other things. And when they run a profiler they observed that top hot spot was actually related to collection management (ConcurrentHashMap and HashSet) on redisson when getting connection info and copying it for every operation.As seen on the following hotspot analysis.This was tested with redisson 3.4.3, haven't tried with the latest one yet.Is there anything that could be changed from config or improved on the code in future versions?I believe the same scenario might show up on other operations besides delete.
SSL it's not fully implemented.Hi,I was trying to use your library with AWS Clustered mode and figured out it does not work with SSL.I figured out the problem and fixed it in my fork  but it's a hack what I did.Basically everywhere you create an address like "redis://" -- you need a way to know if it's SSL and put "rediss://" instead. Since those places have no access to config, unfortunately I changed all to force SSL everywhere.Do you have in plan a fix for this, or I can do it if you point me to the right way. I am trying to understand your logic and how can I be least invasive to pass a config. The simplest way would be to put a static public flag somewhere -- but that's also a hack I guess, and will only allow one type at one time, or pass a jvm property ...what do you suggest?Thanks in advance,Florin Moisa.
Java objects - support for search by non-RId fields.Hi,We have a usecase where we store Java objects in cache and search them by multiple fields. Is there a way to achieve it in Redisson liveObjects? Spring-data-redis provides such functionality but does not support redisson.Thanks,Salil Gandhi.
Failed to continue poll remote responses if current waiting for response has been canceled.No description provided.
 Add RSetMultimapReactive object.No description provided.
reactor/fn/Supplier : Unsupported major.minor version 51.0.I am Using Java 1.6 and the Redisson 2.10.1.and i am using the RedissonReactiveClient  as shown in the blow sample code.
Read-only GEORADIUS support.Hi,Redis 4.0.0 and 3.2.10 introduced read-only GEORADIUS variants(GEORADIUS_RO and GEORADIUSBYMEMBER_RO), as the docs state. Are there any plans to add this command to redisson?Thanks in advance!
Redis timeout exceptions when trying to submit tasks on a now executor.I have a redisson configuration with a single worker executors for various schedules - 1min, 5min, 1hour, ... 24hours. When each of these ticker-tasks are invoked I have a set of devices on which I need to run diagnostics. Each device will have a task that will be slotted in various schedules and these tasks for all the devices that belong to a schedule need to be invoked at that particular time.The device tasks are put in a 'now' executor. So on every schedule invocation, there are a lot of tasks that are submitted on the now-executor.I am using Redisson version 3.3.1 and my key settings are:I am observing sporadic RedisTimeoutException when submitting tasks to the now executor:I am also getting sporadic timeouts on the ticker tasks - 1min, 3min etc.I have two instances running that feed off the Redis cache. These errors are sporadic in  nature. Appreciate any help in understanding the root cause of these timeouts.
Is there a way to get a value from a key that wasn't set using redisson?In my local redis database, I have a node.js app that sets redis keys and values. Can I use redisson to retrieve using the key name? Or can redisson only retrieve keys that were created by redisson?
Initialization timeouts leads to performance issues and timeout on batch.Hi,I've been fighting for the past week with some weird timeout issue on one of our apps.The use case is an RBatch operation that execute a bit of getBucket(..).getAsync()Run scenarios with 1 get or N gets as part of the batch and happens on any.The issue is basically that after a few minutes after starting the app, some instances of my app start displaying timeouts on that cache operation and thus becoming slow, then i restart that particular node of the app, and maybe it's fine forever, then I restart another instance and maybe now that one starts exhibiting the same problem. Sometimes it add a constant base of 50ms delay (due to timeout and retries) and sometimes it's 150ms or similar.We tried with redisson 3.2.0 and 3.5.5 and we can observe the problem on both, we though it might some hardware/network problem on those servers where such apps are running, but after restarting and re-running it works fine (or not) and viceversa on other servers.The errors we get on the failing app are always like this.And this what we observe many times.This is being used on a very high traffic app, but we can reproduce it with low traffic as well.Do you have any suggestion or insight on any thing we can try changing on our config and re-run our load test so we can sort out this issue. And we really need the data to be read from redis because the alternative when our cache fails is a much worse system that cannot handle the load or our SLA.We have been trying changes on the servers, running on different hardware, etc but nothing changed yet. Could it be some dead connection or bottleneck on the batch or connection manager that is causing this? Also as you can see on the avg time graph on top, it doesn't happen for every request, but for many of them, but constantly ONLY on that running app of all the total.
none.
Snappy implementation in recent versions throws ArrayIndexOutOfBoundsException.Summary.Up to and including Redisson version 2.10.1 and 3.5.1, Redisson used the Xerial implementation of Snappy (https) for its SnappyCodec.In versions 2.10.2 and 3.5.2, Redisson was changed to use the internal implementation of Snappy from Netty instead. However, this implementation seems to be designed only for Netty's use cases and cannot encode moderately-sized payloads. In this case, moderately-sized means that payloads of more than 50,000 bytes are very likely to fail.This results in an error during the encoding step, e.g.Steps to Reproduce.I have created a repository that shows how and when this bug occurs. I take the last known good versions (2.10.1 and 3.5.1) and compare them with the most recent versions at the time of writing (2.10.5 and 3.5.4).See the repository here: https.To run the examples, either run the main method for each module in your IDE, or run each module via the command line with mvn package exec:java.The redisson-*-snappy-demo modules show the behavior in the indicated Redisson version. As you can see, the last known good versions (using the Xerial implementation of Snappy) can encode this payload without any problems, whereas the new versions (using the Netty implementation of Snappy) will fail.The netty-xerial-snappy-demo module shows how increasing the size of the encoded payload will soon cause Netty's implementation to reach a breaking point after which all attempts at encoding will fail. When creating the sample data with a random seed of 0, Netty will succeed on a payload of 44,895 bytes and fail on a payload of 44,896 bytes. Changing the seed will change this number, but it will generally fail somewhere between 40,000 to 50,000 bytes.The Xerial implementation, on the other hand, does not fail at any size I tested (up to 100 million bytes).Fix.While it's nice to avoid an additional dependency, I believe the Snappy implementation from Netty should probably be considered an internal implementation since this size limitation makes it unsuitable as a general compression algorithm.The Xerial implementation seems to be more widely used by more high-profile projects (e.g. Cassanda) and is probably a safer choice.
Seeing NullPointerExceptions with distributed services.We are testing the distributed services feature of redisson. We are noticing that at scale (i.e. 1000 tasks in a minute), redisson is throwing NullPointerExceptions and the tasks do not complete.Let me know what other information would be helpful to try and track this down.thanks.
Connection distribution upon nodes.Hi,I have a setup of 3 redis nodes with 3 sentinel nodes.I am using latest redisson with master_slave read mode.I see that almost all connections go to the master redis and slaves are not in use.Also when connecting to redis i see only db0 is being in use.What am i doing wrong in my redisson config?Thanks.
OpenTracing support?Is there any current plans, third party plugins, or a recommended best practice approach to use Open Tracing with Redisson?In particular the remote service invocations seem like they could benefit from the tracing span context propagating across the service boundaries.I have done some quick googling and didn't find any libraries, documentation, or anything else on the subject.
please help.
Out Of Memory When using RScheduledExecutorService.Hi,We are seeing Out Of Memory Exception when using RScheduledExecutorService.We are using redisson 3.5.5.These are our settings:It would be great if you could help provide some guidance here and help figure out the issue.Thanks.
Removed entries in RMapCache Through Eviction Process Still able to see through Redis-cli.I am Using the RMapCache<K,V> and using the Method  putIfAbsent(K key, V value, long ttl, TimeUnit ttlunit) .I want to use the Eviction functionality i.e provided so I am giving ttl as 45 Sec.After 45 Sec when i check the Entry in the MapCache From the ReddisonClient at runtime i didnt found the entry.But when i check the same in the Redis-cli using HGETALL i can still able to found this Entry that was Deleted through Eviction Process by Redisson.SomeTimes even after 5 min i can able to see the Entry in the Redis-cli even Though it can't be able to find from the Redissonclient after 45 Secs.
user_script:1: bad argument #1 to 'len' (string expected, got boolean)I am using spring and redisson cache manager. Below is the issue I am running into. The thing is that if I manually cleared cache from redis-cli, the issue is gone.
AvroJacksonCodec vs Avro Direct Binary.Hello,Can you please tell me the difference between AvroJacksonCodec in Redisson vs creating my own codec using Avro's BinaryEncoder directly? Does the Jackson codec covert the object to JSON first and then to binary? E.g. is it wrapping my objects in { } and also writing the field names? Thanks.
none.
The question of the version.When I used high version(org.redisson:redisson:3.5.3),The error is as follows.But, when I used low version(org.redisson:redisson:2.2.17), my project is started normal with tomcat 8.0.14.My project is used gradle 4.0, I want to use the high version, please tell me how to do?
The Namespace Of Redisson.I want to use the Namespace of IRedisClient. Where is the Namespace of Redisson?
Add entry update strategy on map entry change for RLocalCachedMap object.No description provided.
OOM issue with RedissonExecutorService.Hi,We are seeing out of memory when trying to use RedissonExecutorService.Please find attached the file you can use to reproduce the issue.Usage:
What is the application scenario of the RedissonRedLock?What is the application scenario of the RedissonRedLock?
The deadlock of RedissonMultiLock.When I used the RedissonMultiLock.lock(), I found the code of Redisson.This is my code.The program execution sequence is as follows:Thread A locked the 'lockSoundbox' of lockA. It's OK?Thread B locked the 'lock2000' of lockB. It's OK?Thread A locked the 'lock2000' of lockA. It's OK?Thread B locked the 'lockSoundbox' of lockB. It's OK?I think there's a deadlock between 3 and 4, but I'm not going to try it out.
Problems with Spring Session UsernamePasswordAuthenticationToken deserialization.I've read somewhere that you need to add a serializationcodec but didn't manage to get it to work.. any tips?
Redisson willunable to work after the redis-cluster reboot.No description provided.
Redisson will be unable to work after redis cluster reboot.Redisson runs base on redis-cluster mode, and every thing looks cool.  When redis cluster nodes all down, the redisson is unable to work and throws connection exception. Howerer, when the redis cluster recovered, the redisson is still unable to work and throws null pointer exception!!!!!!!I did this test base on redisson 3.3.0.
Redisson Client hangs on creation.Hey guys,currently trying redis + redisson (v3.5.5), so this might be an easy question for some of you. Anyways as soon as I create my Redisson Client (config seems right), the client hangs in the create statement indefinitely without any exception or timeout, etc (waited for over an hour to hopefully see some error, sadly none).To the setup: Win10 + Ubuntu subsystem running redis on standard port (6379), single server setup. In its config the redis server is binding to 127.0.0.1 (also tried disabling protected mode). RedisDesktop Manager and Jedis connect just fine without any issues.Hope someone can help, as I couldn't find anything related to this anywhere online.Stacktrace :
java.lang.IndexOutOfBoundsException: fromIndex: 0 toIndex: 2 size: 0.the error occurs when get a sub list from Rlist object, use 'indexOf' to get index number of specified string, it returns 1, it shows that there should be some elements in specified region, but reported no data.found, did somebody meet same issue? how did it happen?BTW, the redission version is 3.4.2.
none.
Set removeRandom(10)  throws Exception.it seems to use the command "SPOP key 10".but in fact redis Set doesn't support that uses, SPOP  only pop out one value at a time. So this will cause an Exception "wrong number of arguments for 'spop' command".i am using redission version 3.5.5;and i hope redission wilol support the SRANDMEMBER command in the future.
nginx + tomcat + redisson share session.Environment:Configuration all set and session can store in redis and get from redis.But when I login, I have to login 2 times (First time fail and auto refresh page, second time can success).. After logined, when I click the page, it will show "Uncaught TypeError: Cannot read property 'click' of undefined" (Google Chrome) or "TypeError: tableDom is null"(FireFox). Then I refresh the page and click it agian, it will be normal.Can you help me slove this problem? thanks.
MapLoader seems to hang if you try to check the same null key, more than once.It looks like the second time you try to get a key that was null through a map loader, the loader will simply hang.I was able to reproduce this in RedissonMapCacheTest.java with the following code.I'm running Windows 10 with Redis Version 3.2.100 64 bit version.  This is happening on Redisson 3.5.5 and the current master branch.
spring session with spring security error.org.redisson.client.RedisException: Unexpected exception while processing command.n: no suitable constructor found, can not deserialize from Object value (missing default constructor or creator, or perhaps need to add/enable type information?)
Redisson RScript eval codec is not honored.Command executed:Expected result: values and/or keys encoded with json codec.
redission AtomicObject in debug + breakpoint mode cause a different result.version:3.5.4.At first,I delete the key,confirm the key not exist.
Java 9 warning - illegal reflective access.Just wanted to report this warning I'm seeing now since I am giving Java 9 a go (for native alpn/ssl stuff that's not directly related to Redisson).This warning is shown on stdout when I start up my runnable/uber jar:So far it appears everything is working fine, but figured it might be worth reporting, since it says it will eventually be denied in a future Java 9 release.
RedissonRedLock issue.
spring boot health check redis is down.
RxJava 2 Support.I was hoping to see support for RxJava2, I love having Redis on the stack when I make apps, but it's a real pain when almost every other library has standardized. Thanks for considering :)
Redisson not able to detect ip changes of active node in RLEC endpoint.We are currently using Redisson 3.5.0 to connect to our Redis labs enterprise cluster(RLEC). The driver is configured to connect using single server mode (as recommended for RLEC). When the active node ip switches/changes, Redisson is not able to reconnect with the new active node. It keeps retrying to communicate with the last known active node ip from the endpoint. This behavior is consistent with either "dns monitoring" being set to true / false.  If we manually set the same active node ip back, it immediately reconnects, which proves the point that its unaware of the ip address changes, unless the last known ip is elected again as active.How do we enable Redisson to detect potential ip changes of active node, while using endpoint of RLEC in single server mode?Please let me know if you have any ideas on this one. Thanks.
Eviction Scheduler doesn't remove expired keys from list.Hello,I asked a question on stackoverflow about how to well configure redisson to make eviction scheduler working on set in redis, but no answer yet :(. Could you help us by answering on this post or by improving the wiki about this point ?Many thanks !
Redisson is not reading the values set by external redis clients.I am creating a set through Medis, a Redis client or FastoRedis. When I try to read the same using redissonClient.getSet(key), I see an exception being thrown saying "Unable to evaluate the expression Method threw 'org.redisson.client.RedisException' exception." while debugging the set in IntelliJ. Why can't redisson is reading the value for the key? I noticed one thing when the redisson sets the value, it has quotes. But when you set a string from external clients, it doesn't have any quotes and redisson can't seems to be recognizing it.
ReadWriteLock not working.Hello.I'm interested in this project. I am creating a sample project(https) using this,And I do not think readswriteLock is working properly.The error pattern is a bit different, but the example org.redission.example.ReadWriteLockExamples.java is not working properly. Version 2.10.5 does not work either.I do not know much about redis.I hope this project can be maintained.
redisson work with a cluster with no full coverage slots.
redisson 3.5.5 RScheduledExecutorService.You can't find a class using the Lambda creation task.
FstCodec deserialization problem when adding new properties to session object.FstCodec deserialization problem when adding new properties to session object.Is there any way to handle that? If its possible to either ignore or invalidate session if new properties are added.org.redisson.client.RedisException: Unexpected exception while processing command.
Add executeSchedule methods to RScheduledExecutorService.executeSchedule methods return void method instead of ScheduledFuture this allow to avoid memory consumption by each schedule.
Rename codecProvider and redissonReferenceEnabled Config properties.Rename codecProvider and redissonReferenceEnabled Config properties to referenceCodecProvider and referenceEnabled.
Remove Config.resolverProvider and embed its logic into RedissonLiveObjectService.No description provided.
DNSMonitor fails on bootstrap with custom event loop.redisson 3.5.6 fails on bootstrap when using custom event loop.
Redisson can not deserialize data on expiration event.
JVM crashes when using 1000 concurrent redisson threads.I am scheduling tasks on a Redisson executor. On every schedule a massive chunk of tasks are submitted on two Redisson executors. I have equal number of workers assigned to each of the two executors 500 and a maximum redisson thread count of 1000.I took periodic heap dumps of the JVM and the following was the last dump I captured before the container (my code is running in a docker container) went OOM. It appears to me that the netty's PoolThreadCache continues to increase.Here is a screenshot of the leak suspect report of the last dump I took:I am unable to get the crash dump report of the JVM. Will attach that as soon as I am able to figure out the issue with crash dumps not getting generated.I am using Redisson 3.5.5. The bundled Netty version is 4.1.16.
Redisson remote services can't ack when running redis in cluster mode.To reproduce this, on 3.5.6, I updated BaseTest.java and ran the tests against a clustered Redis server running  Windows 10 with Redis Version 3.2.100 64 bit version.Completion appears to work fine.  It's just the ack that is throwing an error.  If I set the options to noAck, I can get a result.Ack does appear to work correctly if Redis is not in cluster mode.BaseTest Modification:
Removing class name in serializing an object.Hi,I would like to minimize the data storage in Redis. When putting an Object in a list, I found that the object is serialized and stored in JSON. However, for every field in the json string, it has a class name info "java.lang.String" next a field for example.Looking at the source code, realized that this is added by default. Passing my object mapper to initialize won't work either.Is this necessary? Is there a way to disable this?Alternatively, I serialized myself an object into a string and put the string into RList. However, then it seems the library serialize one extra time as follow:
Redisson RMap get response is slow.I've a java application where I'm using Rmap to store and retrieve objects to/from Redis. The response time of map.put(...) is reasonable but map.get(...) is averaging 4000000.0 ns.  I'm using FstCodec for serialization/deserialization. The application has many classes that do not provide no arg constructor and hence certain codecs can't be used.I would like to know how to improve the map.get(...) response. When same object to go LinkedHashMap, the response time is in the range of 446.0 ns and I'm looking for a response time in that range.Find attached my sample java application and config file.
failover does not work.Hi,I'm new to redisson, I setup a redis master-slave environment with 3 sentinels.But failover does not work when I kill master node, it seems redisson node does not try to connect new master node. I got this exception:Here is my redisson configuration, could someone help me? thanks a lot.
AWS ElastiCache SingleServerConfig failover doesn't work partly.We use redisson 3.5.3 , and  AWS ElastiCache SingleServerConfig mode ,of course the redis client config property dnsMonitoring is true , you know that AWS ElastiCache will change the ip to same DNS  when failover.Today AWS ElastiCache failover occurred , we found that we got many redis exception : org.redisson.client.RedisConnectionException:I research the error log file, found that redisson has switch to the corret ip address :
none.
Configure Redisson to connect to Azure redis cache.Hi,I am using redisson 3.5.6 to connect to Azure redis cache (standard tier).  I am using Config.useSingleServer and have provided password in the redisson.yaml configuration.It is throwing Exception: Unable to connect to Redis server.Please help me in resolving the issue.
Reading from Elasticache replica nodes.Hello.I'm using Redisson ( redisson-all-3.5.5.jar )to connect to AWS Elasticache running in Cluster mode disabled. The cluster has 1 primary and 2 replica nodes.  The application uses Redisson's Spring Cache abstraction support.I have configured Redisson in Master-Slave mode providing the primary end-point as master and replica end-points as slaves.I load the application by making hundreds of simultaneous requests hitting the cache.When I view CloudWatch metrics, I notice that there are no CacheHits for the replica nodes. All the requests seem to be going only to the master/primary node.I have tried SLAVE as well as MASTER-SLAVE for read-mode attribute. I played around with the LoadBalancer class trying out RoundRobin and Random , but to no luck.The idea behind using multiple replicas was to distribute read load and not just for high-availability. It is important for us to read from slave nodes. Is there some setting that needs to be enabled to allow Redisson to read from slave nodes ?
Configurable ttl for caches and/or entries in redisson Jcache.Hi, it would be nice to have a global configuration(using redisson-jcache.json, for example) option for the redisson Jcache to set the ttl for caches and/or entries.
Two threads can acquire the same lock with redis cluster.I have a very simple try-finally block something like this:I have a redis cluster 4.x with 3 masters and 3 slaves, redisson is initialized like this:In most cases it work, but sometimes I can see it from the log that the lock cannot block two threads T1 and T2 can acquire the lock simultaneously, then one of them can release the lock successfully, the other one will throw an exception:So, my questions is that, why two threads can acquire the same lock? (They have the same lock name, I observed this from log)
BitMap (RBitSet) questions.I have two questions.Are there any plans to extend RBitSet index range beyond Integer.MAX_VALUE*2?  Since it supports distributed implementation of BitSet and its operations - having this limitation removed would be very helpful.There have been studies suggesting Roaring Bitmaps as very powerful mechanism to support space-saving fast bitwise operations on bitmaps ( operations are performed on compressed representations). See e.g.  When do we plan to having a roaring bitmap implementation - be it PRO or community version of Redisson.
none.
add repeat feature in priority dequeue.Thank u.
none.[].
MapCache listener not working on cross-plateform environment.Hello,I've encountered a bizarre bug when using MapCache listeners between windows and linux.My setup:When running the test I've got the following errors:the line PlatformDependent.isWindows() should not be made regarding to the jvm running environnement but regarding to the redis server.
none.
none.
none.
version 2.10.6, compiler target is 1.6+,but in class BaseRemoteService use Map's putifabsent method?compiler target which defined in pom.xml is 1.6, but in source code such as BaseRemoteService still use Map's putifabsent method.
Add RMapCache.remainTimeToLive(key) method.No description provided.
Add tomcat 9 support.No description provided.
Add ClusteredBloomFilter.No description provided.
DNSMonitor doesn't work with ClusterServersConfig.I noticed that Redisson isn't detecting DNS changes when using the ClusterServersConfig with AWS Elasticache Redis in cluster mode. After debugging it looks like this line is never hit https.I am using a CNAME DNS record that points to the Configuration endpoint of the Redis cluster and then testing destroying/recreating the cluster and pointing the CNAME at the new configuration endpoint.Is this expected? What's the  here?
Add Redis Modules support.Implement an infrastructure for adding custom Redis Module support:
Add KQueue support.No description provided.
Add RMap.valuesAsync(String pattern)The output should be the same as values but it Should response with a RFuture<Colletion<V>>.
Is there anyway RMapCache can work with other clients?Our service (Python) shares a redis with some other Java services. We and some Java service put in the data, and another Java service consumes the stored data.Java services have decided to use redisson RMapCache to store and read the data. And since they both use redisson so there is no issue for them.But I found if RMapCache can not get the data I hset in redis via redis python client.It complains that:I suppose the data I put didn't follow the RMapCache eviction scheduler data format.Is there any workaround for this? Or any suggestions on this situation?
rangeTailAync and rangeHeadAsync.I am looking to get a specidic count of data from endString to startstring.So I have used readTailAsync by providing startString but I am getting data always from startString.I tried using readHeadSync by providing endString but i still get same data from startString. Is this a bug?I would like to know how to solve my problem.
ReadLock not working correctly.Hi,Is this the expected behaviour of the ReadLock from ReadWriteLock?Clarifying because I did not encounter this in release 3.5.4.There are multiple threads that are trying to lock and unlock the readlock concurrently but I am encountering the "attempt to unlock lock, not locked by current thread by node id" exception.Here is a rough code sample to replicate the issue.The unlock part throws the following exception even though they're all read locks.
Using RMapCache what combination of ttl & idleTimeout can I use to expire field that is read < those values.I have a scenario where I have a field that I want to keep as long it the field value is updated at a rate < the idleTime, and expire when the that is not the case.What appears to be happening is that as the field is read more frequently than the idleTime, and when a get is performed it updates the idleTime expiration, so that the field is never expired.I tried the following combinations:but none of those combinations work.  Is it even possible?thanks, Mitchell.
.setDnsMonitoringInterval(-1) doesn't actually seem to be disabling DNS Monitoring.I'm using 3.5.7 and am getting intermittent "Unable to resolve" DNSMonitor exceptions, using AWS ElasticCache Cluster. Here's my createConfig() code:I'm still getting the UnknownHostExceptions from DNSMonitor which suggests the monitoring is not being disabled. Is this a bug or am I missing something?Just an additional FYI, this is my initialization block:
Session object was not updated correctly.I used redisson session manager to externalize session data into redis server. However, session data will not be updated if the session is an object and the data to be changed without running httpsession.setattribute(..).For example:I tried Jedis session manager, it works as same as what I expected as tomcat session. Is this a bug in redisson?
Question about RFuture.Hello,I saw that CompletionStage interface implementation has been deleted based on the code.Are there a particular reason for the removal?Thank you.
RLiveObjectService : isExists method : unclear javadoc.RLiveObjectService has method isExists (which name is grammatically strange already, but "isSomething" is already established expression for boolean variables, so okay)Javadoc says: Returns true if the RLiveObject does not yet exist in redis.But the same javadoc later says: @return true object exists.I find this kind of documentation unclear, as I don't understand if it should return if object exists (like method name and @return says) or not (like description says)UPDATE:I tried to see for myself and got confused even more.Here's my code:Testing code:So what exactly "isExists" feature does ?
InstantiationException when getting priorityQueue.The code.Is that because comparator is anonymous?
Add LongAddr.No description provided.
Save RScheduledFuture in redisson.I have a few tasks which can be started in RScheduledExecutorService from many instances. They also could be cancelled from any instance. To achieve this, I try to save the RScheduledFuture in RMap, but I got next stacktrace:Is there a way to store this kind of objects in redisson? Thanks.
Can I use RBatch for RPriorityQueue?I want to perform RPriorityQueue.remove() and update RBucket as atomic operation. Is it possible? There is no RBatch.getPriorityQueue() method.Tried it with getQueue() method like this:Doesn't work. (and probably shouldn't)
Add DoubleAdder.No description provided.
RScheduledExecutor doesn't restart tasks after crash.I'm testing fault-tolerance of redisson node. I have 5 Runnable scheduled tasks. When instance crashes, sometimes redisson node resumes these tasks again. Sometimes - not.I found that if it resumes tasks, Redis has next keys:Could you provide more information, how reliable task resuming in case of crash can be? If redisson node is shutdown correctly, can I rely that tasks would be resumed? Is it the same case in case of single Redisson node? (with one/multiple ExecutorServices in NodeConfig)Is there some strategy to resume these tasks? Or at lease find out they are broken, remove stale data and re-create tasks?Thanks!
Add new readMode.Can we add a new readMode? It will read memory first, if session data is not in tomcat session, then read from redis? This will help performance and also keep the session when one of the tomcat failed in clustering environment.Something like:
RLock reentrant behaviour over unlock.This might be a trivial case/question but according to java specs, a reentrant lock can be acquired  by the owner thread infinite number of times and simple can be unlocked completely with just one unlock call.What I'm seeing is the opposite of it currently, in RLock implementation. It behaves like a semaphore rather than a reentrant lock. Every unlock call decreases reentrant counter on Redis and in order to unlock it completely, I have to call unlock until the counter hits to zero. Is this the expected behaviour?
RMapCache'Eviction seems not to be in effect.I used RMapCache in my project,and set the timeout time is 3 minutes,but I found that the size of the ZSET is increasing. and the key  still inside, and not be cleared a day after that.Here's the way I store key "a" with value "1",and 3 minutes to live:Did i make any mistake?How can I make the Eviction come into effect?
Add PriorityBlockingDeque.No description provided.
Problem deserializing google immutablelist?Caused by: java.io.IOException: java.lang.InstantiationException: com.google.common.collect.RegularImmutableList.Do i need to register it?
none.
Replace current hash implementation with HighwayHash.
none.
Add JTA implementation.No description provided.
Add support for Spring Transaction API.No description provided.
Add atomicity property to RBatch object.No description provided.
io.netty.resolver.dns.DnsNameResolver#doResolveCached race condition java.lang.IndexOutOfBoundsException.It's an known bug in io.netty 4.1.19.Final and fixed in 4.1.20.Final.netty/netty#7583.Sometimes my AWS Lambdas fail by creation of the redisson client.
tickDuration 1 causes "tickDuration must be greater than 0".With minTimeout = 1, first if block is used, calculating 1 / 2 = 0, causing confusing error message.
RLocalCachedMap.putAll gets stuck.No description provided.
[Question] Environmental Variables in Configuration Files?I'm not seeing this in the documentation, is it possible to reference environmental variables in Redisson configuration files? We are looking at using the Tomcat session manager implementation and being able to do this would be very useful to us given that we are using Docker and the Redis clusters are named differently in different environments (and it isn't easy to use some kind of DNS trickery as we are using SSL).
Add RBucket.getAndDelete method.No description provided.
Add RAtomicLong.getAndDelete and RAtomicDouble.getAndDelete methods.No description provided.
RedisTimeoutException: Unable to send command: (ZADD) with params: ...... after 3 retry attempts.
RSCRIPT LUA timeout and not consistent results.RScript LUA timeout/Null Pointer exception.Description.When trying to execute EVAL LUA script using Redisson library,  We receive either null Pointer exception or timeout exception and results are not consistent.  If we execute one or two statements then it works fine but when we add a couple then it isn't giving consistent results. When ran eval Lua script directly  in REDIS client it doesn't timeout and gives consistent results. Please let us know what the issue is when using redisson library and how to fix it.REDISSON ERROR same error even when I increased the timeout value.
Redisson RBucket codec problem!  java  object is Serializable or not makes putting obj to redis failed! ·.I use redisson 2.8.1, as default it use jackson JSON codec, but once I want to store a class ( which implements java.io.Serializable , it's - org.apache.shiro.session.mgt.SimpleSession ) in a RBucket, it failed to store the every object filed value in redis master slave (sentinel mode ) cluster. That means, I lose some value of the Object stored in redis.... it is dark..Then I tried to use other codec:Tested OK! a class ( which implements java.io.Serializable) object can be sotred correctly and get from redis using RBucket.  But, we have another problem here : a class ( which not implements java.io.Serializable) cannot be stored in redis now.... dark again...Could I beg your suggestion? Thanks very much .
none.
[Question] Use Rmap as a data member on a singleton or create a new instance for every call ·.If our server handles lots of Rest calls that access distributed collections, is it safe to keep a single instance of Rmap as a data member on a Singleton bean (and have multiple threads use it concurrently) or is it better to create a new instance of Rmap for every call?We're not using a local cache, so there's no data supposed to be kept in the Rmap instance, but does it have any concurrency limits we should be aware of?Is there a significant overhead associated with creating a new instance of Rmap for every call?
none.
Reddison Spring Cache modifies exception semantics of annotated method ·.Regarding spring javadoc the spring Cache interface demands implementations to throw a Cache.ValueRetrievalException."Wrapper exception to be thrown from get(Object, Callable) in case of the value loader callback failing with an exception.".The reddision cache implementations breaks this contract and throws a ValueRetrievalException that is wrapped within an IllegalStateException. This exception is not handled by Springs CacheAspectSupport and thus thrown back directly to the caller of the annotated method.Looking at CacheAspectSupport, it would also expect a CacheOperationInvoker.ThrowableWrapper as cause of the ValueRetrievalException which is removed within the reddison cache implementation when constructing the ValueRetrievalException.This behaviour breaks the transparency of the cache abstraction and beaks code that relies on exceptions for control flow (eg. javax.ws.rs.NotFoundException). Can you please take a look and this and tell me if that is intended behaviour?Best Regards.Daniel Selinger.
Redis Replication Configuration.Hi ,I want to test redis replication scenario on my local machine.I am using  docker and have below setting.` redis-master:image: 'bitnami/redis:latest'.ports:And passing address like "redis://127.0.0.1:6379,redis://127.0.0.1:6380".From logs I can see master is ready but I am getting below exception.My all 3 servers are running ...  I tried increasing timeout as well. Can you please tell me what could be the issue or I miss anything..
Spring session annotation support.Hello,I'm following guide, but I get NPE.I tried to use @EnableRedissonHttpSession(maxInactiveIntervalInSeconds = 360) but still the same NPE. Is this annotation usable or the only option I have to use is xml ? Tried  3.5.7 version.
Deserialization through JCache failing with ClassCastException.I am using Redisson as Redis client to store a key-value pair <String, LocalDateTime>. It's configured to be used through the JCache API (JSR-107).It's storing values like 2018-01-23T11:59:34.997834 but in the cache#get invocation is trying to return a String giving a ClassCastException . It compiles perfectly, cache#get returning LocalDateTime, but if fails in execution.Am I missing something here or is there some problem using it with the JCache API?ava.base/java.lang.String cannot be cast to java.base/java.time.LocalDateTime.
Update Spring Session to 2.0.No description provided.
Redisson expiration event - deserialization issue.I use Redisson (sentinel mode), and everything was working fine until I added an EntryExpiredListener.After adding the listener I started getting the following errors.DefaultChannelPipeline] - An exceptionCaught() event was fired, and it reached at the tail of the pipeline. It usually means the last handler in the pipeline did not handle the exception.io.netty.handler.codec.DecoderException: com.fasterxml.jackson.core.JsonParseException: Unexpected character ('b' (code 98)): Expected space separating root-level values.Any hints?Client Factory.
ZREVRANGEBYLEX not supported by redisson ·.@mrniko Currently ZREVRANGEBYLEX is not supported by redisson which can pull details in reverse order of the stored values on a key LEX sorted set data structure. Please support this function as soon as possible as we would like to use it. Without that the retrieval of data in reverse order is very cumbersome and not an easy way out. Even LUA script based on discussion with REDIS labs, they say it fecthes data only from one shard and cannot go and look for data in other shards... We want to use this function zrevrangebylex in redis batch execute to retrieve data from multiple sorted set keys at once.
none.
Cannot call config.enableMetrics() to initialize Metrics.Hello,I'm using Redisson 3.6.0 and want to use the following:However, the org.redisson.config.Config class does not implement enableMetrics(). I can't find the implementation in Github source code.How can one initialize the Metrics as described in the documentation ?Thanks.
RLiveObjectService not support Enum.version : 3.6.0.
org.redisson.RedissonTopic.removeAllListeners got blocked on CountDownLatch.await.Hi there,We hit an issue in one of our server using Redission as Redis Client. We do have a single thread executor handling subscribe/unsubscribe for multiple channels. But last week, we found this got blocked on one server.The org.redisson.RedissonTopic.removeAllListeners is unable to respond request, and blocked in the acquireUninterruptibly FOREVER. I tried to dig into logs, there was one exception thrown before this in CommandAsyncService.syncSubscription line 125 "Subscribe timeout 9500ms". This is possibly related since this was the only "Subscribe timeout" message I saw in last 30 days logs and then this issue happened. But I still don't find prove on this. Looks like this is a rare case since we just hit once. I tried to reproduce locally but with no luck.I think the removeAllListeners should give an option to let caller pass in a timeout. But this is also not going to resolve the root cause. I am wondering if other people have observed this issue before. Please advise if you have any ideas on this, thanks.
RedisClient.getBuckets do not have a asynchrounous api.i want a  buckets.getAsync api.
RDelayedQueue cannot be delayed.
RDelayedQueue cannot be delayed -- help me, thanks.I got it!   Thanks.
"You can't write against a read only slave" after failover with sentinel·.Hello, I have a strange issue with redisson and sentinel fail-over.I have a SpringBoot application, I have multiple instance of this application, load balanced(HAproxy).My http sessions is shared between these instances with Spring-session and Redisson.I have a Redis cluster in "Master - Slave" configuration with 6 sentinel.When I have a failure on my Redis master (I can reproduce with "redis-cli -p 6379 DEBUG sleep 30"), the sentinel fail-over is working well (in around 2 minutes) and the slave become a master.This is the beginning of my problems :First I can see many "org.redisson.client.RedisConnectionException"  during 10-15 minutes.I assume, it's probably due to connection switching.But after during 1 hour, I still have lot of "org.redisson.client.RedisException".Lot of user login in my application are failing and all the access to redis become slow become slow (jump from 2 ms to 100ms)And I restarted my Spring Boot application and everything is back to normal.Do you have experienced similar issue ? or any hint ?I'm using SpringBoot 1.5.8.RELEASE.Redisson 3.5.4.Spring Session 1.3.1.RELEASE.
Slow gets from redisson in CommandServiceAsyncGet.Hi,We are using redisson-client 3.6.0 with cluster mode enabled with elasticache, redis=3.2.6(encryption-at-rest enabled). These are the configurations for 2 separate clusters,We see a degraded performance on all our apis and the bottle-neck seems to be from redisson. We are using spring caching and noticed that all the keys with a particular cacheName are being stored in a single shard instead of being distributed. How do we solve for actually distributing this across different shards?We are contemplating switching to redisson.pro if it's going to help. But does the configuration look good and will redisson.pro help with the issues?Please find attached screenshots that is showing the bottle-neck.
NPE with redisson pro.I am using redisson pro trial version(3.6.0) in cluster config with elasticache(redis=3.2.6), I see NPE in get and evict operations using spring cache framework. I don't see this issue with the community version(3.6.0) and same configuration.It basically just gives this error and hangs. I think the exception is being swallowed by DefaultPromise.
Redisson client keeps running after shutdown invoked.I have the following code:What is other than shutdown needed for graceful shutdown?
Redissonspringlocalcache manager in distributed systems.Hi I have read about the redissonspringlocalcache manager that it is keeping a local cache backed by redis. Please correct me if I am wrong. Please tell me how it works in distributed mode.Eg. If we have 10 ec2 instances deployed connecting to same redis. Suppose there is a case which has been invalidated by one machine. How early can the other 9 machines would be knowing that their local cache is invalid and they need to call the redis to update it.Do it use background polling to check if it is enabled.?
RedissonSpringLocalCachedCacheManager not found.I want to use RedissonSpringLocalCachedCacheManager  for spring cache.But I can not find RedissonSpringLocalCachedCacheManager and LocalCachedCacheConfig in redisson 3.6.0 version. Is something wrong?
Split RFieldAccessor into RGetter and RSetter annotations.No description provided.
Extract RId.generator to RIdGenerator.No description provided.
Sentinel failover with pub/sub failure ·.Guys,I'm facing na issue I'd like to share and get insights from you.We run a sentinel cluster which is composed by (3 sentinels, 1 master and 2 slaves). The application can have dozens of instances and is connected to to this cluster via redisson 2.10.7 and redis 3.2.10.Eventually in an event of failover pub/sub messages seems to not be delivered to redisson clients (I say that because SentinelConnectionManager logs for failover are not present in system logs).The only log after that is:After that, redisson becomes irresponsive and seems to never recover and the only way to fix it is to restart the application node.Redis cluster is confirmed to be working properly (as restart of application nodes alone fixes the issue)According to redis client guideline pub/sub messages are not guaranteed to be delivery and should not replace the pooling mechanism to check the cluster status.  I need to dig a little bit into the redisson code but it seems to strongly rely on pub/sub only.I'm trying to reproduce it locally and build a test case, but it is being tricky.Have you ever experienced this problem before?redisson config as follows:
Add support of PING for Pub/Sub.Add support of PING for pub/sub channels.redis/redis@70e3948.Discussion about this Redis feature: redis/redis#420.
Redisson issuing undue commands with spring cache.We are using redisson 3.5.2 with spring cache.When I put the debug on the method,I get the following requests when using Monitor on the redis server.I am unable to understand why the eval and hset command is sent from redisson when I am getting a key.This is creating an issue for us to scale our services since these eval and hset calls will only go to master. Even if, we increase our redis slaves we wont be able to scale our reads since each read results into two writes to redis master.Other issues are:The eval command is taking a lock on redis master.The hset command is setting the same response in redis master which is being replicated by all the redis slaves. This is resulting in wastage of redis server resources since they are wasting them to replicate the exact same data.
Redisson 2.9.1 Redis 2.8.17 in sentinel mode, redisson subscriber is not self-healing after restarting all redis boxes·.Set Up.Redisson version: 2.9.1.Redis Version: 2.8.17  Mode: Sentinel.Found this issue in our production, not sure if self-healing is supported by redisson during disaster like all redis servers are down, if it is supported, any specific version ?We initialize the subscriber once as following during server startup.Redisson 2.2.27 is performing better than 2.9.1 in the sense of re-subscribe.Even all Client in 2.9.1 version, sharing the same config as above, some clients are able to re-subscribe.I went through the implementation of 2.9.1, found out that if following Scenario B, while doing MasterSlaveEntry. reattachPubSubListeners(), the unsubscribe and resubscribe process is trying in best-effort, which is prone to lose listener for a channel, leading clients unable to resubscribe. What is confusing is in Scenario A, some of the clients were able to reconnect somehow.Is there any way for redisson to survive a redis disaster failure like this ?
Multimap tries to keep the List/Set on the same node, but ignores Key Hash Tags in the given Key.As I described in the title, I am trying to utilize Key Hash Tags to accumulate data on the same ClusterNode.I am using a Multimap and noticed the Key for the Lists/Sets are wrapped in the Key Hash Tags and so they may be placed on another Node.For example:The MultiMap key is "{multi.map}.some.key".An entry in it would be saved in the List/Set "{{multi.map}.some.key}:ADJ...".So the Hash is not "multi.map" but rather "{multi.map".For further information see the "Key Hash Tag" section on.
Redisson Remote Service stops responding.We have an RMI running on Redission 3.5.7.  Each RMI is fire-and-forget with no ack or completion time.This particular RMI is invoked about once every 2 minutes.  After about 3 days, the server side of the RMI simply stops processing.  The client is still producing messages.  Other Redis features such as client caches seem to still be working correctly on the same APP that is supposed to be processing the RMI calls.1-2 minutes after the last processed RMI call on the server side, we get the warning below.  This is the only error or warning that we are getting.  The rest of the java application works fine.  Once the the java application is restarted, all the remote calls are processed as expected.We are running Redis on AWS with Redis 3.2.4 in cluster mode.
Caused by: org.redisson.client.RedisException: ERR max number of clients reached.When I use Reentrant Lock in my application, this exception  ERR max number of clients reached occurs.Redisson version is 2.10.7, and redis version is 3.2.
Multiple JVMs tryLock attempt.We have a spring application running in 3 different servers/jvms. Those services receives an event notification with an eventID.In order to avoid event processing duplication we are trying to use redis lock, to process only one event each time. We have multiple requests with same eventID coming from other services, so this is a very common scenario.The lock is centralized in one Spring Bean.Each time an event comes we first verify if we can lock.We also the singleServer approach (commented above). But in both scenarios events are processed twice, eventually.We don´t understand what its wrong. Can someone give us a clue?
RedissonLocalCachedMap does not broadcast LocalCachedMapClear on clear()clear() method is implemented properly on RedissonMap; but it is not overridden on RedissonLocalCachedMap. RedissonLocalCachedMap should override the parent implementation by clearing the local cache, clearing the Redis map, and broadcasting a LocalCachedMapClear event on the invalidationTopic.
RExecutorService - Task resume on another worker doesn't happen, when worker(redisson node) goes down.Problem:We are evaluating Redisson as a distributed task queue manager and as a result the expected behaviour for failure scenario is:-- If a worker starts working on a task and if worker goes down before completing the task then task should be resumed on another worker.As per our observation this doesn't happen.For SIGINT and SIGQUIT signal - Most of the times it finished the running tasks. (We found couple of instances where it didn't happen)For SIGKILL (when worker is killed using kill -9), executing tasks are lost.Can you please help us understanding that is the above mentioned 'expected behaviour' correct? Does redisson provide this guarantee? If yes are we missing some configuration? If no, please indicate what is the best practice for using Redisson in this case?Here is the code of the the Task:Here is the main code which is invoking it:Commands with which I start two Redisson Nodes are:Please let me know if any more details are needed.
RedissonRedLock.tryLock(long waitTime, long leaseTime, TimeUnit unit) still have something wrong.reference from the issue #1175 after it is closed.I change the test case in RedissonRedLockTest.testLockSuccess() like this:The test case above will fail in case of that lock1/lock2 is locked first in thread t1. However, it will pass in case of lock3 is locked first in thread t1.The  is as follows:No matter which lock is locked first in thread t1, the Red Lock will always can be locked or cannot.In this case, the Red Lock should always be locked for most of the lock is available.
JsonJacksonCodec cannot deserialize EnumMap.Hi,I opened a ticket on the jackson databind project but I think this issue could use some visibility here.FasterXML/jackson-databind#1932.The code below can replicate the exception I am seeing. I ran into this when calling operations on  a RScoredSortedSet, but the code below is stripped to just the Codec.I believe this is a bug but I apologize if I am misusing the library.
RBatch throws NPE with big pipeline in atomic mode.No description provided.
Warning about CommandDecoder.decode() method.
CertificateException while connecting to Azure redis cluster.I have got CertificateException when Redisson try to connect.Caused by: java.security.cert.CertificateException: No subject alternative names matching IP address 12.34.567.89 found.When i disabled the setSslEnableEndpointIdentification the connection was successfully established.The scenario is when I'm using useClusterServers config.the Redisson client sends cluster nodes command to Azure Redis,the server responses with a list of IP and port of cluster nodes, then Redisson client try to connect to newly discovered masters, but now the target is IP and Azure doesn't sign the certificate.Important note:all the discovered IPs are the same IP resolved by endpoint URL (which provided by Azure).I saw that other redis clients separate the endpointIdentification for the base connection and cluster node connection.If we are able to do node cluster endpointIdentification with the base connection verification it will solve the issue.Thanks.
Add RLocalCachedMap.clearLocalCache method.It clears all local cache across all RLocalCachedMap instances.
RBatch doesn't sorted sorted sets.Any reason RBatch does have a getSortedSet() method?
Support for dnsMonitoring in Sentinel Setup · Issue #1299.After the fix of #1280 which improved greatly the resilience of Sentinel setup, it would be great to have dnsMonitoring  feature as well because in failover scenarios of sentinels instances, the box can get a different IP and the current implementation caches the dns resolution forever.  It means it never reconnects to new sentinels in the cluster.
Error while creating bean of RScheduledExecutorService.I am trying to create a singleton bean of RScheduledExecutorService in Spring 4. I have not yet autowired this bean anywhere. I am always ending up with error. I am working with Redisson 2.11.Unable to find any kind of solution or any instances of problem with anyone else here. Is this a bug ?Since it is a JsonMappingException I also tried using different codes but nothing helped.
Performance issues with updateMode=AFTER_REQUEST.We are trying to use updateMode=AFTER_REQUEST to make sure all the session data will be saved into Redis server. After reviewing the source code, looks it may cause performance issues since we keep a lot of data in the session, and store function will be called on every request no matter there is session changes or not.Is it possible put save session data to Redis after tomcat request code to a separate thread?
RedisClient does not override 'hashcode and equals' may cause  redis connections are not closed properly.I found that in master-slave mode, the redis connections on slave servers may not get closed properly.Caused by: org.redisson.client.RedisException: ERR max number of clients reached.After reading the source code, I found that the reason is that RedisClient does not override hashcode and equals.Consider the following situation:One hostname slave-hostname maps to two ip-addresses: ip1, ip2.Firstly, slave-hostname  maps to ip1, client2Entry will cache new RedisClient and ClientConnectionsEntry instances: RedisClient-ip1 and ClientConnectionsEntry-ip1.DNS  changes from ip1 to ip2, all the connections of ClientConnectionsEntry-ip1 were closed properly.DNS  changes from ip2 to ip1, client2Entry will cache another RedisClient and ClientConnectionsEntry instances: RedisClient-ip1-1 and ClientConnectionsEntry-ip1-1. RedisClient-ip1-1 was different from RedisClient-ip1 as they were not the same instance.DNS  changes from ip1 to ip2 again,All the connections of ClientConnectionsEntry-ip1-1 should get closed properly.  When san client2Entry values, it is possible to find ClientConnectionsEntry-ip1 or ClientConnectionsEntry-ip1-1.The connections of ClientConnectionsEntry-ip1-1 may not get closed properly.Our master-slave model.two slave servers, with one slave hostname, DNS changes every twenty seconds.
RBloomFilter.expire only deletes Bloom Filter string, not hash.Problem.If I initialize a bloom filter like this.The String test is the only thing that gets deleted from Redis after expiration time. The config hash {test}:config remains even after expiration.
Add Kryo 4.x support.No description provided.
[Error] while connecting to remote cluster.I transfer redis cluster server from local host to virtual host recently, then some interesting things happened.The cluster worked fine itself, but as soon as I used redisson as client, it went wrong.They can registry by using remote address.However,they cant recognize each other with remote external address, but with local internal address. I dont know how to deal with it, can anyone help me, thanks a lot.
should not clear channel and listeners when unsubscribe failure.This is very likely a bug.in.Set up:in step3: slaveDown happens when maximum attempts reached, but it was unable to send "Unsubscribe".but in, when "UNSUBSCRIBE" failure happens, it removes the channel and remove all the listeners.my thoughts is when "UNSUBSCRIBE" failure, we should readd the channel, and not executing onMessage()
Wrong classloader used by TasksRunnerService?Today I had a lot of work to bind embedded Redisson Node with Spring Boot. Here are the final thoughts and conclusions. In short I believe creating own codec in TasksRunnerService using TasksRunnerService class loader is a bug. Please review the article for more details.
Tomcat Session Manager issue to renew session in Load Balance environment.Hi!I'm using Redisson 3.6.0 with redisson-tomcat 3.5.6 with:Elasticache Redis Cluster.Spring App deployed on two instances EC2 Tomcat (instance 1 and instance 2)Load Balance with non-sticky session.My session timeout is configured to 30min.The steps to reproduce the issue:a. User logged in on instance 1 (a new session is created with timeout of 30 min);b. After 15 min, an ajax request was made by the application which was managed by 'instance 2' refreshing the session to more 30min;c. After more 20min the user reload the page, and the load  balance send some requests to 'instance1' and to 'instance 2', but the instance 1 has been idle  for 35minutes and because of that, delete the session that was renewed 20 min ago!This issue is only reproducible using at least two instances behind a load balance with non-sticky session because the action to delete the session ignores if the session was renewed by other instances.Is there anything I can do to prevent this behavior?I think this is related with #972.
is it possible to add a duplicate check when RedisPubsubConnection addListener ?Sorry to open so many issues for the same problem, feel free to close it if you think this is not appropriate.We are trying to have the best availability of our service when redis servers in Sentinel mode run into disaster situations (like all redis-server, redis-sentinel are down)Currently, what we are trying is when Redisson client last received ping is too old, it will try to re-subscribe to the same channel. However, this introduced new problems, when the QPS is high, we added multiple listeners for the same client to the same channel, which is not optimal.In following two places, there is no duplicate check (if the listener already in the PubsubConnection, don't add the listener)Is it possible to add a duplicate check that only when the listener is not there, we add the listener to the connection ?
Redisson 3.61 not working with spring-session 1.3.1.RELEASE.Hello,I try to upgrade redisson from 3.5.7 to 3.6.1 but I get this exception :I'm using theses dependencies :
JsonJacksonCodec constructor in 3.6.1 breaks with Jackson 2.9.x.Using Jackson 2.9.2 and 2.9.4 (tried both), trying to upgrade from Redisson 3.3.2 to 3.6.1 I get this:Redisson 3.5.7 does not have this issue.
"Unable to init enough connections" when ConnectionMinimumIdleSize is high.We're having trouble spinning up redisson (3.6.1) when the minimum number of connections is high.Steps to reproduce:Run a local redis server. We used the official docker image:Try to create a redisson client with a high number of idle connections, short retry interval and some client name:More often than not, we're getting the following exception after a few seconds, with a varying number if successful connections:
The cache in redis can not be clear automatic when Redisson resatrt.I hava set the ttl and idleTime for cache, the cache can be remove when the app is running, however when I restart app the EvictionScheduler may not work for cache, the cache can not be clear when ttl approach. Does it problem have any solution?
Many exceptions and errors after sentinel failover with redisson 3.6.1.Hello, I'm re-opening the issue #1272 for me it's not fixed in 3.6.1, I get lot of errors long time after a fail-over.My setup :
Redisson 3.6.0 memory leak with cluter batch.018-02-28 19:56:31,534:io.netty.util.ResourceLeakDetector.reportTracedLeak(ResourceLeakDetector.java:311).LEAK: ByteBuf.release() was not called before it's garbage-collected. See for more information.Recent access records: .
RBloomFilter functionality with RBatch commands.This issue is to implement RBloomFilter with the RBatch batch commands. I do not see a getBloomFilter() option with the batch commands, it would be incredibly helpful to have.
Configurable Tomcat Session Key Prefix for Redis.RedissonSessionManager uses "redisson_tomcat_session:"  as key prefix, so if multiple tomcat instances are using same "redis" server for storing session data. So need a mechanism to configure default key prefix.
calling getMap() million times creates millions of map instances.While reading the Redisson tutorial and examples, I am under the impression that I need to always call redisson.getMap() in order to get the latest data from the cache . Right ?I have a storm bolt which calls getmap(key) for millions of incoming records.Looks like millions of instances of RedisonMap being created , leading to pressure on GC.
Upgrade Spring Boot to 2.0.0.No description provided.
 Skipped slave up  for master redis://?:0 differs from current redis.After upgrading from 3.5.7 to 3.6.1 I can see a lot of warnings every 3 seconds:I use SentinelServersConfig.
Redisson 3.5.7 memory leak with locks.I'm using RLock and seeing memory leak via org.redisson.client.handler.CommandPubSubDecoder.Retained objects delta between heap dumps taken apart.Around 10MB leak per day.
Jcache - getAndRemove method is throwing an NPE.We configured a Redisson cached based on Jcr-107. Most operations are working fine but the getAndRemove implementation is throwing a null pointer exception. When removing the key with cache.remove("key"); instead, it works fine. We could do it in two operations but it will lose the free Atomicity.Unfortunately, I'm not fluent in the LUA scripting used in order to propose a solution at the moment.Code that show the issue:
none.
Wiki is broken.Keeps redirecting me to this page.
Old/stale nodes not removed from NodesGroup.When trying to implement a healthcheck for a Redis Cluster I'm using code similar to the below to get the list of nodes and ping them to see if they're up.If I redeploy a node and it gets a new IP, the new node is returned by redisson.getNodesGroup(); but the old one remains and we get an error:If I failover a slave node then the slave node will be returned by redisson.getNodesGroup(); as a master (which is correct) but the original master will appear twice as both a master and a slave. If I then failover back to the original master, that node will be returned as a master twice and still as a slave.When digging into the code it looks like this list/map lives in MasterSlaveConnectionManager as clientEntries which only gets cleared or removed from during a shutdown.What I'd expect is for old or stale nodes to be cleared up from this list/map.
[2.11.1] Unable to re-establish MasterConnectionPool after restarting redis.We are Trying to add a mechanism to re-subscribe to topics after restarting redis.Setting UP:Steps to recreate:See Following Error, Redis MasterConnectionPool is not re-established.We were initially at Redisson version 2.9.1, but when we following the previous steps, in step 5, we encountered the same issue as in #1268, which is removeListener thread blocks forever, so make the switch to 2.11.1.We also simulate the scenario with 2.9.1 version,  without doing removeListener (we found out there is pubsub Listener leak issue with 2.9.1, that is why we remove the old listener first), the MasterConnectionPool was able to re-establish.
Slow down when Redis master switching (sentinel)Hi,We have detect an issue on our redis (sentinel) cluster when there is a redis master switching .During a performance test, we use PriorityQueue (~ 10 calls / seconds). All transaction are closed on 20-50 milli-seconds.When master switching, on JConsole we have seen Redisson place some locks on redis databases, and all application are slow down... All transaction are closed on 3-10 seconds !On our Redis cluster we have, 1 master, 5 slaves.This is our using components versions :Also, we have test, redisson 2.11.1, we have the same issue.We have issue with this config :And we have apply a fix (work around), it's better running, but it's a huge configuration (on system : lot of connection and open file issue)Can you help us please ?Thanks you.
RedLock Java ambiguous implementation.Hi,we should implement a distributed lock system for our clustered Spring Boot application.We have a Redis "cluster" (no cluster mode enabled) with Sentinel.Now, reading the documentation it seems that RedissonRedLock should be used as locks wrapper class to use lock/unlock api.It seems that RedissonRedLock should be used with different RedissonInstance e multiple RLock's.But what kind of lock should we use to implement single distributed lock with single redisson instance per-node?
Unable to connect AWS elastic Cahce over SSL in Cluster mode.I am using lib version: 3.6.2.When trying to connect AWS Elastic cache(i.e rediss) over ssl in cluster mode getting below exception:Not sure whats going wrong here, as per documents AWS manages the SSL certs so ideally this exception shouldn't have arrises.I see this was closed as part of the issue #1135 . How ever single server mode with SSL is working fine. Could you please help me on this?
Deserializing Nested RMap throws NotSerializableException.I am using org.redisson.codec.SerializationCodec and   redisson 3.6.0.I have a child Rmap inside a parent Rmap.Facing an Exception while fetching the stored Rmap.Is Rmap serializable ?How can I use a codec for fetching (get) and storing (put) Rmap from inside a parent Rmap ?
none.
RListMultimapCache removeAll method throw java.lang.ClassCastException: java.util.LinkedHashSet cannot be cast to java.util.List.
ERR Error running script (call to f_8770695dc269722cd5368a1e08ca936b4ccbb0b7): @user_script:1: user_script:1: bad argument #2 to 'unpack'.Getting error when calling readAllKeySet() operation.
Redisson Spring Elasticache Iteamcount issue.Hi,Apologize, if it's not the right forum to post my concern, kindly let me know so i will remove my post or you could redirect me right direction.we have one doubt regarding how redisson internally storing data on redis cluster (here we are using AWS elastiCache), because the actual number of items is not the same as we have stored using our cache application.as per logging it's showing proper Set and Get (the data from/to cache server) but the problem is with the actual item count (number of keys) on AWS, it's too lower tan expected,(e.g   even if we are storing 3K data the count is still showing ~20-30).we are using spring @cachable annotation on top of redisson to achive the caching , also for cluster redis environment we are using AWS elastiCache . here are more details,Spring redisson config:Thanks.
Get type of a key in Redis.Is it possible to execute the "Type" command and determine which datastructure should be used?If not could this be Implemented?
RSortedSet tries to compare wrong types.I have a sorted set of longs and try to check if a value is contained.I use the LongCodec and get the following error:I debugged it and also saw that a RedissonList is created in the constructor, but the Codec is not supplied to it. May has something to do with it...The Values in the list are typed as Integer, which they shouldn't be.
Redisson Pub/Sub Successful, But RTopic publish method return 0.hi @mrniko.redisson use sentinel configure for pub/sub successful,but RTopic publish method return 0.current use version:2.7.0,I have try use last stable version for 2.11.3,this problem still reappearing.
none.
Security Issue - Redis Password visible with TRACE log level.Hello,I have seen my redis password in the TRACE log.In general this is one of security requirements for a development: do not print any passwords in the logs.See OWASP Error Handling and Logging Best Practice 119.I suggest to obfuscate the logged body of the redis command "AUTH" in the class CommandEncoder.Thanks,
Question: Send batched messages - Get batched messages.Hey!When I send a batch with multiple .publish(msg)  commands to redis,does redis send these messages as a "batch/pipeline" back to the subscribers.in ONE network connection so that redisson handles them all at once?Regards, RoboFlax.
redisson jcache.getAll(Set<T>) causes io.netty.util.IllegalReferenceCountException: refCnt: 0.
NPE in CommandDecoder handler while using RBatch object.
Can't execute SENTINEL commands on /.redisson throw follow exception, while start app everytime.
Bug Pub/Sub: Skip result + Execute batch - RedisException: ERR Syntax error, try...I found out that when using skipResult() + execute() in combination it throws a RedisException.Exception:
Fair lock vs regular lock.Hi,Right now we are using regular lock in our system. I found out in the documentation there is also fair lock option.I am trying to find in the documentation any explanation about performance of fair lock vs regular lock.Is there any performance penalty? I mean is there a reason not so use fair lock always by default?Thanks.
how to create a custome id generator in hibernate.No description provided.
none.
two thread get  the same   RedissonMultiLock?Is my code has any problem?there are two different  thread get the same  multilock.thanks!
method putAll throws map value can't be null.
none.
IllegalStateException: availableProcessors is already set to [8], rejecting [8].Hello,i'm using embedded elasticsearch in my application with EHCache and it all works fine. Now I want to configure redisson and I get this exception during startup:Looks like redisson has already initialized a netty runtime and elasticsearch is trying to do the same so it blows with this error.
Cannot construct instance of `org.javamoney.moneta.internal.JDKCurrencyAdapter`.Hello,I have my app working perfectly fine with EHCache. Now I want to migrate my app to use redisson, however I get the following exception:
Redisson-tomcat in a multi-tenant environment Logs: ERROR io.netty.util.HashedWheelTimer - You are creating too many HashedWheelTimer instances.Hi!We are using the redisson-tomcat-8 in a Webserver containing more than a 100 apps. In the tomcat start up we get the following errors in some apps:ERROR io.netty.util.HashedWheelTimer - You are creating too many HashedWheelTimer instances. HashedWheelTimer is a shared resource that must be reused across the JVM,so that only a few.How can we reuse the HashedWheelTimer in order to avoid this error (Many customers have lost their session while browsing, but we are not sure if that is the cause of the problem).We are using Redisson 3.6.2 with redisson-tomcat-8.This is the tomcat context.xml:
DecoderException after upgrade to latest version 3.6.3.We are trying to upgrade our redisson client to latest version by using "After_request" property. However, there is an DecoderException was thrown during tomcat failover testing.Do you have any recent codec code change may link to this error? Currently we are using "SerializationCodec".
Is this a bug.
Consecutive "Subscribe timeout" for topics utilizing same AsyncSemaphore lock.Hi there,Thanks for the quick fix on the ticket #1268 . We tested it and the block on RedissonTopic.removeAllListeners no longer happened.However, we started see another issue: After a fairly long time running with the new code, subscriptions( by calling RedissonTopic.addListener) to the topics which are assigned to the same AsyncSemaphore lock from the method MasterSlaveConnectionManager.getSemaphore() are all encountering the same timeout error like "Subscribe timeout 9500ms". It's very consistent. But for other subscription calls to other topics which assigned to different AsyncSemaphore locks, everything works fine.It's possibly related to #1268. Please help advice how to tune and debug this problem.Thanks.
put  RMap or RLocalCachedMap ,return null, is not sync!!!
Redisson connected to sentinels works fine - But throws the following error.[ERROR] MSG - o.r.c.SentinelConnectionManager Can't update cluster state.Hi,I've RedissonClient connected to Redis Sentinels(Redis 4). Redis commands work fine, but throws the above error. Couldn't figure out the cause of the issue.
Java 10 support.Java 10 looks currently not supported because highMask and lowMask private methods are removed from URI class what is referenced here.
RedisTimeoutException when I register remoteservice.I run redisson by spring,and it works well,But when I register remote service,it does not work.Redis connection is ok.I do not know why.redisson version is 2.11.1.I find that it will happened when worksAmout is a big number or you register a large amount of services.
RedissonScoredSet - contains/remove method - equals and hashcode?But classes with different values (and same id) are not considered to be equal, when I use methods "contains" or "remove" in RScoredSet.Is it the desired behavior?
ERROR [io.netty.util.ResourceLeakDetector] - LEAK:When I run redisson,there are some error logs:
none.
Add Transaction API.Implement Transaction API for Bucket, Set, SetCache, Map, MapCache, LocalCachedMap objects with commit/rollback methods and READ_COMMITTED isolation level.
Spring Data integration.No description provided.
Spring Boot Starter implementation.No description provided.
RSet returned by RSetMultimap.get() does not update multimap correctly.RSets returned by get() cannot be used to populate RSetMultimap. Multimap key and size information is not managed properly despite get() returning populated sets. See this example:Here, multimap1 keyset and keysize are not initialized. Javadoc for the get() method claims:"Changes to the returned collection will update the underlying multimap, and vice versa.".
What is difference between Rmap and RLocalCachedMap.I have a DB with 100k hashmap. And I run some 10k, 100k loop test to compare time between getting by RMap and getting by RmapCached.I saw no differences in benchmark time. Am i make a wrong config or something.When I use RMapLocalCached, why redisson keep getting result from my Redis DB, I think it should get result from some local variable instead of connecting to Redis DB and get result ?I use LocalCachedMapOptions.defaults().cacheSize(0).timeToLive(100000) .evictionPolicy(LocalCachedMapOptions.EvictionPolicy.NONE) .syncStrategy(LocalCachedMapOptions.SyncStrategy.NONE) .reconnectionStrategy(LocalCachedMapOptions.ReconnectionStrategy.NONE),But when i change a value in Redis DB by redis-cli, redisson immediately get a changed value. ?Thanks.
Unhandled DecoderExceptions deplete Netty pool.Our web application is writing an object using Redisson 3.6.4 (Jackson codec) which Jackson cannot deserialise for whatever reason. On attempting to read the object, Redisson fails on the first few attempts and throws a DecoderException as expected. However, the following message is seen from Netty:Apr 06, 2018 11:54:28 AM io.netty.channel.DefaultChannelPipeline onUnhandledInboundException.After a few attempts (depending on size of Redisson connection pool), all connections are depleted. At this point Redisson is unable to execute any more commands regardless of validity.I have created a barebones test case to demonstrate the problem:You can checkout and run with ./gradle run (assuming Redis is running locally). See how the first few read attempts fail immediately, but the thrown execption changes from RedisException to RedisTimeoutException and the RedissonClient cannot execute any more commands.
[CRITICAL] Redisson cluster sync failed.In cluster mode when master goes down and slave becomes a master, Redisson picks up new master but failes to sync slaves. Cluster nodes synchronisation crashes (never scheduled again) with IllegalArgumentException while processing slave nodes.Redis cluster setup:Relevant stacktrace:Code path which fails with IllegalArgumentException (please note it's 3.0.0 branch):scheduleClusterChangeCheck(cfg, null); is never executed thus Redisson stops sync cluster state. Any subsequent cluster change leads to a service outage.
Why no RMapCacheAsync::fastReplace?I am trying to optimize my Redisson throughput, and to do so, am using the MapCache fast methods, where no result is returned for a put or remove, but there is no fastReplace.  Why so?I created my own one by subclassing RedissonMapCache and adding a method there, and that works fine.  However, now I want to use pipelining, but it will not work with the Batch classes without further modification.I do see that there is a replaceOperationAsync, which returns a Boolean, so keeps the response message to a minimum, but that is offset by essentially doubling the size of the request by including the value to be replaced, so that is less than ideal for my purposes.
RList value in a RLocalCachedMap returns RedissonReference.I have the following RLocalCachedMap defined:By the way, I'm using Spring and the Map is loaded as a Bean.Am I doing something wrong or is it a framework issue?
about getList implement.I use a redissonClient  instantce invoke getList method. when I debug into the method,I find it's just return a construct of RList with some parameters(key,executor..).Then the Rlist fullfill with data in redis server! I wanna know how it execute....I look up the source code all the afternoon ,so disappointment.I Find no answer.Please who can tell me how it work linked with the real execute method,thanks a lot ,U angle ღゝ◡╹)ノ♡.
Redis server response timeout (3000 ms)
org.redisson.client.RedisException: ERR unknown command ' EVAL '.I used master slave model on tencent cloud server.
RMI starts to lose ability to send commands.We are using Redisson 3.6.4 and publishing several hundred RMIs at a time.  After a few minutes, we start seeing these errors, and they start to build up over time, until no RMIs are being processed at all.We are on a clustered AWS Redis server.
RedissonSortedSet does not implement ZRANGE commands.RedissonSortedSet does throw an UnsupportedOperationException on a call to the headSet, tailSet and subSet methods.They could return the response of the ZRANGE or the ZRANGEBY redis commands.
throw exception when use redissonClient.getPermitExpirableSemaphore function.
none.
Frequent timeout with RedisLabs multi-proxy setup.In the latest Redislabs cluster, the user can enable multiple proxies, and the DNS query of the cluster would return different IP addresses for load balancing.From Redisson side, we observe Redisson would have very frequent timeout with DNS monitoring enabled. Seems like for each DNS lookup, if IP address changes, Redisson would try to reconnect with this new IP and lead to unstable system.Is it possible for Redisson to check the cluster health before trying to connect to the new IP address?
About select db.why Config.setDatabase can not use? how to select db in sentinel mode.
Implement Spring Transaction API.No description provided.
Redisson: Why reactive client doesn't have PermitExpirableSemaphore?Note: Asked same question here in StackOverflow, but there was no response.I am using redisson reactive Java client. In non reactive client one could get expirable Semaphore as:-.RPermitExpirableSemaphore semaphore = redisson.getPermitExpirableSemaphore("mySemaphore");But If I create a reactive client, I can only find redisson.getSemaphore("value") function. I need PermitExpirableSemaphore because:-.I need a lock, that could be released by different thread(so can't use RLock).I need a lease timeout to prevent deadlock in case the lock aquiring thread is killed or stuck.Is there any way to achieve this behavior in Redisson?I can set lease time global in Config as:- Config().setLockWatchdogTimeout(leaseTimeMs), but I really need different leasetime at different locks.
Introduce BatchOptions object.Currently Batch settings exposed as RBatch method which is not convenient and contradicts common API design.
RMI Garbage Collection in Redis.Each of the RMIs seems to be put in a namespace under {redisson_rs}  How are RMIs being garbage collected or do we need to run another process to do our own garbage collection for RMIs?We are using 3.6.5 on a Redis cluster at Amazon.What we appear to be seeing is that the RMI jobs are never purged from the DB.  Most of our RMIs are set and forget.Our code generally looks something like this:The server code.The client code.What we are seeing.The specific key/value pairs for the RMI seem to grow unbounded, until Redis runs out of memory to process more jobs.  We have been looking for someway to delete the job once it has been completed, but are not sure how to do this.
'reconnectionTimeout' setting in unavailable. Please use 'failedSlaveReconnectionInterval' setting instead!use Version 3.6.5.
PermitExpirableSemaphore to be able to make expirable permit to a normal permit.Once a permit is acquired as an expirable permit, there should be a way to remove the expiry and make it to a normal permit.
java.lang.NoSuchMethodError java/lang/CharSequence.Im using Redisson 3.6.5 and Java JDK 8.
Can't update cluster state.Hi,I am getting below error message when one for the node goes down from the cluster (3 node master/slave cluster).  version of redisson (2.7.4).Above message is keeps on coming. And on subsequent call to redisson leads to below exception.Thanks.Vikram.
ClassCastException with StringCodec while testing non sticky session on Tomcat.I am getting this error on Tomcat 7 and JDK7:Can anyone point out what was the issue?
setDatabase is no use.but no use.when getKeys ,it return all keys ,but not the key of one db.
java.lang.IllegalStateException: Redisson is not in cluster mode!I am trying to connection AWS elasticache with redisson, but get this error.And here is my code used to create redisson client:I am using 3.6.5 redisson library.
NullPointerException for RLiveObjectService.delete?if there is not a model class exist for "key", it will throw a NullPointerException?here may return null.
Request org.redisson.client.RedisTimeoutException during high load.Hello,I'm using redisson v3.6.5 with Redis 4. I have 3 masters and 3 slaves nodes for 5 tomcat clusters. However during high load, my team experienced a lot of org.redisson.client.RedisTimeoutException exceptions such as below:Could you please point me to the direction, as I'm lost with these issues here?Thank you.Kevin.
none.
none.
Add async methods to RLiveObjectService interface.No description provided.
getKeysByPattern is returning less number of keys in version 3.6.1.Hi,We were using redisson version 3.5.2 and getKeysByPattern was returning all the keys matched for a particular pattern. When we upgraded to 3.6.1, the method seems to be broken and returning less number of keys than the keys actual present in redis.
Publish a request id in a redis event.This is a feature request.It's not always easy to associate a redis event with a specific request, e.g., when you don't know whether a put would result in a CREATED or UPDATED event.  It would be nice in a request to optionally provide a request id, which would then included in the published redis event to help with this problem.thanks, Mitchell.
ConcurrentModificationException - Pub/Sub using SerializationCodec, redisson 3.6.5.I have noticed occasional ConcurrentModificationException while using RedissonTopic.publishAsync. We are using it in multi threaded context, but I think this method is supposed to be thread-safe, right?Stack trace:We have noticed this error after upgrading from redisson 3.6.1 to 3.6.5.This is using Redis server in sentinel mode with one master and one slave. Redis info:This issue occurs rarely, under moderate load 50 - 100 messages/s.Could you please check what might be the cause of this, and is there any work-around available.Thank you!
Netty 4.1.23 regression.We notice that netty version used in the latest redisson version is not stable.take a look at.
Why RBitSet.set(...) does not return anything?Return value.Integer reply: the original bit value stored at offset.But RBitSet.set(...) methods are of type void despite their async counterparts having return type of RFuture<Boolean>.
TimeoutException.How to solve this problem?
Exception in thread "main" org.redisson.client.RedisException: ERR unknown command eval. channel.if you have this error ,check your redis server  version,  and confirm   eval command  open.
Tomcat Session replication inconsistences.Hi,I have a tomcat cluster with 2 servers, both having the Redisson Session manager for non-sticky session replication. Whenever a request is served for the first time by a server, a new session is created with session attributes. Next time if the second server receives a request with same session id, it should create a session in memory and fetch the attributes from Redis. Sometimes it does fetch all the attributes and sometimes it does not. This random behaviour is really getting annoying.I've tried to use REDIS as the read mode instead of MEMORY. But the application gave me some problems(IllegalMonitorStateException). That's why I was not able to test it.After looking at the code, I've seen one problem. If we are using the MEMORY read mode and all instances have the same session with all the attributes; whenever an instance updates an attribute it will be persisted on Redis but the other instances won't check this update if they already have a value stored in memory for that session. This is obviously discouraging.I am wrong about my findings? And how can I solve my problem?Thanks in advance.
setPingConnectionInterval for replicated servers configuration is not propagated to underlying MasterSlaveServersConfig.Hey,When I set setPingConnectionInterval in the replicated servers configuration it's not propagated to underlying master slave configuration:My current understand that ReplicatedServersConfig is used to create MasterSlaveServersConfiguration In the MasterSlaveConnectionManager in.In this method setPingConnectionInterval is not copied and default value is used in MasterSlaveServersConfiguration.
RedissonBoundedQueue expiration seems odd.Could someone help me to understand how expiration works with queue.I found several expire method seems like they working fine, but after expiration it needs to initiate queue with trySetCapacity because it is not possible to add element there.Also i found that expire works not per element, it sets for whole queue which i also don't understand, so there could be some strange things if i will set expire for 10 seconds and after will try to set for 20 seconds,  every element will be expired after 20 seconds.I don't say that is a bug i just want to get proper information about expiration in queues.Thanks for every answers.
HOW TO GET REDIS TIME  IN REDISSION?How to get redis server time in redission?
throw exception when use RPermitExpirableSemaphore.tryAcquire.use Version 3.6.5.
AWS ElastiCache ClusterServersConfig DNS rediscovery failure.We are connecting to AWS ElastiCache - Redis cluster using a Route53 DNS endpoint with Redisson v3.6.5.When we change the cluster in the Route53 corresponding lookup change is not happening in Redisson. It is still looking up the old cluster nodes.Netty libraries used are as follows.
Can Redisson KryoCodec default support 0-arg constructor object.As the immutable object is wildly used nowadays can redisson's KryoCodec supports it by default.when get the kryo instance from the pool using following code Objenesis helps do the trick.related issue.
none.
SSL connection to Azure redis failed.I caught Certificate Exception same as #1296,The issue is that "allAddrs" size equals to 1.Can you explain the condition?the cluster contains 6 nodes (3 masters,  3 slaves),all of them have static IP address and a unique port.for example:
sentinel switch-master no work.Hi,I have a Redis setup with 2 nodes (master, slave) and 1 sentinels .redis version is windows 3.2.100 .redisson version is 3.6.5.When master is failover,redisson can not failover to new master automatic.my code:Is that my code's error or redission's bug?I find out the reason.In SentinelConnectionManager's Constructor, loop all sentinelAddress using SENTINELS command to find all sentinels. If there is only one sentinel, List<Map<String, String>> sentinelSentinels = connection.sync(StringCodec.INSTANCE, RedisCommands.SENTINEL_SENTINELS, cfg.getMasterName()); ,the code result will be empty.
Feature request - I would like the ability to specify redis channel name.Currently, when subscribing an application to redis events, via adding a listener, there's no easy way to specify a channel name.  The problem with this is that in a clustered environment, where each member of the cluster is responsible for updating the same redis keys, e.g., session keys, then all members of the cluster will receive all notifications for all the updates, even if they are only interested in the updates that they made.One way to get around this is to specify a unique channel name for each member of the cluster, resulting in only being notified of the updates that it is responsible for.I have been able to achieve this by subclassing the Redisson class, in my case the RedissonMapCache, and overloading the channel naming methods.  I've demonstrated that this works.  One problem with this is that without additional modifications or extensions to Redisson, it won't work with batching.  Ideally, if one could provide a mechanism for modifying the channel name, that would be great.thanks, Mitchell.
java.lang.NoClassDefFoundError: org/redisson/RedissonLock.use Version 3.6.5.
Spring cache not expired properly.Spring Cache should expire with given TTL making it footprint stay at the same level.Spring Cache footprint constantly grows.Steps to reproduce or test case.The Spring Cache data items seem not to be evicted by Redisson if other keys in the same hash are accessed before in periods lower than Spring Cache expiration time, even if this access is performed for different data items.E.g. imagine a case where there is a Spring Cache region named "test-cache" with TTL of 5 minutes.That leads to a problem of uncontrollable cache grows, as the cache is almost 100% guaranteed to be accessed in the period if individual item's TTL (see screenshot):You can see non-expiring Spring Cache in the following redis-cli output (it is production instance output, so no "test-cache" there, but check "ContentService.findAllByContentGroupOrdered" instead that has grown to 27256 members - should be around 100 in a normal case):Sampled 33 keys in the keyspace!
none.
ClassCastException when receiving messages of different types.Hello,I need to be able to publish different types of messages through a single channel.I try to explain my senario with an example.App X publishes messages of type String and Integer to one channel.App 1 catches the Integer objects and App 2 only wants the Strings from the channel.Thanks for helping me...
can use netty3.
Cannot Read Avro encoded Object from Redis after changing Java Class.I don't know if that's the way it works, but I was expecting that I'm able to add a new field to a class, and the deserialization from Redis would be Backward compatible with the "old" schema for the class.The  is that the Read operation from Redis (RBucket) explodes, with all kind of deserialization/parsing errors, depending on the type of the new field. But it breaks always.Steps to reproduce or test case.I just created a simple Java Class. Then I initialize the codec for my redisson client in this way:and I'm able to write and read my object instances from Redis. But After I add a new attribute to my Java Class, then I'm not able to read my saved objects anymore. If I remove the field, then everything starts working again.singleServerconfig.
Invalidated session in one tomcat is still used in another tomcat instance when relogin.Hello,I am using redisson tomcat session manager in docker environment. I have 2 tomcat containers and want to share the sessions with redis. I can see the sessions information are stored and retrieved on redis.However, I have an issue that an invalidated session is used because the invalidation is done in another tomcat. The steps that I've done is:Login request goes to tomcat1 and a session is created.Any request after login (e.g. query) goes to tomcat2. The same session is used, and it works fine.Logout request goes to tomcat1 and the session is invalidated.Try to re-login and the request goes to tomcat2 and it gets a session.The problem occurs here. When a request done after re-login, it goes to tomcat1, but the session is not there, and my application throws an error.I have debugged through the code and I found that:When the first login request is done in tomcat1, the getSession method is called and findSession method will not find any sessions, therefore a new session is created in the memory of tomcat1 and stored to redis.When a request (e.g. query) goes to tomcat2, the findSession method will look into the tomcat2 memory first, and if it could not find it, it will find the session info in redis, and then create a new session object in the tomcat2 memory and put the session information from redis into it. (Correct me if I'm wrong)When logout, it goes to tomcat1, the session is invalidated, it is removed from the tomcat1 memory and also the session info is removed from the redis. This means the session in tomcat2 memory is never removed at this point. (Again, correct me if I'm wrong)Therefore when re-login request goes to tomcat2, because findSession method will get the session from the memory first, and the client still has the same session id, it will get the session from tomcat2 memory which has already been invalidated in tomcat1 and used it in the request without updating to redis.Finally after re-logged in, when trying to make a request and it goes to tomcat1, the session does not exist because the findSession could not find the session neither in tomcat1 memory nor the redis. Therefore the application will throw an error because it checks first if the session exists before making a query request.My question is what behaviour do you expect in this case? Is the findSession method already working as expected?Or do I miss something in my application? (e.g. do I have to always check the "session:isValid" should be true everytime I do login? (because it's not described in the documentation usage guide))Thanks.Regards,Ricky.
Concurrent calls to RemoteService should not result in an exception.Concurrent calls to RemoteService should not result in an exception.Concurrent calls to RemoteService should result in an exception.Steps to reproduce or test case.Redis version.4.0.9.Redisson version.3.6.5.Redisson configuration.
RedisTimeoutException in RBlockingDeque.Hello.When I try to get a result from a blocking deque, I get RedisTimeoutException.I expect that after 1 second I will get null value.Redis version.3.2.100.Redisson version.
Incorrect results from RBitSet.setAsync.I believe the issue is in RedisCommands SETBIT_TRUE and SETBIT_FALSE that use BitSetReplayConvertor that, by the look of it, is implemented to return true if Redis sends back the same value as was passed to SETBIT. Meanwhile the docs say:Return value.Integer reply: the original bit value stored at offset.So the implementation should be something like:In fact, you dont event need two different RedisCommands.
Can I use RScript to run a lua script which inserts data into RMapCache?It's not a bug, just don't know how to do that and googled for nothing.I can use RScript to insert data into RMap, but as I observed RMapCache entry's value is prefixed by ttl and max idle time. Can I generate that prefix by hand and then concatenate the generated value and the real value in lua script?
none.
where can I find more example/quick start/demo ? the quick start on github too short...where can I find more example/quick start/demo ? the quick start on github too short...I want more example/quick start/demo to replace Jedis...
NoClassDefFoundError when using FstCodec.I'm using redisson tomcat session manager 3.7.0, and tried to set codec with FstCodec, but got error during tomcat startup. Did I miss anything? :
org.redisson.client.RedisTimeoutException.
RedissonListReactive don't implement readAll and there is no method that uses LRANGE.Get all the elements from a list at once using the reactive API (a method that uses LRANGE)I have to use RList to get all the elements at once or the iterator from the RedissonListReactive but that last one take ages.Steps to reproduce or test case.Redis version.Redisson version.3.7.0.Redisson configuration.
RLocalCachedMap memory leak when using EvictionPolicy.WEAK.Weak references should be cleared.It seems that even when using static Strings for keys and values and only fastPut method the OOM error occurs after several thousands of invocations.Steps to reproduce or test case.I have created a separate repo to easier reproduce the problem:Redis version.4.0.9.Redisson version.3.7.0.
How do I get redis server nanoTime?redis cmd time return.but redisson time() method only return.I want to get  1)+ 2)  ,please help me.Thank you.
Why RTransaction do not have getBuckets method?RTransaction should be same to RedissonClient, have the method:getBuckets , return batch result.Steps to reproduce or test case.Redis version.Redisson version.3.7.0.Redisson configuration.
RedissonRedLock algrithm improvement.Imagine you have 5 masters, when a client has managed to acquire 3 locks, based on the RedLock algorithm it is deemed to be a winner, hence he can carries on the logic after the lock, however when a network partition happened, he lost one lock. Other clients will then able to acquire a majority.By making failedLocksLimit configurable, the decision on how much risk he is willing to take to use the lock is on the user himself. In some cases he may want N/2 + 2 or +3 etc., to be a valid minimum requirement.
ElasticCache clusterserverconfig - TTL is not working as expected.i am using clusterServersConfig for my ElasticCache Redis Cluster, with redisson 3.2.0. Cluster has 1 shard with 2 nodes.The cache is not expiring after 1sec as expected. Also calling CacheEvict explicitly doesn't clear the cache.Anything missing in config here?Cache config is as below mentioned.maxIdleTime: 1000.
Redisson in cluster environment cannot use the same node when iterating a set.When I try to iterate a set collection in the cluster environment, I'm getting some odd result: some entries are missing. So I've checked the below issues:  #277 and #230.I have 9 Redis nodes. 3 master nodes, which each one has two replication node. So the Redisson can execute sscan command from alternative two slave nodes.I turn on the debug logging, I notice that Redisson has changed connection during each command execution with default load balance strategy.detail logs like this:So I simply trace the source code,In the class BaseIterator, it could store the current query connection correctly with a field.protected RedisClient client;Then, it passes the client info to the function async of the class CommandAsyncService , which the parameter source contains it.The most disturbing part is this:When trying to get a connection from MasterSlaveConnectionManager connectionReadOp, it will not consist with the previous client connection, but to get a new slave connection according to the master-slave entry. So this will get a different connection than the last.like this:At last, here is briefly my test code.Hope to make sense, thanks~.
Some scheduled jobs not getting executed.In my code I am scheduling 50000 jobs but only 49999 jobs are being executed when I set workers of executor service to 3, however when I set workers of executor service to 2 all the 50000 jobs are getting executed.When I schedule 10000 jobs and set worker to 4 all the jobs are getting executed but when I set it to 5, 2 jobs are being skipped.Why some jobs are not being executed?Anyone help me in understanding this behaviour of Redisson, I am not able to debug this.Redis version.4.0.9.Redisson version.3.7.0.
Default value of `threads` in Config.I was viewing the documentation of Config class and I found the above line, can anyone explain what is the meaning of current_processors_amount.
Viewing scheduled jobs in Redisson.I am using scheduled redisson as a scheduler, after I have scheduled the jobs how can I view all the scheduled jobs and status of the jobs that have already got executed.Also I wanted to view total executor services currently present.Redis version.4.0.9.Redisson version.3.7.0.
Job distribution among several RedissonNodes.In case when there are multiple RedissonNodes how the jobs get distributed among them and is it possible that jobs can get executed by both Redisson Nodes (Duplicate execution of scheduled job)
Extend RScoredSortedSet object to support Redis 5.0 commands.ZPOPMIN, ZPOPMAX commands already implemented by pollFirst and pollLast commands.BZPOPMIN, BZPOPMAX.
Redissonnode VS ExecutorService worker.How running multiple redissnnodes differ from running more workers on a single redisson node?How to view all the RedissonNodes?
ClassNotFoundException on Classes under WEB-INF/lib.We upgraded Redisson tomcat session manager from 3.6.3 to 3.7.0, and got ClassNotFoundException on classes under WEB-INF/lib. After reverted back to 3.6.3, error was gone. We are using SerializationCodec and are under java 8 / tomcat 7.
setPingConnectionInterval for single server configuration is not propagated to underlying MasterSlaveServersConfig.Setting the pingConnectionInterval on a single server config should enable periodic ping on connections.No pings take place.  Similar to #1415, this appears to be due to SingleConnectionManager.create not copying the configured value to the MasterSlaveServersConfig.Steps to reproduce or test case.Redis version.
How does executor service gets associated with RedissonNode?Anyone please clarifying the following details :redisson.getExecutorService("w1"); This line in the above code creates a new instance of ExecutorService as described in the configuration but this instance of ExecutorService is not linked to any RedissonNode still the job is being executed. Is the executor service instance described in the configuration shared by all the  RedissonNodes or each RedissonNode will have the different isolated instance of ExecutorService?Does the same executor service instance which is used to schedule the job will also execute the job or job will be executed irrespective of the executor service instance through which it was scheduled.Redis version.4.0.9.Redisson version.3.7.0.
Unable to create RedissonClient.Sometimes get an error during check if Redis is connected: getObject().get().getNodesGroup().pingAll()
ReadWriteLock timeout does not work as expected.I wrote a simple test to check the ReadWriteLock.The behaviour.First case: Read thread finishes executing properly, write thread hangs forever.Second case: Behaves as expected. Read thread locks, sleeps and unlocks. Write thread hangs until the read thread finishes and then locks and finishes.What I see in redis in both cases at the beginning:What I see in redis in both cases after some time:The rwlock_timeout entries expire in both cases, it seems like no one is updating their timeout in redis.In the first case, where the readThread finished running but the lock1 entry never expires and is stuck forever like this:What I expected.In the first case when the read thread finished running I'd expect the read locks to expire after some time and unlock the lock1 entry.In the second case I'd expect the rwlock_timeout entries not to expire since the read thread is alive, it sleeps but it is alive.
CommandAsyncService gets blocked at high concurrency [without OutOfMemoryError].Hi,While running a load test on jmeter of 200 users with ramp up time of 10 seconds and number of puts per user equal to 10, threads are getting  stuck. In this test we are using RTransaction and doing load testing on a single key by putting random values for a single key.here is the stack trace:Steps to reproduce or test case.
Why RedissonTransactionManager do not support Suspend Transaction?RedissonTransactionManager  do not rewrite.protected Object doSuspend(Object transaction) throws TransactionException.method.
Error while using RedissonSessionManager at tomcat(java.io.IOException: java.lang.ClassNotFoundException: org.springframework.webflow.conversation.impl.ConversationContainer)I am seeing below error while using RedissonSessionManager with tomcat. I have followed the default configuration that was provided at.Configuration is working fine in multi node environment with session replication at redis, but for every request I am seeing this error. Can you one please help on this.
none.
redis session count more than visitor count.i used redisson in tomcat8 to mange session.and i have a problem that: site real visitor count only 100,but redis save session count is 1700.i don't understand the reason.
redssion shiro jackson problem.hi:i have a problem when i use redssion manager session and shiro save data.problem description is under:if i want to change the jackson,how i can do?
Subscribe timeout.No exceptions.Why is I keep getting these subscribe timeouts? After restarting service it works allright for, like, 24 hours, then I get a lot of subscribe errors. I have a pretty big connection pool, so I don't see why I keep getting it.I mostly receive this error with RLock, which I use to synchronize. Should I tune my configuration somehow?
RedissonLocalCachedMap can not init with NullPointerException.RedissonLocalCachedMap can not init with NullPointerException when ReconnectionStrategy is ReconnectionStrategy.LOAD.I think the LocalCacheListener is null ;The line 160 in source code org.redisson.RedissonLocalCachedMap.java ,listener is null because it create in line 164;Redis version 4.0.Redisson version 3.7.1.
Redisson executing previous jobs on the schedule of newly submitted jobs.I previously scheduled 5 jobs (old jobs) they executed successfully. After that I scheduled another 5 jobs(new job) but this time the previous 5 jobs got executed on the schedule I gave for new job. Can anyone explain me this behaviour of redisson and point where I am making the mistake.For this experiment I runned 4 redissonnodes in standalone mode with configuration as described below.
How does redisson balances load among several RedissonNodes while scheduling jobs.No description provided.
Redisson API to get the number of subscribers subscribed to a particular channel.Redisson API to get the number of subscribers subscribed to a particular channel.PUBSUB numsub test.How can we get the number of subscribers subscribed to a particular topic in redis as it was possible using the above command.
Redisson CROSSSLOT Keys in request don't hash to the same slot. channel.I scheduled some jobs first then I run one RedissonNode in standalone mode. and I got this error.I have used the below code for scheduling the jobs.Previously it was working fine but I have suddenly started getting this issue.I am running 3 node redis cluster, with one replica.redis version 4.0.9.redisson version 3.7.0.
Implement PUBSUB CHANNELS, PUBSUB NUMSUB and PUBSUB NUMPAT commands.As requested in #1470 by @Himanshu4.
Error while using RedissonSessionManager at tomcat(java.io.IOException: java.lang.ClassNotFoundException: org.springframework.webflow.conversation.impl.ConversationContainer)I am seeing below error while using RedissonSessionManager with tomcat. I have followed the default configuration that was provided at https.Configuration is working fine in multi node environment with session replication at redis, but for every request I am seeing this error. Can you one please help on this.
Invert ZPOP score/element order.Score/element order has been changed around in RC2. See: redis/redis@0a698e4.
RSet can not guarantee element unique.TestBean is.
NullPointerException when using setPingConnectionInterval in Pub/Sub mode.setPingConnectionInterval should ping redis Pub/Sub channel periodically and re-subscribe if pong is not received during specified interval. No exceptions should be thrown or logged by sending PING or receiving PONG messages.There is NullPointerException thrown and logged as error when pong is received.Not sure if connection check and recovery would even work in this case.This is copy/paste from our error log:This is also logged as WARN by redisson, related to the same event:Steps to reproduce or test case.
RedissonScoredSortedSet uses wrong codec for some score methods.The codec specified in the constructor should be used only for values, not for scores.Redis commands : RedisCommands.ZSCORE and RedisCommands.ZSCORE_CONTAINS.Codec for scores sometimes uses LongCodec sometimes uses "codec". For backward data compatibility should always use LongCodec when accessing scores.Steps to reproduce or test case.Create a ScoredSortedSet with non default codec and use getScoreAsync / containsAsync methods.Used to work fine with Redisson Version 3.5.7, when upgraded to 3.7.1 ScoredSortedSet stopped working. Codec.Works fine with this change:
Delete/modify scheduled jobs in redisson.How can I get control over already scheduled jobs in redisson and do operation such as delete/modify on them.
Implement RBatch commands queueing on Redis side.Current implementation of RBatch object accumulates all method invocations in memory on Redisson side before send them to Redis. This approach may lead to OOM exception if accumulated batch is too big.Introduce executionMode setting to allow accumulation of all method invocations on Redis side.
Redis INFO call stopped working after 3.7.1 release.Call Redis INFO on a given node in a cluster and it should return a blob of info for that given node.When the redisson client is preparing to send the redis INFO call, client2key returns null for the given redisClient which only happened to me during INFO calls, not any writes or reads. This is the commit that I believe caused this behavior. fe98d0a#diff-bb90b8f5c06abce59014861b02cecd93.It seems the issue is the hashcodes are different only when making the INFO call (That i know of) because the channels value changes.So when doing the get for client2key, it gets nothing. For Writes and reads that i tried, the hashcodes for the clients are the same.Steps to reproduce or test case.Spin up any redis cluster and simply call .info() on a node in the .getNodesGroup()Redisson configuration.default redis cluster config with 7 nodes in the cluster. 3 Master and 4 Slave.
Cluster Mode: Master fails over to slave, when slave fails over again redisson client retains connection to previous dead node.Redisson is able to send read and write commands to the 2nd newly elected Master.This is the topology:When testing various failover situations, I ran into a situation which causes the redisson client to get stuck using a bad connection when making the write calls, however the thread that is polling for the topology is fine. The situation is the redis process dies on a Master node I am writing to, a slave is then promoted to master. The redisson client is still in a GOOD state. The redis process dies on the new Master, a floating slave is then promoted to Master. At this point, the redisson client is now STUCK using a bad connection to a dead master.Steps to reproduce or test case.Run 7 node cluster, I believe this is the minimum to reproduce this as you need an extra floating slave to promote after the first Master/Slave pair dies. For Master 1 slots 0-5460 (M1), kill the redis process. This should cause it's slave (S1) to promote to master and the floating slave (FS2) to attach to this new master. Then repeat kill the redis process on S1 which was promoted to master and FS1 should be promoted to master. The redisson client will now fail reads/writes because the redisson client connections are to the old S1 node despite FS1 now being the new master but does not fail to poll for CLUSTER NODES because I believe it is using a separate connection pool/thread to do that.Redis version.3.2.11.Redisson version.3.7.0.
none.
RedissonLocalCachedMap - "readAll*()" and "values()" methods could read from local cache only?The performance benefit of using RedissonLocalCachedMap over RedissonMap is negligible when getting all data from the map via readAllKeySet*(), readAllValues*(), readAllEntrySet*() and values(). The readAll*() methods still gets data from server, values() method is not overriden in RedissonLocalCachedMap.Would it be possible to read data only from the local cache in these cases?
do as the redisson3.7.1 RRateLimiter wiki,but it does not work!
tryLock waitTime no valid.hello, I have test the tryLock with waitTime, but find it has bug. My test is as follows:As you can see, the second thread faild to acquire lock but the lock is released during 2 seconds...please tell me ,thanks.
Occasional  ERROR:Search domain query failed.
jvm create to many HashMap Nodes cause many YGC.question.java project springboot+redission only, RedisCluster scanInterval 1000ms,jvm create too many HashMap.Node, cause YGC quickly, I see ClusterConnectionManager.java source.Steps to reproduce or test case.RedissonClient redisson = Redisson.create(config);
How to provide timezone with schedule in job?How can I provide timezone in scheduled tasks according to which tasks should be executed.
Warn:"Invocation of destroy method 'close' failed on bean with name 'jCacheCacheManager'".I imported Redission in spring boot using distributedLock,but the log always show this WARN.
Add Redis Streams support.New feature of upcoming Redis 5.0.
Redisson not executing jobs requiring external dependencies?I have one RunnableTask which makes a HTTP request and hence needs a dependency of HTTP client. This job looks like this.Now I am scheduling some jobs using this code.After this I launched a RedissonNode in standalone mode. Now when the time for the execution of this jobs come, I am getting following error.Anyone please explain why this is happening and resolution for this issue.
Add CL.THROTTLE command for Redisson Client.I'm using the Redis Cell module for keeping track of rate limits on certain keys. Unfortunately with Redisson this means I have to use the low level client for now but it would be nice to include a method for the CL.THROTTLE command used in Redis Cell module with the high level client.This is not related to RRateLimiter which to my understanding is for throttling calls to Redis itself.Redis Cell.
Acquire Methods in RedissonRateLimiter Are Not Functional.Issue since Redisson 3.7.1.Line 125 of RedissonRateLimiter.java throws a null pointer exception when the time unit  parameter is null. When you call the acquire methods it passes a null for that parameter. Basic unit tests for the acquire method would have caught this.
Jobs scheduled with cron expression not running.I have used two methods to schedule the jobs. In method-1 I have used line-1 to schedule the job and in method-2 I have used line-2 to schedule the job. The problem I am facing is that method-1 is working fine but when I comment the line-1 and use method-2 instead the jobs doesn't get executed and I get the error as described below.@jackygurui @mrniko kindly look into this.I am using redisson 3.7.2 in standalone mode and redis 4.0.9.
Avoiding serialization/deserialization of a class.When I am sure that I will be definitely having a class already loaded in memory, is there any way to avoid serialization and deserialization of whole class.
Redisson Class loading.As per my understanding, Redisson serializes the class at the time of scheduling the job and deserializes it at the time of execution of the job. If the class is already in memory at the time of execution of the job  then what does redisson do.Kindly explain me this in details and also correct me if my understanding is not correct.
Missing PubSub messages when using connection ping.setPingConnectionInterval should send periodic ping messages and keep channels alive, but this must not affect any other type of messages on channels.When using setPingConnectionInterval some messages will not be delivered to listeners after being published. I have a test code which can reliably reproduce this issue:Output of this code will produce varying results each time, but it will never get all sent messages, like this:However if connectionPingInterval is set to 0 (disabled) issue is completely eliminated, like this:
none.
How to specify start time and end time for expression?@mrniko @jackygurui.If I want to schedule a job with certain cron expression, how do I specify that job should only run between some start and end time, whenever its execution according to the cron occurs. Like it is provided in quartz.@mrniko.I also feel there should be support for cron expression with delay as well.
How to execute some code after execution of job, something like post listeners?How can I perform some task after execution of some job?
Is there a way to set ExpiryPolicy at cache entrylevel for redis jcache implementation instead of setting at the cache level?Steps to reproduce or test case.
How to inject taskId in runnable?Since I get taskId after scheduling the task, how can I provide taskId to the RunnableTask, so that I can have taskId during execution of task.
How to schedule one time jobs in Redisson?How to schedule a task that would run at particular time, currently I tried to do this with cron expression but it is giving error as described here.
Redisson redlock performance with azure redis cache.Hi I have a distributed application that servers user requests. I want to implement distributed locking to synchronize access to user's data if multiple requests for the same user come in.I'm using redisson with azure redis cache in cluster mode with 3 masters, 3 slaves for this purpose. My incoming request rate is 700/s, with total request processing times ~30-40ms. I've set the redisson cluster config as below (pool size=320, lock_wait_time=3000ms, lock_expiry_time=3000ms). However, I notice that in spite of tuning the connection pool size from 250-700, a small portion of requests fail while waiting to acquire the lock.Questions:Is my usage of redisson redlock below correct?Any recommendations on how I can tune the config to resolve the "failed to acquire lock" errors?
In MapCache, idle timeout is not refreshed upon replace.When using redisson MapCache expiration I would like a replace to refresh the idleTimeout, so that a field does not expire as long as it is replaced within the idleTimeout period.  Note that replace returns the old value, so strictly speaking the value is accessed.Fields are expired after idleTimeout regardless of whether their values are replaced or not.Steps to reproduce or test case.a test added to RedissonMapCacheTest, I would like it to pass:
Too many open file handles with Redisson 3.7.0.Redisson 3.7.0 shouldn't leak file handles.After upgrading from Redisson 3.5.5 to Redisson 3.7.0 With Elasticache cluster I noticed file handles are left open and within an hour all the handles are exhausted causing AWS ECS to terminate the service instance. The issue goes away once I revert back to 3.5.5.Steps to reproduce or test case.Use Redisson 3.7.0 with AWS ElasticCache Cluster.ElasticCache cluster. Following is the Spring code to configure redisson with cluster:I've configured pool size at 20 and minimum pool size at 5. Scan interval is set at 2000 milliseconds.
Exception in thread "main" java.lang.NoSuchFieldException: No such field:
Do redisson store classes by creating extra keys or serialize and store in one key only?
getClusterNodesGroup().pingAll() vs getNodesGroup().pingAll()Is it any difference between this checks? I use getNodesGroup().pingAll() for pinging nodes with cluster config as well. Is it correct way or should I change check on getClusterNodesGroup().pingAll()?
"URGENT"java.lang.ClassCastException:(while returning objects in nested class) Redisson gives the feature of nested object?I am getting "java.lang.ClassCastException: org.redisson.RedissonMap cannot be cast to src.ClientProfile" error. can someone tell me why?(client profile also have 2 classes inside it).
Mitigating Concurrency Issues.Hi,I was wondering what the standard approach is to Mitigate possible Concurrency issues when using Redisson as a spring data source.I am working on an application that gets information from a source application and then layers updated over the top before delivering the updated information to the client.The updates in this case are built for several sources, each one has its own queue.When a new message is placed on any given queue my app reads the message from the queue, and attempts to create or update an updateObject in my redis cache.My problem stems form the fact that messages are constantly being placed on these queues and updates to the updateObject are likely to come in quick succession.Im concerned that this will lead to concurrent read write issues:I have attempted to solve this using @transactional and the RedissonTransactionManager but it doesn't seem to be halting the second messages update while the first message is still updating.Any advice would be really appreciated,Thank you.
none.
Not able to build redisson locally.While building the redisson locally, I am getting the following error:In stable release version I can see 2.12.2 and 3.7.2, I am using 3.7.2 what is the purpose of other release 2.12.2, what is the difference between both.
RMap.readAllValues() returns Number as string.When we use addAndGetAsync the value of key is incremented or decremented.RMap.readAllValues() should return values as 0-> 1, 1- >2 but instead returns values in the form og.0->"0", 1->"2" where the Number class is a string value.Iterating through this collection causes a class cast exception.
Support for endTime in scheduleWithFixedDelay() method?Currently when we schedule the job with scheduleWithFixedDelay() method, it takes only initial delay and delay. But if I do this then this will keep running the job forever. I think there should be version of scheduleWithFixedDelay() method which supports endTime as well.
CustomObjectInputStream doesnt work for proxied classes.Classloader passed into CustomObjectInputStream is not used to load proxied classes.In my case redisson cant deserialize org.springframework.security.oauth2.client.token.AccessTokenRequest class.Following exception is thrown during class loading:Caused by: java.lang.ClassNotFoundException: org.springframework.security.oauth2.client.token.AccessTokenRequest.Steps to reproduce or test case.Redisson configuration.
Add iterator with batch size param to all collections.No description provided.
none.
Feature Request: Locally cached MultiMaps.Hi,I was working with multimaps and wondered, while they have a cache variant, why don't they have a locally cached variant?If nothing speaks against it, could one be added?
Using Redis Transaction MULTI crashes in java.lang.NumberFormatException: For input string: "QUEUED".Steps to reproduce or test case.
none.
RedissonRateLimiter acquire() method blocks forever.The acquire method should block until a permit is available, but it blocks indefinitely instead of the remaining time until a new permit becomes available. From my testing I have found that it doesn't acquire a permit when one should be available based on the rate and interval I tested. If I set the rate to 1 every 5 seconds, it should take a loop of 10 single permit acquires approximately 50 seconds to complete. Instead it acquires the first permit, then blocks forever on the next acquires call.
none.
Live Object service meet NullPointerException when new field add to old RLO.add new field to RLO, use get method will get default value.
RSemaphore example ends up in "Unable to decode data".
Redisson Not able to serialize and deserialize external objects?I am running Redisson Nodes in standalone mode, at the time of execution of this job, I am getting following error.How can I inject such dependencies in redisson, I think this use case is quite natural, and should be definitely be accommodated.
Add DUMP and RESTORE commands support.No description provided.
none.
why 'readonly' command is going to master everytime i send read operation at ReadMode.Master_Slave.'readonly' command should not go to master everytime i send read operation.'readonly' command is going to master or slave only onetime at first when making connection.'readonly' command is going to master everytime when i send read operation.because of added 'readonly' command, master is not distributed throughput.Steps to reproduce or test case.make Redissonclient with ReadMode.MasterSlave.send read operation.redissonClient.eval(Mode.ReadOnly, "return redis.call('get', 'something')"...actually, read operation is distributed propery, but master node get plus 'readonly' command. even though 'readonly' comman is not working at master node and not affecting anything functionally.however this is big problem which increase throughput and cpu utilization on master node. finally, it is same as not distributed.
Lot of connections remain in TIME_WAIT state after Redisson shutdown.No description provided.
will there be React native support?No description provided.
severe bug !! when sending read operation to new slave loading previous data after failover.Steps to reproduce or test case.on each servlet request, i send read command like below to redis, in this case, it is problem.result = redissonClient.getScript().eval(Mode.READ_ONLY, script, RScript.ReturnType.VALUE), keyList, argvList.toArray());on each servlet request, i send read or write command like below to redis,  in this case, it is ok.result = redissonClient.getScript().eval(Mode.READ_WRITE, script, RScript.ReturnType.VALUE), keyList, argvList.toArray());send read operation each reqeuest on servlet server continusly.slave is loading data for syncing with master. it takes 10 minutes to load all data completely.during 10 minutes, servlet server is going strange behavior and throuput is very lower and don't return any exception. i think some threads is hanging around Redisson connection with new slave loading data.actually i expected returning error with timeout. why it is not returning any error until slave is completed loading data.after 10 minutes which completed load data from slave. it is going back to normal and throuput become higer.however, read operation with Mode.ReadOnly is going both master and slave not going to slave only.when loading data at slave, redisson is sending read operation to slave. and read opeartion thread is hanging aroud somewhere in redisson.read operation with Mode.ReadOnly is going well to slave only. however after failover, read operation is going both master and slave not going to slave only.
HyperLogLog.addAll adds only one element.No description provided.
Scheduled task not working.I want to create a simple scheduled task with redisson & kotlin.I get an exception everytime.Steps to reproduce or test case.
org.redisson.RedissonShutdownException: Redisson is shutdown.
aliyun redis not support.when i use redissonClient.getMapCache,put any key. get error :ERR bad lua script for redis cluster, all the keys that the script uses should be passed using the KEYS array, and KEYS should not be in expression. only in aliyun redis.aliyun redis must uses KEYS array in lua. Can you give me some suggestions?Steps to reproduce or test case.
Redisson stops executing commands found during tests with RBoundedBlockingQueue.Probably throwing an alert message or slow down but not stuck in infinite cycle.Stops executing commands.A lot of exceptions logged.
none.
Slow Redis Sentinel Initialization on Start (update from 3.6.5 -> 3.7.3)Hello,I'm updating Redisson lib from version 3.6.5 to 3.7.3. But I saw that Redis Sentinel initialization takes more times in the newer version 3.7.3. Is there's a new parameter to be aware of that could explain/solve this slow initialization ?I'm using the default Redis Sentinel configuration unchanged since version 3.6.5.Regards,Steps to reproduce or test case.Check connection initialization on Sentinel mode with Redisson on version 3.6.5 vs version 3.7.3.
Multiple ReadLocks are not sharing locks properly after WriteLock releases.Hello!I've found something that I believe is a bug in Redisson's RReadWriteLock implementation where multiple ReadLocks seemed to become or at least behaved like WriteLock when it tried to lock on a lockpoint that another WriteLock has already acquired a lock, then released. Because of that, ReadLocks are not sharing the lockpoint like it should and are taking turns in locking the lockpoint. Theoretically, this will have a performance impact on applications that expected Redisson to have quicker locking mechanism based on inclusive locking mechanism but under the hood, it is not inclusive and those applications will spend some time to wait for locks to complete.I have tested this with Java's ReentrantReadWriteLock and it has worked exactly what I'd expected it to be.Note: I have only tested this on a single Redis server. I did not test this on clustered Redis servers.Writer Thread locks.Reader Thread 1 fails to lock and waits.Reader Thread 2 fails to lock and waits.Reader Thread 3 fails to lock and waits.Writer Thread unlocks.Read Thread 1 locks.Read Thread 2 locks.Read Thread 3 locks.Read Thread 1 unlocks.Read Thread 2 unlocks.Read Thread 3 unlocks.This behavior matches Java's ReentrantReadWriteLock behavior exactly.Writer Thread locks.Reader Thread 1 fails to lock and waits.Reader Thread 2 fails to lock and waits.Reader Thread 3 fails to lock and waits.Writer Thread unlocks.Read Thread 1 locks.Read Thread 2 fails to lock and waits.Read Thread 3 fails to lock and waits.Read Thread 1 unlocks.Read Thread 2 locks.Read Thread 3 fails to lock and waits.Read Thread 2 unlocks.Read Thread 3 locks.Read Thread 3 unlocks.This behavior does not match Java's ReentrantReadWriteLock behavior exactly.Steps to reproduce or test case.I have written a test code for you to review, download, and test.The link to my code is here:The test code includes two test suites that runs a control test using Java's ReentrantReadWriteLock and an experiment test with Redisson's RReadWriteLock.Each test suites has two test cases where one of the test does multiple ReadLocks locks on the lockpoint before WriteLock locks on it, and another one tests multiple ReadLocks locking on the lockpoint after WriteLock has locked on it. The failure on the latter test on Redisson's RReadWriteLock is what has prompted me to open this issue ticket. Java's ReentrantReadWriteLock passed that test.Overview:To run the test, run mvn test with Maven to test the code.Single server with default configuration created by Redisson's Config class.
Implementing Job Queue.Hey there,I'm trying to understand how to implement a job queue using this awesome library.I thought about this flow:New tasks are pushed to a pending tasks queue.Tasks taken for execution will be be popped from pending queue and pushed to in progress tasks queue.After X time inside progress queue, the task will be considered as expired and will be moved to a delay queue with a given delay (each task will have a different expiration time).After X time in the delay queue, the task will be moved back to the pending queue.If the task was executed properly, the task will be moved to a processed tasks queue, which will be consumed for further calculations.For the in progress tasks i thought about using priority queue / scored set.For the delay queue i thought about using, well, the delayed queue.Problem is I struggle about the durability of it all, I'm afraid the server will crash the second i pop something (before i get to add it to some other data structure) and I will lose tasks data.There is a feature for this library that I'm not aware of and could come in handy?I would really like to stick with Java and not move to python's celery or something like that, but haven't found something to ease the process yet.If this question is not for this place I'd be happy to hear where should I post it.Thanks and have a nice day :)
Global config codec is not registered in codec cache.When deserializing nested data structures the nested structure should use the codec instance assigned to the redisson config using setCodec.The nested data structure is serialized using the default JsonJacksonCodec codec ignoring the one set on Config using setCodec.Steps to reproduce or test case.Create a new JsonJacksonCodec using a non-default ObjectMapper instance.Assign that instance to Config using Config.setCodec.Stored a nested data structure such as a RBucketReactive inside of a RSetReactive, and store a POJO inside of the RBucketReactive that's dependent on the configuration of the ObjectMapper used previously.Attempt to retrieve the value from the RBucketReactive instance by iterating the RSetReactive contents and observe that Jackson deserialization will fail due to using a defaultly configured ObjectMapper.All defaults except for registering a new Codec.
LiveObjectService - ClassCastException when using multiple ClassLoaders.RedissonLiveObjectService creates proxy objects that are instanceof the given entity class.When using a different ClassLoader when loading the Class-To-Proxy for an LiveObject than when loading the Redission library all proxies creations will throw a ClassCastException.This is most likely due to the line.I think redission should use entityClass.getClassLoader() instead to make sure that the generated proxy object will be assignable to the given entity class.(As soon as spring-boot-devtools is removed from the classpath and there is only 1 ClassLoader around everything works perfectly fine)Steps to reproduce or test case.I've created a minimal repository that shows the error simply by running ./gradlew run in the project.If is removed everything works fine.
Tasks scheduled with timezone not working.The problem I am facing is that, the task gets executed only at first occurrence of the cron and remaining occurrences doesn't get executed. However when I don't specify any timezone then everything works well.To reproduce this the timezone which you provide should be different from your local machine.
Redisson threw MOVED redirection loop detected.Steps to reproduce or test case.I updated redisson from 3.6.3 to 3.7.3, and use RLock for distribution system, It had no problem when it was in 3.6.3, but now it threw a exception above.Feel sorry I have no idea how to reproduce manually. It ran a while and then the exception threw.I used ClusterServersConfig as cluster mode configuration by default with just setting scanInterval property.
Connecting to AWS ElastiCache Redis in cluster mode behind NAT.I want to be able to use Redisson when Redis Cluster is behind NAT. I can think of following solutions:Disable auto discovery and use ElastiCache Management Nodes for all request (prefered approach recommendation in aws doc).Disabling auto discovery by manually registering all nodes in Redisson.Provide customer provide DNS mapping.I am using AWS ElastiCache Redis in cluster mode where AWS creates a management endpoint for whole cluster and separate endpoint for each master node. My whole cluster is behind NAT, so when Redisson tries to discover all the nodes in the cluster it find their local IP not the NAT IP, as a result it fails to connect to clustered nodes.Redisson discovers all the nodes in the clusters and tries to connect to them. However it fails because those IP/endpoints are behind NAT.Steps to reproduce or test case.Create an AWS ElastiCache Redis stack in cluster mode. Create a NAT on top of it and try to connect to the NATed cluster.
Connection is closed per command execution for master node used as slave in readMode = MASTER_SLAVE.This issue leads to new connection established per Redis command invocation and therefore performance degradation for master node used as slave.
How to use RKeys.findKeysByPattern() with Redisson Live Object(RLO)Hi,I'd like to ask a question about RLO and keys matching. I'm new to Redisson Live Object(RLO)I have POJO, and with a String field annotated with @Rid.  I'm able to use rLiveOjbectService.persist, and .get to save/retrieve the object based on the field value just fine.Questions:I have several RLO whose keys fit a specific pattern. I want to call RKeys.findKeysByPattern() to get all the keys that fit the specific pattern. Then I'll call rLiveObjectService.get(class, key) on the keys returned to get to all the objects that fit the pattern.However, it seems like findKeysByPattern doesn't work with RLO?From looking at the actual redis data, it seems RLO doesn't just use the value of the field annotated with @Rid as an actual redis key. It seems to do something special with the actual key name, so RKeys.findKeysByPattern() doesn't work anymore.What is the recommended way to get all the RLO objects that match a specific key pattern? Is it possible?Thank you so much.
Add RRateLimiterReactive.No description provided.
Add reactive version of FairLock.No description provided.
Add RGeoReactive.No description provided.
Introduce RSortableReactive interface.It should be implemented by RScoredSortedSetReactive, RSetReactive, RListReactive.
StatusListener onUnsubscribe Not effective.not effective.please help me,thanks.
Getting issues while using Redisson Tomcat session manager to share one redis instance among multiple tomcats.Hi,I am trying to use one redis instance for multiple tomcats to make session storage centralized for my application. But i am getting below error.As far as i understood redisson is not able to get the session created previously and then it goes on to create a new one. Because of this every time i use application on one tomcat to login it creates new session and when i come to other tomcat to use the same application its not able to find the created session and goes on to create a new one.But i do see all the sessions created in redis and being stored properly. Its just that redisson is not able to read the session.Below are my config:I am using redisson 3.7.4.
none.
How to make Redisson update a cluster status with new nodes and new IPs.Is there a way to make Redisson client query the sentinel for Redis hosts in new IPs on a configured interval? or... should scanInterval be doing this?Elaborating, we have a Redis cluster with a Sentinel cluster, in a Kubernetes environment, so when Redis nodes are taken down and new ones arise, they have different IPs, and the old ones no longer exist.Reading online I'm aware of:But working with Redisson 3.7.4, clients keep logging that can't connect to some Redis node for days.Maybe the problem is that Redisson is not contemplating that nodes can change IP, or it only contemplates the IPs changing behind steady DNS names, but not sure.Is there a way to solve this problem?Redisson clients to get updated nodes when a Redis Kubernetes cluster is rebuilt and new nodes arise with new IPs. (no DNS names involved)When the cluster is rebuilt, clients keep logging connection errors for days.Steps to reproduce or test case.Having a Redis cluster, with a Sentinel in front of them, take down Redis nodes and bring up some new ones.
RTransaction Unusual Locking Problem.Hi mrniko,We have two methods:As per our test we invoke method 1 and then immediately invoke method 2. The second transaction waits until the first one finishes and seems like the first transaction takes a pessimistic lock on one of the keys of the map being used here and we are totally fine with that.Now we have another method in a different test scenario:As per our previous test we expected a deadlock situation in this scenario, since transaction1 has the lock over the key and transaction2 is trying to alter it. But in our test both transactions commit successfully and maintain order.Please explain the ambigious locking in case of these to scenarios. Thank you.
How to get All the Keys from org.redisson.jcache.JCache.I had implemented cache as per jsr107 by using Redission.Can you please guide How can i get All the Keys (Complete set of Keys)from JCache.Thanks,
RedissonClient Get operation.
Spring Cache setting TTL on keys, not working as expected.We are using redisson with spring cache and setting ttl on our keys.:Redisson version is 3.7.0, Redis instance version 4.0.10.We are using redis single server.TTL settings is here:(with time to live of 10 seconds)Questions:with ttl settings shown above, after the cache value is set, in redis command line, every time I type command "ttl chatContext", it shows -2, not the remaining time to live.(it seems redisson is not making use of the redis ttl setting?)with the above ttl setting, after we put value in cache,if I keep querying the value of the "chatContext" value in redis command line, by typing "hgetall chatContext", then this value does not time out no matter after how many seconds.if I do nothing after the value is put in cache, and just wait for 10 seconds, then query the value of "chatContext" cache, its value is not available anymore, which is the expected behaviour.If we use cacheManager.setCacheNames(Arrays.asList("chatContext", "otherCacheNames")); then the cache value will never expire, the ttl settings of 10 seconds are ignored. Code is shown below:
none.
Only Linux launch error: io.netty.handler.codec.DecoderException: CommandDecoder.decode()Like error #1295.Windows is OK, but Linux error!
Redis node failover triggers 30x spike in Commands to the failover shard (using RBatch object)Redis node failover triggers 30x spike in Commands to the failover shard.Additional Description: We have Elasticache cluster with 2 shards* 6 nodes in each shard. Whenever a node failover occurs, the commands (HashCommands) that shard processes increases by 30x (For ex: ). No change in the incoming requests to service but the request/ commands processed by Redis goes up by 30x. Once we redeploy service, Redis commands to that shard will come to normal state.Updated redisson client to latest version. With redisson client update, we are seeing a performance hit. Latencies are increased by 25%. We haven't verified whether the issue is happening in latest version or not.Appreciate any inputs to debug what's happening here.: Failover should be handled gracefully.: Failover leads to increase in traffic to Redis.Steps to reproduce or test case:Failover Primary in one of the shard.
can we have an extra API on getNodesGroup.currently in Redissn class, we have the following API.can we expose an extra endpoint in Redisson class where we can get only certain Node type like Master?the request comes up when we are doing healthz check on our system, our system uses healtzh hook which deletes to redisson to check the health status of redis, currently, what we are doing is redisson.getNodesGroup().pingAll()which is not optimal, we would like the system to still work properly even when one slave is down, can we expose an extra API on this ?
"RedisConnectionException: SlaveConnectionPool no available Redis entries" even when slave is reachable and connections established.Since slave connections are present, connection exception should not occur.In our redis cluster of 3 nodes, redisson client is failing with following exception:However, the client host does have connections:Typically, we see the following log when slave connection-pool is populated on client startup:But, for the failed slave (172.16.62.4), during client startup, the above log never came.The number of idle connections for failed slave was less than slaveConnectionMinimumIdleSize. It was 29 instead of 32.
Spring session integration error.Spring Session should be able to serialize/deserialize the Spring session > security context via Redisson as documented.Spring SecurityContextImpl fails to deserialize when its put in a Redisson map.It deserializes ok in a regular HashMap, leading to the conclusion that this might be a Redisson issue.Steps to reproduce or test case.The test case demonstrates the problem by replicating the behavior of the RedissonSessionRepository::load() method.
none.
RMapCache's addListener  become invalid.I have two redis in one virtual ip by keepalived,and I use RMapCache's addListener monitor data change.everytime datachange can notify me.from sometime,datachange no longer notify me.Steps to reproduce or test case.
Continuation to the Issue # 1562 (How to get All the Keys from org.redisson.jcache.JCache)Hi Nikita Koksharov,Thank you so much for your replay.I can Use Iterator but it will take more time to iterate each entry for capturing the key.is there any other way to do this.Tried with client.getMap() it is taking less time.For the region with 39450 keys.Iterator approach took 6301 ms.rmap.keySet() took 1377 ms.Here my concern is when i use rmap.keySet() i need a new client, i can't use the client in jcahe. Can you Please Suggest any other approach for this.Please find my code snippet for getting keys in both below.Thanks in advance.
Jcache removeAll(Keys) Method is not working ***.Hi,Please let me know if anything is Wrong from myside.Thanks.
redisson.getNodesGroup() returns Nodes where both redis-server and redis-sentinel are not running.the issue is like #1330, but they are different.I am not sure if this issue is being fixed in newer version, but this is for sure reproducible in 2.11.3, following is the steps to reproduce.having 3 redis vms running in Sentinel mode, current redisson.getNodesGroup().size() is 3  ---> as expected.bring down one of the redis boxes by shuting down both redis-server and redis-sentinel.redisson.getNodesGroup().size() is 2 ----> as expected.bring the node up agin, redisson.getNodesGroup().size() is 4 ----> something is wrong here.running steps 1-3 once might not reproduce the issue, but running it twice like following steps 1,2,3,2,3 will surface this issue, in fact it will lead the node size growing into 4, 5 and more.Following is what I did in the class RedisNodes.java.
org.redisson.client.RedisTimeoutException: Redis server response timeout (3000 ms) occured for command.org.redisson.client.RedisTimeoutException: Redis server response timeout (3000 ms) occured for command:
Redisson continuously send lock request to redis after redis cluster master-slave switch.Evn : jdk 7, redisson version: 2.11.4,redis version:4.0.1,enable redis cluster with 3 masters and 3 slaves.After my redis cluster occurs an master-slave switch and then I try to get a lock, but redisson starts getting out of control, it continuously send Lua script command to get lock, while redis cluster return a MOVED error because of master-slave switch early, it seems that the redisson didn't know the master-slave switch and continuously send Lua script command to the same server to get lock. Approximately redisson sends 150000 lock request to redis in 5 seconds with merely more than a dozen application lock request. The network traffic between the redisson server and redis server rise up to 150Mbps, then it becomes normal after restart the redisson server.The getting lock code general show below,(I just receive 10+ lock request):The network packages general show as below:
Why I am getting java.lang.AbstractMethodError errors?Below code to schedule the job.
redisson keep sending lock request to redis due to redis cluster master-slave failover.i use redisson redLock in my project, i think redLock should be work in any case, below is my code,but when redis cluster code master-slave failover, redisson failed to acquire lock and keep sending acquire lock request, below is request:then send same request again and again... cluster response again...
Redisson stand alone giving classNotFoundException.When we try to run java -cp core-1.0-SNAPSHOT.jar -jar redisson-all-3.7.3.jar single.json, classNotFoundException should not occur.we get classNotFound Exception.
Can't write command batch to channel. ·.Can't write command batch to channel:.If redis block for some times. then redis recover.but redisson still use broken connection.I found the tcp.socket not exists , bu we use it .why we not close it in   CommandBatchService.checkWriteFuture.
Redisson Session Manager for tomcat is not able to serialize/deserialize session object when multiple web application (war file) share same session.hi, Need a help.our organization was using oracle web coherence for session management. there are around 15 modules deployed as war files which share the same session with different context for each war file.Coherence uses :: com.tangosol.coherence.servlet.AbstractHttpSessionCollection$GlobalScopeController in order to Share Session Information Between Multiple Applications. There is no class visibility issue by coherence session manager between applications sharing same session.see LInk:section: 4.2.2.1 Sharing Session Information Between Multiple Applications.Each context places some of its class in the session.setattribute and when using weblogic + coherence there was no issue with class visibility in session when the context gets changed during the user flow.Now, our organization is trying to migrate to tomcat + RedissonSessionManager. however there are issues with the redisson session manager. one class loaded in one context is not visible by session manager when the context gets changed. So, session manager is complaining about ClassNotFoundException as it does not have visibility to the classes which were loaded in session when the control was in previous session.Please let me know if there is any feature AVAILABLE in redisson session manager like oracle coherence has which makes it capable of viewing all the classes in the different war files (different contexts).
Channel Inactive but  the event not catched by ConnectionWatchdog.channelInactive()I find the Channel Inactive , but  the event not catched by ConnectionWatchdog.channelInactive()so the connection not reconnect .then it throw  "org.redisson.client.WriteRedisConnectionException: Can't write command batch to channel".for the socket not exists.
Memory Leak when I try to create client.It should't have memory leak.Steps to reproduce or test case.
'reconnectionTimeout' and 'failedAttempts' setting in unavailable.I config with the version of 2.12.5,it warn that "'failedAttempts' setting in unavailable. Please use 'failedSlaveCheckInterval' setting instead!".but the document haven't update.document here!
java.lang.ClassNotFoundException: com.fasterxml.jackson.databind.jsontype.TypeResolverBuilder.after built project and run on vps(java 1.8) error appear, in intellij everythink work.
some suggest of set with ttl.would you be consistent.
about bucket set with ttl return hashmap?
java.lang.IncompatibleClassChangeError: Expected static method org.hibernate.cache.internal.DefaultCacheKeysFactory.createEntityKey.No description provided.
Command execution timeout when calling CMS.QUERY in CountMinSketch module.When applying module CountMinSketch, calling CMS.QUERY using redission client to call CMS.QUERY command to get value, Timeout exception is throwed out.:I use the code:Before I already ran a command on redis-cli:  CMS.INCRBY  key item 1.And, I ran a command: CMS.QUERY key item  using redis-cli and it returns  1) (integer) 1.I also try sending  the above CMS.INCRBY  command using redission api and  the comand is running successfully.obj can get or contain the value 1 inside.set CountMinSketch as a module for redis and launch redis.I am using redission 3.7.5.
In CommandsQueue , the preceding request will block the request behind.  how did you handle it?In CommandsQueue , if the previous request was responsed for a long time.Then the  behind request will block , how did you handle it .
At least two sentinels should be defined in Redis configuration.error:  At least two sentinels should be defined in Redis configuration.
problem about RLock.lock() interruptedException?RLock.lock() does not return anything, is that mean a thread can always get the lock?After i saw the source code of lock funcation, it calls lockInterruptibly and catch the InterruptedException, it means that when a thread is interrupted by other thread, it will stop waiting and return from this lock function.so I tried a example in such way:There are two threads in my example, thread-1 gets the lock, and thread-2 is waiting for the lock, then main thread interrupts thread-2, and in this way, thread-2 actually does not get the lock, but thread-2 still stops waiting and return from lock() funcation and continues to do the business which should be locked.should i use the interruption status of current thread to check if the current thread has got the lock?Thank you very much!Steps to reproduce or test case.
Shade or unpackage snakeyaml.Redisson is packaging snakeyaml inside it's own redisson-all.jar library. This version is not shaded.When using Redisson as a Session Manager in Tomcat, Redisson has to be loaded in one of the class loaders above the webapps (Bootstrap, System or Common). Since redisson-all package snakeyaml, it will take precedence over any snakeyaml provided by the webapp.As a result, any application that use a snakeyaml's version different to Redisson may crash.Consider shading the snakeyaml implementation treat snakeyaml as a transitive dependency which could be overridden.Redisson and all other applications (ie Spring) are able to load yaml files.Steps to reproduce or test case.Install redisson in Tomcat in either of the following class loaders: Bootstrap, System or Common.In a webapp, using spring 5.0.8, load a yaml configuration file.
Non Sticky Session with tomcat 8: Session loaded in second node triggers new session event(tellnew)We are using Tomcat 8 session replication and some attributes are set in session listeners whenever a new session event is created. Configuration details are given below.When a request for a session (created in node 1 goes to node 2) is loaded from redis cache, we are getting the following error as one of the listeners is setting an attribute and the Session's isValid attribute is false at the time. is that for sessions loaded from redis cache, "session created" event (tellNew) should not be triggered.A probable solution would be to disable notification when setting the session id (ie) setId(id, false) in  RedissonSessionManager.findSession function.Steps to reproduce or test case.Add this listener to the application's web.xml.org.eclipse.birt.report.listener.ViewerHttpSessionListener.Start the loadbalancer and all tomcat nodes. Login to the application and browse through the application.The above error will be logged in the log files for the node that is trying to load the session from the redis cache.
RExecutorService task execution performance regression.RExecutorService task execution process got performance regression about x5 times, after #1468 had been resolved.
questions about redisson.These are questions about redissons rather than issues.I plan to use redisson in our company project, Use RLocalCachedMap to cache some business orders, but still have some questions about RLocalCachedMap since I can't get them from Wiki, API, Issue discussion in GitHub.read from map of RLocalCachedMap will always return the NEWEST data in real-time.clearLocalCache just clear the local data in JVM, it will not clear the data in Redis server, next read of clearLocalCache will sync the data from redis server to local JVM, right?How to get a Pro version of redisson, please send a email to haiyang.pan@gmail.com.
none.
Spring webflow is throwing NoConversationException when we use RedissonSessionManager.I am using redisson-tomcat-8 3.7.5 version at tomcat level and my application is using spring-webflow.Facing below error when web-flow is proceeding from one state to another state.  Could you please suggest what I can do to get rid of these errors.PN: My application is not configured for spring-session dependencies and it solely depends on tomcat.Caused by: org.springframework.webflow.conversation.NoSuchConversationException: No conversation could be found with id '1' – perhaps this conversation has ended?
Driver Support for Redis Engine version 4.0.10.Hi,I'm using Hibernate-reids library for second level cache, can i point to the redis Engine version 4.0.10 ?as per the documentation it is mentioned that it has tested this with redis server 3.x. with Redisson 2.3.x.as per my opinion i'm using Redisson client 2.12.5 and  if Redisson client supports redis Engine version 4.0.10 then Hibernate-reids also should support.Please provide your inputs.Thanks in Advance.Srinivas.
Accumulation of MapCacheEvictionTask in Memory.When the RMapCache entries expire, the MapCacheEvictionTask should be cleaned up.MapCacheEvictionTask is leaking memory as more and more RMapCache gets created.Steps to reproduce or test case.We create millions of RMapCache a day. Over the course of a few days, the MapCachEvictionTask object stays in memory and is never cleaned up.
unlock fail and expirationRenewal still execute.unlock success.unlock  fail.Steps to reproduce or test case.unlock ()client -> redis service network problem.unlock throw Exception.network recovery.expirationRenewal still execute.
Lock watchdog does not monitor read locks.Hi, when we acquire multiple (concurrent) read locks and process a task for longer than the Config.lockWatchdogTimeout, we get errors when unlocking.Code to reproduce (wait the watchdog timeout):int threadCount = 100;Looking into Redis for the ttl of different keys, I noticed:The key 'mytestlock' gets an extended ttl.The key '{mytestlock}:UUID:THREADID:rwlock_timeout:1 is not set with new ttl and the key disappears before the unlock is called.We tested with Redisson 3.5.4 and 3.7.5.
Using RScheduledExecutorServiceAsync to scheduleAsync a task is getting executed  before timeout/delay.I expect the output after 1200 seconds.. but I see it after 5 mins .. 300 seconds.The scheduled CallableTask should be executed after the delay has expired and not before that.
Why RedissonRedLock only unlock the acquired locks in the release stage?I expect that RedissonRedLock will release all the locks when it fail to acquire the lock.I learn about redlock from this page: Distributed locks with Redis, and it tell me that we should try to release the lock in all instances even if the lock was not acquired successfully, since may be we have executed the command successfully but the redis instance failed to send the response to the client.
lexicographically sort with ALPHA modifier.It looks that Redisson doesn't implement ALPHA in sorting. In Redis ALPHA  prevents "ERR One or more scores can't be converted into double".I found ALPHA only in  redisson-spring-data (RedissonConnection.java).Should I send PR?readSort returns Set with null.
DecoderException thrown when calling RMapCache.entrySet().iterator()Hi,I am working on a v1.5.15 Spring Boot project using Redisson v2.12.5 and Redis v3.2.10 on CentOS 7.I am storing an object as a value (using  the JsonJacksonCodec codec implementation) and the key is a String (using the StringCodec codec implementation) in a RMapCache. When I put data into the map there are no problems at all and I can see it on a GUI Redis tool but when I try to get it via RMapCache.entrySet(), the iterator() method throws the following exception:But RMapCache.get(key) method successfully returns elements from the map.Everything works great if I run the same code using a RMap instead of a RMapCache.Please find attached a small Spring Boot project to reproduce the error. Configuration values can be found in resources/config/application.properties file and the bean definition in resources/application-context.xml.
Unable to find maven artifact.Hi everyone,This is more a question than an issue. I'm using Spring Boot 1.5.x with Spring Data Redis 1.8 on top of JDK 1.8+ and I'd like to replace the Jedis client with Redisson. I was able to find the artifact org.redisson:redisson:3.7.5 on the Sonatype maven repository but I can't find org.redisson:redisson-spring-data-18:3.x in order to register a RedissonConnectionFactory bean. I forked and compiled the repository locally, but the artifact version I got after the compilation was 2.12.x which targets JDK 1.6+.Best,
Redisson reconnection issue in Kubernetes.When Redis in single server mode stops, its pod takes some time to restart. Redisson client should eventually reconnect.Redisson connectionWatchdog detects that redis is down and tries to reconnect but quickly stops trying, before redis is newly available.IP address does not change as redis is exposed via a kubernetes clusterIp service.Redisson never reconnects to redis.Steps to reproduce or test case.Deploy redis helm in single server mode. Connect a client from a pod inside the cluster. Stop redis pod manually.
RedisConnectionException thrown if client-name is set and retry-attempts is zero.Redisson should start properly when client-name property is set and retry-attempts property is zero in a single-server configuration.Redisson starts properly if retry-attempts is set to 1.The following exception is thrown and the server does not start:
RMap.putAll() inside a Rtransaction takes alot of time and finally fails.While putting 50000 entries in RMap using putAll method, we are getting the following error:Below is my configuration:
lost route to host.sometimes  it is happened,restart the  consumer is well work.
Slave unable to switch DNS in AWS ElastiCache ReplicatedServers.We are trying to switch the redis dns using route53 on aws elasticCache Service.While the master gets switched successfully but slave give the following error.
I found two problems about Scheduled Jobs in redisson3.7.5.I am using scheduleWithFixedDelay to create a scheduled job, initialDelay is 0 and delay is 10m. When the job was running, I found the job's interval is 5min.I found the problem was created by ff..requestId, because the ExecutorOptions.default() is 5m.Debug the code, I know startTime is System.currentTimeMillis() + delay, but 'ff'..ARGV[2] is System.currentTimeMillis() + retryInterval. In my program, delay is 10m, retryInterval is 5m, so 'ff'..requestId is before requestId in zset named {jobName:org.redisson.executor.RemoteExecutorService}:scheduler. So, the job's interval is changed to 5 minutes.Another problem is that {jobName:org.redisson.executor.RemoteExecutorService}:retry-interval was deleted when only one Job was running and first run() was finish.When tasksCounterName's value is 0, tasksRetryIntervalName is deleted. But tasksRetryIntervalName can't be reset.
Task scheduled with delay more than 1 hour timeout prematurely.Task scheduled with delay more than 1 hour should not timeout prematurely.Task scheduled with delay more than 1 hour are timing out  prematurely.Steps to reproduce or test case.
none.
Redis- Master/slave role detection through DNS.Master connections should be created on new master.We are using Elasticache with 1 master and 1 slave. The redis endpoints are behind route53 record sets. When we swtich the endpoints in route53 to point to new master and slaves. The redisson is pointing to incorrect slave.Steps to reproduce or test case.where route53 recordsets are pointing redis-slave-1.dev.com to read endpoint of a node which is master.and redis-slave-2.dev.com points to read endpoint of node (slave).If we change the recordset redis-slave-1.dev.com (earlier pointing to master) to point to read endpoint of a node which is slave and we also switch redis-slave-2.dev.com (earlier pointing to slave) to point to read endpoint of node (master), then this error comes.The following logs are found:Then all the writes to redis are returning error with:Please note that redisson is easily able to detect master/slave and able to switch connections when doing promotion of a slave.It is also able to detect the DNS change successfully if the master endpoint is replaced by another cluster's master endpoint.But, when we switch the DNS in a manner so that the earlier recordset which was pointing to a master now points to a slave and vice-versa, redisson is unable to detect it.
Redisson Sentinel not executing scheduled task on Master-Slave Failover.I am running Redis in Sentinel Mode with 5 Sentinel, 1 Master and 2 Slaves. I am scheduling a task with Redisson. It is executing the scheduled tasks normally but if i bring down the Master and a new master is elected by the sentinels, redisson doesn't execute the previously scheduled task. Newly scheduled tasks are getting executed.Observation: The previously scheduled tasks are getting executed on restarting redisson node.Redisson Node should execute the previously scheduled task after master-slave failover.Redisson Node doesn't execute the previously scheduled task after master-slave failover.
Avoid to create connection per RRemoteService/RScheduledExecutorService worker.No description provided.
Locking on Jersey.I'm trying to use Lock and Unlock on Jersey Resource.User makes a POST request.System LOCK "A".System does some stuff.System UNLOCK "A".User makes another POST request.System LOCK "A".System does some stuff.System UNLOCK "A".The system crashes at point 6 (view attachment).If i try to make some LOCK-UNLOCK in a while loop it works, but when i make these LOCK-UNLOCK from different threads it does not works.
Lock TTL. Any plan to add TTL to a Lock operation? Don't confuse with tryLock with TIME.I refer to a situation where a thread is dead and leave a resource locked (deadlock).
Deadlock while obtaining lock.Thread gets stuck while obtaining lock. Running 'keys L*' in redis-cli returns an empty list.The same lock name was likely concurrently obtained and held by another thread possibly on another jvm, and then released.Redisson version used: 1.1.5.
Lock reentrancy race.At line A the lock key is set only if it doesn't exist (NX), but on line B it's set assuming it still exists. If the lock timeouts between A and B, another process may obtain the lock, which is then overwritten at B.Here's a test case:This will reliably fail if:run in debug mode with a breakpoint placed in RedissonLock.tryLockInner(long, TimeUnit) on line B (line 306 for 508b903).the breakpoint is released after waiting at least half a second.The same problem is also present in the no-args method RedissonLock.tryLockInner(). (though a race condition is possible only if upgrading an expiring lock)I wonder if reentrancy support shouldn't be done purely in java.
RedissonLock locks up.Under heavy use on production, Redisson's locks get all locked up, and the application stalls. I'm using Redisson 1.1.5.I have 1 thread locked trying to release a lock:Also of note, I have about 30 other threads locked awaiting for a lock (a different one from the one used by the previous thread).I checked the threads with jstack, here is the relevant output:I checked Redis's state:this key is the one corresponding to the thread blocked trying to release a lock. The other threads, that are waiting for a separate lock are locked even though there is no-one taking up such lock....
when thread is interrupt...all Reference variables is locked!!the redisson is locked!all Reference variables is locked!!
Exception java.lang.Integer cannot be cast to org.redisson.RedissonLock$LockValue.when use lock,but throw some class cast exception,sample code :error stack:
Use issues, lock when i run the method Exception: ERR wrong number of arguments for 'set' command.How to solve this problem?
lock, report error:
lock,report error:
Thread deadlock when using distributed lock on 1.2.1.I run into a thread dead lock problem when using distributed lock on 1.2.1:After a certain period, some threads will be dead lock, and we can tell this by VisualVM's thread dump:
Thread deadlock bug when using distributed lock on 1.2.1.I run into a thread dead lock problem when using distributed lock on 1.2.1:There are ten threads call this function like this in a thread pool:After a certain period, some threads will be dead lock, and we can tell this by VisualVM's thread dump:I don't know why, is it a bug?
CMI call hangs forever if exception is thrown during Command processing.Bug found that can cause MasterSlaveConnectionManager to hang forever on get() call if exception is thrown anywhere in CommandHandler.To replicate the bug, you can use RedissonMap with JsonJacksonCodec to put instance of class that doesn't have default constructor. When you try to fetch that object by using RedissonMap.get() call, deserialization of object will fail in MapOutput because of missing appropriate constructor and thread calling RedissonMap.get() will block forever.In more details, this is happening because get() method awaits forever on Future object, which is released when Command.complete() is called. This complete() call is executed in decode() method of CommandHandler after RedisStateMachine processes Redis response. If, for example, RedisStateMachine throws an exception, complete() won't be called and result/exception will never be set to the Future object. This is causing calling thread to block forever in MasterSlaveConnectionManager.get() method.Pull request with test case that is proving this bug and bug fix proposition will be published shortly.
Issue in locking on key in concurrency.In my project, I have a servlet, that call a utility class.Utility class calls a wrapper class that  I have implemented over redisson lock.Wrapper class holds RLock object for a thread and provides lock and unlock methods that call RLock's lock and unlock method.But while running a apache ab-test tool for concurrency, Following exception occurs.Can you tell me if I am missing something over here?
Opening new connections in org.redisson.CommandExecutorService#async.Rmap.addAndGetAsync (and any *Async methonds) - as i understand it shouldn't lock the calling thread, and return value (Future) as soon as possible.But if for any reason connection is not established yet the calling thread will be blocked.And if redis server is not available at all it will be blocked for very long period of time.Maybe i'm wrong but it doesn't look like async nor lock-free.
CMI thows Exception: ERR Error running script (call to f_2d027cdc209d32fe7dade9ba284110f88d497180): @user_script:1: WRONGTYPE Operation against a key holding the wrong kind of value . channel: [id: 0x24baaaa8, /192.168.99.1:64875 => /192.168.99.100:6379].ENV: redis 3.0.3/2.8.3.REDISSON: 2.1.1/1.3.1.
EOFException when I use RLock with SerializationCodec.I configure Redisson to use SerializationCodec instead of default JsonJacksonCodec. Then I run my code in environment with concurrent threads and use Lock object to sync thread. After that I get exception and unlock only after expiration in 30 sec. Previous major version of Redisson does't contain this issues. Similar problem I have when I use CountDown.
CMI get hung when I disable/enable my local network.I was crashed into a blocking issue when I was doing some configuration on my windows laptop. RLock.isLocked()  got hung forever with callstack as following:Callstack:The issue is repreduceable. Steps to reproduce the issue:My os is windows, and I haven't tested it on linux.Steps: disable network.  Then enable network. The program will be blocked with the callstack I pasted.
RLock did not work.It's very wired. I just run a very simple test case to try redisson lock. But the result is not good.Can anyone show me why RLock didn't work?The results are as below. It seems the lock failed completely.
ElasticacheCluster not working correctly with DistributedLocks.I am trying to use redisson 2.2.7 for distributed locks. I have a 3 node Elasticache cluster with one of them as master.When I try to get lock using the following code, i get an error saying that i cant write to a Slave. My assumption is that i can feed a list of nodes to the redisson client as Elasticache nodes and it will figure out who the master is...is that not true?The error that i get is shown below..Here is how i am setting up a redisson client.
Read Write lock cannot be correctly unlocked. in ReadLock and WriteLock,  the unlock method use thread id to determine whether it is owned by this thread. it works fine for a single machine.However, when it is used in a distributed processing framework such as MapReduce, the Read and Write lock cannot be correctly unlocked.I browse the source codes and find that the UUID is generated in the lock, I think it is better to use UUID as lock id  istead of thread id or provides a way to let users to set a unque id.
Deadlock using RedissonMultiLock.I am using simple app to run on 2 clients to test locks.While using RedissonMultiLock with 3 locks both clients blocks.
Error if first node is down in 3 node Master-Master cluster.I have a Master Master redis cluster of 3 (node1,node2,node3). Locking mechanism works fine if we block the network for node2 or node 3. But if we block node1's network then it fails with the below error.Below is how I'm creating the Redission client.
Rlock Exception in cluster mode.Hi.I am using redis 3.0.6 (4 node cluster  ) and redisson version 2.2.5.Sometimes when I try lock a key I get the following exceptions:my code :
Rlock performance issue.Hi.I am using reddison Rlock with a cluster setup , and sometimes I see latency( up to 1000ms)  when trying to acquire the lock or unlock.I saw this issue opened by zhxjouc (#455) with a similar problem  and I am working with 2.2.13 but I am still getting latency when a thread is trying  lock a key.My code is running with Java thread pool for accessing redis, I notice that if I work with pool of size 1-2.almost no latency when getting the lock, but working with 30-50 threads cause the lock delay.It could be thread overhead issue but I think that 1000ms is too long for that.Any help on how can I get better performance when locking an unlocking?.Thanks.
Dead Locks Happen in lock() Process.when heavy concurrency happens in my application, a few lock requests will "sink" without any responses, even after the lock lease time has passed. All of these requests wait at RedissonLock.lockInterruptibly().The exact position is RedissonLock.get() after RedissonLock.subscribe().In my opinion, this may be due to a thread removes the netty listener which is used by another thread. It can happen in this way:Thread A is in the loop of getting the lock after subscription.Thread B has also applied subscription and waits for result.Thread A gets the lock very soon and enters  RedissonLock.unsubscribe(). In this step, it possibly removes all the listeners on the same channel, which includes the listener used by Thread B. It causes Thread B can never get subscription response and hang on forever.The similar issue is at http. But I think it is not solved completely.Also I suggest  to apply the ttl algorithm to RedissonLock.get() because this step can cost some time. And if it has a timeout, dead lock can be prevented in a work-around way.This is the thread dump when dead lock happens:
Asynchronous lock release.Hi,I'm trying to create an infrastructure where different machines acquire shared locks through Redisson. Once the lock is acquired, some async tasks gets done, finally, when I finish the job, I'm releasing the Redisson lock through the thread currently running - but i receive the following error.java.lang.IllegalMonitorStateException: attempt to unlock lock, not locked by current thread by node id: xxxxx thread-id: 57.So, I understand the meaning of that, but since I want to perform asynchronous work, I cannot use the acquiring thread to perform the release.Is there a solution for asynchronous programming? Should I not use Redisson Lock?I also references the issue on SO.Thanks.
Deadlock on lock() and not only.Hi,I want to raise the issue with deadlocks again.This bug is still exist and making big headache. As before, It present itself only on very heavy loaded tasks, but in this case I is happens only when client talks to the claster which is located remotely.With a single-local or claster-local servers I was unable to reproduce it, but with remote server it happens with rate 1 / 20 (means from 20 runs of "heavy-load" JUnit test it happens only once)I can see where thread is locked down, it always stuck in CommandAsyncService.get(Future), on l.await() line and never exits from it. As I understand something wrong with mainPromise object, it is staying in incomplete state... and nobody change it. I tried to understand the logics in CommandAsyncService.async(...) function, which is actually deals with connection, retry, redirections and at end should release (or fail) the mainPromise object, but it is nightmare. All these spagetty with promises and futures made the code difficult to read and impossible to analyse. For sure BUG is there, but I am near to give-up. Any thoughts?
Exception in using RedissonMultiLock.I have 5 independent masters and I use single server config to create Redission instance.The RedissonMultiLock works fine if all the redis nodes are alive.If I shutdown one of the redis nodes, it will throw RedisConnectionException.Exception in thread "main" org.redisson.client.RedisConnectionException: Can't init enough connections amount! Only 0 from 5 were initialized. Server: /192.168.223.128:8000.According to The Redlock algorithm, it should try to lock another node but not throw exception. Do I use RedissonMultiLock correctly?It tries to acquire the lock in all the N instances sequentially, using the same key name and random value in all the instances. During step 2, when setting the lock in each instance, the client uses a timeout which is small compared to the total lock auto-release time in order to acquire it. For example if the auto-release time is 10 seconds, the timeout could be in the ~ 5-50 milliseconds range. This prevents the client from remaining blocked for a long time trying to talk with a Redis node which is down: if an instance is not available, we should try to talk with the next instance ASAP.
RLock trylock blocks forever.Found this in 2.2.16, seems like this was not around in 2.2.10. But still verifying.When tryLock is called with 0 wait time, the thread blocks forever. I took a thread dump and it looks like the stack pasted below.A note on the environment: We are running this against an Elasticache cluster in AWS and accessing from 4 EC2 instances. We have seen a lot of command timeouts. I am not sure if that is some way leading to this.
RedissonLock.isHeldByCurrentThread() doesn't check properly.I am using RedissonLock in my system.The lock realted logic in service is like this:But in the log I found:I can see the the thread name is same, so the thread got the lock and the thread try to unlock is same thread.Is there any problem in my code? Or in the logic of lock.isHeldByCurrentThread()?
loop lock blocked when master-slave failover.description: after master-slave failover , the test code blocked forever .redis cluster :test code:exception:
attempt to unlock lock, not locked by current thread by node id.redisson version:2.2.21.implement code:
tryLock method throw Exception:attempt to unlock lock, not locked by current thread by node id: 157ddcf5-0cc2-445d-bdea-98160a459bd5 thread-id: 42.@mrniko.hi, I stress test tryLock(long waitTime, long leaseTime, TimeUnit unit) method, throw Exception:attempt to unlock lock, not locked by current thread by node id: 157ddcf5-0cc2-445d-bdea-98160a459bd5 thread-id: 42.unnormal code:1:but use lock() or lock(long leaseTime, TimeUnit unit) method is normal, why?2:tryLock() can not be block? lock() is blocked?3:tryLock(long waitTime, long leaseTime, TimeUnit unit) method, waitTime must be more than leaseTime value, otherwise occasionally have "attempt to unlock lock, not locked by current thread by node id" ecxeption, in stress test condition, why?
redisson lock failure problem.redisson version:2.2.24.@mrniko.hi, i user jmeter pressure measurement  redisson lock.scene :Pressure test scenarios:Using two tomcat, simulating the two service requests, each request the server queue to obtain a lock, concurrency of 5000, continued request for 20 minutes,After acquiring the lock counter, increments by 1. It appears six times double counting problem, log is as follows::A server.lock and unlock code.
rlock error report.
RedissonRedLock & RedissonMultiLock lock method stuck.If more than 3 locks are supplied to RedissonRedLock or RedissonMultiLock instance then lock method could stuck.
RedissonRedLock trylock success while another thread already hold the lock in specific conditions.it's reproducible, my code is below.redlock lock result will be success, but when I check redis, I found the multi locks belong to different thread.like:I did more test and found:if the single lock is the first of redlock, it's ok.when I move multilock2 to first position ,it will return false correctly.the code below.I am wondering if it is a bug or not?
CommandAsyncService blocks indefinitely.Hi,I have a thread stuck in the CommandAsyncService#get() indefinitely waiting for the CountdownLatch. I don't have a particular repro case but this happens every once in a while on our servers (under load). Redis itself is still delivering events and the instance receives objects on other threads as well.Would it make sense instead of waiting indefinitely on the latch to only wait as long as the timeout is configured (as a safe belt) and abort the action if there hasn't been any success/failure by then?Cheers,Philipp.
DistributedLock - Lock is getting acquired by multiple threads.We are using distributed lock to ensure that only one thread can take a particular action, among a group of threads spread across multiple EC2 instances.Here is a snippet that represents what we are doing.The issue is that we are seeing multiple threads from being able to acquire and do the job.What might be the issue? Do you see an error in the way we are using distributed locks...is there a better way to solve this problem?Our goal is to ensure that for every job run...only one thread gets to do the job.
Documentation on locks.I was wondering if the documentation could be clarified on what happens to each of the lock types should one redisson node request a lock, then die before releasing it while another node is waiting on it.i.e.If the documentation could also note suggested ways to prevent deadlocking in such cases (should deadlocking occur) that would be good too. It's not clear if the distributed locking takes into account the loss of a node while holding a lock.
Unlock does not really unlock.If you unlock a FairLock from some thread, there is a delay until all threads actually see that lock as available.Example test clase.
RReadWriteLock is not reentrant.I was expecting the RReadWriteLock to be reentrant, as the wiki page describes it as (emphasis mine):Redisson distributed reentrant ReadWriteLock object for Java.However, in my simple test:The "reentrancy" clause of the ReentrantReadWriteLock Javadoc states:Additionally, a writer can acquire the read lock, but not vice-versa.My use of redisson relies on these locks being reentrant (at least within the same Thread), however this does not seem to be the case - is this a bug, or a configuration issue on my end?
Problem with Rlock - unlock not releasing lock to waiting threads.I am seeing an intermittent issue with Rlocks. I am implementing what is basically a distributed cyclic barrier using Redisson.I am running multiple instances of a service on different virtual machines. Each instance receives multiple HTTP REST api requests, handled by multiple threads. As each request is received it waits at a redisson count down latch until the threshold for # of requests has been reached.At this point, I need one thread to calculate the results and store it in redis so it can be available to all the other threads across all instances. So each thread tries to acquire an Rlock (with TTL of 5 seconds). One thread gets the lock, does the calculation, and stores the result back to redis. It then releases the Rlock.Now all the other threads that are waiting on the Rlock can (one at a time) acquire the lock, see that the data is already in redis, and simply release the lock and send the result back via HTTP, without repeating the calculation.We are using a master/slave redis cluster with 1 master and 2 or more slaves. As well as using redisson for the countdown latch and rlock, we use jedis for standard redis reads and writes, but never using the same keys as we use for the latch and locks.This is all working about 99% of the time. However periodically, I can see that after the Rlock is released, none of the threads that are waiting for it are able to acquire the lock. I was originally using lock(), and finding that HTTP threads were hanging forever. I switched to using trylock, and this returns, but it returns false, indicating a timeout waiting for the lock.I have added logging to be 100% sure that unlock is being called on the lock in the failure case. Any suggestions on how I can debug this issue, or any known problems with our configuration that might be causing it?We are running Redisson 3.2.3 and redis 3.2.5.Thanks for the help,Sue.
Indefinite lock lost during master failover.I've found my indefinitely held locks will sometimes disappear after a master/slave failover.  The block here will not reschedule a renewal if the attempt of the update fails.The update can fail during a failover, in which case the lock is gone for good.The exception that gets thrown when the update fails:
CommandAsyncService blocks indefinitely [without OutOfMemoryError].all application threads are blocked with stack trace.
RReadWriteLock is incompatible with reentry r&w op.While using RReadWriteLock, a bug (or not?) confuse me for a long time.I described a wrong ops yesterday, and fix it now. Sorry about this.There is a sure logic problem if ops like this:So if there is no holding check and running in a concurrent environment, op4 may throw IllegalMonitorException.But it's ok as follows:I found that "read unlock" will delete the whole lock without checking if there is any other write lock.Is it a bug, or it just shouldn't do and need to do in another way?
Cache ops taking too long.Currently i'm using Redisson 2.7.4  as JCache Provider, and some cache operations are taking a long time to execute, as can be seen in the log below:in some cases it takes ~30 minutes.Taking a thread dump I noticed that all EJB async threads (and some http-executor threads too) were in the same state, generating a huge queue in the async thread pool:Thread dump for some threads (Complete thread dump can be downloaded here):it looks like that is a lock issue, but i don't know how to solve it.
Concurrency Issues.Today I tried some tests to experiment with Redisson's performance using a build from /master and discovered significant concurrency issues. I'm not sure what the state of this code is, so perhaps these issues are known ones, but wanted to make sure you guys are aware of them.I have a very simple app that a) Creates a Redisson instance with a connection pool of 50 to masters and 50 to slaves, then b) creates a quick thread pool using Executors.newFixedThreadPool() and then c) feeds it Runnables, each of which generates a random string and adds it to the end of a Deque.Whenever I do any of these three things: 1) Add >1 millions of queued Runnables or 2) Increase the number of threads >20 or 3) add a .contains() call on the Deque (more on that in a sec), I get a ton of exceptions that don't include any of my code in the stack trace. Here's one such snippet:
RedisConnectionException in High Concurrence.I use redis as required data store, but in high concurrence, there are almost 50% connection failed. I want to know whether to optimize my redis server(use cluster) or my client? Is there any great suggestion? infinity retry until success? And My test code are list after:I use 1000 threads, and find that if i set the connection pool size to 500, the successful proportion achieves maximum.
RedissonSortedSet's order seems broken.Hi, we have been using RedissonSortedSet and just found that on certain cases the order can be broken and I assume RedissonSortedSet is supposedly thread safe.Assuming RedissonSortedSet of integers are added with the following integers : 103, 101, 102. RedissonSortedSet state (list in the redis server) should be: 101, 102, 103. However, there are cases when it is not. It may become 102, 101, 103 instead. And looking at RedissonSortedSet's source code, it uses binary search that requires the list/state to be always sorted. Therefore it breaks many other functionality.The use case that breaks (in my case) is when we are adding multiple items and there is another thread that delete an item in between. Looking the source code implementation briefly, it may be because when removing an item it does not consider getCurrentVersion() (just a quick guess).
Redisson map get makes the thread waiting forever.The map is a regular <Integer, String> map, and by calling a get on some key we see the following thread trace:
Incorrect RedissonRedLock.tryLock behaviour.Lock could acquired by several threads at once when leaseTime parameter less than waitTime parameter passed into RedissonRedLock.tryLock.
performance slow, when multiple thread.I use 1000 mutliple thread to test the list operation. the costTime is average 1000~2000ms. But when single thread it costs 1ms.
StackOverflowException in URLBuilder.URIBuilder is not thread-safe. Following scenario causes infinite recursion and StackOverflowException when someone tries to create new URL:URLBuilder.replaceURLFactory() - URLBuilder.currentFactory set to null, URL.factory set to custom.URLBuilder.replaceURLFactory() - URLBuilder.currentFactory set to custom, URL.factory set to custom again.new URL fails on StackOverflowException. Following code is an infinite loop because currentFactory points to "this":Affected version: 3.3.0.
RedisNodeNotFoundException : Never catch, so never release the countdownlatch.Hello,I have a cluster 3 master and 3 slaves, freshly created.You can see the conf in config dir and the creation script is init_and_launch_cluster.sh.I launch a Java junit test which use Redisson.The test initialise redisson (with a scan interval set to 100 ms in order to produce the bug quicker),and insert key into the redis cluster in 15 thread.I launch the kill-random-redis-master_local.sh script. This script kill a random master, wait 15s (nodetimeout is 10s),relaunch the killed master, wait 10s, and start over.In generally 10 minutes, I have this exception :I can't understand why there is this exception, but it is not catch anywhere.So the thread which handle this command is stuck in await of the countdownlatch (CountDownLatch:148)After 15 RedisNodeNotFoundException, all my insert thread are stuck, i can't insert any more.I made a little project on github, to help people reproduce this:Thanks for you're help.Ps :  In pj you found the log of the last reproction i made (redis 3.2.6 and redission 3.3.0)logs.tar.gz.
URIBuilder seems not to be thread safe.We test this in case of a multi cluster setup and sometimes went the java.net.URL.factory to null instead of the original factory.Best,ebersb.
RedissonList's Iterator Race Conditions.RedissonList iterator as it tries to keep "up to date" with data has a race condition in which if between the .hasNext() and the .next() call the set is emptied the list will throw NoSuchElementException.Unit Test.Additional Information.This also effects RedissonSet, but much less likely to hit the race condition. It causes RedissonSet line 96 to throw a null pointer exception.This is akin to issue #104.
Report possible race issues.Hi, Developers of mrniko/redisson,I am writing to report two race issues on use of ConcurrentHashMap. The issues are reported by our tool in an automatic way. Although manually confirmed, they would be false positives, given we do not know the specification of the program. We would very appreciate if you could check below for details and confirm with us whether they are real problems. For more information, please refer to our website:Line 120 is in the synchronized block on "ENTRIES". If the intention is to guarantee exclusive access for the !containsKey checking on "ENTRIES" and to ensure the atomicity of the checking and unsubscription (line 120,121), then the write operations on "ENTRIES" in line 66, 115, 117, 136 may break this. Relying on the ConcurrentHashMap to ensure exclusive access is dangerous since ConcurrentHashMap has no guarantee of exclusive access.
Redisson shutdown hangs if redis server was down.Start redis server.Create redisson bean.Stop on a breakpoint inside test.Shutdown redis server.call redisson.shutdown()What I see is that ConnectionWatchdog is scheduling tryReconnect indefinitely incrementing attempts and connection is not closing. But if I put break point in ConnectionWatchdog#channelInactive (line 64) and stop there, connections are closing properly. Perhaps there is race condition somewhere?
Possible race-condition in RemoteService.Race-condition during ack checking is possible. For example, ack timeout = 1000 ms:worker receives Request in 999 ms sends ack, but it comes in 1010ms or something like that.client checks ack in 1000 ms and throws RemoteServiceAckTimeoutException.worker invokes method.To solve this problem ackObject was introduced. Worker or client set it to 1 via SETNX command. Worker set it during ack sending. Client during ack receiving.Client check ackObject only if ack timeout has occurred. If client can't set it means that worker have done it already. So client should poll an element from queue again.If worker can't set ackObject then it means that ack timeout already occurred on client side and invocation should skipped.
Possible PublishSubscribe race-condition.There is a rare possibility of race-condition during channel re-connection and RTopic subscription invoked first time.
RScoredSortedSet race condition with Redis cluster.We are running two redis servers in AWS, one master, and a replica. The read mode is the default (slave).In our application code we have something like this..The issue is that since reads go to the slave, addasync returns from master and before the data replicates to the other server it tries to pull the new revrank and returns null. imo the following api would make more sense and avoid that race condition..In the meantime I will either add retry logic or change the read mode to master but that's not going to scale in the long run so it would be nice to have this addressed.Cheers!
Redisson hang on RBatch.execute()Hi, we are using redisson client for our multi-threaded application.We use RBatch to batch two commands as below:During the test, we noticed the hang several time.We first show this error first before the hang:Then our thread calling the batch hung. There is the stacktrack:I tried to set the lower lockWatchdogTimeout and set the batch timeout but this did not help.
RFairLock dead lock issue.Hi,I would like to report a locking issue we are seeing using redisson versions 3.3.2 to 3.5.4, using RFairLock.We have 3 instances of an application competing for a fair lock. After some time, the timeout of the fair lock queue gets set to a time many hours in the future, and no thread ever gets the lock.Here is what redis is reporting during one of the occurences - both commands ran at about 9:30AM PST on 10/17/2017 (1508257800000):You can see that the timeout (zscore of the timeout keys) is set about 6 hours in the future.So far, we haven't been able to reproduce the issue locally, but it is happening daily in our production environment. We are suspecting the problem is happening randomly when one of the application gets killed by the operating system (kill -9), something that can happen quite often due to the way we manage the apps.We were using redisson version 3.2.3 before, and never experienced the issue.Earlier this year, we tried updating to version 3.3.2 and started seeing the problem within a day or so. We reverted to 3.2.3, and waited for an updated version.Two days ago, we decided to upgrade to 3.5.4 assuming the problem was fixed, but it happened again within a few hours.I will keep on trying to reproduce the issue, but any help is appreciated.Thanks,Michael.
JVM crashes when using 1000 concurrent redisson threads.I am scheduling tasks on a Redisson executor. On every schedule a massive chunk of tasks are submitted on two Redisson executors. I have equal number of workers assigned to each of the two executors 500 and a maximum redisson thread count of 1000.I took periodic heap dumps of the JVM and the following was the last dump I captured before the container (my code is running in a docker container) went OOM. It appears to me that the netty's PoolThreadCache continues to increase.Here is a screenshot of the leak suspect report of the last dump I took:I am unable to get the crash dump report of the JVM. Will attach that as soon as I am able to figure out the issue with crash dumps not getting generated.I am using Redisson 3.5.5. The bundled Netty version is 4.1.16.
ReadLock not working correctly.Hi,Is this the expected behaviour of the ReadLock from ReadWriteLock?Clarifying because I did not encounter this in release 3.5.4.There are multiple threads that are trying to lock and unlock the readlock concurrently but I am encountering the "attempt to unlock lock, not locked by current thread by node id" exception.Here is a rough code sample to replicate the issue.The unlock part throws the following exception even though they're all read locks.
org.redisson.RedissonTopic.removeAllListeners got blocked on CountDownLatch.await.Hi there,We hit an issue in one of our server using Redission as Redis Client. We do have a single thread executor handling subscribe/unsubscribe for multiple channels. But last week, we found this got blocked on one server.The org.redisson.RedissonTopic.removeAllListeners is unable to respond request, and blocked in the acquireUninterruptibly FOREVER. I tried to dig into logs, there was one exception thrown before this in CommandAsyncService.syncSubscription line 125 "Subscribe timeout 9500ms". This is possibly related since this was the only "Subscribe timeout" message I saw in last 30 days logs and then this issue happened. But I still don't find prove on this. Looks like this is a rare case since we just hit once. I tried to reproduce locally but with no luck.I think the removeAllListeners should give an option to let caller pass in a timeout. But this is also not going to resolve the root cause. I am wondering if other people have observed this issue before. Please advise if you have any ideas on this, thanks.
RedissonRedLock.tryLock(long waitTime, long leaseTime, TimeUnit unit) still have something wrong.reference from the issue #1175 after it is closed.I change the test case in RedissonRedLockTest.testLockSuccess() like this:The test case above will fail in case of that lock1/lock2 is locked first in thread t1. However, it will pass in case of lock3 is locked first in thread t1.The  is as follows:No matter which lock is locked first in thread t1, the Red Lock will always can be locked or cannot.In this case, the Red Lock should always be locked for most of the lock is available.
[2.11.1] Unable to re-establish MasterConnectionPool after restarting redis.We are Trying to add a mechanism to re-subscribe to topics after restarting redis.Setting UP:Steps to recreate:See Following Error, Redis MasterConnectionPool is not re-established.We were initially at Redisson version 2.9.1, but when we following the previous steps, in step 5, we encountered the same issue as in #1268, which is removeListener thread blocks forever, so make the switch to 2.11.1.We also simulate the scenario with 2.9.1 version,  without doing removeListener (we found out there is pubsub Listener leak issue with 2.9.1, that is why we remove the old listener first), the MasterConnectionPool was able to re-establish.
ReadWriteLock timeout does not work as expected.I wrote a simple test to check the ReadWriteLock.The behaviour.First case: Read thread finishes executing properly, write thread hangs forever.Second case: Behaves as expected. Read thread locks, sleeps and unlocks. Write thread hangs until the read thread finishes and then locks and finishes.What I see in redis in both cases at the beginning:What I see in redis in both cases after some time:The rwlock_timeout entries expire in both cases, it seems like no one is updating their timeout in redis.In the first case, where the readThread finished running but the lock1 entry never expires and is stuck forever like this:What I expected.In the first case when the read thread finished running I'd expect the read locks to expire after some time and unlock the lock1 entry.In the second case I'd expect the rwlock_timeout entries not to expire since the read thread is alive, it sleeps but it is alive.
CommandAsyncService gets blocked at high concurrency [without OutOfMemoryError].Hi,While running a load test on jmeter of 200 users with ramp up time of 10 seconds and number of puts per user equal to 10, threads are getting  stuck. In this test we are using RTransaction and doing load testing on a single key by putting random values for a single key.here is the stack trace:Steps to reproduce or test case.
tryLock waitTime no valid.hello, I have test the tryLock with waitTime, but find it has bug. My test is as follows:As you can see, the second thread faild to acquire lock but the lock is released during 2 seconds...please tell me ,thanks.
severe bug !! when sending read operation to new slave loading previous data after failover.Steps to reproduce or test case.on each servlet request, i send read command like below to redis, in this case, it is problem.result = redissonClient.getScript().eval(Mode.READ_ONLY, script, RScript.ReturnType.VALUE), keyList, argvList.toArray());on each servlet request, i send read or write command like below to redis,  in this case, it is ok.result = redissonClient.getScript().eval(Mode.READ_WRITE, script, RScript.ReturnType.VALUE), keyList, argvList.toArray());send read operation each reqeuest on servlet server continusly.slave is loading data for syncing with master. it takes 10 minutes to load all data completely.during 10 minutes, servlet server is going strange behavior and throuput is very lower and don't return any exception. i think some threads is hanging around Redisson connection with new slave loading data.actually i expected returning error with timeout. why it is not returning any error until slave is completed loading data.after 10 minutes which completed load data from slave. it is going back to normal and throuput become higer.however, read operation with Mode.ReadOnly is going both master and slave not going to slave only.when loading data at slave, redisson is sending read operation to slave. and read opeartion thread is hanging aroud somewhere in redisson.read operation with Mode.ReadOnly is going well to slave only. however after failover, read operation is going both master and slave not going to slave only.
Lock watchdog does not monitor read locks.Hi, when we acquire multiple (concurrent) read locks and process a task for longer than the Config.lockWatchdogTimeout, we get errors when unlocking.Code to reproduce (wait the watchdog timeout):int threadCount = 100;Looking into Redis for the ttl of different keys, I noticed:The key 'mytestlock' gets an extended ttl.The key '{mytestlock}:UUID:THREADID:rwlock_timeout:1 is not set with new ttl and the key disappears before the unlock is called.We tested with Redisson 3.5.4 and 3.7.5.
unlock fail and expirationRenewal still execute.unlock success.unlock  fail.Steps to reproduce or test case.unlock ()client -> redis service network problem.unlock throw Exception.network recovery.expirationRenewal still execute.
Deadlock with RedissonLock used by JCache.We've ran into a number of issues with using the Redisson implementation of JCache via bucket4j in production for rate limiting.JCache.put(K key, V value) calls RedissonLock.lock() with no lease time, resulting in RedissonLock's creating a 'watchdog' thread that continuously renews the lease on the lock in Redis. We are using the default 'lockWatchdogTimeout' of 30 seconds so this thread runs every 10 seconds. What we've seen is in rare cases this watchdog thread never gets canceled, meaning it continues renewing the lease indefinitely until the instance containing the thread is restarted. This causes deadlock of all other threads trying to grab the lock and can ultimately bring down an application as threads build up.Threads using RedissonLock will wait forever for a lock to be released. There is no timeout when waiting for the lock.The 'unlock' method in RedissonLock can fail for a number of reasons -- e.g., timing out trying to unlock with Redis after 3 seconds (this happened in our case). When the unlock fails the watchdog thread is not canceled. This means the instance would have to be restarted to release the lock.A 'watchdog' thread should not exist. This is prone to issues where it never gets destroyed and a lock is held forever. A lease time should be used to ensure the lock is never held forever and somehow it should be verified that the lock is still held by the caller when making updates with it (an atomic check at update time) in case the first thread doesn't execute its update within the lease time and another thread grabs the lock.Threads should not wait forever for the lock. There should be some configurable timeout.A timeout on 'unlock' should be retried, but the lease time in 1 should handle any failure to unlock. If for some reason the 'watchdog' thread is kept, the unlock needs to ensure it is canceled if it fails.
Deadlock while obtaining lock.Thread gets stuck while obtaining lock.The same lock name was likely concurrently obtained and held by another thread possibly on another jvm, and then released.Observed intermittently.
two thread get the same lock by trylock?Steps to reproduce or test case.
RedisOutOfMemoryException.No errors should be thrown after setting maxmemory-policy :volatile-lru, maxmemory:4MB.When I am using two threads to put values through redisson to different database with limited memory(maxmemory-policy :volatile-lru, maxmemory:4MB),  error like org.redisson.client.RedisOutOfMemoryException: command not allowed when used memory > 'maxmemory' sprang up, and the database was flushed by redisson.But I replaced to use Jedis(2.8.0) to test again, no such exceptions came out, and the database was not flushed by Jedis. The items which exceed 4MB  can be deleted by redis automatically because of volatile-lru policy.Steps to reproduce or test case.Run commands on redis-cli, config set maxmemory-policy volatile-lru  config set maxmemory 4mb.Run the code twice(Two threads) using different database with type to 0.singleServer, refer to the codes for details.Codes I run.
Deadlock after Redis timeout.After a Redis response timeout, Redisson needs to be resilient and back to normal operation after Redis timeout and allow to lock and unlock critical sections again.After a Redis response timeout between attempts, Redisson adds the lock to scheduled renew task and never remove them. So, the application enters on a deadlock due to a lock renewed even after unlock.The task can run on the same thread due to reentrant lock feature, but when the task runs on another thread a deadlock occurs.Steps to reproduce or test case.Start Redis.Run the test application (https) with a simple locked task.Force a timeout on Redis runnning a client pause command: "CLIENT PAUSE 5000".
Cannot shutdown RedissonNode if there infinite lock is locked.To reproduce the problem:1 Create a Runnable job which will last ~ 1 minutes (greater than "internalLockLeaseTime" used by RedissonLock.java), get a lock and lock it by lock.tryLock(), release the lock after the job is done.2 Schedule and run this job using Redission framework.This is because RedissonLock.scheduleExpirationRenewal still running after we shutdown the node.Can Redisson stop the scheduleExpirationRenewal when user call node.shutdown()?
Unexpected exception while processing command.I got this problem when I trying to locking an object. Here is the problem:Date: Thu, 19 Oct 2017 10:15:31 GMT.what I'm missing?
The deadlock of RedissonMultiLock.When I used the RedissonMultiLock.lock(), I found the code of Redisson.This is my code.The program execution sequence is as follows:Thread A locked the 'lockSoundbox' of lockA. It's OK?Thread B locked the 'lock2000' of lockB. It's OK?Thread A locked the 'lock2000' of lockA. It's OK?Thread B locked the 'lockSoundbox' of lockB. It's OK?I think there's a deadlock between 3 and 4, but I'm not going to try it out.
Redisson 3.5.7 memory leak with locks.I'm using RLock and seeing memory leak via org.redisson.client.handler.CommandPubSubDecoder.Retained objects delta between heap dumps taken apart.Around 10MB leak per day.
RedissonRateLimiter acquire() method blocks forever.The acquire method should block until a permit is available, but it blocks indefinitely instead of the remaining time until a new permit becomes available. From my testing I have found that it doesn't acquire a permit when one should be available based on the rate and interval I tested. If I set the rate to 1 every 5 seconds, it should take a loop of 10 single permit acquires approximately 50 seconds to complete. Instead it acquires the first permit, then blocks forever on the next acquires call.
Multiple ReadLocks are not sharing locks properly after WriteLock releases.Hello!I've found something that I believe is a bug in Redisson's RReadWriteLock implementation where multiple ReadLocks seemed to become or at least behaved like WriteLock when it tried to lock on a lockpoint that another WriteLock has already acquired a lock, then released. Because of that, ReadLocks are not sharing the lockpoint like it should and are taking turns in locking the lockpoint. Theoretically, this will have a performance impact on applications that expected Redisson to have quicker locking mechanism based on inclusive locking mechanism but under the hood, it is not inclusive and those applications will spend some time to wait for locks to complete.I have tested this with Java's ReentrantReadWriteLock and it has worked exactly what I'd expected it to be.Note: I have only tested this on a single Redis server. I did not test this on clustered Redis servers.Writer Thread locks.Reader Thread 1 fails to lock and waits.Reader Thread 2 fails to lock and waits.Reader Thread 3 fails to lock and waits.Writer Thread unlocks.Read Thread 1 locks.Read Thread 2 locks.Read Thread 3 locks.Read Thread 1 unlocks.Read Thread 2 unlocks.Read Thread 3 unlocks.This behavior matches Java's ReentrantReadWriteLock behavior exactly.Writer Thread locks.Reader Thread 1 fails to lock and waits.Reader Thread 2 fails to lock and waits.Reader Thread 3 fails to lock and waits.Writer Thread unlocks.Read Thread 1 locks.Read Thread 2 fails to lock and waits.Read Thread 3 fails to lock and waits.Read Thread 1 unlocks.Read Thread 2 locks.Read Thread 3 fails to lock and waits.Read Thread 2 unlocks.Read Thread 3 locks.Read Thread 3 unlocks.This behavior does not match Java's ReentrantReadWriteLock behavior exactly.Steps to reproduce or test case.I have written a test code for you to review, download, and test.The link to my code is here:The test code includes two test suites that runs a control test using Java's ReentrantReadWriteLock and an experiment test with Redisson's RReadWriteLock.Each test suites has two test cases where one of the test does multiple ReadLocks locks on the lockpoint before WriteLock locks on it, and another one tests multiple ReadLocks locking on the lockpoint after WriteLock has locked on it. The failure on the latter test on Redisson's RReadWriteLock is what has prompted me to open this issue ticket. Java's ReentrantReadWriteLock passed that test.Overview:To run the test, run mvn test with Maven to test the code.Single server with default configuration created by Redisson's Config class.
RTransaction Unusual Locking Problem.Hi mrniko,We have two methods:As per our test we invoke method 1 and then immediately invoke method 2. The second transaction waits until the first one finishes and seems like the first transaction takes a pessimistic lock on one of the keys of the map being used here and we are totally fine with that.Now we have another method in a different test scenario:As per our previous test we expected a deadlock situation in this scenario, since transaction1 has the lock over the key and transaction2 is trying to alter it. But in our test both transactions commit successfully and maintain order.Please explain the ambigious locking in case of these to scenarios. Thank you.
Redisson continuously send lock request to redis after redis cluster master-slave switch.Evn : jdk 7, redisson version: 2.11.4,redis version:4.0.1,enable redis cluster with 3 masters and 3 slaves.After my redis cluster occurs an master-slave switch and then I try to get a lock, but redisson starts getting out of control, it continuously send Lua script command to get lock, while redis cluster return a MOVED error because of master-slave switch early, it seems that the redisson didn't know the master-slave switch and continuously send Lua script command to the same server to get lock. Approximately redisson sends 150000 lock request to redis in 5 seconds with merely more than a dozen application lock request. The network traffic between the redisson server and redis server rise up to 150Mbps, then it becomes normal after restart the redisson server.The getting lock code general show below,(I just receive 10+ lock request):The network packages general show as below:
redisson keep sending lock request to redis due to redis cluster master-slave failover.i use redisson redLock in my project, i think redLock should be work in any case, below is my code,but when redis cluster code master-slave failover, redisson failed to acquire lock and keep sending acquire lock request, below is request:then send same request again and again... cluster response again...
RedissonBlockingQueue.take() returns null in case of internal error.The take() method in RedissonBlockingQueue uses Future.getNow(), which returns null if an exception occurs. In our case, we have tons of NPEs when the application is stopped.
CMI issue.
ReadWriteLock not working.Hello.I'm interested in this project. I am creating a sample project(https) using this,And I do not think readswriteLock is working properly.The error pattern is a bit different, but the example org.redission.example.ReadWriteLockExamples.java is not working properly. Version 2.10.5 does not work either.I do not know much about redis.I hope this project can be maintained.
Caused by: org.redisson.client.RedisException: ERR max number of clients reached.When I use Reentrant Lock in my application, this exception  ERR max number of clients reached occurs.Redisson version is 2.10.7, and redis version is 3.2.
Warn:"Invocation of destroy method 'close' failed on bean with name 'jCacheCacheManager'".I imported Redission in spring boot using distributedLock,but the log always show this WARN.
RedLock slow performance when one redis instance is down.According to RedLock Algorithm, Step 2 RedissonRedLock#tryLock should fail fast if redis instance is unavailable:During step 2, when setting the lock in each instance, the client uses a timeout which is small compared to the total lock auto-release time in order to acquire it. For example if the auto-release time is 10 seconds, the timeout could be in the ~ 5-50 milliseconds range. This prevents the client from remaining blocked for a long time trying to talk with a Redis node which is down: if an instance is not available, we should try to talk with the next instance ASAP.RedLock#tryLock blocks for duration equal to config.retryInterval * config.retryAttempts on each tryLock attempt.Such behavior makes business code not able to consume messages at requried rate, which in turn leads to other negative consequences.Setting config.retryAttempts=1 and config.retryInterval=50 does not work, since initial commands are not fast enough and connection establishment fails.Other timeouts doesn't seem to have relation to this issue.
CommandAsyncService blocks indefinitely [without OutOfMemoryError].Similarly to #889.throw exception.Thread indefinitely park.Using RMapCache and configure maploader to DB(oracle).Shutdown DB,3.RMapCache get operation will be blocked.
CMI with timeout blocks forever.If it's not possible to acquire a permission before timeout elapses, tryAcquire should return a boolean false.Even if the timeout elapses, the method tryAcquire keeps blocked.Steps to reproduce or test case.
Unexpected exception while processing command while taking a lock on a key.Note:Same scenario works as expected when there is no exception or error inside the try block.
RedisResponseTimeoutException at getLockedLock for read operation in "replicatedServersConfig".Hi,I'm using jcache  implementation and using AWS Redis servers in "replicatedServersConfig", i'm getting response time out exception at "getLockedLock" method. raised another issue  related to jcache.Please do the needful.Thanks,
Race condition in RedissonLock subscribing to pubsub channel.We are currently using redisson for, among other things, distributed locking. In our use case, we can have hundreds of unique fair locks being acquired many times, usually for short periods of time (~1-2 seconds).During testing, we noticed that sustained load eventually, but consistently, results in threads failing to acquire the lock. To try to pinpoint the problem, we added extra logging in various places in code path used by RedissonLock. What we found was that it sometimes took a long time for the lock to subscribe to its pubsub channel, by which point the unlock message was already published. This results in the thread waiting on entry.getLatch().tryAcquire(ttl, TimeUnit.MILLISECONDS); until failure.In other words, the sequence of events seems to be:thread 1 acquires a lock.thread 2 tries and fails to acquire the lock, initiating pubsub subscription.thread 1 releases lock (semaphore is not released since nothing is waiting on it yet!)thread 2 completes subscription connection and waits on semaphore, eventually timing out.There seem to be two places where this delay happens:Acquiring an AsyncSemaphore in  the PublishSubscribe::subscribe method.The 'await' call in RedissonLock::tryLock.Are we missing something here? It seems strange that it can take upwards of several seconds for the lock to subscribe to its pubsub channel.
redlock unlock fail.
tryLockAsync and lockAsync methods of RedissonMultiLock object get hang.No description provided.
RedissonAtomicLong.get blocks indefinitely.Stack info:Steps to reproduce or test case.Small probability and we can't reproduce, maybe related to bad network.Redisson configuration.cluster default config.
PriorityBlockingQueue doesn't release lock after reconnect on network.reconnect to network.there is a lock  name redisson_sortedset_lock:{testqueue} which dosen't release,it seem's like it can't release lock cause network boke,however it get a lock before network boke.Steps to reproduce or test case.1.run code blow.2.disconnect your network.3.wait a few minute,then reconnect your network.
spring boot started incorrectly, but unlocking can work properly.
Concurrent calls to RemoteService should not result in an exception.Concurrent calls to RemoteService should not result in an exception.Concurrent calls to RemoteService should result in an exception.Steps to reproduce or test case.Redis version.4.0.9.Redisson version.3.6.5.Redisson configuration.
Mitigating Concurrency Issues.Hi,I was wondering what the standard approach is to Mitigate possible Concurrency issues when using Redisson as a spring data source.I am working on an application that gets information from a source application and then layers updated over the top before delivering the updated information to the client.The updates in this case are built for several sources, each one has its own queue.When a new message is placed on any given queue my app reads the message from the queue, and attempts to create or update an updateObject in my redis cache.My problem stems form the fact that messages are constantly being placed on these queues and updates to the updateObject are likely to come in quick succession.Im concerned that this will lead to concurrent read write issues:I have attempted to solve this using @transactional and the RedissonTransactionManager but it doesn't seem to be halting the second messages update while the first message is still updating.Any advice would be really appreciated,Thank you.
[CRITICAL] Redisson cluster sync failed.In cluster mode when master goes down and slave becomes a master, Redisson picks up new master but failes to sync slaves. Cluster nodes synchronisation crashes (never scheduled again) with IllegalArgumentException while processing slave nodes.Redis cluster setup:Relevant stacktrace:Code path which fails with IllegalArgumentException (please note it's 3.0.0 branch):scheduleClusterChangeCheck(cfg, null); is never executed thus Redisson stops sync cluster state. Any subsequent cluster change leads to a service outage.
redission AtomicObject in debug + breakpoint mode cause a different result.version:3.5.4.At first,I delete the key,confirm the key not exist.
Possible race-condition during write operation cancellation.No description provided.
RLock.unlock method returns true if lock doesn't exist.No description provided.
RedissonLock.renewExpiration will refresh forever.If the lock key no longer exist the refresh should cease.The renewExpiration() method ignores the return value of renewExpirationAsync() and reschedules itself forever.Steps to reproduce or test case.Should be as simple as manually removing a lock entry key from redis.On a side note, another thing we noticed while looking into this is that renewExpirationAsync() does a scripted call that returns 0 or 1 depending on HEXISTS. It seems unnecessary as according to the redis docs about PEXPIRE, it does the same thing out of the box in a single command call.
RedissonSemaphore doesn't take linux machine's down into account, like RedissonLock do.when machine is down, RedissonSemaphore should release it never released.Steps to reproduce or test case.
Exception when use CMI.I'm trying to introduce RedLock algorithm in my project, I have 3 Redis nodes, and I need to lock several keys in each thread. Here is my implementation:no exception.Got exception with message: ""org.redisson.RedissonMultiLock cannot be cast to org.redisson.RedissonLock"".Steps to reproduce or test case.the root cause is this code in method tryLock(long waitTime, long leaseTime, TimeUnit unit) of class RedissonMultiLock.java:It trys to cast rLock to RedissonLock, but in my case the rLock is RedissonMultiLock. By this implementation, RedissonMultiLock actually can not group any RLock types but RedissonLock.
RedissonFairLock timeout drift.We've discovered additional conditions that produce timeout drift as originally described in #1104. To summarize the issue, we see that the timeouts in the redisson_lock_timeout sorted set created by RedissonFairLock can gradually increase over time to be hours or days in the future despite the queue only containing less than 10 threads; this condition continues until the fair wait queue empties, or one of the threads dies and the rest of the threads are forced to wait for the far in the future timeout on the dead thread to lapse (this creates a dead lock-like situation).I'll provide a PR to follow shortly with test cases and proposed changes to fix the issue. We greatly appreciate feed back on any misunderstanding of the issue described here and will do the same for feedback on the PR.The expected behavior is that which is documented in the second paragraph of 8.2 Fair Lock:All waiting threads are queued and if some thread has died then Redisson waits its return for 5 seconds. For example, if 5 threads are died for some reason then delay will be 25 seconds.As an example that replicates this documentation, given we have 7 threads trying to take one lock, we expect the redis data structures to contain roughly the following after a 7 threads try to acquire the lock once using RLock.tryLock(threadId) in order with short delays between:1) lock name of the 1st thread.2) "1".3) lock name of the 2nd thread.4) lock name of the 3rd thread.5) lock name of the 4th thread.6) lock name of the 5th thread.7) lock name of the 6th thread.8) lock name of the 7th thread.9) lock name of the 2nd thread.10) lock timeout + 5s.11) lock name of the 3rd thread.12) lock timeout + 10s.13) lock name of the 4th thread.14) lock timeout + 15s.15) lock name of the 5th thread.16) lock timeout + 20s.17) lock name of the 6th thread.18) lock timeout + 25s.19) lock name of the 7th thread.20) lock timeout + 30s.In the above we see that the 7th thread will need to wait 25s after the lock expiration (based on the lease time) until it can acquire the lock if the 1st to 6th threads die.Additionally, we expect that when a thread leaves the queue voluntarily either by wait timeout or by acquiring the lock, that timeouts adjust regardless of where the thread was in the queue. For example, if the 3rd thread in the above example left the queue via a RedissonFairLock.acquireFailedAsync call due to wait timeout, the sorted set would then be expected to be:1) lock name of the 2nd thread.2) lock timeout + 5s.3) lock name of the 4th thread.4) lock timeout + 10s.5) lock name of the 5th thread.6) lock timeout + 15s.7) lock name of the 6th thread.8)  lock timeout + 20s.9)  lock name of the 7th thread.10) lock timeout + 25s.And the 7th thread would then only need to wait 20s after the lock expiration to acquire the lock if the other threads died.In one of our usages of redisson we use the fair lock using 3-6 servers using each a single instance of Redisson running roughly the following code in one thread per server:We observe that since the work done within the locked portion of the code can take only ~100ms that the 6 server threads running this code quickly churn through the lock queue without issue, though a queue is always present since there is little time between when each thread unlocks and locks again. If we take periodic snapshots of the redisson_lock_timeout sorted set, we tend to see that the timeouts increase in increments of 5s over time until the timeouts are hours or days in the future. If one of the servers is killed, then we observe that the other servers stop doing work and are timing out trying to get the lock due to the dead server's lock holding the first position in redisson_lock_queue with a timeout in redisson_lock_timeout that may be hours or days in the future. We expect that under the case that we lose one server of 6, that the timeout values will be in the range of 10 to 35s in the future at any one time (5s lease time + 5s thread wait time * position in queue). It may be said that the above lock usage itself may be foolish, but its mostly working except for the chance of deadlock.Steps to reproduce or test case.I'll provide a PR for this issue to follow with additional test cases added to RedissonFairLockTest. However, what we started with was a modification of the testTimeoutDrift where we changed the wait time from 500ms to 3s and changed the lock holding time from 30s to 100ms (see Thread.sleep(30000)); with this test case, instead of the tryLock failing due to wait timeout, the threads are able to lock and unlock the lock quickly. The new version of the test, the test fails with a timeout drift into the futre, in a similar way that the test failed in #1104.The PR will contain other test cases with the hope that we cover all code changes and produce the expected behavior described above.We run a single redis server for use exclusively by redisson.
CMI does not work well with Read-Write block in a multi-JVM environment.Then call lock.tryLock() first, return true.Then call lock.tryLock() after the previous call has been made, now it should return false because there is a readLock under the same name.Then call lock.tryLock() first return true as expected.Then call lock.tryLock() after the previous one, now it return true i.e. have both write lock and read lock on the same ReadWriteLock.Steps to reproduce or test case.As described above.In case if this is useful information, if replace getRedLock with getMultiLock it actually works. Also if having only one JVM it also works.
Why do locks fail occasionally?Here's how I use it:But there are still high concurrency issues.Two of the same information is generated.Request to solve.thank.
if waitTime == -1 and leaseTime != -1,multiple threads get the lock at the same time.if waitTime == -1  and leaseTime != -1,multiple threads get the lock at the same time.Thank you.
@Transactional and RLock.unlock()As can be seen from the above, transaction committing occurs after the unlocking operation. Is there a possibility that other threads will have concurrent problems because the thread has been unlocked before the transaction has been submitted?I tested it with JMeter and found no concurrency problems between unlocking and committing transactions.If you know, please let me know. Thank you.
RLock unlock with a different thread that the one that locked gives: attempt to unlock lock, not locked by current thread by node id.I'm using RxJava and as a part of the sequence I use a RLock, at some point (in another process) I unlock it and if the thread to unlock is not the same as the one that blocked I get an exception (see below).I see that the lock has been done using the pool of redisson-netty, and the unlock is done by the same pool, but there are several threads in that pool, so any thread can potentially perform the unlock.That should be as simple as tryLock and unlock without having to control anything else right? Do we have to do something specific to ensure the proper behaviour?The lock gets unlocked regardless the thread that did the lock.An exception is thrown and the lock is not unlocked.
redission ScheduledFuture can not be execute after definite time.complete the ScheduledFuture after ten seconds.the schedule task above can not be executed after 10 seconds, the current thread beign blocked.Steps to reproduce or test case.using spring boot org.redisson.spring.starter.RedissonAutoConfiguration, just configure redis host and port in properties file.
when I unlock the lock, accept an exception.somebody can help me ?
CMI deadlock.Seems related to the change on #2099.We have tried to upgrade to 3.11.2 from 3.10.7 and this behavior started occurring.The FairLock acquired on high load system without lease time defined.Redisson does not handle the case of Fair lock without lease time (on high load).when many different threads are asking for the same lock key the client is stuck and no thread acquires the lock.Steps to reproduce or test case.
LockWatchdogTimeout will cause the IllegalMonitorStateException.redis version: 3.0.504.redisson version:3.11.1.setLockWatchdogTimeout will cause the IllegalMonitorStateException.
threads blocked waiting on CountDownLatch.Hello,We are facing an an issue where some threads get blocked indefinitely waiting on the CountDownLatch in CommandAsyncService.get(). Relevant section of the thread dump:The reason for why the requests aren't able to complete isn't relevant here (we are deploying redis in kubernetes, and are working through various upgrade/failure scenarios that currently can result in severed connections). However, it's strange to me that the CommandAsyncService.get() method doesn't respect timeout configuration, and simply calls l.await().Is there any way around this? Please let me know if I am misunderstanding the situation.CommandAsyncService.get() should throw an exception if the future is unable to complete within a timeout.Many threads are hanging indefinitely in the CommandAsyncService.get() method.
thread blocked at closeNodeConnections.Hi,The call to closeNodeConnection waits indefinitely on call to MasterSlaveConnectionManager.closeNodeConnections.Section from thread dump:MasterSlaveConnectionManager.closeNodeConnections should throw an timeout exception if the same is not able to complete within a configured timeout.Thread hangs indefinitely at the request.
when aquire redisson lock , that throw redis response timeout sometimes.redisson.2.2.13.when occouring this problem,the redis has not much qps.
CMI doesn't throw Exception.
CMI hangs infinitely waiting for RedissonPromise.Calls to RedissonLock.unlock() are expected to finish after the lock has been deleted from Redis.We have experienced several threads locked forever waiting inside calls to RedissonLock.unlock() in our production system within a few hours after upgrading to Redisson 3.11.4 from Redisson 3.8.0.Steps to reproduce or test case.Unfortunately I am unable to reproduce the problem on my own computer. We have however experienced it on several of our production servers within just a few hours after starting our newer version of the application with updated Redisson version. We upgraded from 3.8.0 in order to receive fixes for bug #1966 - Deadlock after Redis timeout, which we also experienced a couple of times. However right after start we have found some (29) exceptions in our logs coming from internal redisson threads:After that we were investigating issues with blocked threads by analyzing thread dumps. All stuck threads had exactly the same stack trace as below:After examining the source code of RedissonLock.java we have found that the NullPointerException occurs probably due to missing timeout object inside task:I'm not sure if it would solve the root cause why task.getTimeout() returns null, but calls to cancelExpirationRenewal method should not fail with an exception, otherwise, e.g. in RedissonLock.unlockAsync method the future will never receive a result (or a failure):Please add null check for timeout inside the ExpirationEntry object.We had to return to 3.8.0 version because of this problem. I think it is quire severe.Default configuration with sentinel servers.
Interrupted blocking methods aren't canceled.No description provided.
Reactive/Rxjava2 transaction doesn't unlock lock on rollback or commit.No description provided.
Lock expiration renewal stops working after connection error/timeout.After a connection problem during expiration renewal, if a new lock is created (with the same key), the expiration renewal should be working.If an error ocurred in the expiration renewal (ex: connection to redis timeout), it stops working for new locks.Steps to reproduce or test case.Create a Redisson lock.Force a expiration renewal timeout (ex: restarting redis-server)unlock (it will throw a exception, as expected)Create a new lock with the same key.wait for the expiration renewal time.unlock (it will throw a exception, because the expiration renewal is not working)Default, SingleServer, (LockWatchdogTimeout reduced just for testing)I believe the problem is in RedissonLock.unlockAsync method, when opStatus is null, the cancelExpirationRenewal method should be called.
RLock.unlock() results in ERR hash value is not an integer.The following code snippet will successfully create and lock RLock and will throw RedisException unlocking the lock.
Unable to remove lock automatically.The code is as follows, the lock cannot be automatically deleted, the lock will continue to live.
Unable to unlock  when thread isInterrupted.Unable to unlock when thread isInterrupted,Please,RUN it First!!!
RedissonLock fails to unsubscribe from channel when a lock is acquired.Expected behavior.The pub/sub channels that are created while trying to acquire a lock with RedissonLock should be unsubscribed when no longer needed.Actual behavior.Some pub/sub channels are still present (meaning that the client did not unsubscribe) even after some locks are no longer used (either they expired or were unlocked). These channels are never cleaned up (still present after 24h since created). The only workaround to get rid of these is to restart the client.This was observed because it caused a connection leak. When calling RedissonLock to obtain new locks this returned the error : Subscribe timeout: (7500ms). Increase 'subscriptionsPerConnection' and/or 'subscriptionConnectionPoolSize' parameters. We have increased the limits in order to have a workaround for this bug.Steps to reproduce or test case.use RedissonLock.java implementation with method lockInterruptibly(long leaseTime, TimeUnit unit) to obtain multiple locks simultaneously.use lower limits for  subscription-connection-pool-size and  subscriptions-per-connection to increase the probability to see the bug.wait until this error shows up Subscribe timeout: (7500ms). Increase 'subscriptionsPerConnection' and/or 'subscriptionConnectionPoolSize' parameters.connect to Redis server and fetch all lock keys and all pub-sub channels.if number of pub-sub channels > active locks , then the bug was reproduced.if number of pub-sub channels does not decrease at all long after locks are being created, this means that subscriptions have leaked, active long after these are no longer used in RedissonLock implementation.
tryLock(),Machines are not evenly distributed, and one server never gets the lock.Machines are not evenly distributed, and one server never gets the lock.It's going to last forever.
In a frequent job , sometime CMI can not get lock.In a spring boot 1.5.6 application , We have a new job which is running every 30 seconds and try to acquire lock to do something . In recent days the job has tried to acquire one specific lock cause of business , We found from 00:13 on Feb 24  the job can not get the lock but after 15:03 the job can get the lock again . The operation on this lock only in this job .the code on the lock as below :Thanks.
Distlock Mutual exclusion problem?1、assume a Redis cluster has a 5 master node; A , B, C ,D ,E representative node name.2、Client A  lock to A,B,C three node. lock success.3、This time B,C Node happen Network partition.4、Client B lock to D,E tow node, lock success,Satisfy N/2 + 1 ,because have A,D,E three node.5、Violation of mutual exclusion.
RedissonBoundedBlockingQueue drainTo method got infinite hung.Expected behavior.RedissonBoundedBlockingQueue drainTo method will return result.Actual behavior.RedissonBoundedBlockingQueue drainTo method got infinite hung.
RLock throws java.lang.IllegalMonitorStateException in the thread where got the lock twice.In a spring boot 1.5.6 application, We have below operations on merchant account ,In PayServiceImpl class , using spring proxy (IOC) to call payHandlerService.balanceFreeze.It seems (B) throws the exception as below.Thanks.
RedissonLock.tryLock() interrupted and keep renew lock.Expected behavior.when tryLock is interrupted, watchdog renew listener is cancelled too.Actual behavior.when tryLock is interrupted, watchdog keeps renewing lock, this makes ifinite lock.Steps to reproduce or test case.
RedissonReactiveClient getLock and getLexSortedSet is executing on different thread.So here lockk is printed as true, but redissonReactiveClient.getLexSortedSet(redisKey) cannot execute and directly goes to onErrorResume as it is executing in different thread than lock.tryLock(). I'm new to this reactive style of programming, I don't know what I'm doing wrong maybe there is a better way to lock and get the sortedset? please help.
`tryLock` in redis cluster working not properly.Expected behavior.tryLock of RLock can not return true when the lock key still exist in cluster redis.Actual behavior.Sometimes tryLock can acquire the lock key although it still exists. Moreover, the TTL of the lock key also is reset.Steps to reproduce or test case.
Thread that called tryLock stops in standby state.Hello,Running the redisServer again does not resolve the issue.In particular, Scheduler threads cause serious problems.Is there a solution?Below is the test code.This result is Thread dump.
Is tryLock() method expected to return false when redis is not available.Expected behavior.tryLock() method return false after certain time when redis is not available.Actual behavior.tryLock() method is hanging forever.Steps to reproduce or test case.when application starts, the redis server is there, then bring down the redis.local redis docker without authentication.
spring-integration unlock error when use redisson.use redisson and spring-integration.Steps to reproduce or test case.this keyCommands() retuen this OBJECT occur recursion.Maybe,we need override method unlink in RedissonConnection.
redisson lock uncontrolled release.Hi all,I am facing strange problems with Redisson lock.I use the lock without expiration - which means is that watchdog mechanism in-charge of updating the lease time of the lock in redis.Threads that are using the lock, lock it for time ranging from couple of seconds to 300 seconds or even more.The problem:sometimes when a thread(that acquired it) tries to release the lock the thread receives IllegalMonitorStateException , which means that this lock is already released.One solution was to increase the watchdog timeout - I increased it to 100 seconds and it decreased the number of errors but they still occur from time to time...I don't want to increase the timeout even more because this doesn't address the root problem.How can I solve this? is anyone else encountered this behaviour?
Using lockAsync with Scala Akka.Hi,Does lockAsync / unlockAsync and bucket async APIs work with Akka actor using Scala/Play?I am getting the exceptin below:java.lang.IllegalMonitorStateException: attempt to unlock lock, not locked by current thread by node id.Is that because of unlockAsync being triggered inside Future of lockAsync? I am using Scala converters to get Scala Futures from these APIs.If I generate my own thread ids using random long then it does work.Thanks.Rakesh.
redisson 3.13.1 Always connected to redis cluster and can not to acquire lock,but no exception.redis version:5.0.8.redisson version: 3.13.1.i have built redis cluster with six instance.and use cluster nodes to view clusters info.
redisson,The current thread does not release the lock, will hava some problems.yesterday,i test the redisson lock,i use  Apache JMeter to test the concurrency.param: thread number = 1000,  loop = 1.i found when i not release the lock .but other thread can get the lock.example:
Don't release the lock actively, there is a problem in high concurrency.yesterday,i test the redisson lock,i use  Apache JMeter to test the concurrency.param: thread number = 1000,  loop = 1.i found when i not release the lock .but other thread can get the lock.example:
RedissonFairLock deadlock.RedissonFairLock result.Only more than 100 "endLok" were printed.if use RedissonLock,it can be print all.
possible concurrent issue in RedissonLock?When running multiple threads to acquire the lock with the same name, the below error happened from time to time.Not sure if we need any concurrency control in the ExpirationEntry of RedissonLock? e.g. by simply converting the threadIds to a synchronized map, the issue got fixed in our particular case.
Thread gets stuck when trying to acquire lock via tryLock()Expected behavior.The thread should get release i.e tryLock should return false.Actual behavior.Thread gets stuck in Waiting state.Steps to reproduce or test case.This is how we are calling the tryLock and multiple threads are scheduled to call this.Some threads gets stuck at the Waiting state at tryLock.This is observed when the shards are being added (Sharding is In Progress state).  After sharding is done then Restarting the application releases the threads.
FairLock is freezed after run more than 9000 times.this is my code.the log will not print after a few minute.
Non thread-safe initialization in RedissonObjectBuilder.Spring bean created successfully.Steps to reproduce or test case.We have several spring beans that initialise in prallel.
Redisson 3.10.7 & FST 2.57 - Data is not cleared from ThraedLocal while using Serialization of FST library.When we are saving some data in redis using FST codec then data is not cleared from ThreadLocal after data saved to the redis. This is causing issue of OutOfMemory as tomcat thread's ThreadLocalMap is filled with huge data which was used while FST serialization.Detail:Main code requested for putting some data in Redis.Redisson uses FST serialization to serialize data and then stores into Redis.FSTObjectOutput which was used while serialization has stored data in ThreadLocal object and it has not cleared data from ThreadLocal after it was saved in the Redis.I can see ThreadLocalMap contains all the data which was used while FST serialization. Please see below snapshot of heap dump:Ideally it should clear the data from ThreadLocal, once the data stored in Redis.
On Reading Locks.Multithread concurrency can be unlocked successfully.Multithread concurrency with only one thread successfully unlocked.Are there any problems with the script here?When a thread finds the corresponding key, it deletes the whole key. Is it impossible for other threads to find it?Steps to reproduce or test case.
RLock unlock always throw an exception what like 'not lock by current thread'.trylock and unlock success.RLock unlock always throw an exception what like 'not lock by current thread'.Steps to reproduce or test case.According to the stack information, the underlying asynchronous unlocking may cause the unlocking to throw an exception.This phenomenon can be reproduced 100%.
lock.isHeldByCurrentThread() verification  before unlocking Exception.RLock.lock.isHeldByCurrentThread() verification  before unlocking.but sometimes exception.
A lot of threads waiting on "org.redisson.spring.data.connection.RedissonConnection.sync".When I was doing the stress test, there were more than 180 threads (like:org.redisson.spring.data.connection.RedissonConnection.write() ,OR org.redisson.spring.data.connection.RedissonConnection.read(),and org.redisson.spring.data.connection.RedissonConnection.del())waiting for "org.redisson.spring.data.connection.RedissonConnection.sync()". What is the reason for this? And how to solve it?Thank you very much!
redisson-netty thread lock.Hi,We have setup Redis cluster and populated key/values. Some Keys contain more than 2M fields. When we call getAll of RMap using redission client, it takes more than 30 mins and goes to idle state. We analyzed the thread dump and noticed the below errors. We are using redission client (3.13.1). Is this known issue with Redisson client?
Spring Data Redis connection in multi mode may cause thread hang.No description provided.
InternalThreadLocalMap memory leak.Expected behavior.Actual behavior.after long running, application gets oom.Steps to reproduce or test case.our app runs about 1 month.Redis version.cloud service, not sure.very big array(1048576 size) in each threadlocal, new array was created in old-gen and always fail.
RedissonAtomicLong#getAndSet throws NullPointerException when value does not exist yet.Expected behavior.Either no Exception (just create the value, getAndSet shoudl be able to create the value as well) or documented behaviour.Actual behavior.Null Pointer Exception, but only during first execution. Reproducible if I manually delete the value in Redis again.Steps to reproduce or test case.When the value does not exist yet, counterInDb is not null but calling getAndSet on it without checking isExists as well in the if gives me a NullPointerException at RedissonAtomicLong.java:122. This is quite confusing as.The Null Pointer Exception is from the implicit cast from Long to long, which makes it really hard to spot.There is no JavaDoc warning that this might happen.
Redisson throws RedisTimeoutException before timeout has exceeded.Redisson throws RedisTimeoutException after timeout has exceeded.There is a race condition where Redisson may throw RedisTimeoutException after retryInterval has exceeded but before timeout has exceeded (in a nutshell when there are bursts of commands, commands will timeout even if timeout hasn't passed if retry interval is set to 0).line 765 in CommandAsyncService seems suspect as it uses retry interval for the initial timeout value..Steps to reproduce or test case.
RedissonConnection#del() doesn’t participate in pipeline.We’ve been experiencing intermittent NullPointerExceptions (stacktrace at end) that appeared to be race condition. The root seems to be that del(byte[] keys...) doesn’t properly participate when a connection is pipelined.I believe the simplest reproduction is:
RedissonSessionRepository topic listeners initialization has race condition.We’ve successfully migrated to using RedissonSessionRepository for our Spring sessions, but we get intermittent NPEs right after startup. It looks like the issue is that the first listener is added before all of the topics are initialized, and the conditional matching in onMessage doesn’t go in the same order as initialization.
RedissonSession#changeSessionId expiredKey race condition.We have a number of instances of our app in production, and we’ve encountered a race condition where the same session might have changeSessionId invoked on the same session separate servers. This means one server might receive -2 from PTTL, which isn’t currently handled.
RedissonFairLock blocks indefinitely after threadWaitTimeExpiry. Expected behavior. Threads that are alive and waiting for a RedissionFairLock will always get ownership of the lock it tried to acquire.Actual behavior.When a RedissonFairLock is locked by long-running Thread T1, and other Threads (T2, ..., Tn) attempts to access the lock and waits for longer than 5 minutes (the default threadWaitTime), even when T1 releases the lock all waiting Threads T2 to Tn hang indefinitely.This is due to future threads removing "expired" threads from the Queue, when in reality these threads are still alive and waiting for the lock. These "expired" threads never receive the PUBLISH message on unlock.Steps to reproduce or test case.
Redis is disconnected for a long time, and using redisson's trylock() will cause the thread to wait all the time.Expected behavior.notify thread and return false.or throw redis disconnected exception.Actual behavior.Keep waiting.Steps to reproduce or test case.1.Run application.2.Disconnect redis.3.Execute trylock()(1)Create a thread pool.CorePoolSize:8.QueueCapacity:200.ThreadNamePrefix:cmdpAsyncExecutor-.(2)Use trylock() in a thread.for loop 10 times.4.Wait a few minutes.5.Reonnect redis.6.View thread status.View thread stack information.We found that the thread had been waiting.
TimeSeries.iterator() doesn't respect the ordering.Expected behavior.Since timeseries is a sorted collection I'd expect iterator() to respect the ordering. There's a range method which in fact returns the values in order, however it returns Mono<Collection> instead of Flux which means entire set is loaded into the memory, while I'd like to read it reactively in chunks.Actual behavior.redisson.getTimeSeries("").iterator().next().block() != redisson.first.block()Steps to reproduce or test case.add multiple elements into the timeseries collection.open a redis desktop manager or use the cli to check the elements are indeed ordered by score.call iterator() method and check the ordering.I've checked also the non-reactive version and seems to work in the same way.
Concurrency issues with RQueue::removeIf / RQueue's iterator.Expected behavior.When having one producer and at least two consumer threads (or instances of an application) I expect RQueue's removeIf(lambda) method to remove elements without negative side effects.I expect the same when using an iterator to iterate over the queue and calling remove() on the iterator.Actual behavior.There are multiple types of errors that I observed:I've seen NullPointerExceptions inside the removeIf lambda (e.g. q.removeIf(element -> element.getId().equals("id"))), where element is null (we don't add null elements to the queue).Other times removeIf does not actually remove the elements from the queue, probably because it did not find the elements in the first place.As the default implementation of removeIf uses the iterator my guess is that basically the iterator causes this issue and may not work properly when another consumer of a queue modifies the queue while it is used.Steps to reproduce or test case.I have the following test case which can be used to reproduce the issue. It uses Lombok, Awaitility and Apache's RandomStringUtils for convenience (in case you want to run it without modification). Below I will explain steps to modify the test to get different results.The test has one producer thread pushing 200 random Strings (wrapped with QueueEntry objects) and one or more consumer threads "processing" these objects (parking them in an "in-progress-queue" - which is the problematic queue).If you run the test as it is here it will fail because the "in-progress-queue" is not empty.Modifications to change the test results:Change the number of consumer threads to 1 in the line marked with (4). Now the test should pass. Change the number back to something larger than 1.Comment in the RLock and its usages marked with (1). Now the test should pass. Comment the lines out again.Comment out the removeIf(...) statement (marked with (2)) and comment in the remove(...) statement (marked with (3)) instead. Now the test should pass.Instead of using removeIf() you could also modify the test to use an iterator and remove elements with it. The results will be similar.Default single server config with JsonJacksonCodec.
Rlock not able to handle 200 concurrent requests.Hi,I was trying to use distributed lock to do some operations and here I am facing an issue - it wasn't able to handle more than 200 concurrent requests.I am using redis as single server instance for this testing and here is my code.Please advise on what to look for to handle higher concurrency and handle the required requests per second. Our target was to handle around 1k concurrent requests.
Is there any method can tell multiLock is held by current thread?In RedissonMultiLock method isHeldByCurrentThread direct throw unsupportedOperationException.
RedissonFairLock.tryLock returns with false after timeout even when lock has been released.We use RedissonFairLock in our application to synchronize across multiple threads. Whenever there are several simultaneous lock attempts on the same lock, one or more of the waiting threads always errors out with tryLock returning false after the waitTime configured, which is almost 5 mins, even though I can clearly see that the other threads that were holding the lock have long since released it.Is there a known issues with RedissonFairLock? Also, would switching to a non-fair lock help (we don't really need fairness guarantees)?Code used to obtain lock -.Redisson version being used is v3.13.6.
the lock expiration  failed when the network breaked.I have a problem ,this is code:at imeUnit.MINUTES.sleep(5), break the network,the program throw a network exception,restore the network,find the lock expiration  failed,other thread can lock the key ,is a problem?
can i use redisson with spring cloud getway and webflux.when i use redisson in spring cloud getway filter,but when i unlock this rLock report error log not locked by current thread , this rLock is not the same thread when i locked, how can i fix this problem.
RMapCacheReactive.getLock returns org.redisson.RedissonLock instead of org.redisson.api.RLockReactive.Expected behavior.RMapCacheReactive.getLock should return an instance of org.redisson.api.RLockReactive.Actual behavior.RMapCacheReactive.getLock returns an instance of org.redisson.RedissonLock and throws exception:Steps to reproduce or test case.
Redisson 3.12.5 unlock hang forever.redisson version:3.12.5.redis version:5.0.7.redis cluster mode: 3 master 3 slave deployed in vm.question descript:In my production environment, a thread(dubheTaskExecutor-pool-2-thread-836) hangs up forever  whe invokes RedissonLock.unlock() . And I never found any error  in my application log. I am desired to find out if is a bug in redisson 3.12.5.The thread dump file is below(core part) :
internal RedissonBaseLock.evalWriteAsync() method isn't executed again if cluster slaves amount > 0.Expected behavior.Actual behavior.Steps to reproduce or test case.Redis version.Redisson version.Redisson configuration.
RedissonBaseLock can't be unlocked if exception got thrown from the same thread.RedissonBaseLock.java:312.opStatus is always null:RedissonPromise.java:183  (status of netty's Future is canceled due to Exception thrown from the same thread)I'm experience it permanently.At a first glance (if i'm not mistaken) this is a Blocker  level issue.RedissonPromise.java:187:Same behavior if Exception got thrown too early, such that f.getNow() results null.
Failed to cancel scheduled tasks and blocked threads.Expected behavior.Normal mission cancellation.Actual behavior.Failed to cancel the task and blocked the thread.Steps to reproduce or test case.When canceling a timed task, if the task is running, there is a chance that the task will not be canceled. If we use synchronous method to cancel the task, it will cause the current thread to block permanently, and the actual analysis shows that it will be in the scheduleCheck method.
There may be concurrency problems in org.redisson.RedissonLock#tryLockInnerAsync.if two thread get the same lock subject and run the method at same time, one's leaseTime is -1, and another's leaseTime is bigger than 30, the "-1" thread first cam in and set internalLockLeaseTime, then another thread came in set the internalLockLeaseTime bigger than 30, then if the bigger leaseTime one get the real redis lock! It while cause watchDog invaild and the lock be expired ahead of time.
Thread lock starvation with RSemaphore on high concurrency with hundreds of locks.We (@cstamas and me) are currently trying to integrate Redisson into Apache Maven Resolver. The purpose is to synchronize access to the Maven local repository across multiple processes. In our tests we experience a constant thread stravation where a write lock cannot be obtained in time, but tens of other threads are given access with RSemaphore. I assumed that we are having the same problem as in #1763, but the fiddling with config options did not work out. The lock is a hot path in dependency resolution.The amount of locks is around 500 accessed by around 100 Maven modules from 48 threads (T4C on a 12-core Xeon processor).Here is a sample condensed overview of semaphore permit acquisition and release:I can provide full debug output, actual source code (see PR), pre-compiled Maven distro and the sample project which almost always fails for me. Help would be very appreciated because I am at my wit's end.Note: The following lock types work flawlessly with the same project: rwlock-redisson (RReadWriteLock), semaphore-local (Semaphore) and rwlock-local (ReentrantReadWriteLock).
Async lock thread affinity.Hi,I'm working on a kotlin micronaut web app which is attempting to be fully async and we're using redisson for distributed locks.I'm somewhat unclear on how to exactly use it correctly.The official documentation says RLock object behaves according to the Java Lock specification. It means only lock owner thread can unlock it otherwise IllegalMonitorStateException would be thrown. Otherwise consider to use RSemaphore object. which sounds weird as in an async context, executing on a specific threads is never guaranteed.The code I'm using for now, in a kotlin suspendable func, is like this:The unlock line is not guaranteed to execute on the same thread as the lockAsync line.Thanks!
RLockReactive fail to unlock when subscribe to tryLock(Thread ID)RLockReactive fail to unlock with RedissonShutdownException when un lock it at the end of the reactive sequence with doFinally() or with then() operators. When testing it with StepVerifier the unlock is complete sucessfully but fail with subscribe().Example:
Trylock causes a deadlock, System restart can be unlocked.
RExecutorService does not work,block at future.get()redis_version:6.0.2.code.
Redisson renewExpiration not working after redis lock expires.Expected behavior.After a lock is expired or removed on Redis-Server a new lock should be created with renewalExpiration renewing TTL of a lock.Actual behavior.A new lock is created , but for some reason this new lock do not call renewExpiration but add this ThreadId to a map and  I dom't figure it out how it uses this map to renewal.On this specific case I was trying to use the same thread to reaquire this log,  I tried with a new thread but the result was the same.If I restart the applications, as this map is empty  the ttl renewal works as spected.Steps to reproduce or test case.Set a HIgh watchdog (30s) aquire a lock expire it manually on server. Aquire it on the same application.
Redis renewExpiration  ttl problem.Expected behavior.Allways renew the ttl key .Actual behavior.after looses a lock and try to aquire it again, sometimes the renewal feature doesn't work as it supposed.Steps to reproduce or test case.To reproduce it I had to use debug stop the execution before this call.with redis client remove the key.Then release the flow.if the key does'nt exists the renewal doesn't fire for this specific key, and it's everything ok.So my code aquire this lock again since it's not the owner, and everything seems to work except that it doesn't renew the ttl key lock because of this.In my point of view if you add.cancelExpirationRenewal(threadId)when the renewal fails , it solves the problem.
Thread lock starvation with RSemaphore on high concurrency with hundreds of locks (2)This is a followup to #3573. We have now received the first user feedback from @jebeaudet which exhibits the same behavior as in the previous issue.We have tried with Maven 3.8.x from the maven-3.8.x and Resolver 1.7.1 with Redisson's RSemaphore. Several runs observe the same behavior. One thread tries to acquire a lock which is not held by anyone else and after the time is up (30 s) no lock is obtained. @jebeaudet privately provided me log files of those builds and I have distilled the lock workflows from it. Here is a sample:The write lock artifact:ch.qos.logback:logback-classic:1.2.3 is not held by someone, yet it fails. I can provide several SQLite databases which contain raw imported data, prepared data as well as joined by lock workflows/transitions. The thread dump of a hanging build looks always the same:Nothing, but localhost....PS: There is a similar issue with RReadWriteLock, but I will report this seperately.
FairLock deadlock again.Expected behavior.redisson_lock_queue and redisson_lock_timeout keys disappear once the lock that was taken by the first thread is timed out automatically after lock lease time, and then the second thread successfully takes the lock.Actual behavior.Sometimes, even though the lock from the first thread is timed out and released automatically, the redisson_lock_queue and redisson_lock_timeout keys are stuck and the second thread can't acquire the lock, even though nobody is holding it. The second thread is stuck for full acquisition timeout. Then, it fails to get the lock eventually, and keys redisson_lock_queue and redisson_lock_timeout disappear, making the lock available again. Feels like lock expiry notification gets lost and Redisson waits for nothing. P.S. In this regard, would be great to have FairSpinLock not to rely on pubsub.Related? #2883.Steps to reproduce or test case.1 redis, 1 sentinel.
redis lock not working as expected.I have the following test scenario:My expectation is the following: if the lock couldn't be acquired in 1s  then it should show Failed to acquire lock. If the lock is acquired then, in 30s, it should be automatically released by Redis (this 30s are very important as I only need to allow another run after this time). Only one should should be acquired in 30s. The problem is that most of the times I get multiple Lock acquired between 30s intervals.The code launches 1000 parallel execution tasks. Since Redis is (mostly) single threaded then I wasn't expecting any concurrency problems (and I'm pretty sure they aren't on the Redis side). I am also using a single node Redis.I have also tried another solution using Zookeeper Leader Election and that one works as expected using the same caller function. It acquired a single lock at a time.Am I doing something wrong here are we having a Redisson issue?
Different effects when Mix using of multiLock and Lock.version:redisson-3.14.1.When try to using both multiLock and Lock with same key.There are different effects according to the lock order.When lock lock1 first ,then lock multiLock1.multiLock1 stun for a few seconds and then, lock success(lock1 are not released)When lock multiLock1 first ,then lock lock1.lock1 are stoped and waitting for the multiLock to release.it's confused.
RedissonKeys.Delete() method pass empty array will block the thread in redis cluster.Expected behavior.Exception throws like single redis server.Actual behavior.In cluster mode, this method will block the thread and no exception throws.Steps to reproduce or test case.
RedissonLock Perhaps leak.The tryLock(long waitTime, long leaseTime, TimeUnit unit) method, if the subscribe timeout, and then subscribeFuture.cancel success,when to call unsubscribe , the subscribeFuture.onComplete should move out ,before the if block.
RedissonFairLock does not automatically clear non-running LockName and non-reference lock methods after a restart and cannot be automatically renewed.Expected behavior.Actual behavior.Production environment with a large number of requests queued.At around 19:23 on the night of September 9, due to the existence of a large Key in the store, after submitting a work order to delete the large Key, there was still an imbalance of data in the cluster slice, and the DBA tried to perform a memory analysis of the cluster, resulting in a Redis slice switch and the loss of some of the Keys.Redisson's unlock mechanism will go to determine the LockKey Delete state, if Delete succeeds then publish a message to notify other clients subscribed to this lock to compete for the lock, if Delete fails then there is no message notification (Delete is a failure state when Key does not exist), thus causing the clients subscribed to the lock to wait until the thread wait timeout time (default is 5 minutes) to compete for the lock again.Steps to reproduce or test case.Creating a large number of concurrent requests for locks.The business processing request time to obtain the lock is set longer than 30s.If thread A acquires the lock and manually deletes the key of the lock, i.e. RawName.Observing other threads acquiring locks, you will find that you need to wait a long time to get the lock, and after restarting the main method of Test, you cannot empty the last waiting queue, but can only wait for the default 5 minutes to clear the non-running state LockName(id:ThreadId)1. RedissonFairLock.lock will not automatically renew.
RLockReactive tryLock waits longer than waitTime.Expected behavior.long id = Thread.currentThread().getId();... lock.tryLock(0, 10, TimeUnit.SECONDS, id) ...Expect this to exit immediately - reporting "true" if it can get the lock now ; and reporting "false" if it can not.Actual behavior.It seems to block and wait until the lock becomes available.The waitTime (set as 0 above) does not seem to influence the behaviour.Steps to reproduce or test case.Invoke "lock.tryLock(0, 10, TimeUnit.SECONDS, id)", when the lock is already taken.Expect it to instantly return with "false". It does not.((Note: I am working inside Quarkus, and using "reactor.core.publisher.Mono" to convert the Redisson Reactive Core (Mono) into Mutiny (Uni) - this does not seem related ; but it makes it harder for me to frame a pure-Redission test case))
Redisson getLock operation does not respect timeout.Expected behavior.Redisson getLock timeouts after timeout.Actual behavior.Redisson getLock timeouts after timeout + 1 second.
org.redisson.client.RedisResponseTimeoutException: Redis server response timeout when use RLock.My Redis don't use cluster just only one node address.I used RLock for locking but was not successful because of Redis timeout. I restarted the service, it worked but it's not the best way in the production stage.I referred to the same issue about Redis timeout such as an increased nettyThreads or timeout config but it's not successful.
Concurrent attempt to RReadWriteLock writeLock leaves thread in blocked state after lock is released.Two Threads, thread-1 and thread-2 attempt to acquire a RReadWriteLock.writeLock() using lock().  thread-1 gets the lock, thread-2 waits for lock to be released.  thread-1 releases lock, thread-2 acquires lock.When thread-1 releases lock (using unlock()), thread-2 does not acquire lock.  Wait for lock expires after 35 seconds.2 threads call lock() on the same RReadWriteLock at or near the same time.thread that gets the lock release the lock (after a second or two).Note that thread-2 doesn't automatically get the released lock..Redisson version 3.16.3.
Stuck on joining HashedWheelTimer worker thread when shutting down.Sometimes Redisson seems to be stuck when calling Redisson.shutdown(). Some Services are stuck for mutliple days. But it seems to be a very rare event,This is the Thread netty tries to join. Stack trace does not seem to change over time (took multiple thread dumps)Expected behavior.Redisson.shutdown() should be blocking but not for ever.Actual behavior.Redisson.shutdown() is stuck for days (in some rare cases) and the Timer thread is taking huge amounts of processing power (this is not a typical profiler bug with parking threads but acutally showing in the process list)Steps to reproduce or test case.Not tried but maybe if you could point us in a direction.
Got a NullPointerException in WriteReadLock.the redis model is cluster.
Error while aquiring ReadWriteLock and Lock at the same time.When I call method runWithRwLock and method runWithMultiLock at same time, it works fine. When I call method runWithLock and method runWithRwLock/runWithMultiLock, the following error is frequently reported.This is my test code:
Error while acquire Lock and ReadLock.Steps to reproduce or test case.Let me simplify the reproduce process:Thread x get Lock "A" and hold the Lock.Thread y get ReadLock "A" and also hold the ReadLock.Thread x and thread y all acquired lock.Thread y call method unlock to release ReadLock y.After a few seconds, thread x also call method unlock to release Lock x,and then it causes an exception.Here is stacktrace.
multilock fail.Expected behavior.lock successful.Actual behavior.lock fail when get first lock in multi lock case.Steps to reproduce or test case.when I set waitTime=0in multi lock , it fail, but I set waitTime=0 in RLock, it success, why?then , debug RedissonMultiLock,  until Line 413.I think it is a bug in RedissonMultiLock.
multi lock fail.Expected behavior.lock successful.Actual behavior.lock fail when get first lock in multi lock case.Steps to reproduce or test case.when I set waitTime=0in multi lock , it fail, but I set waitTime=0 in RLock, it success, why?then , debug RedissonMultiLock,  until Line 413.I think it is a bug in RedissonMultiLock.
MultiLock causes deadlocks in high concurrency cases.Expected behavior.No DeadLock.Actual behavior.DeadLock.Steps to reproduce or test case.The complete code is as follows.Deadlocks don't happen every time. After running the program for a while, I found that the process stopped and the keys in redis were fixed, not added or reduced. What is even more strange is that the expiration time I added the lock is 800ms, and if I use the ttl command to get the expiration time, the result should be 0 or 1, or a negative number. But, I found a number greater than 1! And it keeps changing, like this: 4s -> 3s -> 2s -> 4s.
Thread safe problem when acquiring locks resulting in a pubsub channel not being unsubscribed · 64 ·.This seems to be related to:  #2575.Expected behavior.The pub/sub channels that are created while trying to acquire a lock with RedissonLock should be unsubscribed when no longer needed.Actual behavior.In some cases when 2 pub sub channels are created around the same time for (2 different lock keys) one of the two throws an error:Subscribe timeout: (7500ms). Increase 'subscriptionsPerConnection' and/or 'subscriptionConnectionPoolSize' parameters.After this error the failed lock key will lock fine when not locked. If it is however locked by another thread it will fail instantly.see the logging from the test case below, notice how thread [pool-1-thread-12] successfully locks key 0. When thread [pool-1-thread-19] tries to lock lockkey-0  it instantly throws the subscribe timeout exception (notice it does not wait 7500ms).If there is no locking going on and the app is still running it kept a channel active for lockkey-0.Some logging from the test case when it fails:
ERR WAIT cannot be used with slave instances.This occurs when trying to acquire a lock.Currently, we are using redisson library 3.16.3 with readmode: SLAVE.
Redisson : Issue while unlock lock for a key ,  attempt to unlock lock, not locked by current thread.Hi, I am getting below errors in my logs.I am using below dependency for redisson:And I've implemented a wrapper that will acquire and release the lock:But the log "Released lock for key" is logged rarely. The task after acquiring the lock gets finished within 1 or 2 seconds and the wait and lease time are 5 and 15 secs respectively.RedisConfig is :We have redis server in Kubernetes cluster with 2 pod instances both as master.Would appreciate any suggestions?
response timeout in a job lead to deadlock.redisson version: 3.9.0.action:creating a thread makes a job every 5 seconds.job acquire fairlock  trylock(10, 10, timeunit.seconds)redis busy or bad network, response timeout(default 3s)5s, this instance will reentrance  lock.other intance will not acquire lock.suggestion:when redis response timeout , should redisson release the lock?
Unable to Acquire Fair Lock.In my code, I am trying to acquire a fair lock with a fixed waitTime and leaseTime as so.fairLock.tryLockAsync(waitTime, leaseTime, timeUnit, ID)Sometimes, all the requests will get queued up for apparently no reason, while no request has acquired the lock.I can see a wait queue being formed for the lock, but the actual lock is not held by anyone.Eventually, all of these waiting requests will time out and fail, and new requests will work fine.This seems to happen randomly when there are a lot of simultaneous requests.I am not able to reproduce this locally.
when i set waitTime=0 in multi lock, it fail.about issue#4033,I don't need to wait,so i set waittime=0,but the result is failure,why Rlock set waittime=0 result is successful?i need get the lock fail,end business at once.see source code,when waitime=0,leaseTime assignment zero.Expected behavior.Actual behavior.Steps to reproduce or test case.
Only one thread can get lock after unlock timeout.I have an annotation RLock which works with an aspect, it work well in some programs.Here is the codes:Someday a program throws Exception at every tryLock in two of three containers. I checked ELK and find RedisTimeoutException before the first exception.By the way, every container works with only one thread to consume kafka messages.It seems taht  the first RLock unlock timeout and then redisson treats next RLocks as reentrant cause they have the same thread Id.How to ensure that the lock could be released correctly after unlock timeout.
isHeldByCurrentThread() goes wrong.
CMI doesn't work.and i found it will consume 16 thread once instead of 5.